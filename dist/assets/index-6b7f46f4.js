(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const O of document.querySelectorAll('link[rel="modulepreload"]'))k(O);new MutationObserver(O=>{for(const Q of O)if(Q.type==="childList")for(const ae of Q.addedNodes)ae.tagName==="LINK"&&ae.rel==="modulepreload"&&k(ae)}).observe(document,{childList:!0,subtree:!0});function x(O){const Q={};return O.integrity&&(Q.integrity=O.integrity),O.referrerpolicy&&(Q.referrerPolicy=O.referrerpolicy),O.crossorigin==="use-credentials"?Q.credentials="include":O.crossorigin==="anonymous"?Q.credentials="omit":Q.credentials="same-origin",Q}function k(O){if(O.ep)return;O.ep=!0;const Q=x(O);fetch(O.href,Q)}})();var E0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pd={},S0={get exports(){return pd},set exports(E){pd=E}};(function(E,y){(function(x,k){E.exports=k()})(E0,function(){var x,k,O;function Q(o,re){if(!x)x=re;else if(!k)k=re;else{var Ce="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+x+")(sharedChunk); ("+k+")(sharedChunk); self.onerror = null;",Xe={};x(Xe),O=re(Xe),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(O.workerUrl=window.URL.createObjectURL(new Blob([Ce],{type:"text/javascript"})))}}Q(["exports"],function(o){var re=typeof self<"u"?self:{},Ce="2.12.1";let Xe;const Ge={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Xe==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Xe={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{Xe=t}}return Xe},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},We={supported:!1,testSupport:function(t){!Ft&&Ze&&(Ct?rt(t):Ve=t)}};let Ve,Ze,Ft=!1,Ct=!1;function rt(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ze),t.isContextLost())return;We.supported=!0}catch{}t.deleteTexture(e),Ft=!0}re.document&&(Ze=re.document.createElement("img"),Ze.onload=function(){Ve&&rt(Ve),Ve=null,Ct=!0},Ze.onerror=function(){Ft=!0,Ve=null},Ze.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ne="01";var at=St;function St(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}St.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var a=this.sampleCurveX(i)-t;if(Math.abs(a)<e)return i;var c=this.sampleCurveDerivativeX(i);if(Math.abs(c)<1e-6)break;i-=a/c}var h=0,d=1;for(i=t,n=0;n<20&&(a=this.sampleCurveX(i),!(Math.abs(a-t)<e));n++)t>a?h=i:d=i,i=.5*(d-h)+h;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Se=dt;function dt(t,e){this.x=t,this.y=e}dt.prototype={clone:function(){return new dt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),a=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},dt.convert=function(t){return t instanceof dt?t:Array.isArray(t)?new dt(t[0],t[1]):t};const Pi=Math.PI/180,kt=180/Math.PI;function gt(t){return t*Pi}function ei(t){return t*kt}const rr=[[0,0],[1,0],[1,1],[0,1]];function Tr(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function ii(t,e,i,n){const a=new at(t,e,i,n);return function(c){return a.solve(c)}}const ji=ii(.25,.1,.25,1);function Tt(t,e,i){return Math.min(i,Math.max(e,t))}function Wi(t,e,i){return(i=Tt((i-t)/(e-t),0,1))*i*(3-2*i)}function fr(t,e,i){const n=i-e,a=((t-e)%n+n)%n+e;return a===e?i:a}function Mr(t,e,i){if(!t.length)return i(null,[]);let n=t.length;const a=new Array(t.length);let c=null;t.forEach((h,d)=>{e(h,(m,_)=>{m&&(c=m),a[d]=_,--n==0&&i(c,a)})})}function Si(t){const e=[];for(const i in t)e.push(t[i]);return e}function Ye(t,...e){for(const i of e)for(const n in i)t[n]=i[n];return t}let ft=1;function Ot(){return ft++}function Ut(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Gt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ti(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function gi(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function ri(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Ii(t,e,i){const n={};for(const a in t)n[a]=e.call(i||this,t[a],a,t);return n}function Ai(t,e,i){const n={};for(const a in t)e.call(i||this,t[a],a,t)&&(n[a]=t[a]);return n}function Mi(t){return Array.isArray(t)?t.map(Mi):typeof t=="object"&&t?Ii(t,Mi):t}const Oi={};function $t(t){Oi[t]||(typeof console<"u"&&console.warn(t),Oi[t]=!0)}function Ci(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function It(t){let e=0;for(let i,n,a=0,c=t.length,h=c-1;a<c;h=a++)i=t[a],n=t[h],e+=(n.x-i.x)*(i.y+n.y);return e}function qi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function sn(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,n,a,c)=>{const h=a||c;return e[n]=!h||h.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let an=null;function po(t){if(an==null){const e=t.navigator?t.navigator.userAgent:null;an=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return an}function Qo(t){try{const e=re[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function vn(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Hs="mapbox-tiles";let cr,bn,fo=500,es=50;function mo(){try{return re.caches}catch{}}function wn(){mo()&&!cr&&(cr=re.caches.open(Hs))}function ts(t){const e=t.indexOf("?");if(e<0)return t;const i=function(a){const c=a.indexOf("?");return c>0?a.slice(c+1).split("&"):[]}(t),n=i.filter(a=>{const c=a.split("=");return c[0]==="language"||c[0]==="worldview"});return n.length?`${t.slice(0,e)}?${n.join("&")}`:t.slice(0,e)}let _o=1/0;const Er={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Er);class is extends Error{constructor(e,i,n){i===401&&bo(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const go=qi()?()=>self.worker&&self.worker.referrer:()=>(re.location.protocol==="blob:"?re.parent:re).location.href,Tn=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(go())&&!/^\w+:/.test(i))){if(re.fetch&&re.Request&&re.AbortController&&re.Request.prototype.hasOwnProperty("signal"))return function(n,a){const c=new re.AbortController,h=new re.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:go(),signal:c.signal});let d=!1,m=!1;const _=(b=h.url).indexOf("sku=")>0&&bo(b);var b;n.type==="json"&&h.headers.set("Accept","application/json");const T=(M,C,D)=>{if(m)return;if(M&&M.message!=="SecurityError"&&$t(M),C&&D)return S(C);const B=Date.now();re.fetch(h).then(H=>{if(H.ok){const ee=_?H.clone():null;return S(H,ee,B)}return a(new is(H.statusText,H.status,n.url))}).catch(H=>{H.code!==20&&a(new Error(H.message))})},S=(M,C,D)=>{(n.type==="arrayBuffer"?M.arrayBuffer():n.type==="json"?M.json():M.text()).then(B=>{m||(C&&D&&function(H,ee,W){if(wn(),!cr)return;const J={status:ee.status,statusText:ee.statusText,headers:new re.Headers};ee.headers.forEach((ye,ge)=>J.headers.set(ge,ye));const ne=sn(ee.headers.get("Cache-Control")||"");if(ne["no-store"])return;ne["max-age"]&&J.headers.set("Expires",new Date(W+1e3*ne["max-age"]).toUTCString());const te=J.headers.get("Expires");te&&(new Date(te).getTime()-W<42e4||function(ye,ge){if(bn===void 0)try{new Response(new ReadableStream),bn=!0}catch{bn=!1}bn?ge(ye.body):ye.blob().then(ge)}(ee,ye=>{const ge=new re.Response(ye,J);wn(),cr&&cr.then(Ie=>Ie.put(ts(H.url),ge)).catch(Ie=>$t(Ie.message))}))}(h,C,D),d=!0,a(null,B,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch(B=>{m||a(new Error(B.message))})};return _?function(M,C){if(wn(),!cr)return C(null);const D=ts(M.url);cr.then(B=>{B.match(D).then(H=>{const ee=function(W){if(!W)return!1;const J=new Date(W.headers.get("Expires")||0),ne=sn(W.headers.get("Cache-Control")||"");return J>Date.now()&&!ne["no-cache"]}(H);B.delete(D),ee&&B.put(D,H.clone()),C(null,H,ee)}).catch(C)}).catch(C)}(h,T):T(null,null),{cancel:()=>{m=!0,d||c.abort()}}}(t,e);if(qi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(n,a){const c=new re.XMLHttpRequest;c.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const h in n.headers)c.setRequestHeader(h,n.headers[h]);return n.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=n.credentials==="include",c.onerror=()=>{a(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let h=c.response;if(n.type==="json")try{h=JSON.parse(c.response)}catch(d){return a(d)}a(null,h,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else a(new is(c.statusText,c.status,n.url))},c.send(n.body),{cancel:()=>c.abort()}}(t,e)},En=function(t,e){return Tn(Ye(t,{type:"arrayBuffer"}),e)};function rs(t){const e=re.document.createElement("a");return e.href=t,e.protocol===re.document.location.protocol&&e.host===re.document.location.host}const Ys="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let yo,Sn;yo=[],Sn=0;const xo=function(t,e){if(We.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Sn>=Ge.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return yo.push(c),c}Sn++;let i=!1;const n=()=>{if(!i)for(i=!0,Sn--;yo.length&&Sn<Ge.MAX_PARALLEL_IMAGE_REQUESTS;){const c=yo.shift(),{requestParameters:h,callback:d,cancelled:m}=c;m||(c.cancel=xo(h,d).cancel)}},a=En(t,(c,h,d,m)=>{n(),c?e(c):h&&(re.createImageBitmap?function(_,b){const T=new re.Blob([new Uint8Array(_)],{type:"image/png"});re.createImageBitmap(T).then(S=>{b(null,S)}).catch(S=>{b(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(_,b)=>e(_,b,d,m)):function(_,b){const T=new re.Image,S=re.URL;T.onload=()=>{b(null,T),S.revokeObjectURL(T.src),T.onload=null,re.requestAnimationFrame(()=>{T.src=Ys})},T.onerror=()=>b(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new re.Blob([new Uint8Array(_)],{type:"image/png"});T.src=_.byteLength?S.createObjectURL(M):Ys}(h,(_,b)=>e(_,b,d,m)))});return{cancel:()=>{a.cancel(),n()}}},vo="NO_ACCESS_TOKEN";function Fr(t){return t.indexOf("mapbox:")===0}function bo(t){return Ge.API_URL_REGEX.test(t)}function Ks(t){return Ge.API_CDN_URL_REGEX.test(t)}function wo(t){return Ge.API_STYLE_REGEX.test(t)&&!qn(t)}function qn(t){return Ge.API_SPRITE_REGEX.test(t)}const To=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ur(t){const e=t.match(To);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function In(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function ns(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(re.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Z{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=ns(Ge.ACCESS_TOKEN);let n="";return n=i&&i.u?re.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(Number("0x"+c)))):Ge.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=Qo("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const a=re.localStorage.getItem(i);a&&(this.eventData=JSON.parse(a));const c=re.localStorage.getItem(n);c&&(this.anonId=c)}catch{$t("Unable to read from LocalStorage")}}saveEventData(){const e=Qo("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{re.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&re.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{$t("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,n,a){if(!Ge.EVENTS_URL)return;const c=Ur(Ge.EVENTS_URL);c.params.push(`access_token=${a||Ge.ACCESS_TOKEN||""}`);const h={event:this.type,created:new Date(e).toISOString()},d=i?Ye(h,i):h,m={url:In(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([d])};this.pendingRequest=function(_,b){return Tn(Ye(_,{method:"POST"}),b)}(m,_=>{this.pendingRequest=null,n(_),this.saveEventData(),this.processRequests(a)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const z=new class extends Z{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Ge.EVENTS_URL&&Ge.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>Fr(i)||bo(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ns(Ge.ACCESS_TOKEN),i=e?e.u:Ge.ACCESS_TOKEN;let n=i!==this.eventData.tokenU;ti(this.anonId)||(this.anonId=Ut(),n=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),h=new Date(a),d=(a-this.eventData.lastSuccess)/864e5;n=n||d>=1||d<-1||c.getDate()!==h.getDate()}else n=!0;n?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ce,skuId:Ne,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=a,this.eventData.tokenU=i)},t):this.processRequests()}},L=z.postTurnstileEvent.bind(z),q=new class extends Z{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,n){this.skuToken=e,this.errorCb=n,Ge.EVENTS_URL&&(i||Ge.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(vo)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ti(this.anonId)||(this.anonId=Ut()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ce,skuId:Ne,skuToken:this.skuToken,userId:this.anonId},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t))}},K=q.postMapLoadEvent.bind(q),se=new class extends Z{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Ge.EVENTS_URL&&(t||Ge.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),n=function(a){const c=re.performance.getEntriesByType("resource"),h=re.performance.getEntriesByType("mark"),d=function(S){const M={};if(S){for(const C in S)if(C!=="other")for(const D of S[C]){const B=`${C}ResolveRangeMin`,H=`${C}ResolveRangeMax`,ee=`${C}RequestCount`,W=`${C}RequestCachedCount`;M[B]=Math.min(M[B]||1/0,D.startTime),M[H]=Math.max(M[H]||-1/0,D.responseEnd);const J=ne=>{M[ne]===void 0&&(M[ne]=0),++M[ne]};D.transferSize!==void 0&&D.transferSize===0&&J(W),J(ee)}}return M}(function(S,M){const C={};if(S)for(const D of S){const B=M(D);C[B]===void 0&&(C[B]=[]),C[B].push(D)}return C}(c,Be)),m=re.devicePixelRatio,_=re.navigator.connection||re.navigator.mozConnection||re.navigator.webkitConnection,b={counters:[],metadata:[],attributes:[]},T=(S,M,C)=>{C!=null&&S.push({name:M,value:C.toString()})};for(const S in d)T(b.counters,S,d[S]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(T(b.counters,"interactionRangeMin",a.interactionRange[0]),T(b.counters,"interactionRangeMax",a.interactionRange[1])),h)for(const S of Object.keys(De)){const M=De[S],C=h.find(D=>D.name===M);C&&T(b.counters,M,C.startTime)}return T(b.counters,"visibilityHidden",a.visibilityHidden),T(b.attributes,"style",function(S){if(S)for(const M of S){const C=M.name.split("?")[0];if(wo(C)){const D=C.split("/").slice(-2);if(D.length===2)return`mapbox://styles/${D[0]}/${D[1]}`}}}(c)),T(b.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),T(b.attributes,"fogEnabled",a.fogEnabled?"true":"false"),T(b.attributes,"projection",a.projection),T(b.attributes,"zoom",a.zoom),T(b.metadata,"devicePixelRatio",m),T(b.metadata,"connectionEffectiveType",_?_.effectiveType:void 0),T(b.metadata,"navigatorUserAgent",re.navigator.userAgent),T(b.metadata,"screenWidth",re.screen.width),T(b.metadata,"screenHeight",re.screen.height),T(b.metadata,"windowWidth",re.innerWidth),T(b.metadata,"windowHeight",re.innerHeight),T(b.metadata,"mapWidth",a.width/m),T(b.metadata,"mapHeight",a.height/m),T(b.metadata,"webglRenderer",a.renderer),T(b.metadata,"webglVendor",a.vendor),T(b.metadata,"sdkVersion",Ce),T(b.metadata,"sdkIdentifier","mapbox-gl-js"),b}(i);for(const a of n.metadata);for(const a of n.counters);for(const a of n.attributes);this.postEvent(e,n,()=>{},t)}},de=se.postPerformanceEvent.bind(se),pe=new class extends Z{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,n){if(!Ge.API_URL||!Ge.SESSION_PATH)return;const a=Ur(Ge.API_URL+Ge.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${n||Ge.ACCESS_TOKEN||""}`);const c={url:In(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(h,d){return Tn(Ye(h,{method:"GET"}),d)}(c,h=>{this.pendingRequest=null,i(h),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,i,n){this.skuToken=e,this.errorCb=n,Ge.SESSION_PATH&&Ge.API_URL&&(i||Ge.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(vo)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t)}},le=pe.getSessionAPI.bind(pe),me=new Set,De={create:"create",load:"load",fullLoad:"fullLoad"},Ke={mark(t){re.performance.mark(t)},measure(t,e,i){re.performance.measure(t,e,i)}};function Be(t){const e=t.name.split("?")[0];return Ks(e)&&e.includes("mapbox-gl.js")?"javascript":Ks(e)&&e.includes("mapbox-gl.css")?"css":function(i){return Ge.API_FONTS_REGEX.test(i)}(e)?"fontRange":qn(e)?"sprite":wo(e)?"style":function(i){return Ge.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const mt=re.performance;function pt(t){const e=t?t.url.toString():void 0;return mt.getEntriesByName(e)}let lt,wt,Dt,Kt;const ct={now:()=>Dt!==void 0?Dt:re.performance.now(),setNow(t){Dt=t},restoreNow(){Dt=void 0},frame(t){const e=re.requestAnimationFrame(t);return{cancel:()=>re.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:n}=t;Kt||(Kt=re.document.createElement("canvas"));const a=Kt.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>Kt.width||n>Kt.height)&&(Kt.width=i,Kt.height=n),a.clearRect(-e,-e,i+2*e,n+2*e),a.drawImage(t,0,0,i,n),a.getImageData(-e,-e,i+2*e,n+2*e)},resolveURL:t=>(lt||(lt=re.document.createElement("a")),lt.href=t,lt.href),get devicePixelRatio(){return re.devicePixelRatio},get prefersReducedMotion(){return!!re.matchMedia&&(wt==null&&(wt=re.matchMedia("(prefers-reduced-motion: reduce)")),wt.matches)}};function hi(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function yi(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);n!==-1&&i[t].splice(n,1)}}class qr{constructor(e,i={}){Ye(this,i),this.type=e}}class An extends qr{constructor(e,i={}){super("error",Ye({error:e},i))}}class Cr{on(e,i){return this._listeners=this._listeners||{},hi(e,i,this._listeners),this}off(e,i){return yi(e,i,this._listeners),yi(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},hi(e,i,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,i){typeof e=="string"&&(e=new qr(e,i||{}));const n=e.type;if(this.listens(n)){e.target=this;const a=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const d of a)d.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const d of c)yi(n,d,this._oneTimeListeners),d.call(this,e);const h=this._eventedParent;h&&(Ye(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof An&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Me=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ln(t,...e){for(const i of e)for(const n in i)t[n]=i[n];return t}function Ni(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function cn(t){if(Array.isArray(t))return t.map(cn);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=cn(t[i]);return e}return Ni(t)}class Lh extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Sr=Lh;class Js{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[n,a]of i)this.bindings[n]=a}concat(e){return new Js(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Lc=Js;const ur={kind:"null"},Je={kind:"number"},jt={kind:"string"},Lt={kind:"boolean"},jr={kind:"color"},Zn={kind:"object"},zt={kind:"value"},os={kind:"collator"},Eo={kind:"formatted"},Mn={kind:"resolvedImage"};function Hi(t,e){return{kind:"array",itemType:t,N:e}}function Ti(t){if(t.kind==="array"){const e=Ti(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Zr=[ur,Je,jt,Lt,jr,Eo,Zn,Hi(zt),Mn];function ss(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ss(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of Zr)if(!ss(i,e))return null}}return`Expected ${Ti(t)} but found ${Ti(e)} instead.`}function as(t,e){return e.some(i=>i.kind===t.kind)}function ls(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}var cs,sl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Cn(t){return(t=Math.round(t))<0?0:t>255?255:t}function us(t){return Cn(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Qs(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function al(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{cs={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in sl)return sl[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=i.indexOf("("),a=i.indexOf(")");if(n!==-1&&a+1===i.length){var c=i.substr(0,n),h=i.substr(n+1,a-(n+1)).split(","),d=1;switch(c){case"rgba":if(h.length!==4)return null;d=Qs(h.pop());case"rgb":return h.length!==3?null:[us(h[0]),us(h[1]),us(h[2]),d];case"hsla":if(h.length!==4)return null;d=Qs(h.pop());case"hsl":if(h.length!==3)return null;var m=(parseFloat(h[0])%360+360)%360/360,_=Qs(h[1]),b=Qs(h[2]),T=b<=.5?b*(_+1):b+_-b*_,S=2*b-T;return[Cn(255*al(S,T,m+1/3)),Cn(255*al(S,T,m)),Cn(255*al(S,T,m-1/3)),d];default:return null}}return null}}catch{}class mr{constructor(e,i,n,a=1){this.r=e,this.g=i,this.b=n,this.a=a}static parse(e){if(!e)return;if(e instanceof mr)return e;if(typeof e!="string")return;const i=cs(e);return i?new mr(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,n,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(n)},${a})`}toArray(){const{r:e,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*i/a,255*n/a,a]}toArray01(){const{r:e,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[e/a,i/a,n/a,a]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:n,a}=this;return[e,i,n,a]}}mr.black=new mr(0,0,0,1),mr.white=new mr(1,1,1,1),mr.transparent=new mr(0,0,0,0),mr.red=new mr(1,0,0,1),mr.blue=new mr(0,0,1,1);var ki=mr;class hs{constructor(e,i,n){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ll{constructor(e,i,n,a,c){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=n,this.fontStack=a,this.textColor=c}}class Yi{constructor(e){this.sections=e}static fromString(e){return new Yi([new ll(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Yi?e:Yi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const n={};i.fontStack&&(n["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(n["font-scale"]=i.scale),i.textColor&&(n["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(n)}return e}}class kr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new kr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Rc(t,e,i,n){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ea(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof ki||t instanceof hs||t instanceof Yi||t instanceof kr)return!0;if(Array.isArray(t)){for(const e of t)if(!ea(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!ea(t[e]))return!1;return!0}return!1}function Vi(t){if(t===null)return ur;if(typeof t=="string")return jt;if(typeof t=="boolean")return Lt;if(typeof t=="number")return Je;if(t instanceof ki)return jr;if(t instanceof hs)return os;if(t instanceof Yi)return Eo;if(t instanceof kr)return Mn;if(Array.isArray(t)){const e=t.length;let i;for(const n of t){const a=Vi(n);if(i){if(i===a)continue;i=zt;break}i=a}return Hi(i||zt,e)}return Zn}function ps(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof ki||t instanceof Yi||t instanceof kr?t.toString():JSON.stringify(t)}class cl{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ea(e[1]))return i.error("invalid value");const n=e[1];let a=Vi(n);const c=i.expectedType;return a.kind!=="array"||a.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(a=c),new cl(a,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ki?["rgba"].concat(this.value.toArray()):this.value instanceof Yi?this.value.serialize():this.value}}var ds=cl,Xi=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const So={string:jt,number:Je,boolean:Lt,object:Zn};class ul{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let n,a=1;const c=e[0];if(c==="array"){let d,m;if(e.length>2){const _=e[1];if(typeof _!="string"||!(_ in So)||_==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);d=So[_],a++}else d=zt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);m=e[2],a++}n=Hi(d,m)}else n=So[c];const h=[];for(;a<e.length;a++){const d=i.parse(e[a],a,zt);if(!d)return null;h.push(d)}return new ul(n,h)}evaluate(e){for(let i=0;i<this.args.length;i++){const n=this.args[i].evaluate(e);if(!ss(this.type,Vi(n)))return n;if(i===this.args.length-1)throw new Xi(`Expected value to be of type ${Ti(this.type)}, but found ${Ti(Vi(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){i.push(n.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(n=>n.serialize()))}}var un=ul;class fs{constructor(e){this.type=Eo,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return i.error("First argument must be an image or text section.");const a=[];let c=!1;for(let h=1;h<=e.length-1;++h){const d=e[h];if(c&&typeof d=="object"&&!Array.isArray(d)){c=!1;let m=null;if(d["font-scale"]&&(m=i.parse(d["font-scale"],1,Je),!m))return null;let _=null;if(d["text-font"]&&(_=i.parse(d["text-font"],1,Hi(jt)),!_))return null;let b=null;if(d["text-color"]&&(b=i.parse(d["text-color"],1,jr),!b))return null;const T=a[a.length-1];T.scale=m,T.font=_,T.textColor=b}else{const m=i.parse(e[h],1,zt);if(!m)return null;const _=m.type.kind;if(_!=="string"&&_!=="value"&&_!=="null"&&_!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,a.push({content:m,scale:null,font:null,textColor:null})}}return new fs(a)}evaluate(e){return new Yi(this.sections.map(i=>{const n=i.content.evaluate(e);return Vi(n)===Mn?new ll("",n,null,null,null):new ll(ps(n),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const n={};i.scale&&(n["font-scale"]=i.scale.serialize()),i.font&&(n["text-font"]=i.font.serialize()),i.textColor&&(n["text-color"]=i.textColor.serialize()),e.push(n)}return e}}class ta{constructor(e){this.type=Mn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const n=i.parse(e[1],1,jt);return n?new ta(n):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),n=kr.fromString(i);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(i)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Rh={"to-boolean":Lt,"to-color":jr,"to-number":Je,"to-string":jt};class hl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return i.error("Expected one argument.");const a=Rh[n],c=[];for(let h=1;h<e.length;h++){const d=i.parse(e[h],h,zt);if(!d)return null;c.push(d)}return new hl(a,c)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let i,n;for(const a of this.args){if(i=a.evaluate(e),n=null,i instanceof ki)return i;if(typeof i=="string"){const c=e.parseColor(i);if(c)return c}else if(Array.isArray(i)&&(n=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Rc(i[0],i[1],i[2],i[3]),!n))return new ki(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Xi(n||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const n of this.args){if(i=n.evaluate(e),i===null)return 0;const a=Number(i);if(!isNaN(a))return a}throw new Xi(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Yi.fromString(ps(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?kr.fromString(ps(this.args[0].evaluate(e))):ps(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new fs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ta(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Xn=hl;const ia=["Unknown","Point","LineString","Polygon"];var Bc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ia[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ki.parse(t)),e}};class Io{constructor(e,i,n,a){this.name=e,this.type=i,this._evaluate=n,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const n=e[0],a=Io.definitions[n];if(!a)return i.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(a)?a[0]:a.type,h=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,d=h.filter(([_])=>!Array.isArray(_)||_.length===e.length-1);let m=null;for(const[_,b]of d){m=new Hn(i.registry,i.path,null,i.scope);const T=[];let S=!1;for(let M=1;M<e.length;M++){const C=e[M],D=Array.isArray(_)?_[M-1]:_.type,B=m.parse(C,1+T.length,D);if(!B){S=!0;break}T.push(B)}if(!S)if(Array.isArray(_)&&_.length!==T.length)m.error(`Expected ${_.length} arguments, but found ${T.length} instead.`);else{for(let M=0;M<T.length;M++){const C=Array.isArray(_)?_[M]:_.type,D=T[M];m.concat(M+1).checkSubtype(C,D.type)}if(m.errors.length===0)return new Io(n,c,b,T)}}if(d.length===1)i.errors.push(...m.errors);else{const _=(d.length?d:h).map(([T])=>{return S=T,Array.isArray(S)?`(${S.map(Ti).join(", ")})`:`(${Ti(S.type)}...)`;var S}).join(" | "),b=[];for(let T=1;T<e.length;T++){const S=i.parse(e[T],1+b.length);if(!S)return null;b.push(Ti(S.type))}i.error(`Expected arguments of type ${_}, but found (${b.join(", ")}) instead.`)}return null}static register(e,i){Io.definitions=i;for(const n in i)e[n]=Io}}var kn=Io;class ra{constructor(e,i,n){this.type=os,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return i.error("Collator options argument must be an object.");const a=i.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,Lt);if(!a)return null;const c=i.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,Lt);if(!c)return null;let h=null;return n.locale&&(h=i.parse(n.locale,1,jt),!h)?null:new ra(a,c,h)}evaluate(e){return new hs(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ki=8192;function na(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ms(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Oc(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*Ki),Math.round(n*a*Ki)]}function Fc(t,e,i){const n=t[0]-e[0],a=t[1]-e[1],c=t[0]-i[0],h=t[1]-i[1];return n*h-c*a==0&&n*c<=0&&a*h<=0}function oa(t,e){let i=!1;for(let h=0,d=e.length;h<d;h++){const m=e[h];for(let _=0,b=m.length;_<b-1;_++){if(Fc(t,m[_],m[_+1]))return!1;(a=m[_])[1]>(n=t)[1]!=(c=m[_+1])[1]>n[1]&&n[0]<(c[0]-a[0])*(n[1]-a[1])/(c[1]-a[1])+a[0]&&(i=!i)}}var n,a,c;return i}function Uc(t,e){for(let i=0;i<e.length;i++)if(oa(t,e[i]))return!0;return!1}function sa(t,e,i,n){const a=n[0]-i[0],c=n[1]-i[1],h=(t[0]-i[0])*c-a*(t[1]-i[1]),d=(e[0]-i[0])*c-a*(e[1]-i[1]);return h>0&&d<0||h<0&&d>0}function _s(t,e,i){for(const _ of i)for(let b=0;b<_.length-1;++b)if((d=[(h=_[b+1])[0]-(c=_[b])[0],h[1]-c[1]])[0]*(m=[(a=e)[0]-(n=t)[0],a[1]-n[1]])[1]-d[1]*m[0]!=0&&sa(n,a,c,h)&&sa(c,h,n,a))return!0;var n,a,c,h,d,m;return!1}function pl(t,e){for(let i=0;i<t.length;++i)if(!oa(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(_s(t[i],t[i+1],e))return!1;return!0}function jc(t,e){for(let i=0;i<e.length;i++)if(pl(t,e[i]))return!0;return!1}function gs(t,e,i){const n=[];for(let a=0;a<t.length;a++){const c=[];for(let h=0;h<t[a].length;h++){const d=Oc(t[a][h],i);na(e,d),c.push(d)}n.push(c)}return n}function dl(t,e,i){const n=[];for(let a=0;a<t.length;a++){const c=gs(t[a],e,i);n.push(c)}return n}function Wn(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const a=.5*n;let c=t[0]-i[0]>a?-n:i[0]-t[0]>a?n:0;c===0&&(c=t[0]-i[2]>a?-n:i[2]-t[0]>a?n:0),t[0]+=c}na(e,t)}function Jt(t,e,i,n){const a=Math.pow(2,n.z)*Ki,c=[n.x*Ki,n.y*Ki],h=[];if(!t)return h;for(const d of t)for(const m of d){const _=[m.x+c[0],m.y+c[1]];Wn(_,e,i,a),h.push(_)}return h}function Nc(t,e,i,n){const a=Math.pow(2,n.z)*Ki,c=[n.x*Ki,n.y*Ki],h=[];if(!t)return h;for(const m of t){const _=[];for(const b of m){const T=[b.x+c[0],b.y+c[1]];na(e,T),_.push(T)}h.push(_)}if(e[2]-e[0]<=a/2){(d=e)[0]=d[1]=1/0,d[2]=d[3]=-1/0;for(const m of h)for(const _ of m)Wn(_,e,i,a)}var d;return h}class ys{constructor(e,i){this.type=Lt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ea(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let a=0;a<n.features.length;++a){const c=n.features[a].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ys(n,n.features[a].geometry)}else if(n.type==="Feature"){const a=n.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new ys(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new ys(n,n)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,n){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(n.type==="Polygon"){const d=gs(n.coordinates,c,h),m=Jt(i.geometry(),a,c,h);if(!ms(a,c))return!1;for(const _ of m)if(!oa(_,d))return!1}if(n.type==="MultiPolygon"){const d=dl(n.coordinates,c,h),m=Jt(i.geometry(),a,c,h);if(!ms(a,c))return!1;for(const _ of m)if(!Uc(_,d))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,n){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(n.type==="Polygon"){const d=gs(n.coordinates,c,h),m=Nc(i.geometry(),a,c,h);if(!ms(a,c))return!1;for(const _ of m)if(!pl(_,d))return!1}if(n.type==="MultiPolygon"){const d=dl(n.coordinates,c,h),m=Nc(i.geometry(),a,c,h);if(!ms(a,c))return!1;for(const _ of m)if(!jc(_,d))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var fl=ys;function Ao(t){if(t instanceof kn&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof fl)return!1;let e=!0;return t.eachChild(i=>{e&&!Ao(i)&&(e=!1)}),e}function aa(t){if(t instanceof kn&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!aa(i)&&(e=!1)}),e}function xs(t,e){if(t instanceof kn&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(n=>{i&&!xs(n,e)&&(i=!1)}),i}class la{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const n=e[1];return i.scope.has(n)?new la(n,i.scope.get(n)):i.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ml=la;class ca{constructor(e,i=[],n,a=new Lc,c=[]){this.registry=e,this.path=i,this.key=i.map(h=>`[${h}]`).join(""),this.scope=a,this.errors=c,this.expectedType=n}parse(e,i,n,a,c={}){return i?this.concat(i,n,a)._parse(e,c):this._parse(e,c)}_parse(e,i){function n(a,c,h){return h==="assert"?new un(c,[a]):h==="coerce"?new Xn(c,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=e[0];if(typeof a!="string")return this.error(`Expression name must be a string, but found ${typeof a} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const c=this.registry[a];if(c){let h=c.parse(e,this);if(!h)return null;if(this.expectedType){const d=this.expectedType,m=h.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||m.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||m.kind!=="value"&&m.kind!=="string"){if(this.checkSubtype(d,m))return null}else h=n(h,d,i.typeAnnotation||"coerce");else h=n(h,d,i.typeAnnotation||"assert")}if(!(h instanceof ds)&&h.type.kind!=="resolvedImage"&&Mo(h)){const d=new Bc;try{h=new ds(h.type,h.evaluate(d))}catch(m){return this.error(m.message),null}}return h}return this.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,n){const a=typeof e=="number"?this.path.concat(e):this.path,c=n?this.scope.concat(n):this.scope;return new ca(this.registry,a,i||null,c,this.errors)}error(e,...i){const n=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new Sr(n,e))}checkSubtype(e,i){const n=ss(e,i);return n&&this.error(n),n}}var Hn=ca;function Mo(t){if(t instanceof ml)return Mo(t.boundExpression);if(t instanceof kn&&t.name==="error"||t instanceof ra||t instanceof fl)return!1;const e=t instanceof Xn||t instanceof un;let i=!0;return t.eachChild(n=>{i=e?i&&Mo(n):i&&n instanceof ds}),!!i&&Ao(t)&&xs(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ua(t,e){const i=t.length-1;let n,a,c=0,h=i,d=0;for(;c<=h;)if(d=Math.floor((c+h)/2),n=t[d],a=t[d+1],n<=e){if(d===i||e<a)return d;c=d+1}else{if(!(n>e))throw new Xi("Input is not a number.");h=d-1}return 0}class vs{constructor(e,i,n){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,c]of n)this.labels.push(a),this.outputs.push(c)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const n=i.parse(e[1],1,Je);if(!n)return null;const a=[];let c=null;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);for(let h=1;h<e.length;h+=2){const d=h===1?-1/0:e[h],m=e[h+1],_=h,b=h+1;if(typeof d!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_);if(a.length&&a[a.length-1][0]>=d)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',_);const T=i.parse(m,b,c);if(!T)return null;c=c||T.type,a.push([d,T])}return new vs(c,n,a)}evaluate(e){const i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return n[0].evaluate(e);const c=i.length;return a>=i[c-1]?n[c-1].evaluate(e):n[ua(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var ha=vs;function Zt(t,e,i){return t*(1-i)+e*i}var pa=Object.freeze({__proto__:null,number:Zt,color:function(t,e,i){return new ki(Zt(t.r,e.r,i),Zt(t.g,e.g,i),Zt(t.b,e.b,i),Zt(t.a,e.a,i))},array:function(t,e,i){return t.map((n,a)=>Zt(n,e[a],i))}});const _l=.95047,Vc=1.08883,gl=4/29,da=6/29,Gc=3*da*da,$c=Math.PI/180,Bh=180/Math.PI;function fa(t){return t>.008856451679035631?Math.pow(t,1/3):t/Gc+gl}function ma(t){return t>da?t*t*t:Gc*(t-gl)}function yl(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function xl(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function qc(t){const e=xl(t.r),i=xl(t.g),n=xl(t.b),a=fa((.4124564*e+.3575761*i+.1804375*n)/_l),c=fa((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*c-16,a:500*(a-c),b:200*(c-fa((.0193339*e+.119192*i+.9503041*n)/Vc)),alpha:t.a}}function Zc(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*ma(e),i=_l*ma(i),n=Vc*ma(n),new ki(yl(3.2404542*i-1.5371385*e-.4985314*n),yl(-.969266*i+1.8760108*e+.041556*n),yl(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function Oh(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const bs={forward:qc,reverse:Zc,interpolate:function(t,e,i){return{l:Zt(t.l,e.l,i),a:Zt(t.a,e.a,i),b:Zt(t.b,e.b,i),alpha:Zt(t.alpha,e.alpha,i)}}},Co={forward:function(t){const{l:e,a:i,b:n}=qc(t),a=Math.atan2(n,i)*Bh;return{h:a<0?a+360:a,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*$c,i=t.c;return Zc({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Oh(t.h,e.h,i),c:Zt(t.c,e.c,i),l:Zt(t.l,e.l,i),alpha:Zt(t.alpha,e.alpha,i)}}};var Xc=Object.freeze({__proto__:null,lab:bs,hcl:Co});class _a{constructor(e,i,n,a,c){this.type=e,this.operator=i,this.interpolation=n,this.input=a,this.labels=[],this.outputs=[];for(const[h,d]of c)this.labels.push(h),this.outputs.push(d)}static interpolationFactor(e,i,n,a){let c=0;if(e.name==="exponential")c=vl(i,e.base,n,a);else if(e.name==="linear")c=vl(i,1,n,a);else if(e.name==="cubic-bezier"){const h=e.controlPoints;c=new at(h[0],h[1],h[2],h[3]).solve(vl(i,1,n,a))}return c}static parse(e,i){let[n,a,c,...h]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const _=a[1];if(typeof _!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:_}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const _=a.slice(1);if(_.length!==4||_.some(b=>typeof b!="number"||b<0||b>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:_}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(c=i.parse(c,2,Je),!c)return null;const d=[];let m=null;n==="interpolate-hcl"||n==="interpolate-lab"?m=jr:i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let _=0;_<h.length;_+=2){const b=h[_],T=h[_+1],S=_+3,M=_+4;if(typeof b!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(d.length&&d[d.length-1][0]>=b)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);const C=i.parse(T,M,m);if(!C)return null;m=m||C.type,d.push([b,C])}return m.kind==="number"||m.kind==="color"||m.kind==="array"&&m.itemType.kind==="number"&&typeof m.N=="number"?new _a(m,n,a,c,d):i.error(`Type ${Ti(m)} is not interpolatable.`)}evaluate(e){const i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return n[0].evaluate(e);const c=i.length;if(a>=i[c-1])return n[c-1].evaluate(e);const h=ua(i,a),d=_a.interpolationFactor(this.interpolation,a,i[h],i[h+1]),m=n[h].evaluate(e),_=n[h+1].evaluate(e);return this.operator==="interpolate"?pa[this.type.kind.toLowerCase()](m,_,d):this.operator==="interpolate-hcl"?Co.reverse(Co.interpolate(Co.forward(m),Co.forward(_),d)):bs.reverse(bs.interpolate(bs.forward(m),bs.forward(_),d))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)i.push(this.labels[n],this.outputs[n].serialize());return i}}function vl(t,e,i,n){const a=n-i,c=t-i;return a===0?0:e===1?c/a:(Math.pow(e,c)-1)/(Math.pow(e,a)-1)}var Xr=_a;class ga{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let n=null;const a=i.expectedType;a&&a.kind!=="value"&&(n=a);const c=[];for(const d of e.slice(1)){const m=i.parse(d,1+c.length,n,void 0,{typeAnnotation:"omit"});if(!m)return null;n=n||m.type,c.push(m)}const h=a&&c.some(d=>ss(a,d.type));return new ga(h?zt:n,c)}evaluate(e){let i,n=null,a=0;for(const c of this.args){if(a++,n=c.evaluate(e),n&&n instanceof kr&&!n.available&&(i||(i=n),n=null,a===this.args.length))return i;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var bl=ga;class ya{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let c=1;c<e.length-1;c+=2){const h=e[c];if(typeof h!="string")return i.error(`Expected string, but found ${typeof h} instead.`,c);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",c);const d=i.parse(e[c+1],c+1);if(!d)return null;n.push([h,d])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,n);return a?new ya(n,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,n]of this.bindings)e.push(i,n.serialize());return e.push(this.result.serialize()),e}}var Wc=ya;class wl{constructor(e,i,n){this.type=e,this.index=i,this.input=n}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Je),a=i.parse(e[2],2,Hi(i.expectedType||zt));return n&&a?new wl(a.type.itemType,n,a):null}evaluate(e){const i=this.index.evaluate(e),n=this.input.evaluate(e);if(i<0)throw new Xi(`Array index out of bounds: ${i} < 0.`);if(i>=n.length)throw new Xi(`Array index out of bounds: ${i} > ${n.length-1}.`);if(i!==Math.floor(i))throw new Xi(`Array index must be an integer, but found ${i} instead.`);return n[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Hc=wl;class xa{constructor(e,i){this.type=Lt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,zt),a=i.parse(e[2],2,zt);return n&&a?as(n.type,[Lt,jt,Je,ur,zt])?new xa(n,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(n.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!ls(i,["boolean","string","number","null"]))throw new Xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(Vi(i))} instead.`);if(!ls(n,["string","array"]))throw new Xi(`Expected second argument to be of type array or string, but found ${Ti(Vi(n))} instead.`);return n.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Yc=xa;class va{constructor(e,i,n){this.type=Je,this.needle=e,this.haystack=i,this.fromIndex=n}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,zt),a=i.parse(e[2],2,zt);if(!n||!a)return null;if(!as(n.type,[Lt,jt,Je,ur,zt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(n.type)} instead`);if(e.length===4){const c=i.parse(e[3],3,Je);return c?new va(n,a,c):null}return new va(n,a)}evaluate(e){const i=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!ls(i,["boolean","string","number","null"]))throw new Xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(Vi(i))} instead.`);if(!ls(n,["string","array"]))throw new Xi(`Expected second argument to be of type array or string, but found ${Ti(Vi(n))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return n.indexOf(i,a)}return n.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Fh=va;class Tl{constructor(e,i,n,a,c,h){this.inputType=e,this.type=i,this.input=n,this.cases=a,this.outputs=c,this.otherwise=h}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let n,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c={},h=[];for(let _=2;_<e.length-1;_+=2){let b=e[_];const T=e[_+1];Array.isArray(b)||(b=[b]);const S=i.concat(_);if(b.length===0)return S.error("Expected at least one branch label.");for(const C of b){if(typeof C!="number"&&typeof C!="string")return S.error("Branch labels must be numbers or strings.");if(typeof C=="number"&&Math.abs(C)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof C=="number"&&Math.floor(C)!==C)return S.error("Numeric branch labels must be integer values.");if(n){if(S.checkSubtype(n,Vi(C)))return null}else n=Vi(C);if(c[String(C)]!==void 0)return S.error("Branch labels must be unique.");c[String(C)]=h.length}const M=i.parse(T,_,a);if(!M)return null;a=a||M.type,h.push(M)}const d=i.parse(e[1],1,zt);if(!d)return null;const m=i.parse(e[e.length-1],e.length-1,a);return m?d.type.kind!=="value"&&i.concat(1).checkSubtype(n,d.type)?null:new Tl(n,a,d,c,h,m):null}evaluate(e){const i=this.input.evaluate(e);return(Vi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),n=[],a={};for(const h of i){const d=a[this.cases[h]];d===void 0?(a[this.cases[h]]=n.length,n.push([this.cases[h],[h]])):n[d][1].push(h)}const c=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,d]of n)e.push(d.length===1?c(d[0]):d.map(c)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}var Uh=Tl;class ko{constructor(e,i,n){this.type=e,this.branches=i,this.otherwise=n}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let n;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);const a=[];for(let h=1;h<e.length-1;h+=2){const d=i.parse(e[h],h,Lt);if(!d)return null;const m=i.parse(e[h+1],h+1,n);if(!m)return null;a.push([d,m]),n=n||m.type}const c=i.parse(e[e.length-1],e.length-1,n);return c?new ko(n,a,c):null}evaluate(e){for(const[i,n]of this.branches)if(i.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,n]of this.branches)e(i),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Kc=ko;class ws{constructor(e,i,n,a){this.type=e,this.input=i,this.beginIndex=n,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,zt),a=i.parse(e[2],2,Je);if(!n||!a)return null;if(!as(n.type,[Hi(zt),jt,zt]))return i.error(`Expected first argument to be of type array or string, but found ${Ti(n.type)} instead`);if(e.length===4){const c=i.parse(e[3],3,Je);return c?new ws(n.type,n,a,c):null}return new ws(n.type,n,a)}evaluate(e){const i=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!ls(i,["string","array"]))throw new Xi(`Expected first argument to be of type array or string, but found ${Ti(Vi(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(n,a)}return i.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var jh=ws;function Jc(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Qc(t,e,i,n){return n.compare(e,i)===0}function Yn(t,e,i){const n=t!=="=="&&t!=="!=";return class z_{constructor(c,h,d){this.type=Lt,this.lhs=c,this.rhs=h,this.collator=d,this.hasUntypedArgument=c.type.kind==="value"||h.type.kind==="value"}static parse(c,h){if(c.length!==3&&c.length!==4)return h.error("Expected two or three arguments.");const d=c[0];let m=h.parse(c[1],1,zt);if(!m)return null;if(!Jc(d,m.type))return h.concat(1).error(`"${d}" comparisons are not supported for type '${Ti(m.type)}'.`);let _=h.parse(c[2],2,zt);if(!_)return null;if(!Jc(d,_.type))return h.concat(2).error(`"${d}" comparisons are not supported for type '${Ti(_.type)}'.`);if(m.type.kind!==_.type.kind&&m.type.kind!=="value"&&_.type.kind!=="value")return h.error(`Cannot compare types '${Ti(m.type)}' and '${Ti(_.type)}'.`);n&&(m.type.kind==="value"&&_.type.kind!=="value"?m=new un(_.type,[m]):m.type.kind!=="value"&&_.type.kind==="value"&&(_=new un(m.type,[_])));let b=null;if(c.length===4){if(m.type.kind!=="string"&&_.type.kind!=="string"&&m.type.kind!=="value"&&_.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(b=h.parse(c[3],3,os),!b)return null}return new z_(m,_,b)}evaluate(c){const h=this.lhs.evaluate(c),d=this.rhs.evaluate(c);if(n&&this.hasUntypedArgument){const m=Vi(h),_=Vi(d);if(m.kind!==_.kind||m.kind!=="string"&&m.kind!=="number")throw new Xi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${m.kind}, ${_.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const m=Vi(h),_=Vi(d);if(m.kind!=="string"||_.kind!=="string")return e(c,h,d)}return this.collator?i(c,h,d,this.collator.evaluate(c)):e(c,h,d)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[t];return this.eachChild(h=>{c.push(h.serialize())}),c}}}const eu=Yn("==",function(t,e,i){return e===i},Qc),tu=Yn("!=",function(t,e,i){return e!==i},function(t,e,i,n){return!Qc(0,e,i,n)}),El=Yn("<",function(t,e,i){return e<i},function(t,e,i,n){return n.compare(e,i)<0}),Nh=Yn(">",function(t,e,i){return e>i},function(t,e,i,n){return n.compare(e,i)>0}),Vh=Yn("<=",function(t,e,i){return e<=i},function(t,e,i,n){return n.compare(e,i)<=0}),Gh=Yn(">=",function(t,e,i){return e>=i},function(t,e,i,n){return n.compare(e,i)>=0});class Sl{constructor(e,i,n,a,c,h){this.type=jt,this.number=e,this.locale=i,this.currency=n,this.unit=a,this.minFractionDigits=c,this.maxFractionDigits=h}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const n=i.parse(e[1],1,Je);if(!n)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let c=null;if(a.locale&&(c=i.parse(a.locale,1,jt),!c))return null;let h=null;if(a.currency&&(h=i.parse(a.currency,1,jt),!h))return null;let d=null;if(a.unit&&(d=i.parse(a.unit,1,jt),!d))return null;let m=null;if(a["min-fraction-digits"]&&(m=i.parse(a["min-fraction-digits"],1,Je),!m))return null;let _=null;return a["max-fraction-digits"]&&(_=i.parse(a["max-fraction-digits"],1,Je),!_)?null:new Sl(n,c,h,d,m,_)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Il{constructor(e){this.type=Je,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=i.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Ti(n.type)} instead.`):new Il(n):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Xi(`Expected value to be of type string or array, but found ${Ti(Vi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const iu={"==":eu,"!=":tu,">":Nh,"<":El,">=":Gh,"<=":Vh,array:un,at:Hc,boolean:un,case:Kc,coalesce:bl,collator:ra,format:fs,image:ta,in:Yc,"index-of":Fh,interpolate:Xr,"interpolate-hcl":Xr,"interpolate-lab":Xr,length:Il,let:Wc,literal:ds,match:Uh,number:un,"number-format":Sl,object:un,slice:jh,step:ha,string:un,"to-boolean":Xn,"to-color":Xn,"to-number":Xn,"to-string":Xn,var:ml,within:fl};function ru(t,[e,i,n,a]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const c=a?a.evaluate(t):1,h=Rc(e,i,n,c);if(h)throw new Xi(h);return new ki(e/255*c,i/255*c,n/255*c,c)}function Al(t,e){return t in e}function ba(t,e){const i=e[t];return i===void 0?null:i}function Wr(t){return{type:t}}kn.register(iu,{error:[{kind:"error"},[jt],(t,[e])=>{throw new Xi(e.evaluate(t))}],typeof:[jt,[zt],(t,[e])=>Ti(Vi(e.evaluate(t)))],"to-rgba":[Hi(Je,4),[jr],(t,[e])=>e.evaluate(t).toArray()],rgb:[jr,[Je,Je,Je],ru],rgba:[jr,[Je,Je,Je,Je],ru],has:{type:Lt,overloads:[[[jt],(t,[e])=>Al(e.evaluate(t),t.properties())],[[jt,Zn],(t,[e,i])=>Al(e.evaluate(t),i.evaluate(t))]]},get:{type:zt,overloads:[[[jt],(t,[e])=>ba(e.evaluate(t),t.properties())],[[jt,Zn],(t,[e,i])=>ba(e.evaluate(t),i.evaluate(t))]]},"feature-state":[zt,[jt],(t,[e])=>ba(e.evaluate(t),t.featureState||{})],properties:[Zn,[],t=>t.properties()],"geometry-type":[jt,[],t=>t.geometryType()],id:[zt,[],t=>t.id()],zoom:[Je,[],t=>t.globals.zoom],pitch:[Je,[],t=>t.globals.pitch||0],"distance-from-center":[Je,[],t=>t.distanceFromCenter()],"heatmap-density":[Je,[],t=>t.globals.heatmapDensity||0],"line-progress":[Je,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Je,[],t=>t.globals.skyRadialProgress||0],accumulated:[zt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Je,Wr(Je),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[Je,Wr(Je),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:Je,overloads:[[[Je,Je],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Je],(t,[e])=>-e.evaluate(t)]]},"/":[Je,[Je,Je],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Je,[Je,Je],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Je,[],()=>Math.LN2],pi:[Je,[],()=>Math.PI],e:[Je,[],()=>Math.E],"^":[Je,[Je,Je],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Je,[Je],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Je,[Je],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Je,[Je],(t,[e])=>Math.log(e.evaluate(t))],log2:[Je,[Je],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Je,[Je],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Je,[Je],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Je,[Je],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Je,[Je],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Je,[Je],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Je,[Je],(t,[e])=>Math.atan(e.evaluate(t))],min:[Je,Wr(Je),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Je,Wr(Je),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Je,[Je],(t,[e])=>Math.abs(e.evaluate(t))],round:[Je,[Je],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Je,[Je],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Je,[Je],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Lt,[jt,zt],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Lt,[zt],(t,[e])=>t.id()===e.value],"filter-type-==":[Lt,[jt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Lt,[jt,zt],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n<a}],"filter-id-<":[Lt,[zt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[Lt,[jt,zt],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n>a}],"filter-id->":[Lt,[zt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[Lt,[jt,zt],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[Lt,[zt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[Lt,[jt,zt],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[Lt,[zt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[Lt,[zt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Lt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Lt,[Hi(jt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Lt,[Hi(zt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Lt,[jt,Hi(zt)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Lt,[jt,Hi(zt)],(t,[e,i])=>function(n,a,c,h){for(;c<=h;){const d=c+h>>1;if(a[d]===n)return!0;a[d]>n?h=d-1:c=d+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Lt,overloads:[[[Lt,Lt],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Wr(Lt),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Lt,overloads:[[[Lt,Lt],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Wr(Lt),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Lt,[Lt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Lt,[jt],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[jt,[jt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[jt,[jt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[jt,Wr(zt),(t,e)=>e.map(i=>ps(i.evaluate(t))).join("")],"resolved-locale":[jt,[os],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Ts=iu;function nu(t){return{result:"success",value:t}}function Ir(t){return{result:"error",value:t}}function Kn(t){return t["property-type"]==="data-driven"}function Jn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ml(t){return!!t.expression&&t.expression.interpolated}function Qt(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Es(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function $h(t){return t}function wa(t,e){const i=e.type==="color",n=t.stops&&typeof t.stops[0][0]=="object",a=n||!(n||t.property!==void 0),c=t.type||(Ml(e)?"exponential":"interval");if(i&&((t=ln({},t)).stops&&(t.stops=t.stops.map(_=>[_[0],ki.parse(_[1])])),t.default=ki.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Xc[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let h,d,m;if(c==="exponential")h=kl;else if(c==="interval")h=ou;else if(c==="categorical"){h=Cl,d=Object.create(null);for(const _ of t.stops)d[_[0]]=_[1];m=typeof t.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);h=zl}if(n){const _={},b=[];for(let M=0;M<t.stops.length;M++){const C=t.stops[M],D=C[0].zoom;_[D]===void 0&&(_[D]={zoom:D,type:t.type,property:t.property,default:t.default,stops:[]},b.push(D)),_[D].stops.push([C[0].value,C[1]])}const T=[];for(const M of b)T.push([_[M].zoom,wa(_[M],e)]);const S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:Xr.interpolationFactor.bind(void 0,S),zoomStops:T.map(M=>M[0]),evaluate:({zoom:M},C)=>kl({stops:T,base:t.base},e,M).evaluate(M,C)}}if(a){const _=c==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:_,interpolationFactor:Xr.interpolationFactor.bind(void 0,_),zoomStops:t.stops.map(b=>b[0]),evaluate:({zoom:b})=>h(t,e,b,d,m)}}return{kind:"source",evaluate(_,b){const T=b&&b.properties?b.properties[t.property]:void 0;return T===void 0?zo(t.default,e.default):h(t,e,T,d,m)}}}function zo(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function Cl(t,e,i,n,a){return zo(typeof i===a?n[i]:void 0,t.default,e.default)}function ou(t,e,i){if(Qt(i)!=="number")return zo(t.default,e.default);const n=t.stops.length;if(n===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const a=ua(t.stops.map(c=>c[0]),i);return t.stops[a][1]}function kl(t,e,i){const n=t.base!==void 0?t.base:1;if(Qt(i)!=="number")return zo(t.default,e.default);const a=t.stops.length;if(a===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[a-1][0])return t.stops[a-1][1];const c=ua(t.stops.map(b=>b[0]),i),h=function(b,T,S,M){const C=M-S,D=b-S;return C===0?0:T===1?D/C:(Math.pow(T,D)-1)/(Math.pow(T,C)-1)}(i,n,t.stops[c][0],t.stops[c+1][0]),d=t.stops[c][1],m=t.stops[c+1][1];let _=pa[e.type]||$h;if(t.colorSpace&&t.colorSpace!=="rgb"){const b=Xc[t.colorSpace];_=(T,S)=>b.reverse(b.interpolate(b.forward(T),b.forward(S),h))}return typeof d.evaluate=="function"?{evaluate(...b){const T=d.evaluate.apply(void 0,b),S=m.evaluate.apply(void 0,b);if(T!==void 0&&S!==void 0)return _(T,S,h)}}:_(d,m,h)}function zl(t,e,i){return e.type==="color"?i=ki.parse(i):e.type==="formatted"?i=Yi.fromString(i.toString()):e.type==="resolvedImage"?i=kr.fromString(i.toString()):Qt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),zo(i,t.default,e.default)}class Ta{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new Bc,this._defaultValue=i?function(n){return n.type==="color"&&(Es(n.default)||Array.isArray(n.default))?new ki(0,0,0,0):n.type==="color"?ki.parse(n.default)||null:n.default===void 0?null:n.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,n,a,c,h,d,m){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=n,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=m||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,n,a,c,h,d,m){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=n||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=m||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Xi(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Ss(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ts}function zn(t,e){const i=new Hn(Ts,[],e?function(a){const c={color:jr,string:jt,number:Je,enum:jt,boolean:Lt,formatted:Eo,resolvedImage:Mn};return a.type==="array"?Hi(c[a.value]||zt,a.length):c[a.type]}(e):void 0),n=i.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?nu(new Ta(n,e)):Ir(i.errors)}class Pn{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!aa(i.expression)}evaluateWithoutErrorHandling(e,i,n,a,c,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,n,a,c,h)}evaluate(e,i,n,a,c,h){return this._styleExpression.evaluate(e,i,n,a,c,h)}}class Ea{constructor(e,i,n,a){this.kind=e,this.zoomStops=n,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!aa(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,n,a,c,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,n,a,c,h)}evaluate(e,i,n,a,c,h){return this._styleExpression.evaluate(e,i,n,a,c,h)}interpolationFactor(e,i,n){return this.interpolationType?Xr.interpolationFactor(this.interpolationType,e,i,n):0}}function Pl(t,e){if((t=zn(t,e)).result==="error")return t;const i=t.value.expression,n=Ao(i);if(!n&&!Kn(e))return Ir([new Sr("","data expressions not supported")]);const a=xs(i,["zoom","pitch","distance-from-center"]);if(!a&&!Jn(e))return Ir([new Sr("","zoom expressions not supported")]);const c=Is(i);return c||a?c instanceof Sr?Ir([c]):c instanceof Xr&&!Ml(e)?Ir([new Sr("",'"interpolate" expressions cannot be used with this property')]):nu(c?new Ea(n?"camera":"composite",t.value,c.labels,c instanceof Xr?c.interpolation:void 0):new Pn(n?"constant":"source",t.value)):Ir([new Sr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Po{constructor(e,i){this._parameters=e,this._specification=i,ln(this,wa(this._parameters,this._specification))}static deserialize(e){return new Po(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Is(t){let e=null;if(t instanceof Wc)e=Is(t.result);else if(t instanceof bl){for(const i of t.args)if(e=Is(i),e)break}else(t instanceof ha||t instanceof Xr)&&t.input instanceof kn&&t.input.name==="zoom"&&(e=t);return e instanceof Sr||t.eachChild(i=>{const n=Is(i);n instanceof Sr?e=n:!e&&n?e=new Sr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new Sr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Qe{constructor(e,i,n,a){this.message=(e?`${e}: `:"")+n,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}function zr(t){const e=t.key,i=t.value,n=t.valueSpec||{},a=t.objectElementValidators||{},c=t.style,h=t.styleSpec;let d=[];const m=Qt(i);if(m!=="object")return[new Qe(e,i,`object expected, ${m} found`)];for(const _ in i){const b=_.split(".")[0],T=n[b]||n["*"];let S;a[b]?S=a[b]:n[b]?S=nr:a["*"]?S=a["*"]:n["*"]&&(S=nr),S?d=d.concat(S({key:(e&&`${e}.`)+_,value:i[_],valueSpec:T,style:c,styleSpec:h,object:i,objectKey:_},i)):d.push(new Qe(e,i[_],`unknown property "${_}"`))}for(const _ in n)a[_]||n[_].required&&n[_].default===void 0&&i[_]===void 0&&d.push(new Qe(e,i,`missing required property "${_}"`));return d}function As(t){const e=t.value,i=t.valueSpec,n=t.style,a=t.styleSpec,c=t.key,h=t.arrayElementValidator||nr;if(Qt(e)!=="array")return[new Qe(c,e,`array expected, ${Qt(e)} found`)];if(i.length&&e.length!==i.length)return[new Qe(c,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Qe(c,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let d={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};a.$version<7&&(d.function=i.function),Qt(i.value)==="object"&&(d=i.value);let m=[];for(let _=0;_<e.length;_++)m=m.concat(h({array:e,arrayIndex:_,value:e[_],valueSpec:d,style:n,styleSpec:a,key:`${c}[${_}]`}));return m}function su(t){const e=t.key,i=t.value,n=t.valueSpec;let a=Qt(i);if(a==="number"&&i!=i&&(a="NaN"),a!=="number")return[new Qe(e,i,`number expected, ${a} found`)];if("minimum"in n){let c=n.minimum;if(Qt(n.minimum)==="array"&&(c=n.minimum[t.arrayIndex]),i<c)return[new Qe(e,i,`${i} is less than the minimum value ${c}`)]}if("maximum"in n){let c=n.maximum;if(Qt(n.maximum)==="array"&&(c=n.maximum[t.arrayIndex]),i>c)return[new Qe(e,i,`${i} is greater than the maximum value ${c}`)]}return[]}function au(t){const e=t.valueSpec,i=Ni(t.value.type);let n,a,c,h={};const d=i!=="categorical"&&t.value.property===void 0,m=!d,_=Qt(t.value.stops)==="array"&&Qt(t.value.stops[0])==="array"&&Qt(t.value.stops[0][0])==="object",b=zr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(M){if(i==="identity")return[new Qe(M.key,M.value,'identity function may not have a "stops" property')];let C=[];const D=M.value;return C=C.concat(As({key:M.key,value:D,valueSpec:M.valueSpec,style:M.style,styleSpec:M.styleSpec,arrayElementValidator:T})),Qt(D)==="array"&&D.length===0&&C.push(new Qe(M.key,D,"array must have at least one stop")),C},default:function(M){return nr({key:M.key,value:M.value,valueSpec:e,style:M.style,styleSpec:M.styleSpec})}}});return i==="identity"&&d&&b.push(new Qe(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||b.push(new Qe(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!Ml(t.valueSpec)&&b.push(new Qe(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(m&&!Kn(t.valueSpec)?b.push(new Qe(t.key,t.value,"property functions not supported")):d&&!Jn(t.valueSpec)&&b.push(new Qe(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!_||t.value.property!==void 0||b.push(new Qe(t.key,t.value,'"property" property is required')),b;function T(M){let C=[];const D=M.value,B=M.key;if(Qt(D)!=="array")return[new Qe(B,D,`array expected, ${Qt(D)} found`)];if(D.length!==2)return[new Qe(B,D,`array length 2 expected, length ${D.length} found`)];if(_){if(Qt(D[0])!=="object")return[new Qe(B,D,`object expected, ${Qt(D[0])} found`)];if(D[0].zoom===void 0)return[new Qe(B,D,"object stop key must have zoom")];if(D[0].value===void 0)return[new Qe(B,D,"object stop key must have value")];const H=Ni(D[0].zoom);if(typeof H!="number")return[new Qe(B,D[0].zoom,"stop zoom values must be numbers")];if(c&&c>H)return[new Qe(B,D[0].zoom,"stop zoom values must appear in ascending order")];H!==c&&(c=H,a=void 0,h={}),C=C.concat(zr({key:`${B}[0]`,value:D[0],valueSpec:{zoom:{}},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{zoom:su,value:S}}))}else C=C.concat(S({key:`${B}[0]`,value:D[0],valueSpec:{},style:M.style,styleSpec:M.styleSpec},D));return Ss(cn(D[1]))?C.concat([new Qe(`${B}[1]`,D[1],"expressions are not allowed in function stops.")]):C.concat(nr({key:`${B}[1]`,value:D[1],valueSpec:e,style:M.style,styleSpec:M.styleSpec}))}function S(M,C){const D=Qt(M.value),B=Ni(M.value),H=M.value!==null?M.value:C;if(n){if(D!==n)return[new Qe(M.key,H,`${D} stop domain type must match previous stop domain type ${n}`)]}else n=D;if(D!=="number"&&D!=="string"&&D!=="boolean"&&typeof B!="number"&&typeof B!="string"&&typeof B!="boolean")return[new Qe(M.key,H,"stop domain value must be a number, string, or boolean")];if(D!=="number"&&i!=="categorical"){let ee=`number expected, ${D} found`;return Kn(e)&&i===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(M.key,H,ee)]}return i!=="categorical"||D!=="number"||typeof B=="number"&&isFinite(B)&&Math.floor(B)===B?i!=="categorical"&&D==="number"&&typeof B=="number"&&typeof a=="number"&&a!==void 0&&B<a?[new Qe(M.key,H,"stop domain values must appear in ascending order")]:(a=B,i==="categorical"&&B in h?[new Qe(M.key,H,"stop domain values must be unique")]:(h[B]=!0,[])):[new Qe(M.key,H,`integer expected, found ${String(B)}`)]}}function Do(t){const e=(t.expressionContext==="property"?Pl:zn)(cn(t.value),t.valueSpec);if(e.result==="error")return e.value.map(n=>new Qe(`${t.key}${n.key}`,t.value,n.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new Qe(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!aa(i))return[new Qe(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return lu(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!xs(i,["zoom","feature-state"]))return[new Qe(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Ao(i))return[new Qe(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lu(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const a of e.valueSpec.expression.parameters)i.delete(a);if(i.size===0)return[];const n=[];return t instanceof kn&&i.has(t.name)?[new Qe(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(a=>{n.push(...lu(a,e))}),n)}function Sa(t){const e=t.key,i=t.value,n=t.valueSpec,a=[];return Array.isArray(n.values)?n.values.indexOf(Ni(i))===-1&&a.push(new Qe(e,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(n.values).indexOf(Ni(i))===-1&&a.push(new Qe(e,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),a}function Lo(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Lo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Qn(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lo(t)||(t=Bo(t));const i=t;let n=!0;try{n=function(_){if(!Ro(_))return _;let b=cn(_);return Ms(b),b=_r(b),b}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const a=Me[`filter_${e}`],c=zn(n,a);let h=null;if(c.result==="error")throw new Error(c.value.map(_=>`${_.key}: ${_.message}`).join(", "));h=(_,b,T)=>c.value.evaluate(_,b,{},T);let d=null,m=null;if(n!==i){const _=zn(i,a);if(_.result==="error")throw new Error(_.value.map(b=>`${b.key}: ${b.message}`).join(", "));d=(b,T,S,M,C)=>_.value.evaluate(b,T,{},S,void 0,void 0,M,C),m=!Ao(_.value.expression)}return{filter:h,dynamicFilter:d||void 0,needGeometry:cu(n),needFeature:!!m}}function _r(t){if(!Array.isArray(t))return t;const e=function(i){if(qh.has(i[0])){for(let n=1;n<i.length;n++)if(Ro(i[n]))return!0}return i}(t);return e===!0?e:e.map(i=>_r(i))}function Ms(t){let e=!1;const i=[];if(t[0]==="case"){for(let n=1;n<t.length-1;n+=2)e=e||Ro(t[n]),i.push(t[n+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||Ro(t[1]);for(let n=2;n<t.length-1;n+=2)i.push(t[n+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||Ro(t[1]);for(let n=1;n<t.length-1;n+=2)i.push(t[n+1])}e&&(t.length=0,t.push("any",...i));for(let n=1;n<t.length;n++)Ms(t[n])}function Ro(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(Ro(t[i]))return!0;return!1}const qh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Zh(t,e){return t<e?-1:t>e?1:0}function cu(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(cu(t[e]))return!0;return!1}function Bo(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Dl(t[1],t[2],"=="):e==="!="?Aa(Dl(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Dl(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(Bo))):e==="all"?["all"].concat(t.slice(1).map(Bo)):e==="none"?["all"].concat(t.slice(1).map(Bo).map(Aa)):e==="in"?Ia(t[1],t.slice(2)):e==="!in"?Aa(Ia(t[1],t.slice(2))):e==="has"?uu(t[1]):e==="!has"?Aa(uu(t[1])):e!=="within"||t;var i}function Dl(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Ia(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Zh)]]:["filter-in-small",t,["literal",e]]}}function uu(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Aa(t){return["!",t]}function Cs(t){return Lo(cn(t.value))?Do(ln({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):hu(t)}function hu(t){const e=t.value,i=t.key;if(Qt(e)!=="array")return[new Qe(i,e,`array expected, ${Qt(e)} found`)];const n=t.styleSpec;let a,c=[];if(e.length<1)return[new Qe(i,e,"filter array must have at least 1 element")];switch(c=c.concat(Sa({key:`${i}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),Ni(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ni(e[1])==="$type"&&c.push(new Qe(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&c.push(new Qe(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=Qt(e[1]),a!=="string"&&c.push(new Qe(`${i}[1]`,e[1],`string expected, ${a} found`)));for(let h=2;h<e.length;h++)a=Qt(e[h]),Ni(e[1])==="$type"?c=c.concat(Sa({key:`${i}[${h}]`,value:e[h],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&c.push(new Qe(`${i}[${h}]`,e[h],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let h=1;h<e.length;h++)c=c.concat(hu({key:`${i}[${h}]`,value:e[h],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":a=Qt(e[1]),e.length!==2?c.push(new Qe(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="string"&&c.push(new Qe(`${i}[1]`,e[1],`string expected, ${a} found`));break;case"within":a=Qt(e[1]),e.length!==2?c.push(new Qe(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="object"&&c.push(new Qe(`${i}[1]`,e[1],`object expected, ${a} found`))}return c}function Ll(t,e){const i=t.key,n=t.style,a=t.styleSpec,c=t.value,h=t.objectKey,d=a[`${e}_${t.layerType}`];if(!d)return[];const m=h.match(/^(.*)-transition$/);if(e==="paint"&&m&&d[m[1]]&&d[m[1]].transition)return nr({key:i,value:c,valueSpec:a.transition,style:n,styleSpec:a});const _=t.valueSpec||d[h];if(!_)return[new Qe(i,c,`unknown property "${h}"`)];let b;if(Qt(c)==="string"&&Kn(_)&&!_.tokens&&(b=/^{([^}]+)}$/.exec(c)))return[new Qe(i,c,`"${h}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(b[1])} }\`.`)];const T=[];return t.layerType==="symbol"&&(h==="text-field"&&n&&!n.glyphs&&T.push(new Qe(i,c,'use of "text-field" requires a style "glyphs" property')),h==="text-font"&&Es(cn(c))&&Ni(c.type)==="identity"&&T.push(new Qe(i,c,'"text-font" does not support identity functions'))),T.concat(nr({key:t.key,value:c,valueSpec:_,style:n,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:h}))}function Rl(t){return Ll(t,"paint")}function pu(t){return Ll(t,"layout")}function Ma(t){let e=[];const i=t.value,n=t.key,a=t.style,c=t.styleSpec;i.type||i.ref||e.push(new Qe(n,i,'either "type" or "ref" is required'));let h=Ni(i.type);const d=Ni(i.ref);if(i.id){const m=Ni(i.id);for(let _=0;_<t.arrayIndex;_++){const b=a.layers[_];Ni(b.id)===m&&e.push(new Qe(n,i.id,`duplicate layer id "${i.id}", previously used at line ${b.id.__line__}`))}}if("ref"in i){let m;["type","source","source-layer","filter","layout"].forEach(_=>{_ in i&&e.push(new Qe(n,i[_],`"${_}" is prohibited for ref layers`))}),a.layers.forEach(_=>{Ni(_.id)===d&&(m=_)}),m?m.ref?e.push(new Qe(n,i.ref,"ref cannot reference another ref layer")):h=Ni(m.type):typeof d=="string"&&e.push(new Qe(n,i.ref,`ref layer "${d}" not found`))}else if(h!=="background"&&h!=="sky")if(i.source){const m=a.sources&&a.sources[i.source],_=m&&Ni(m.type);m?_==="vector"&&h==="raster"?e.push(new Qe(n,i.source,`layer "${i.id}" requires a raster source`)):_==="raster"&&h!=="raster"?e.push(new Qe(n,i.source,`layer "${i.id}" requires a vector source`)):_!=="vector"||i["source-layer"]?_==="raster-dem"&&h!=="hillshade"?e.push(new Qe(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):h!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||_==="geojson"&&m.lineMetrics||e.push(new Qe(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Qe(n,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Qe(n,i.source,`source "${i.source}" not found`))}else e.push(new Qe(n,i,'missing required property "source"'));return e=e.concat(zr({key:n,value:i,valueSpec:c.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>nr({key:`${n}.type`,value:i.type,valueSpec:c.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:m=>Cs(ln({layerType:h},m)),layout:m=>zr({layer:i,key:m.key,value:m.value,valueSpec:{},style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":_=>pu(ln({layerType:h},_))}}),paint:m=>zr({layer:i,key:m.key,value:m.value,valueSpec:{},style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":_=>Rl(ln({layerType:h},_))}})}})),e}function hn(t){const e=t.value,i=t.key,n=Qt(e);return n!=="string"?[new Qe(i,e,`string expected, ${n} found`)]:[]}const Bl={promoteId:function({key:t,value:e}){if(Qt(e)==="string")return hn({key:t,value:e});{const i=[];for(const n in e)i.push(...hn({key:`${t}.${n}`,value:e[n]}));return i}}};function du(t){const e=t.value,i=t.key,n=t.styleSpec,a=t.style;if(!e.type)return[new Qe(i,e,'"type" is required')];const c=Ni(e.type);let h;switch(c){case"vector":case"raster":case"raster-dem":return h=zr({key:i,value:e,valueSpec:n[`source_${c.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:Bl}),h;case"geojson":if(h=zr({key:i,value:e,valueSpec:n.source_geojson,style:a,styleSpec:n,objectElementValidators:Bl}),e.cluster)for(const d in e.clusterProperties){const[m,_]=e.clusterProperties[d],b=typeof m=="string"?[m,["accumulated"],["get",d]]:m;h.push(...Do({key:`${i}.${d}.map`,value:_,expressionContext:"cluster-map"})),h.push(...Do({key:`${i}.${d}.reduce`,value:b,expressionContext:"cluster-reduce"}))}return h;case"video":return zr({key:i,value:e,valueSpec:n.source_video,style:a,styleSpec:n});case"image":return zr({key:i,value:e,valueSpec:n.source_image,style:a,styleSpec:n});case"canvas":return[new Qe(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Sa({key:`${i}.type`,value:e.type,valueSpec:{values:fu(n)},style:a,styleSpec:n})}}function fu(t){return t.source.reduce((e,i)=>{const n=t[i];return n.type.type==="enum"&&(e=e.concat(Object.keys(n.type.values))),e},[])}function mu(t){const e=t.value,i=t.styleSpec,n=i.light,a=t.style;let c=[];const h=Qt(e);if(e===void 0)return c;if(h!=="object")return c=c.concat([new Qe("light",e,`object expected, ${h} found`)]),c;for(const d in e){const m=d.match(/^(.*)-transition$/);c=c.concat(m&&n[m[1]]&&n[m[1]].transition?nr({key:d,value:e[d],valueSpec:i.transition,style:a,styleSpec:i}):n[d]?nr({key:d,value:e[d],valueSpec:n[d],style:a,styleSpec:i}):[new Qe(d,e[d],`unknown property "${d}"`)])}return c}function Ca(t){const e=t.value,i=t.key,n=t.style,a=t.styleSpec,c=a.terrain;let h=[];const d=Qt(e);if(e===void 0)return h;if(d!=="object")return h=h.concat([new Qe("terrain",e,`object expected, ${d} found`)]),h;for(const m in e){const _=m.match(/^(.*)-transition$/);h=h.concat(_&&c[_[1]]&&c[_[1]].transition?nr({key:m,value:e[m],valueSpec:a.transition,style:n,styleSpec:a}):c[m]?nr({key:m,value:e[m],valueSpec:c[m],style:n,styleSpec:a}):[new Qe(m,e[m],`unknown property "${m}"`)])}if(e.source){const m=n.sources&&n.sources[e.source],_=m&&Ni(m.type);m?_!=="raster-dem"&&h.push(new Qe(i,e.source,`terrain cannot be used with a source of type ${String(_)}, it only be used with a "raster-dem" source type`)):h.push(new Qe(i,e.source,`source "${e.source}" not found`))}else h.push(new Qe(i,e,'terrain is missing required property "source"'));return h}function _u(t){const e=t.value,i=t.style,n=t.styleSpec,a=n.fog;let c=[];const h=Qt(e);if(e===void 0)return c;if(h!=="object")return c=c.concat([new Qe("fog",e,`object expected, ${h} found`)]),c;for(const d in e){const m=d.match(/^(.*)-transition$/);c=c.concat(m&&a[m[1]]&&a[m[1]].transition?nr({key:d,value:e[d],valueSpec:n.transition,style:i,styleSpec:n}):a[d]?nr({key:d,value:e[d],valueSpec:a[d],style:i,styleSpec:n}):[new Qe(d,e[d],`unknown property "${d}"`)])}return c}const gu={"*":()=>[],array:As,boolean:function(t){const e=t.value,i=t.key,n=Qt(e);return n!=="boolean"?[new Qe(i,e,`boolean expected, ${n} found`)]:[]},number:su,color:function(t){const e=t.key,i=t.value,n=Qt(i);return n!=="string"?[new Qe(e,i,`color expected, ${n} found`)]:cs(i)===null?[new Qe(e,i,`color expected, "${i}" found`)]:[]},enum:Sa,filter:Cs,function:au,layer:Ma,object:zr,source:du,light:mu,terrain:Ca,fog:_u,string:hn,formatted:function(t){return hn(t).length===0?[]:Do(t)},resolvedImage:function(t){return hn(t).length===0?[]:Do(t)},projection:function(t){const e=t.value,i=t.styleSpec,n=i.projection,a=t.style;let c=[];const h=Qt(e);if(h==="object")for(const d in e)c=c.concat(nr({key:d,value:e[d],valueSpec:n[d],style:a,styleSpec:i}));else h!=="string"&&(c=c.concat([new Qe("projection",e,`object or string expected, ${h} found`)]));return c}};function nr(t){const e=t.value,i=t.valueSpec,n=t.styleSpec;return i.expression&&Es(Ni(e))?au(t):i.expression&&Ss(cn(e))?Do(t):i.type&&gu[i.type]?gu[i.type](t):zr(ln({},t,{valueSpec:i.type?n[i.type]:i}))}function Xh(t){const e=t.value,i=t.key,n=hn(t);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new Qe(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new Qe(i,e,'"glyphs" url must include a "{range}" token'))),n}function Ol(t,e=Me){return pn(nr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Xh,"*":()=>[]}}))}const Wh=t=>pn(Rl(t)),Hh=t=>pn(pu(t));function pn(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function yu(t,e){let i=!1;if(e&&e.length)for(const n of e)t.fire(new An(new Error(n.message))),i=!0;return i}var Oo=Hr;function Hr(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(i=a[2]);for(var c=0;c<this.d*this.d;c++){var h=a[3+c],d=a[3+c+1];n.push(h===d?null:a.subarray(h,d))}var m=a[3+n.length+1];this.keys=a.subarray(a[3+n.length],m),this.bboxes=a.subarray(m),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var _=0;_<this.d*this.d;_++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var b=i/e*t;this.min=-b,this.max=t+b}Hr.prototype.insert=function(t,e,i,n,a){this._forEachCell(e,i,n,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(a)},Hr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Hr.prototype._insertCell=function(t,e,i,n,a,c){this.cells[a].push(c)},Hr.prototype.query=function(t,e,i,n,a){var c=this.min,h=this.max;if(t<=c&&e<=c&&h<=i&&h<=n&&!a)return Array.prototype.slice.call(this.keys);var d=[];return this._forEachCell(t,e,i,n,this._queryCell,d,{},a),d},Hr.prototype._queryCell=function(t,e,i,n,a,c,h,d){var m=this.cells[a];if(m!==null)for(var _=this.keys,b=this.bboxes,T=0;T<m.length;T++){var S=m[T];if(h[S]===void 0){var M=4*S;(d?d(b[M+0],b[M+1],b[M+2],b[M+3]):t<=b[M+2]&&e<=b[M+3]&&i>=b[M+0]&&n>=b[M+1])?(h[S]=!0,c.push(_[S])):h[S]=!1}}},Hr.prototype._forEachCell=function(t,e,i,n,a,c,h,d){for(var m=this._convertToCellCoord(t),_=this._convertToCellCoord(e),b=this._convertToCellCoord(i),T=this._convertToCellCoord(n),S=m;S<=b;S++)for(var M=_;M<=T;M++){var C=this.d*M+S;if((!d||d(this._convertFromCellCoord(S),this._convertFromCellCoord(M),this._convertFromCellCoord(S+1),this._convertFromCellCoord(M+1)))&&a.call(this,t,e,i,n,C,c,h,d))return}},Hr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Hr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Hr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var c=e,h=0;h<t.length;h++){var d=t[h];a[3+h]=c,a.set(d,c),c+=d.length}return a[3+t.length]=c,a.set(this.keys,c),a[3+t.length+1]=c+=this.keys.length,a.set(this.bboxes,c),c+=this.bboxes.length,a.buffer};const ka={};function it(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),ka[e]={klass:t,omit:i.omit||[]}}it(Object,"Object"),Oo.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},Oo.deserialize=function(t){return new Oo(t.buffer)},Object.defineProperty(Oo,"name",{value:"Grid"}),it(Oo,"Grid"),it(ki,"Color"),it(Error,"Error"),it(is,"AJAXError"),it(kr,"ResolvedImage"),it(Po,"StylePropertyFunction"),it(Ta,"StyleExpression",{omit:["_evaluator"]}),it(Ea,"ZoomDependentExpression"),it(Pn,"ZoomConstantExpression"),it(kn,"CompoundExpression",{omit:["_evaluate"]});for(const t in Ts)ka[Ts[t]._classRegistryKey]||it(Ts[t],`Expression${t}`);function xu(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function vu(t){return re.ImageBitmap&&t instanceof re.ImageBitmap}function Dn(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(xu(t)||vu(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof re.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const n of t)i.push(Dn(n,e));return i}if(typeof t=="object"){const i=t.constructor,n=i._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const a=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const c in t)t.hasOwnProperty(c)&&(ka[n].omit.indexOf(c)>=0||(a[c]=Dn(t[c],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(a.$name=n),a}throw new Error("can't serialize object of type "+typeof t)}function ks(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||xu(t)||vu(t)||ArrayBuffer.isView(t)||t instanceof re.ImageData)return t;if(Array.isArray(t))return t.map(ks);if(typeof t=="object"){const e=t.$name||"Object",{klass:i}=ka[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const a of Object.keys(t))a!=="$name"&&(n[a]=ks(t[a]));return n}throw new Error("can't deserialize object of type "+typeof t)}const Fl=t=>t>=1536&&t<=1791,bu=t=>t>=1872&&t<=1919,Ul=t=>t>=2208&&t<=2303,jl=t=>t>=11904&&t<=12031,Nl=t=>t>=12032&&t<=12255,Vl=t=>t>=12272&&t<=12287,Fo=t=>t>=12288&&t<=12351,zs=t=>t>=12352&&t<=12447,za=t=>t>=12448&&t<=12543,wu=t=>t>=12544&&t<=12591,Gl=t=>t>=12704&&t<=12735,Tu=t=>t>=12736&&t<=12783,Eu=t=>t>=12784&&t<=12799,Su=t=>t>=12800&&t<=13055,Iu=t=>t>=13056&&t<=13311,Au=t=>t>=13312&&t<=19903,$l=t=>t>=19968&&t<=40959,Mu=t=>t>=40960&&t<=42127,Cu=t=>t>=42128&&t<=42191,ql=t=>t>=44032&&t<=55215,Ps=t=>t>=63744&&t<=64255,l=t=>t>=64336&&t<=65023,r=t=>t>=65040&&t<=65055,s=t=>t>=65072&&t<=65103,u=t=>t>=65104&&t<=65135,p=t=>t>=65136&&t<=65279,f=t=>t>=65280&&t<=65519;function g(t){for(const e of t)if(A(e.charCodeAt(0)))return!0;return!1}function v(t){for(const e of t)if(!w(e.charCodeAt(0)))return!1;return!0}function w(t){return!(Fl(t)||bu(t)||Ul(t)||l(t)||p(t))}function A(t){return!(t!==746&&t!==747&&(t<4352||!(Gl(t)||wu(t)||s(t)&&!(t>=65097&&t<=65103)||Ps(t)||Iu(t)||jl(t)||Tu(t)||!(!Fo(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Au(t)||$l(t)||Su(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||ql(t)||zs(t)||Vl(t)||(e=>e>=12688&&e<=12703)(t)||Nl(t)||Eu(t)||za(t)&&t!==12540||!(!f(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!u(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||r(t)||(e=>e>=19904&&e<=19967)(t)||Mu(t)||Cu(t))))}function I(t){return!(A(t)||function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Fo(e)||za(e)||(i=>i>=57344&&i<=63743)(e)||s(e)||u(e)||f(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function P(t){return t>=1424&&t<=2303||l(t)||p(t)}function R(t,e){return!(!e&&P(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(i=>i>=6016&&i<=6143)(t))}function N(t){for(const e of t)if(P(e.charCodeAt(0)))return!0;return!1}const j="deferred",V="loading",F="loaded";let U=null,X="unavailable",G=null;const Y=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(X="error"),U&&U(t)};function oe(){ie.fire(new qr("pluginStateChange",{pluginStatus:X,pluginURL:G}))}const ie=new Cr,ce=function(){return X},xe=function(){if(X!==j||!G)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");X=V,oe(),G&&En({url:G},t=>{t?Y(t):(X=F,oe())})},_e={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>X===F||_e.applyArabicShaping!=null,isLoading:()=>X===V,setState(t){X=t.pluginStatus,G=t.pluginURL},isParsed:()=>_e.applyArabicShaping!=null&&_e.processBidirectionalText!=null&&_e.processStyledBidirectionalText!=null,getPluginURL:()=>G};class ue{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,n){for(const a of i)if(!R(a.charCodeAt(0),n))return!1;return!0}(e,_e.isLoaded())}}class Ue{constructor(e,i){this.property=e,this.value=i,this.expression=function(n,a){if(Es(n))return new Po(n,a);if(Ss(n)){const c=Pl(n,a);if(c.result==="error")throw new Error(c.value.map(h=>`${h.key}: ${h.message}`).join(", "));return c.value}{let c=n;return typeof n=="string"&&a.type==="color"&&(c=ki.parse(n)),{kind:"constant",evaluate:()=>c}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,n){return this.property.possiblyEvaluate(this,e,i,n)}}class fe{constructor(e){this.property=e,this.value=new Ue(e,void 0)}transitioned(e,i){return new be(this.property,this.value,i,Ye({},e.transition,this.transition),e.now)}untransitioned(){return new be(this.property,this.value,null,{},0)}}class Ae{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Mi(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new fe(this._values[e].property)),this._values[e].value=new Ue(this._values[e].property,i===null?void 0:Mi(i))}getTransition(e){return Mi(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new fe(this._values[e].property)),this._values[e].transition=Mi(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const n=this.getValue(i);n!==void 0&&(e[i]=n);const a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const n=new Re(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].transitioned(e,i._values[a]);return n}untransitioned(){const e=new Re(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class be{constructor(e,i,n,a,c){const h=a.delay||0,d=a.duration||0;c=c||0,this.property=e,this.value=i,this.begin=c+h,this.end=this.begin+d,e.specification.transition&&(a.delay||a.duration)&&(this.prior=n)}possiblyEvaluate(e,i,n){const a=e.now||0,c=this.value.possiblyEvaluate(e,i,n),h=this.prior;if(h){if(a>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(a<this.begin)return h.possiblyEvaluate(e,i,n);{const d=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,i,n),c,Tr(d))}}return c}}class Re{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,n){const a=new je(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,i,n);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Mi(this._values[e].value)}setValue(e,i){this._values[e]=new Ue(this._values[e].property,i===null?void 0:Mi(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const n=this.getValue(i);n!==void 0&&(e[i]=n)}return e}possiblyEvaluate(e,i,n){const a=new je(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,i,n);return a}}class Pe{constructor(e,i,n){this.property=e,this.value=i,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,n,a){return this.property.evaluate(this.value,this.parameters,e,i,n,a)}}class je{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class he{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,n){const a=pa[this.specification.type];return a?a(e,i,n):e}}class ve{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,n,a){return new Pe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},n,a)}:e.expression,i)}interpolate(e,i,n){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Pe(this,{kind:"constant",value:void 0},e.parameters);const a=pa[this.specification.type];return a?new Pe(this,{kind:"constant",value:a(e.value.value,i.value.value,n)},e.parameters):e}evaluate(e,i,n,a,c,h){return e.kind==="constant"?e.value:e.evaluate(i,n,a,c,h)}}class nt{constructor(e){this.specification=e}possiblyEvaluate(e,i,n,a){return!!e.expression.evaluate(i,null,{},n,a)}interpolate(){return!1}}class ut{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new ue(0,{});for(const n in e){const a=e[n];a.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new Ue(a,void 0),h=this.defaultTransitionablePropertyValues[n]=new fe(a);this.defaultTransitioningPropertyValues[n]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate(i)}}}function ot(t,e){return 256*(t=Tt(Math.floor(t),0,255))+Tt(Math.floor(e),0,255)}it(ve,"DataDrivenProperty"),it(he,"DataConstantProperty"),it(nt,"ColorRampProperty");const xt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class At{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ht{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function et(t,e=1){let i=0,n=0;return{members:t.map(a=>{const c=xt[a.type].BYTES_PER_ELEMENT,h=i=ni(i,Math.max(e,c)),d=a.components||1;return n=Math.max(n,c),i+=c*d,{name:a.name,type:a.type,components:d,offset:h}}),size:ni(i,Math.max(n,e)),alignment:e}}function ni(t,e){return Math.ceil(t/e)*e}class Yt extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=n,e}}Yt.prototype.bytesPerElement=4,it(Yt,"StructArrayLayout2i4");class pi extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,n)}emplace(e,i,n,a){const c=3*e;return this.int16[c+0]=i,this.int16[c+1]=n,this.int16[c+2]=a,e}}pi.prototype.bytesPerElement=6,it(pi,"StructArrayLayout3i6");class li extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n,a)}emplace(e,i,n,a,c){const h=4*e;return this.int16[h+0]=i,this.int16[h+1]=n,this.int16[h+2]=a,this.int16[h+3]=c,e}}li.prototype.bytesPerElement=8,it(li,"StructArrayLayout4i8");class gr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,n,a,c,h,d)}emplace(e,i,n,a,c,h,d,m){const _=6*e,b=12*e,T=3*e;return this.int16[_+0]=i,this.int16[_+1]=n,this.uint8[b+4]=a,this.uint8[b+5]=c,this.uint8[b+6]=h,this.uint8[b+7]=d,this.float32[T+2]=m,e}}gr.prototype.bytesPerElement=12,it(gr,"StructArrayLayout2i4ub1f12");class Ar extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n,a)}emplace(e,i,n,a,c){const h=4*e;return this.float32[h+0]=i,this.float32[h+1]=n,this.float32[h+2]=a,this.float32[h+3]=c,e}}Ar.prototype.bytesPerElement=16,it(Ar,"StructArrayLayout4f16");class hr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,n,a,c)}emplace(e,i,n,a,c,h){const d=6*e,m=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=n,this.uint16[d+2]=a,this.uint16[d+3]=c,this.float32[m+2]=h,e}}hr.prototype.bytesPerElement=12,it(hr,"StructArrayLayout4ui1f12");class Yr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n,a)}emplace(e,i,n,a,c){const h=4*e;return this.uint16[h+0]=i,this.uint16[h+1]=n,this.uint16[h+2]=a,this.uint16[h+3]=c,e}}Yr.prototype.bytesPerElement=8,it(Yr,"StructArrayLayout4ui8");class xi extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,n,a,c,h)}emplace(e,i,n,a,c,h,d){const m=6*e;return this.int16[m+0]=i,this.int16[m+1]=n,this.int16[m+2]=a,this.int16[m+3]=c,this.int16[m+4]=h,this.int16[m+5]=d,e}}xi.prototype.bytesPerElement=12,it(xi,"StructArrayLayout6i12");class di extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,h,d,m,_,b,T,S){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,n,a,c,h,d,m,_,b,T,S)}emplace(e,i,n,a,c,h,d,m,_,b,T,S,M){const C=12*e;return this.int16[C+0]=i,this.int16[C+1]=n,this.int16[C+2]=a,this.int16[C+3]=c,this.uint16[C+4]=h,this.uint16[C+5]=d,this.uint16[C+6]=m,this.uint16[C+7]=_,this.int16[C+8]=b,this.int16[C+9]=T,this.int16[C+10]=S,this.int16[C+11]=M,e}}di.prototype.bytesPerElement=24,it(di,"StructArrayLayout4i4ui4i24");class Xt extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,n,a,c,h)}emplace(e,i,n,a,c,h,d){const m=10*e,_=5*e;return this.int16[m+0]=i,this.int16[m+1]=n,this.int16[m+2]=a,this.float32[_+2]=c,this.float32[_+3]=h,this.float32[_+4]=d,e}}Xt.prototype.bytesPerElement=20,it(Xt,"StructArrayLayout3i3f20");class Di extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Di.prototype.bytesPerElement=4,it(Di,"StructArrayLayout1ul4");class or extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,h,d,m,_,b,T,S,M){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,n,a,c,h,d,m,_,b,T,S,M)}emplace(e,i,n,a,c,h,d,m,_,b,T,S,M,C){const D=20*e,B=10*e;return this.int16[D+0]=i,this.int16[D+1]=n,this.int16[D+2]=a,this.int16[D+3]=c,this.int16[D+4]=h,this.float32[B+3]=d,this.float32[B+4]=m,this.float32[B+5]=_,this.float32[B+6]=b,this.int16[D+14]=T,this.uint32[B+8]=S,this.uint16[D+18]=M,this.uint16[D+19]=C,e}}or.prototype.bytesPerElement=40,it(or,"StructArrayLayout5i4f1i1ul2ui40");class fi extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,n,a,c,h,d)}emplace(e,i,n,a,c,h,d,m){const _=8*e;return this.int16[_+0]=i,this.int16[_+1]=n,this.int16[_+2]=a,this.int16[_+4]=c,this.int16[_+5]=h,this.int16[_+6]=d,this.int16[_+7]=m,e}}fi.prototype.bytesPerElement=16,it(fi,"StructArrayLayout3i2i2i16");class pr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,n,a,c)}emplace(e,i,n,a,c,h){const d=4*e,m=8*e;return this.float32[d+0]=i,this.float32[d+1]=n,this.float32[d+2]=a,this.int16[m+6]=c,this.int16[m+7]=h,e}}pr.prototype.bytesPerElement=16,it(pr,"StructArrayLayout2f1f2i16");class Ds extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n,a)}emplace(e,i,n,a,c){const h=12*e,d=3*e;return this.uint8[h+0]=i,this.uint8[h+1]=n,this.float32[d+1]=a,this.float32[d+2]=c,e}}Ds.prototype.bytesPerElement=12,it(Ds,"StructArrayLayout2ub2f12");class dn extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,n)}emplace(e,i,n,a){const c=3*e;return this.float32[c+0]=i,this.float32[c+1]=n,this.float32[c+2]=a,e}}dn.prototype.bytesPerElement=12,it(dn,"StructArrayLayout3f12");class sr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,n)}emplace(e,i,n,a){const c=3*e;return this.uint16[c+0]=i,this.uint16[c+1]=n,this.uint16[c+2]=a,e}}sr.prototype.bytesPerElement=6,it(sr,"StructArrayLayout3ui6");class Pr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,h,d,m,_,b,T,S,M,C,D,B,H,ee,W,J,ne){const te=this.length;return this.resize(te+1),this.emplace(te,e,i,n,a,c,h,d,m,_,b,T,S,M,C,D,B,H,ee,W,J,ne)}emplace(e,i,n,a,c,h,d,m,_,b,T,S,M,C,D,B,H,ee,W,J,ne,te){const ye=30*e,ge=15*e,Ie=60*e;return this.int16[ye+0]=i,this.int16[ye+1]=n,this.int16[ye+2]=a,this.float32[ge+2]=c,this.float32[ge+3]=h,this.uint16[ye+8]=d,this.uint16[ye+9]=m,this.uint32[ge+5]=_,this.uint32[ge+6]=b,this.uint32[ge+7]=T,this.uint16[ye+16]=S,this.uint16[ye+17]=M,this.uint16[ye+18]=C,this.float32[ge+10]=D,this.float32[ge+11]=B,this.uint8[Ie+48]=H,this.uint8[Ie+49]=ee,this.uint8[Ie+50]=W,this.uint32[ge+13]=J,this.int16[ye+28]=ne,this.uint8[Ie+58]=te,e}}Pr.prototype.bytesPerElement=60,it(Pr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Kr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,h,d,m,_,b,T,S,M,C,D,B,H,ee,W,J,ne,te,ye,ge,Ie,Oe,we,ke,ze,Le){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,i,n,a,c,h,d,m,_,b,T,S,M,C,D,B,H,ee,W,J,ne,te,ye,ge,Ie,Oe,we,ke,ze,Le)}emplace(e,i,n,a,c,h,d,m,_,b,T,S,M,C,D,B,H,ee,W,J,ne,te,ye,ge,Ie,Oe,we,ke,ze,Le,Fe){const Te=38*e,$e=19*e;return this.int16[Te+0]=i,this.int16[Te+1]=n,this.int16[Te+2]=a,this.float32[$e+2]=c,this.float32[$e+3]=h,this.int16[Te+8]=d,this.int16[Te+9]=m,this.int16[Te+10]=_,this.int16[Te+11]=b,this.int16[Te+12]=T,this.int16[Te+13]=S,this.uint16[Te+14]=M,this.uint16[Te+15]=C,this.uint16[Te+16]=D,this.uint16[Te+17]=B,this.uint16[Te+18]=H,this.uint16[Te+19]=ee,this.uint16[Te+20]=W,this.uint16[Te+21]=J,this.uint16[Te+22]=ne,this.uint16[Te+23]=te,this.uint16[Te+24]=ye,this.uint16[Te+25]=ge,this.uint16[Te+26]=Ie,this.uint16[Te+27]=Oe,this.uint16[Te+28]=we,this.uint32[$e+15]=ke,this.float32[$e+16]=ze,this.float32[$e+17]=Le,this.float32[$e+18]=Fe,e}}Kr.prototype.bytesPerElement=76,it(Kr,"StructArrayLayout3i2f6i15ui1ul3f76");class Jr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Jr.prototype.bytesPerElement=4,it(Jr,"StructArrayLayout1f4");class Ls extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,n,a,c)}emplace(e,i,n,a,c,h){const d=5*e;return this.float32[d+0]=i,this.float32[d+1]=n,this.float32[d+2]=a,this.float32[d+3]=c,this.float32[d+4]=h,e}}Ls.prototype.bytesPerElement=20,it(Ls,"StructArrayLayout5f20");class Uo extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n,a)}emplace(e,i,n,a,c){const h=6*e;return this.uint32[3*e+0]=i,this.uint16[h+2]=n,this.uint16[h+3]=a,this.uint16[h+4]=c,e}}Uo.prototype.bytesPerElement=12,it(Uo,"StructArrayLayout1ul3ui12");class Qr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=n,e}}Qr.prototype.bytesPerElement=4,it(Qr,"StructArrayLayout2ui4");class Zl extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Zl.prototype.bytesPerElement=2,it(Zl,"StructArrayLayout1ui2");class ku extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=n,e}}ku.prototype.bytesPerElement=8,it(ku,"StructArrayLayout2f8");class Nd extends At{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Nd.prototype.size=40;class Yh extends or{get(e){return new Nd(this,e)}}it(Yh,"CollisionBoxArray");class Vd extends At{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Vd.prototype.size=60;class Gd extends Pr{get(e){return new Vd(this,e)}}it(Gd,"PlacedSymbolArray");class $d extends At{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}$d.prototype.size=76;class qd extends Kr{get(e){return new $d(this,e)}}it(qd,"SymbolInstanceArray");class Zd extends Jr{getoffsetX(e){return this.float32[1*e+0]}}it(Zd,"GlyphOffsetArray");class Xd extends Yt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}it(Xd,"SymbolLineVertexArray");class Wd extends At{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Wd.prototype.size=12;class Hd extends Uo{get(e){return new Wd(this,e)}}it(Hd,"FeatureIndexArray");class Yd extends Qr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}it(Yd,"FillExtrusionCentroidArray");const K_=et([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),J_=et([{name:"a_dash",components:4,type:"Uint16"}]);var Pa={exports:{}},Kd={exports:{}};Kd.exports=function(t,e){var i,n,a,c,h,d,m,_;for(n=t.length-(i=3&t.length),a=e,h=3432918353,d=461845907,_=0;_<n;)m=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24,++_,a=27492+(65535&(c=5*(65535&(a=(a^=m=(65535&(m=(m=(65535&m)*h+(((m>>>16)*h&65535)<<16)&4294967295)<<15|m>>>17))*d+(((m>>>16)*d&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(c>>>16)&65535)<<16);switch(m=0,i){case 3:m^=(255&t.charCodeAt(_+2))<<16;case 2:m^=(255&t.charCodeAt(_+1))<<8;case 1:a^=m=(65535&(m=(m=(65535&(m^=255&t.charCodeAt(_)))*h+(((m>>>16)*h&65535)<<16)&4294967295)<<15|m>>>17))*d+(((m>>>16)*d&65535)<<16)&4294967295}return a^=t.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0};var Jd={exports:{}};Jd.exports=function(t,e){for(var i,n=t.length,a=e^n,c=0;n>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24))+((1540483477*(i>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++c;switch(n){case 3:a^=(255&t.charCodeAt(c+2))<<16;case 2:a^=(255&t.charCodeAt(c+1))<<8;case 1:a=1540483477*(65535&(a^=255&t.charCodeAt(c)))+((1540483477*(a>>>16)&65535)<<16)}return a=1540483477*(65535&(a^=a>>>13))+((1540483477*(a>>>16)&65535)<<16),(a^=a>>>15)>>>0};var Qd=Kd.exports,Q_=Jd.exports;Pa.exports=Qd,Pa.exports.murmur3=Qd,Pa.exports.murmur2=Q_;class zu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,n,a){this.ids.push(ef(e)),this.positions.push(i,n,a)}getPositions(e){const i=ef(e);let n=0,a=this.ids.length-1;for(;n<a;){const h=n+a>>1;this.ids[h]>=i?a=h:n=h+1}const c=[];for(;this.ids[n]===i;)c.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return c}static serialize(e,i){const n=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Kh(n,a,0,n.length-1),i&&i.push(n.buffer,a.buffer),{ids:n,positions:a}}static deserialize(e){const i=new zu;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function ef(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Pa.exports(String(t))}function Kh(t,e,i,n){for(;i<n;){const a=t[i+n>>1];let c=i-1,h=n+1;for(;;){do c++;while(t[c]<a);do h--;while(t[h]>a);if(c>=h)break;Pu(t,c,h),Pu(e,3*c,3*h),Pu(e,3*c+1,3*h+1),Pu(e,3*c+2,3*h+2)}h-i<n-h?(Kh(t,e,i,h),i=h+1):(Kh(t,e,h+1,n),n=h)}}function Pu(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}it(zu,"FeaturePositionMap");class eo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Du extends eo{constructor(e){super(e),this.current=0}set(e,i,n){this.fetchUniformLocation(e,i)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class tf extends eo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,n){this.fetchUniformLocation(e,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class rf extends eo{constructor(e){super(e),this.current=ki.transparent}set(e,i,n){this.fetchUniformLocation(e,i)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const eg=new Float32Array(16),tg=new Float32Array(9),ig=new Float32Array(4);function Jh(t){return[ot(255*t.r,255*t.g),ot(255*t.b,255*t.a)]}class Xl{constructor(e,i,n){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=n}setUniform(e,i,n,a,c){i.set(e,c,a.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new rf(e):new Du(e)}}class Da{constructor(e,i){this.uniformNames=i.map(n=>`u_${n}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,n,a,c){const h=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;h&&i.set(e,c,h)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new tf(e):new Du(e)}}class to{constructor(e,i,n,a){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=i.map(c=>({name:`a_${c}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,n,a,c,h){const d=this.paintVertexArray.length,m=this.expression.evaluate(new ue(0),i,{},c,a,h);this.paintVertexArray.resize(e),this._setPaintValue(d,e,m)}updatePaintArray(e,i,n,a,c){const h=this.expression.evaluate({zoom:0},n,a,void 0,c);this._setPaintValue(e,i,h)}_setPaintValue(e,i,n){if(this.type==="color"){const a=Jh(n);for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fn{constructor(e,i,n,a,c,h){this.expression=e,this.uniformNames=i.map(d=>`u_${d}_t`),this.type=n,this.useIntegerZoom=a,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,n,a,c,h){const d=this.expression.evaluate(new ue(this.zoom),i,{},c,a,h),m=this.expression.evaluate(new ue(this.zoom+1),i,{},c,a,h),_=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(_,e,d,m)}updatePaintArray(e,i,n,a,c){const h=this.expression.evaluate({zoom:this.zoom},n,a,void 0,c),d=this.expression.evaluate({zoom:this.zoom+1},n,a,void 0,c);this._setPaintValue(e,i,h,d)}_setPaintValue(e,i,n,a){if(this.type==="color"){const c=Jh(n),h=Jh(a);for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,c[0],c[1],h[0],h[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,n,a);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,n,a,c){const h=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,d=Tt(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(e,c,d)}getBinding(e,i){return new Du(e)}}class jo{constructor(e,i,n,a,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(n==="array"?J_:K_).members;for(let h=0;h<i.length;++h);this.paintVertexArray=new a}populatePaintArray(e,i,n){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],n)}updatePaintArray(e,i,n,a,c,h){this._setPaintValues(e,i,n.patterns&&n.patterns[this.layerId],h)}_setPaintValues(e,i,n,a){if(!a||!n)return;const c=a[n];if(!c)return;const{tl:h,br:d,pixelRatio:m}=c;for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,h[0],h[1],d[0],d[1],m)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class No{constructor(e,i,n=()=>!0){this.binders={},this._buffers=[];const a=[];for(const c in e.paint._values){if(!n(c))continue;const h=e.paint.get(c);if(!(h instanceof Pe&&Kn(h.property.specification)))continue;const d=ng(c,e.type),m=h.value,_=h.property.specification.type,b=h.property.useIntegerZoom,T=c==="line-dasharray"||c.endsWith("pattern"),S=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(m.kind!=="constant"||S)if(m.kind==="source"||S||T){const M=nf(c,_,"source");this.binders[c]=T?new jo(m,d,_,M,e.id):new to(m,d,_,M),a.push(`/a_${c}`)}else{const M=nf(c,_,"composite");this.binders[c]=new fn(m,d,_,b,i,M),a.push(`/z_${c}`)}else this.binders[c]=T?new Da(m.value,d):new Xl(m.value,d,_),a.push(`/u_${c}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof to||i instanceof fn?i.maxValue:0}populatePaintArrays(e,i,n,a,c,h){for(const d in this.binders){const m=this.binders[d];(m instanceof to||m instanceof fn||m instanceof jo)&&m.populatePaintArray(e,i,n,a,c,h)}}setConstantPatternPositions(e){for(const i in this.binders){const n=this.binders[i];n instanceof Da&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,i,n,a,c,h){let d=!1;for(const m in e){const _=i.getPositions(m);for(const b of _){const T=n.feature(b.index);for(const S in this.binders){const M=this.binders[S];if((M instanceof to||M instanceof fn||M instanceof jo)&&M.expression.isStateDependent===!0){const C=a.paint.get(S);M.expression=C.value,M.updatePaintArray(b.start,b.end,T,e[m],c,h),d=!0}}}}return d}defines(){const e=[];for(const i in this.binders){const n=this.binders[i];(n instanceof Xl||n instanceof Da)&&e.push(...n.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof to||n instanceof fn||n instanceof jo)for(let a=0;a<n.paintVertexAttributes.length;a++)e.push(n.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof Xl||n instanceof Da||n instanceof fn)for(const a of n.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Xl||a instanceof Da||a instanceof fn)for(const c of a.uniformNames)i.push({name:c,property:n,binding:a.getBinding(e,c)})}return i}setUniforms(e,i,n,a,c){for(const{name:h,property:d,binding:m}of n)this.binders[d].setUniform(e,m,c,a.get(d),h)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof to||i instanceof fn||i instanceof jo)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const n=this.binders[i];(n instanceof to||n instanceof fn||n instanceof jo)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof to||i instanceof fn||i instanceof jo)&&i.destroy()}}}class Rs{constructor(e,i,n=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new No(a,i,n);this.needsUpload=!1,this._featureMap=new zu,this._bufferOffset=0}populatePaintArrays(e,i,n,a,c,h,d){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,i,a,c,h,d);i.id!==void 0&&this._featureMap.add(i.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,n,a,c){for(const h of n)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,i,h,a,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const rg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function ng(t,e){return rg[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const og={"line-pattern":{source:hr,composite:hr},"fill-pattern":{source:hr,composite:hr},"fill-extrusion-pattern":{source:hr,composite:hr},"line-dasharray":{source:Yr,composite:Yr}},sg={color:{source:ku,composite:Ar},number:{source:Jr,composite:ku}};function nf(t,e,i){const n=og[t];return n&&n[i]||sg[e][i]}it(Xl,"ConstantBinder"),it(Da,"PatternConstantBinder"),it(to,"SourceExpressionBinder"),it(jo,"PatternCompositeBinder"),it(fn,"CompositeExpressionBinder"),it(No,"ProgramConfiguration",{omit:["_buffers"]}),it(Rs,"ProgramConfigurationSet");const Lu="-transition";class mn extends Cr{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new Ee(i.layout)),i.paint)){this._transitionablePaint=new Ae(i.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new je(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,n={}){i!=null&&this._validate(Hh,`layers.${this.id}.layout.${e}`,e,i,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return ri(e,Lu)?this._transitionablePaint.getTransition(e.slice(0,-Lu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,n={}){if(i!=null&&this._validate(Wh,`layers.${this.id}.paint.${e}`,e,i,n))return!1;if(ri(e,Lu))return this._transitionablePaint.setTransition(e.slice(0,-Lu.length),i||void 0),!1;{const a=this._transitionablePaint._values[e],c=a.value.isDataDriven(),h=a.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const d=this._transitionablePaint._values[e].value,m=d.isDataDriven(),_=ri(e,"pattern")||e==="line-dasharray";return m||c||_||this._handleOverridablePaintPropertyUpdate(e,h,d)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ai(e,(i,n)=>!(i===void 0||n==="layout"&&!Object.keys(i).length||n==="paint"&&!Object.keys(i).length))}_validate(e,i,n,a,c={}){return(!c||c.validate!==!1)&&yu(this,e.call(Ol,{key:i,layerType:this.type,objectKey:n,value:a,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Pe&&Kn(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Qn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const ag=et([{name:"a_pos",components:2,type:"Int16"}],4),lg=et([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Gi{constructor(e=[]){this.segments=e}prepareSegment(e,i,n,a){let c=this.segments[this.segments.length-1];return e>Gi.MAX_VERTEX_ARRAY_LENGTH&&$t(`Max vertices per segment is ${Gi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>Gi.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==a)&&(c={vertexOffset:i.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},a!==void 0&&(c.sortKey=a),this.segments.push(c)),c}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,n,a){return new Gi([{vertexOffset:e,primitiveOffset:i,vertexLength:n,primitiveLength:a,vaos:{},sortKey:0}])}}Gi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,it(Gi,"SegmentVector");var bt=8192;class Vo{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof qt?new qt(e.lng,e.lat):qt.convert(e),this}setSouthWest(e){return this._sw=e instanceof qt?new qt(e.lng,e.lat):qt.convert(e),this}extend(e){const i=this._sw,n=this._ne;let a,c;if(e instanceof qt)a=e,c=e;else{if(!(e instanceof Vo))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Vo.convert(e)):this.extend(qt.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(qt.convert(e)):this;if(a=e._sw,c=e._ne,!a||!c)return this}return i||n?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),n.lng=Math.max(c.lng,n.lng),n.lat=Math.max(c.lat,n.lat)):(this._sw=new qt(a.lng,a.lat),this._ne=new qt(c.lng,c.lat)),this}getCenter(){return new qt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qt(this.getWest(),this.getNorth())}getSouthEast(){return new qt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:n}=qt.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&a}static convert(e){return!e||e instanceof Vo?e:new Vo(e)}}const Ru=63710088e-1;class qt{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qt(fr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,n=this.lat*i,a=e.lat*i,c=Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return Ru*Math.acos(Math.min(c,1))}toBounds(e=0){const i=360*e/40075017,n=i/Math.cos(Math.PI/180*this.lat);return new Vo(new qt(this.lng-n,this.lat-i),new qt(this.lng+n,this.lat+i))}static convert(e){if(e instanceof qt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new qt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new qt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const of=2*Math.PI*Ru;function Qh(t){return of*Math.cos(t*Math.PI/180)}function Ln(t){return(180+t)/360}function Rn(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function en(t,e){return t/Qh(e)}function Nr(t){return 360*t-180}function ar(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function sf(t,e){return t*Qh(ar(e))}const Bn=85.051129;function af(t){return 1/Math.cos(t*Math.PI/180)}class La{constructor(e,i,n=0){this.x=+e,this.y=+i,this.z=+n}static fromLngLat(e,i=0){const n=qt.convert(e);return new La(Ln(n.lng),Rn(n.lat),en(i,n.lat))}toLngLat(){return new qt(Nr(this.x),ar(this.y))}toAltitude(){return sf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/of*af(ar(this.y))}}function ep(t,e,i,n,a,c,h,d,m){const _=(e+n)/2,b=(i+a)/2,T=new Se(_,b);d(T),function(S,M,C,D,B,H){const ee=C-B,W=D-H;return Math.abs((D-M)*ee-(C-S)*W)/Math.hypot(ee,W)}(T.x,T.y,c.x,c.y,h.x,h.y)>=m?(ep(t,e,i,_,b,c,T,d,m),ep(t,_,b,n,a,T,h,d,m)):t.push(h)}function lf(t,e,i){let n=t[0],a=n.x,c=n.y;e(n);const h=[n];for(let d=1;d<t.length;d++){const m=t[d],{x:_,y:b}=m;e(m),ep(h,a,c,_,b,n,m,e,i),a=_,c=b,n=m}return h}function tp(t,e,i,n){if(n(e,i)){const a=e.add(i)._mult(.5);tp(t,e,a,n),tp(t,a,i,n)}else t.push(i)}function cg(t,e){let i=t[0];const n=[i];for(let a=1;a<t.length;a++){const c=t[a];tp(n,i,c,e),i=c}return n}const ip=Math.pow(2,14)-1,cf=-ip-1;function ug(t,e){const i=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=Tt(i,cf,ip),t.y=Tt(n,cf,ip),(i<t.x||i>t.x+1||n<t.y||n>t.y+1)&&$t("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function io(t,e,i){const n=t.loadGeometry(),a=t.extent,c=bt/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:d,x:m,y:_,projection:b}=i,T=S=>{const M=Nr((e.x+S.x/a)/h),C=ar((e.y+S.y/a)/h),D=b.project(M,C);S.x=(D.x*d-m)*a,S.y=(D.y*d-_)*a};for(let S=0;S<n.length;S++)if(t.type!==1)n[S]=lf(n[S],T,1);else{const M=[];for(const C of n[S])C.x<0||C.x>=a||C.y<0||C.y>=a||(T(C),M.push(C));n[S]=M}}for(const h of n)for(const d of h)ug(d,c);return n}function Bs(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?io(t):[]}}function Bu(t,e,i,n,a){t.emplaceBack(2*e+(n+1)/2,2*i+(a+1)/2)}function Ou(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class rp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Yt,this.indexArray=new sr,this.segments=new Gi,this.programConfigurations=new Rs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,n,a){const c=this.layers[0],h=[];let d=null;c.type==="circle"&&(d=c.layout.get("circle-sort-key"));for(const{feature:_,id:b,index:T,sourceLayerIndex:S}of e){const M=this.layers[0]._featureFilter.needGeometry,C=Bs(_,M);if(!this.layers[0]._featureFilter.filter(new ue(this.zoom),C,n))continue;const D=d?d.evaluate(C,{},n):void 0,B={id:b,properties:_.properties,type:_.type,sourceLayerIndex:S,index:T,geometry:M?C.geometry:io(_,n,a),patterns:{},sortKey:D};h.push(B)}d&&h.sort((_,b)=>_.sortKey-b.sortKey);let m=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new xi,m=a.projection);for(const _ of h){const{geometry:b,index:T,sourceLayerIndex:S}=_,M=e[T].feature;this.addFeature(_,b,T,i.availableImages,n,m),i.featureIndex.insert(M,b,T,S,this.index)}}update(e,i,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ag.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,lg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,n,a,c,h){for(const d of i)for(const m of d){const _=m.x,b=m.y;if(_<0||_>=bt||b<0||b>=bt)continue;if(h){const M=h.projectTilePoint(_,b,c),C=h.upVector(c,_,b),D=this.globeExtVertexArray;Ou(D,M,C),Ou(D,M,C),Ou(D,M,C),Ou(D,M,C)}const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=T.vertexLength;Bu(this.layoutVertexArray,_,b,-1,-1),Bu(this.layoutVertexArray,_,b,1,-1),Bu(this.layoutVertexArray,_,b,1,1),Bu(this.layoutVertexArray,_,b,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+2,S+3),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},a,c)}}function uf(t,e){for(let i=0;i<t.length;i++)if(Os(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Os(t,e[i]))return!0;return!!np(t,e)}function hg(t,e,i){return!!Os(t,e)||!!op(e,t,i)}function hf(t,e){if(t.length===1)return df(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let a=0;a<n.length;a++)if(Os(t,n[a]))return!0}for(let i=0;i<t.length;i++)if(df(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(np(t,e[i]))return!0;return!1}function pg(t,e,i){if(t.length>1){if(np(t,e))return!0;for(let n=0;n<e.length;n++)if(op(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(op(t[n],e,i))return!0;return!1}function np(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],a=t[i+1];for(let c=0;c<e.length-1;c++)if(dg(n,a,e[c],e[c+1]))return!0}return!1}function dg(t,e,i,n){return Ci(t,i,n)!==Ci(e,i,n)&&Ci(t,e,i)!==Ci(t,e,n)}function op(t,e,i){const n=i*i;if(e.length===1)return t.distSqr(e[0])<n;for(let a=1;a<e.length;a++)if(pf(t,e[a-1],e[a])<n)return!0;return!1}function pf(t,e,i){const n=e.distSqr(i);if(n===0)return t.distSqr(e);const a=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function df(t,e){let i,n,a,c=!1;for(let h=0;h<t.length;h++){i=t[h];for(let d=0,m=i.length-1;d<i.length;m=d++)n=i[d],a=i[m],n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(c=!c)}return c}function Os(t,e){let i=!1;for(let n=0,a=t.length-1;n<t.length;a=n++){const c=t[n],h=t[a];c.y>e.y!=h.y>e.y&&e.x<(h.x-c.x)*(e.y-c.y)/(h.y-c.y)+c.x&&(i=!i)}return i}function ff(t,e,i,n,a){for(const h of t)if(e<=h.x&&i<=h.y&&n>=h.x&&a>=h.y)return!0;const c=[new Se(e,i),new Se(e,a),new Se(n,a),new Se(n,i)];if(t.length>2){for(const h of c)if(Os(t,h))return!0}for(let h=0;h<t.length-1;h++)if(fg(t[h],t[h+1],c))return!0;return!1}function fg(t,e,i){const n=i[0],a=i[2];if(t.x<n.x&&e.x<n.x||t.x>a.x&&e.x>a.x||t.y<n.y&&e.y<n.y||t.y>a.y&&e.y>a.y)return!1;const c=Ci(t,e,i[0]);return c!==Ci(t,e,i[1])||c!==Ci(t,e,i[2])||c!==Ci(t,e,i[3])}function Ra(t,e,i){const n=e.paint.get(t).value;return n.kind==="constant"?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Fu(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function mf(t,e,i,n,a){if(!e[0]&&!e[1])return t;const c=Se.convert(e)._mult(a);i==="viewport"&&c._rotate(-n);const h=[];for(let d=0;d<t.length;d++)h.push(t[d].sub(c));return h}function _f(t,e,i,n){const a=Se.convert(t)._mult(n);return e==="viewport"&&a._rotate(-i),a}it(rp,"CircleBucket",{omit:["layers"]});const mg=new ut({"circle-sort-key":new ve(Me.layout_circle["circle-sort-key"])});var _g={paint:new ut({"circle-radius":new ve(Me.paint_circle["circle-radius"]),"circle-color":new ve(Me.paint_circle["circle-color"]),"circle-blur":new ve(Me.paint_circle["circle-blur"]),"circle-opacity":new ve(Me.paint_circle["circle-opacity"]),"circle-translate":new he(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new he(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new he(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new he(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ve(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ve(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ve(Me.paint_circle["circle-stroke-opacity"])}),layout:mg},Uu=1e-6,Dr=typeof Float32Array<"u"?Float32Array:Array;function gf(){var t=new Dr(9);return Dr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function yf(t,e,i){var n=e[0],a=e[1],c=e[2],h=e[3],d=e[4],m=e[5],_=e[6],b=e[7],T=e[8],S=i[0],M=i[1],C=i[2],D=i[3],B=i[4],H=i[5],ee=i[6],W=i[7],J=i[8];return t[0]=S*n+M*h+C*_,t[1]=S*a+M*d+C*b,t[2]=S*c+M*m+C*T,t[3]=D*n+B*h+H*_,t[4]=D*a+B*d+H*b,t[5]=D*c+B*m+H*T,t[6]=ee*n+W*h+J*_,t[7]=ee*a+W*d+J*b,t[8]=ee*c+W*m+J*T,t}function _n(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function sp(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],h=e[4],d=e[5],m=e[6],_=e[7],b=e[8],T=e[9],S=e[10],M=e[11],C=e[12],D=e[13],B=e[14],H=e[15],ee=i*d-n*h,W=i*m-a*h,J=i*_-c*h,ne=n*m-a*d,te=n*_-c*d,ye=a*_-c*m,ge=b*D-T*C,Ie=b*B-S*C,Oe=b*H-M*C,we=T*B-S*D,ke=T*H-M*D,ze=S*H-M*B,Le=ee*ze-W*ke+J*we+ne*Oe-te*Ie+ye*ge;return Le?(t[0]=(d*ze-m*ke+_*we)*(Le=1/Le),t[1]=(a*ke-n*ze-c*we)*Le,t[2]=(D*ye-B*te+H*ne)*Le,t[3]=(S*te-T*ye-M*ne)*Le,t[4]=(m*Oe-h*ze-_*Ie)*Le,t[5]=(i*ze-a*Oe+c*Ie)*Le,t[6]=(B*J-C*ye-H*W)*Le,t[7]=(b*ye-S*J+M*W)*Le,t[8]=(h*ke-d*Oe+_*ge)*Le,t[9]=(n*Oe-i*ke-c*ge)*Le,t[10]=(C*te-D*J+H*ee)*Le,t[11]=(T*J-b*te-M*ee)*Le,t[12]=(d*Ie-h*we-m*ge)*Le,t[13]=(i*we-n*Ie+a*ge)*Le,t[14]=(D*W-C*ne-B*ee)*Le,t[15]=(b*ne-T*W+S*ee)*Le,t):null}function Fs(t,e,i){var n=e[0],a=e[1],c=e[2],h=e[3],d=e[4],m=e[5],_=e[6],b=e[7],T=e[8],S=e[9],M=e[10],C=e[11],D=e[12],B=e[13],H=e[14],ee=e[15],W=i[0],J=i[1],ne=i[2],te=i[3];return t[0]=W*n+J*d+ne*T+te*D,t[1]=W*a+J*m+ne*S+te*B,t[2]=W*c+J*_+ne*M+te*H,t[3]=W*h+J*b+ne*C+te*ee,t[4]=(W=i[4])*n+(J=i[5])*d+(ne=i[6])*T+(te=i[7])*D,t[5]=W*a+J*m+ne*S+te*B,t[6]=W*c+J*_+ne*M+te*H,t[7]=W*h+J*b+ne*C+te*ee,t[8]=(W=i[8])*n+(J=i[9])*d+(ne=i[10])*T+(te=i[11])*D,t[9]=W*a+J*m+ne*S+te*B,t[10]=W*c+J*_+ne*M+te*H,t[11]=W*h+J*b+ne*C+te*ee,t[12]=(W=i[12])*n+(J=i[13])*d+(ne=i[14])*T+(te=i[15])*D,t[13]=W*a+J*m+ne*S+te*B,t[14]=W*c+J*_+ne*M+te*H,t[15]=W*h+J*b+ne*C+te*ee,t}function Wl(t,e,i){var n,a,c,h,d,m,_,b,T,S,M,C,D=i[0],B=i[1],H=i[2];return e===t?(t[12]=e[0]*D+e[4]*B+e[8]*H+e[12],t[13]=e[1]*D+e[5]*B+e[9]*H+e[13],t[14]=e[2]*D+e[6]*B+e[10]*H+e[14],t[15]=e[3]*D+e[7]*B+e[11]*H+e[15]):(a=e[1],c=e[2],h=e[3],d=e[4],m=e[5],_=e[6],b=e[7],T=e[8],S=e[9],M=e[10],C=e[11],t[0]=n=e[0],t[1]=a,t[2]=c,t[3]=h,t[4]=d,t[5]=m,t[6]=_,t[7]=b,t[8]=T,t[9]=S,t[10]=M,t[11]=C,t[12]=n*D+d*B+T*H+e[12],t[13]=a*D+m*B+S*H+e[13],t[14]=c*D+_*B+M*H+e[14],t[15]=h*D+b*B+C*H+e[15]),t}function Us(t,e,i){var n=i[0],a=i[1],c=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ap(t,e,i){var n=Math.sin(i),a=Math.cos(i),c=e[4],h=e[5],d=e[6],m=e[7],_=e[8],b=e[9],T=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*a+_*n,t[5]=h*a+b*n,t[6]=d*a+T*n,t[7]=m*a+S*n,t[8]=_*a-c*n,t[9]=b*a-h*n,t[10]=T*a-d*n,t[11]=S*a-m*n,t}function ju(t,e,i){var n=Math.sin(i),a=Math.cos(i),c=e[0],h=e[1],d=e[2],m=e[3],_=e[8],b=e[9],T=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*a-_*n,t[1]=h*a-b*n,t[2]=d*a-T*n,t[3]=m*a-S*n,t[8]=c*n+_*a,t[9]=h*n+b*a,t[10]=d*n+T*a,t[11]=m*n+S*a,t}function xf(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vf(t,e,i){var n,a,c,h=i[0],d=i[1],m=i[2],_=Math.hypot(h,d,m);return _<Uu?null:(h*=_=1/_,d*=_,m*=_,n=Math.sin(e),a=Math.cos(e),t[0]=h*h*(c=1-a)+a,t[1]=d*h*c+m*n,t[2]=m*h*c-d*n,t[3]=0,t[4]=h*d*c-m*n,t[5]=d*d*c+a,t[6]=m*d*c+h*n,t[7]=0,t[8]=h*m*c+d*n,t[9]=d*m*c-h*n,t[10]=m*m*c+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var gg=Fs;function lp(){var t=new Dr(3);return Dr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function bf(t){var e=new Dr(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Hl(t){return Math.hypot(t[0],t[1],t[2])}function Ba(t,e,i){var n=new Dr(3);return n[0]=t,n[1]=e,n[2]=i,n}function ro(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function cp(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function wf(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Yl(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function Kl(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function Vr(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Jl(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t}function yr(t,e){var i=e[0],n=e[1],a=e[2],c=i*i+n*n+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t}function tn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function up(t,e,i){var n=e[0],a=e[1],c=e[2],h=i[0],d=i[1],m=i[2];return t[0]=a*m-c*d,t[1]=c*h-n*m,t[2]=n*d-a*h,t}function Li(t,e,i){var n=e[0],a=e[1],c=e[2],h=i[3]*n+i[7]*a+i[11]*c+i[15];return t[0]=(i[0]*n+i[4]*a+i[8]*c+i[12])/(h=h||1),t[1]=(i[1]*n+i[5]*a+i[9]*c+i[13])/h,t[2]=(i[2]*n+i[6]*a+i[10]*c+i[14])/h,t}function Tf(t,e,i){var n=i[0],a=i[1],c=i[2],h=e[0],d=e[1],m=e[2],_=a*m-c*d,b=c*h-n*m,T=n*d-a*h,S=a*T-c*b,M=c*_-n*T,C=n*b-a*_,D=2*i[3];return b*=D,T*=D,M*=2,C*=2,t[0]=h+(_*=D)+(S*=2),t[1]=d+b+M,t[2]=m+T+C,t}var Ql,gn=cp,yg=wf,xg=Hl;function Ef(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Sf(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],h=i*i+n*n+a*a+c*c;return h>0&&(h=1/Math.sqrt(h)),t[0]=i*h,t[1]=n*h,t[2]=a*h,t[3]=c*h,t}function js(t,e,i){var n=e[0],a=e[1],c=e[2],h=e[3];return t[0]=i[0]*n+i[4]*a+i[8]*c+i[12]*h,t[1]=i[1]*n+i[5]*a+i[9]*c+i[13]*h,t[2]=i[2]*n+i[6]*a+i[10]*c+i[14]*h,t[3]=i[3]*n+i[7]*a+i[11]*c+i[15]*h,t}function If(){var t=new Dr(4);return Dr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Af(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Mf(t,e,i){i*=.5;var n=e[0],a=e[1],c=e[2],h=e[3],d=Math.sin(i),m=Math.cos(i);return t[0]=n*m+h*d,t[1]=a*m+c*d,t[2]=c*m-a*d,t[3]=h*m-n*d,t}function Cf(t,e,i){i*=.5;var n=e[0],a=e[1],c=e[2],h=e[3],d=Math.sin(i),m=Math.cos(i);return t[0]=n*m-c*d,t[1]=a*m+h*d,t[2]=c*m+n*d,t[3]=h*m-a*d,t}lp(),Ql=new Dr(4),Dr!=Float32Array&&(Ql[0]=0,Ql[1]=0,Ql[2]=0,Ql[3]=0);var vg=Sf;lp(),Ba(1,0,0),Ba(0,1,0),If(),If(),gf();class hp{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,n){const a=tn(i,this.dir);if(Math.abs(a)<1e-6)return!1;const c=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return n[0]=this.pos[0]+this.dir[0]*c,n[1]=this.pos[1]+this.dir[1]*c,n[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,i,n){if(function(M,C){var D=M[0],B=M[1],H=M[2],ee=C[0],W=C[1],J=C[2];return Math.abs(D-ee)<=Uu*Math.max(1,Math.abs(D),Math.abs(ee))&&Math.abs(B-W)<=Uu*Math.max(1,Math.abs(B),Math.abs(W))&&Math.abs(H-J)<=Uu*Math.max(1,Math.abs(H),Math.abs(J))}(this.pos,e)||i===0)return n[0]=n[1]=n[2]=0,!1;const[a,c,h]=this.dir,d=this.pos[0]-e[0],m=this.pos[1]-e[1],_=this.pos[2]-e[2],b=a*a+c*c+h*h,T=2*(d*a+m*c+_*h),S=T*T-4*b*(d*d+m*m+_*_-i*i);if(S<0){const M=Math.max(-T/2,0),C=d+a*M,D=m+c*M,B=_+h*M,H=Math.hypot(C,D,B);return n[0]=C*i/H,n[1]=D*i/H,n[2]=B*i/H,!1}{const M=(-T-Math.sqrt(S))/(2*b);if(M<0){const C=Math.hypot(d,m,_);return n[0]=d*i/C,n[1]=m*i/C,n[2]=_*i/C,!1}return n[0]=d+a*M,n[1]=m+c*M,n[2]=_+h*M,!0}}}class pp{constructor(e,i,n,a,c){this.TL=e,this.TR=i,this.BR=n,this.BL=a,this.horizon=c}static fromInvProjectionMatrix(e,i,n){const a=[-1,1,1],c=[1,1,1],h=[1,-1,1],d=[-1,-1,1],m=Li(a,a,e),_=Li(c,c,e),b=Li(h,h,e),T=Li(d,d,e);return new pp(m,_,b,T,i/n)}}class dp{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,n,a){const c=Math.pow(2,n),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(m=>{const _=js([],m,e),b=1/_[3]/i*c;return function(T,S,M){return T[0]=S[0]*M[0],T[1]=S[1]*M[1],T[2]=S[2]*M[2],T[3]=S[3]*M[3],T}(_,_,[b,b,a?1/_[3]:b,b])}),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(m=>{const _=yr([],up([],gn([],h[m[0]],h[m[1]]),gn([],h[m[2]],h[m[1]]))),b=-tn(_,h[m[1]]);return _.concat(b)});return new dp(h,d)}}class xr{static fromPoints(e){const i=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const a of e)Yl(i,i,a),Kl(n,n,a);return new xr(i,n)}static applyTransform(e,i){const n=e.getCorners();for(let a=0;a<n.length;++a)Li(n[a],n[a],i);return xr.fromPoints(n)}constructor(e,i){this.min=e,this.max=i,this.center=Vr([],ro([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],n=bf(this.min),a=bf(this.max);for(let c=0;c<i.length;c++)n[c]=i[c]?this.min[c]:this.center[c],a[c]=i[c]?this.center[c]:this.max[c];return a[2]=this.max[2],new xr(n,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let n=!0;for(let a=0;a<e.planes.length;a++){const c=e.planes[a];let h=0;for(let d=0;d<i.length;d++)h+=tn(c,i[d])+c[3]>=0;if(h===0)return 0;h!==i.length&&(n=!1)}if(n)return 2;for(let a=0;a<3;a++){let c=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let d=0;d<e.points.length;d++){const m=e.points[d][a]-this.min[a];c=Math.min(c,m),h=Math.max(h,m)}if(h<0||c>this.max[a]-this.min[a])return 0}return 1}}function kf(t,e,i,n,a,c,h,d,m){if(c&&t.queryGeometry.isAboveHorizon)return!1;c&&(m*=t.pixelToTileUnitsFactor);const _=t.tileID.canonical,b=i.projection.upVectorScale(_,i.center.lat,i.worldSize).metersToTile;for(const T of e)for(const S of T){const M=S.add(d),C=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(M.x,M.y,!0):0,D=i.projection.projectTilePoint(M.x,M.y,_);if(C>0){const W=i.projection.upVector(_,M.x,M.y);D.x+=W[0]*b*C,D.y+=W[1]*b*C,D.z+=W[2]*b*C}const B=c?M:bg(D.x,D.y,D.z,n),H=c?t.tilespaceRays.map(W=>Tg(W,C)):t.queryGeometry.screenGeometry,ee=js([],[D.x,D.y,D.z,1],n);if(!h&&c?m*=ee[3]/i.cameraToCenterDistance:h&&!c&&(m*=i.cameraToCenterDistance/ee[3]),c){const W=ar((S.y/bt+_.y)/(1<<_.z));m/=i.projection.pixelsPerMeter(W,1)/en(1,W)}if(hg(H,B,m))return!0}return!1}function bg(t,e,i,n){const a=js([],[t,e,i,1],n);return new Se(a[0]/a[3],a[1]/a[3])}const zf=Ba(0,0,0),wg=Ba(0,0,1);function Tg(t,e){const i=lp();return zf[2]=e,t.intersectsPlane(zf,wg,i),new Se(i[0],i[1])}class Pf extends rp{}function Df(t,{width:e,height:i},n,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*n)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=a,t}function Lf(t,e,i){const{width:n,height:a}=e;n===t.width&&a===t.height||(fp(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,a)},i),t.width=n,t.height=a,t.data=e.data)}function fp(t,e,i,n,a,c){if(a.width===0||a.height===0)return e;if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const h=t.data,d=e.data;for(let m=0;m<a.height;m++){const _=((i.y+m)*t.width+i.x)*c,b=((n.y+m)*e.width+n.x)*c;for(let T=0;T<a.width*c;T++)d[b+T]=h[_+T]}return e}it(Pf,"HeatmapBucket",{omit:["layers"]});class no{constructor(e,i){Df(this,e,1,i)}resize(e){Lf(this,new no(e),1)}clone(){return new no({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,n,a,c){fp(e,i,n,a,c,1)}}class Lr{constructor(e,i){Df(this,e,4,i)}resize(e){Lf(this,new Lr(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Lr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,n,a,c){fp(e,i,n,a,c,4)}}it(no,"AlphaImage"),it(Lr,"RGBAImage");var Eg={paint:new ut({"heatmap-radius":new ve(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ve(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new he(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nt(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new he(Me.paint_heatmap["heatmap-opacity"])})};function mp(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,a=t.image||new Lr({width:i,height:n}),c=(h,d,m)=>{e[t.evaluationKey]=m;const _=t.expression.evaluate(e);a.data[h+d+0]=Math.floor(255*_.r/_.a),a.data[h+d+1]=Math.floor(255*_.g/_.a),a.data[h+d+2]=Math.floor(255*_.b/_.a),a.data[h+d+3]=Math.floor(255*_.a)};if(t.clips)for(let h=0,d=0;h<n;++h,d+=4*i)for(let m=0,_=0;m<i;m++,_+=4){const b=m/(i-1),{start:T,end:S}=t.clips[h];c(d,_,T*(1-b)+S*b)}else for(let h=0,d=0;h<i;h++,d+=4)c(0,d,h/(i-1));return a}var Sg={paint:new ut({"hillshade-illumination-direction":new he(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new he(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new he(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new he(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new he(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new he(Me.paint_hillshade["hillshade-accent-color"])})};const Ig=et([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ag}=Ig;var ec={exports:{}};function Nu(t,e,i){i=i||2;var n,a,c,h,d,m,_,b=e&&e.length,T=b?e[0]*i:t.length,S=Rf(t,0,T,i,!0),M=[];if(!S||S.next===S.prev)return M;if(b&&(S=function(D,B,H,ee){var W,J,ne,te=[];for(W=0,J=B.length;W<J;W++)(ne=Rf(D,B[W]*ee,W<J-1?B[W+1]*ee:D.length,ee,!1))===ne.next&&(ne.steiner=!0),te.push(Rg(ne));for(te.sort(Pg),W=0;W<te.length;W++)H=Dg(te[W],H);return H}(t,e,S,i)),t.length>80*i){n=c=t[0],a=h=t[1];for(var C=i;C<T;C+=i)(d=t[C])<n&&(n=d),(m=t[C+1])<a&&(a=m),d>c&&(c=d),m>h&&(h=m);_=(_=Math.max(c-n,h-a))!==0?32767/_:0}return tc(S,M,i,n,a,_,0),M}function Rf(t,e,i,n,a){var c,h;if(a===yp(t,e,i,n)>0)for(c=e;c<i;c+=n)h=Ff(c,t[c],t[c+1],h);else for(c=i-n;c>=e;c-=n)h=Ff(c,t[c],t[c+1],h);return h&&Vu(h,h.next)&&(rc(h),h=h.next),h}function Ns(t,e){if(!t)return t;e||(e=t);var i,n=t;do if(i=!1,n.steiner||!Vu(n,n.next)&&Fi(n.prev,n,n.next)!==0)n=n.next;else{if(rc(n),(n=e=n.prev)===n.next)break;i=!0}while(i||n!==e);return e}function tc(t,e,i,n,a,c,h){if(t){!h&&c&&function(b,T,S,M){var C=b;do C.z===0&&(C.z=_p(C.x,C.y,T,S,M)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==b);C.prevZ.nextZ=null,C.prevZ=null,function(D){var B,H,ee,W,J,ne,te,ye,ge=1;do{for(H=D,D=null,J=null,ne=0;H;){for(ne++,ee=H,te=0,B=0;B<ge&&(te++,ee=ee.nextZ);B++);for(ye=ge;te>0||ye>0&&ee;)te!==0&&(ye===0||!ee||H.z<=ee.z)?(W=H,H=H.nextZ,te--):(W=ee,ee=ee.nextZ,ye--),J?J.nextZ=W:D=W,W.prevZ=J,J=W;H=ee}J.nextZ=null,ge*=2}while(ne>1)}(C)}(t,n,a,c);for(var d,m,_=t;t.prev!==t.next;)if(d=t.prev,m=t.next,c?Cg(t,n,a,c):Mg(t))e.push(d.i/i|0),e.push(t.i/i|0),e.push(m.i/i|0),rc(t),t=m.next,_=m.next;else if((t=m)===_){h?h===1?tc(t=kg(Ns(t),e,i),e,i,n,a,c,2):h===2&&zg(t,e,i,n,a,c):tc(Ns(t),e,i,n,a,c,1);break}}}function Mg(t){var e=t.prev,i=t,n=t.next;if(Fi(e,i,n)>=0)return!1;for(var a=e.x,c=i.x,h=n.x,d=e.y,m=i.y,_=n.y,b=a<c?a<h?a:h:c<h?c:h,T=d<m?d<_?d:_:m<_?m:_,S=a>c?a>h?a:h:c>h?c:h,M=d>m?d>_?d:_:m>_?m:_,C=n.next;C!==e;){if(C.x>=b&&C.x<=S&&C.y>=T&&C.y<=M&&Oa(a,d,c,m,h,_,C.x,C.y)&&Fi(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function Cg(t,e,i,n){var a=t.prev,c=t,h=t.next;if(Fi(a,c,h)>=0)return!1;for(var d=a.x,m=c.x,_=h.x,b=a.y,T=c.y,S=h.y,M=d<m?d<_?d:_:m<_?m:_,C=b<T?b<S?b:S:T<S?T:S,D=d>m?d>_?d:_:m>_?m:_,B=b>T?b>S?b:S:T>S?T:S,H=_p(M,C,e,i,n),ee=_p(D,B,e,i,n),W=t.prevZ,J=t.nextZ;W&&W.z>=H&&J&&J.z<=ee;){if(W.x>=M&&W.x<=D&&W.y>=C&&W.y<=B&&W!==a&&W!==h&&Oa(d,b,m,T,_,S,W.x,W.y)&&Fi(W.prev,W,W.next)>=0||(W=W.prevZ,J.x>=M&&J.x<=D&&J.y>=C&&J.y<=B&&J!==a&&J!==h&&Oa(d,b,m,T,_,S,J.x,J.y)&&Fi(J.prev,J,J.next)>=0))return!1;J=J.nextZ}for(;W&&W.z>=H;){if(W.x>=M&&W.x<=D&&W.y>=C&&W.y<=B&&W!==a&&W!==h&&Oa(d,b,m,T,_,S,W.x,W.y)&&Fi(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;J&&J.z<=ee;){if(J.x>=M&&J.x<=D&&J.y>=C&&J.y<=B&&J!==a&&J!==h&&Oa(d,b,m,T,_,S,J.x,J.y)&&Fi(J.prev,J,J.next)>=0)return!1;J=J.nextZ}return!0}function kg(t,e,i){var n=t;do{var a=n.prev,c=n.next.next;!Vu(a,c)&&Bf(a,n,n.next,c)&&ic(a,c)&&ic(c,a)&&(e.push(a.i/i|0),e.push(n.i/i|0),e.push(c.i/i|0),rc(n),rc(n.next),n=t=c),n=n.next}while(n!==t);return Ns(n)}function zg(t,e,i,n,a,c){var h=t;do{for(var d=h.next.next;d!==h.prev;){if(h.i!==d.i&&Bg(h,d)){var m=Of(h,d);return h=Ns(h,h.next),m=Ns(m,m.next),tc(h,e,i,n,a,c,0),void tc(m,e,i,n,a,c,0)}d=d.next}h=h.next}while(h!==t)}function Pg(t,e){return t.x-e.x}function Dg(t,e){var i=function(a,c){var h,d=c,m=a.x,_=a.y,b=-1/0;do{if(_<=d.y&&_>=d.next.y&&d.next.y!==d.y){var T=d.x+(_-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(T<=m&&T>b&&(b=T,h=d.x<d.next.x?d:d.next,T===m))return h}d=d.next}while(d!==c);if(!h)return null;var S,M=h,C=h.x,D=h.y,B=1/0;d=h;do m>=d.x&&d.x>=C&&m!==d.x&&Oa(_<D?m:b,_,C,D,_<D?b:m,_,d.x,d.y)&&(S=Math.abs(_-d.y)/(m-d.x),ic(d,a)&&(S<B||S===B&&(d.x>h.x||d.x===h.x&&Lg(h,d)))&&(h=d,B=S)),d=d.next;while(d!==M);return h}(t,e);if(!i)return e;var n=Of(i,t);return Ns(n,n.next),Ns(i,i.next)}function Lg(t,e){return Fi(t.prev,t,e.prev)<0&&Fi(e.next,t,t.next)<0}function _p(t,e,i,n,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Rg(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Oa(t,e,i,n,a,c,h,d){return(a-h)*(e-d)>=(t-h)*(c-d)&&(t-h)*(n-d)>=(i-h)*(e-d)&&(i-h)*(c-d)>=(a-h)*(n-d)}function Bg(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,n){var a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==n.i&&a.next.i!==n.i&&Bf(a,a.next,i,n))return!0;a=a.next}while(a!==i);return!1}(t,e)&&(ic(t,e)&&ic(e,t)&&function(i,n){var a=i,c=!1,h=(i.x+n.x)/2,d=(i.y+n.y)/2;do a.y>d!=a.next.y>d&&a.next.y!==a.y&&h<(a.next.x-a.x)*(d-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next;while(a!==i);return c}(t,e)&&(Fi(t.prev,t,e.prev)||Fi(t,e.prev,e))||Vu(t,e)&&Fi(t.prev,t,t.next)>0&&Fi(e.prev,e,e.next)>0)}function Fi(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Vu(t,e){return t.x===e.x&&t.y===e.y}function Bf(t,e,i,n){var a=$u(Fi(t,e,i)),c=$u(Fi(t,e,n)),h=$u(Fi(i,n,t)),d=$u(Fi(i,n,e));return a!==c&&h!==d||!(a!==0||!Gu(t,i,e))||!(c!==0||!Gu(t,n,e))||!(h!==0||!Gu(i,t,n))||!(d!==0||!Gu(i,e,n))}function Gu(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function $u(t){return t>0?1:t<0?-1:0}function ic(t,e){return Fi(t.prev,t,t.next)<0?Fi(t,e,t.next)>=0&&Fi(t,t.prev,e)>=0:Fi(t,e,t.prev)<0||Fi(t,t.next,e)<0}function Of(t,e){var i=new gp(t.i,t.x,t.y),n=new gp(e.i,e.x,e.y),a=t.next,c=e.prev;return t.next=e,e.prev=t,i.next=a,a.prev=i,n.next=i,i.prev=n,c.next=n,n.prev=c,n}function Ff(t,e,i,n){var a=new gp(t,e,i);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function rc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function gp(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yp(t,e,i,n){for(var a=0,c=e,h=i-n;c<i;c+=n)a+=(t[h]-t[c])*(t[c+1]+t[h+1]),h=c;return a}function Og(t,e,i,n,a){Uf(t,e,i||0,n||t.length-1,a||Fg)}function Uf(t,e,i,n,a){for(;n>i;){if(n-i>600){var c=n-i+1,h=e-i+1,d=Math.log(c),m=.5*Math.exp(2*d/3),_=.5*Math.sqrt(d*m*(c-m)/c)*(h-c/2<0?-1:1);Uf(t,e,Math.max(i,Math.floor(e-h*m/c+_)),Math.min(n,Math.floor(e+(c-h)*m/c+_)),a)}var b=t[e],T=i,S=n;for(nc(t,i,e),a(t[n],b)>0&&nc(t,i,n);T<S;){for(nc(t,T,S),T++,S--;a(t[T],b)<0;)T++;for(;a(t[S],b)>0;)S--}a(t[i],b)===0?nc(t,i,S):nc(t,++S,n),S<=e&&(i=S+1),e<=S&&(n=S-1)}}function nc(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Fg(t,e){return t<e?-1:t>e?1:0}function xp(t,e){const i=t.length;if(i<=1)return[t];const n=[];let a,c;for(let h=0;h<i;h++){const d=It(t[h]);d!==0&&(t[h].area=Math.abs(d),c===void 0&&(c=d<0),c===d<0?(a&&n.push(a),a=[t[h]]):a.push(t[h]))}if(a&&n.push(a),e>1)for(let h=0;h<n.length;h++)n[h].length<=e||(Og(n[h],e,1,n[h].length-1,Ug),n[h]=n[h].slice(0,e));return n}function Ug(t,e){return e.area-t.area}function vp(t,e,i){const n=i.patternDependencies;let a=!1;for(const c of e){const h=c.paint.get(`${t}-pattern`);h.isConstant()||(a=!0);const d=h.constantOr(null);d&&(a=!0,n[d]=!0)}return a}function bp(t,e,i,n,a){const c=a.patternDependencies;for(const h of e){const d=h.paint.get(`${t}-pattern`).value;if(d.kind!=="constant"){let m=d.evaluate({zoom:n},i,{},a.availableImages);m=m&&m.name?m.name:m,c[m]=!0,i.patterns[h.id]=m}}return i}ec.exports=Nu,ec.exports.default=Nu,Nu.deviation=function(t,e,i,n){var a=e&&e.length,c=Math.abs(yp(t,0,a?e[0]*i:t.length,i));if(a)for(var h=0,d=e.length;h<d;h++)c-=Math.abs(yp(t,e[h]*i,h<d-1?e[h+1]*i:t.length,i));var m=0;for(h=0;h<n.length;h+=3){var _=n[h]*i,b=n[h+1]*i,T=n[h+2]*i;m+=Math.abs((t[_]-t[T])*(t[b+1]-t[_+1])-(t[_]-t[b])*(t[T+1]-t[_+1]))}return c===0&&m===0?0:Math.abs((m-c)/c)},Nu.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,a=0;a<t.length;a++){for(var c=0;c<t[a].length;c++)for(var h=0;h<e;h++)i.vertices.push(t[a][c][h]);a>0&&i.holes.push(n+=t[a-1].length)}return i};class qu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yt,this.indexArray=new sr,this.indexArray2=new Qr,this.programConfigurations=new Rs(e.layers,e.zoom),this.segments=new Gi,this.segments2=new Gi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,n,a){this.hasPattern=vp("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:d,id:m,index:_,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,S=Bs(d,T);if(!this.layers[0]._featureFilter.filter(new ue(this.zoom),S,n))continue;const M=c?c.evaluate(S,{},n,i.availableImages):void 0,C={id:m,properties:d.properties,type:d.type,sourceLayerIndex:b,index:_,geometry:T?S.geometry:io(d,n,a),patterns:{},sortKey:M};h.push(C)}c&&h.sort((d,m)=>d.sortKey-m.sortKey);for(const d of h){const{geometry:m,index:_,sourceLayerIndex:b}=d;if(this.hasPattern){const T=bp("fill",this.layers,d,this.zoom,i);this.patternFeatures.push(T)}else this.addFeature(d,m,_,n,{},i.availableImages);i.featureIndex.insert(e[_].feature,m,_,b,this.index)}}update(e,i,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,n,a)}addFeatures(e,i,n,a,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ag),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,n,a,c,h=[]){for(const d of xp(i,500)){let m=0;for(const C of d)m+=C.length;const _=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),b=_.vertexLength,T=[],S=[];for(const C of d){if(C.length===0)continue;C!==d[0]&&S.push(T.length/2);const D=this.segments2.prepareSegment(C.length,this.layoutVertexArray,this.indexArray2),B=D.vertexLength;this.layoutVertexArray.emplaceBack(C[0].x,C[0].y),this.indexArray2.emplaceBack(B+C.length-1,B),T.push(C[0].x),T.push(C[0].y);for(let H=1;H<C.length;H++)this.layoutVertexArray.emplaceBack(C[H].x,C[H].y),this.indexArray2.emplaceBack(B+H-1,B+H),T.push(C[H].x),T.push(C[H].y);D.vertexLength+=C.length,D.primitiveLength+=C.length}const M=ec.exports(T,S);for(let C=0;C<M.length;C+=3)this.indexArray.emplaceBack(b+M[C],b+M[C+1],b+M[C+2]);_.vertexLength+=m,_.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,h,a)}}it(qu,"FillBucket",{omit:["layers","patternFeatures"]});const jg=new ut({"fill-sort-key":new ve(Me.layout_fill["fill-sort-key"])});var Ng={paint:new ut({"fill-antialias":new he(Me.paint_fill["fill-antialias"]),"fill-opacity":new ve(Me.paint_fill["fill-opacity"]),"fill-color":new ve(Me.paint_fill["fill-color"]),"fill-outline-color":new ve(Me.paint_fill["fill-outline-color"]),"fill-translate":new he(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new he(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new ve(Me.paint_fill["fill-pattern"])}),layout:jg};const Vg=et([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Gg=et([{name:"a_centroid_pos",components:2,type:"Uint16"}]),$g=et([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:qg}=Vg;var Zu={},Zg=Se,jf=Fa;function Fa(t,e,i,n,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=a,t.readFields(Xg,this,e)}function Xg(t,e,i){t==1?e.id=i.readVarint():t==2?function(n,a){for(var c=n.readVarint()+n.pos;n.pos<c;){var h=a._keys[n.readVarint()],d=a._values[n.readVarint()];a.properties[h]=d}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function Wg(t){for(var e,i,n=0,a=0,c=t.length,h=c-1;a<c;h=a++)n+=((i=t[h]).x-(e=t[a]).x)*(e.y+i.y);return n}Fa.types=["Unknown","Point","LineString","Polygon"],Fa.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,a=0,c=0,h=0,d=[];t.pos<i;){if(a<=0){var m=t.readVarint();n=7&m,a=m>>3}if(a--,n===1||n===2)c+=t.readSVarint(),h+=t.readSVarint(),n===1&&(e&&d.push(e),e=[]),e.push(new Zg(c,h));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&d.push(e),d},Fa.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,a=0,c=0,h=1/0,d=-1/0,m=1/0,_=-1/0;t.pos<e;){if(n<=0){var b=t.readVarint();i=7&b,n=b>>3}if(n--,i===1||i===2)(a+=t.readSVarint())<h&&(h=a),a>d&&(d=a),(c+=t.readSVarint())<m&&(m=c),c>_&&(_=c);else if(i!==7)throw new Error("unknown command "+i)}return[h,m,d,_]},Fa.prototype.toGeoJSON=function(t,e,i){var n,a,c=this.extent*Math.pow(2,i),h=this.extent*t,d=this.extent*e,m=this.loadGeometry(),_=Fa.types[this.type];function b(M){for(var C=0;C<M.length;C++){var D=M[C];M[C]=[360*(D.x+h)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(D.y+d)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(n=0;n<m.length;n++)T[n]=m[n][0];b(m=T);break;case 2:for(n=0;n<m.length;n++)b(m[n]);break;case 3:for(m=function(M){var C=M.length;if(C<=1)return[M];for(var D,B,H=[],ee=0;ee<C;ee++){var W=Wg(M[ee]);W!==0&&(B===void 0&&(B=W<0),B===W<0?(D&&H.push(D),D=[M[ee]]):D.push(M[ee]))}return D&&H.push(D),H}(m),n=0;n<m.length;n++)for(a=0;a<m[n].length;a++)b(m[n][a])}m.length===1?m=m[0]:_="Multi"+_;var S={type:"Feature",geometry:{type:_,coordinates:m},properties:this.properties};return"id"in this&&(S.id=this.id),S};var Hg=jf,Nf=Vf;function Vf(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Yg,this,e),this.length=this._features.length}function Yg(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(n){for(var a=null,c=n.readVarint()+n.pos;n.pos<c;){var h=n.readVarint()>>3;a=h===1?n.readString():h===2?n.readFloat():h===3?n.readDouble():h===4?n.readVarint64():h===5?n.readVarint():h===6?n.readSVarint():h===7?n.readBoolean():null}return a}(i))}Vf.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Hg(this._pbf,e,this.extent,this._keys,this._values)};var Kg=Nf;function Jg(t,e,i){if(t===3){var n=new Kg(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var wp=Zu.VectorTile=function(t,e){this.layers=t.readFields(Jg,{},e)},Xu=Zu.VectorTileFeature=jf;function Wu(t,e,i,n){const a=[],c=n===0?(h,d,m,_,b,T)=>{h.push(new Se(T,m+(T-d)/(_-d)*(b-m)))}:(h,d,m,_,b,T)=>{h.push(new Se(d+(T-m)/(b-m)*(_-d),T))};for(const h of t){const d=[];for(const m of h){if(m.length<=2)continue;const _=[];for(let S=0;S<m.length-1;S++){const M=m[S].x,C=m[S].y,D=m[S+1].x,B=m[S+1].y,H=n===0?M:C,ee=n===0?D:B;H<e?ee>e&&c(_,M,C,D,B,e):H>i?ee<i&&c(_,M,C,D,B,i):_.push(m[S]),ee<e&&H>=e&&c(_,M,C,D,B,e),ee>i&&H<=i&&c(_,M,C,D,B,i)}let b=m[m.length-1];const T=n===0?b.x:b.y;T>=e&&T<=i&&_.push(b),_.length&&(b=_[_.length-1],_[0].x===b.x&&_[0].y===b.y||_.push(_[0]),d.push(_))}d.length&&a.push(d)}return a}Zu.VectorTileLayer=Nf;const Qg=Xu.types,ey=Math.pow(2,13);function oc(t,e,i,n,a,c,h,d){t.emplaceBack((e<<1)+h,(i<<1)+c,(Math.floor(n*ey)<<1)+a,Math.round(d))}function sc(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Gf{constructor(){this.acc=new Se(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Se(e.x,e.y),this.max=new Se(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const n=this.min,a=this.max;e.x<n.x?n.x=e.x:e.x>a.x&&(a.x=e.x),e.y<n.y?n.y=e.y:e.y>a.y&&(a.y=e.y),((e.x===0||e.x===bt)&&e.x===i.x)!=((e.y===0||e.y===bt)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,Zt(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>bt!=e.x>bt&&this.addBorderIntersection(1,Zt(i.y,e.y,(bt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Zt(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>bt!=e.y>bt&&this.addBorderIntersection(3,Zt(i.x,e.x,(bt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];i<n[0]&&(n[0]=i),i>n[1]&&(n[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,i.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,i.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((i,n)=>i+n.edges,0);return e!==0?this.acc.div(e)._round():new Se(0,0)}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class ac{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new li,this.centroidVertexArray=new Yd,this.indexArray=new sr,this.programConfigurations=new Rs(e.layers,e.zoom),this.segments=new Gi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,n,a){this.features=[],this.hasPattern=vp("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(c){const h=Math.exp(Math.PI*(1-c.y/(1<<c.z)*2));return 80150034*h/(h*h+1)/bt/(1<<c.z)}(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:h,index:d,sourceLayerIndex:m}of e){const _=this.layers[0]._featureFilter.needGeometry,b=Bs(c,_);if(!this.layers[0]._featureFilter.filter(new ue(this.zoom),b,n))continue;const T={id:h,sourceLayerIndex:m,index:d,geometry:_?b.geometry:io(c,n,a),properties:c.properties,type:c.type,patterns:{}},S=this.layoutVertexArray.length;this.hasPattern?this.features.push(bp("fill-extrusion",this.layers,T,this.zoom,i)):this.addFeature(T,T.geometry,d,n,{},i.availableImages,a),i.featureIndex.insert(c,T.geometry,d,m,this.index,S)}this.sortBorders()}addFeatures(e,i,n,a,c){for(const h of this.features){const{geometry:d}=h;this.addFeature(h,d,h.index,i,n,a,c)}this.sortBorders()}update(e,i,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,$g.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Gg.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,n,a,c,h,d){const m=[new Se(0,0),new Se(bt,bt)],_=d.projection,b=_.name==="globe",T=this.enableTerrain&&!b?new Gf:null,S=Qg[e.type]==="Polygon";b&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new xi);const M=xp(i,500);for(let H=M.length-1;H>=0;H--){const ee=M[H];(ee.length===0||(C=ee[0]).every(W=>W.x<=0)||C.every(W=>W.x>=bt)||C.every(W=>W.y<=0)||C.every(W=>W.y>=bt))&&M.splice(H,1)}var C;let D;if(b)D=Yf(M,m,a);else{D=[];for(const H of M)D.push({polygon:H,bounds:m})}const B=S?this.edgeRadius:0;for(const{polygon:H,bounds:ee}of D){let W=0,J=0;for(const te of H)S&&!te[0].equals(te[te.length-1])&&te.push(te[0]),J+=S?te.length-1:te.length;const ne=this.segments.prepareSegment((S?5:4)*J,this.layoutVertexArray,this.indexArray);if(S){const te=[],ye=[];W=ne.vertexLength;for(const Ie of H){let Oe,we;Ie.length&&Ie!==H[0]&&ye.push(te.length/2),Oe=Ie[1].sub(Ie[0])._perp()._unit();for(let ke=1;ke<Ie.length;ke++){const ze=Ie[ke],Le=Ie[ke===Ie.length-1?1:ke+1];let{x:Fe,y:Te}=ze;if(B){we=Le.sub(ze)._perp()._unit();const $e=Oe.add(we)._unit(),_t=B*Math.min(4,1/(Oe.x*$e.x+Oe.y*$e.y));Fe+=_t*$e.x,Te+=_t*$e.y,Oe=we}oc(this.layoutVertexArray,Fe,Te,0,0,1,1,0),ne.vertexLength++,te.push(ze.x,ze.y),b&&sc(this.layoutVertexExtArray,_.projectTilePoint(Fe,Te,a),_.upVector(a,Fe,Te))}}const ge=ec.exports(te,ye);for(let Ie=0;Ie<ge.length;Ie+=3)this.indexArray.emplaceBack(W+ge[Ie],W+ge[Ie+2],W+ge[Ie+1]),ne.primitiveLength++}for(const te of H){T&&te.length&&T.startRing(te[0]);let ye,ge,Ie,Oe=te.length>4&&Xf(te[te.length-2],te[0],te[1]),we=B?ty(te[te.length-2],te[0],te[1],B):0;ge=te[1].sub(te[0])._perp()._unit();let ke=!0;for(let ze=1,Le=0;ze<te.length;ze++){let Fe=te[ze-1],Te=te[ze];const $e=te[ze===te.length-1?1:ze+1];if(T&&S&&T.currentPolyCount.top++,Zf(Te,Fe,ee)){B&&(ge=$e.sub(Te)._perp()._unit(),ke=!ke);continue}T&&T.append(Te,Fe);const _t=Te.sub(Fe)._perp(),He=_t.x/(Math.abs(_t.x)+Math.abs(_t.y)),st=_t.y>0?1:0,qe=Fe.dist(Te);if(Le+qe>32768&&(Le=0),B){Ie=$e.sub(Te)._perp()._unit();let Mt=qf(Fe,Te,$e,$f(ge,Ie),B);isNaN(Mt)&&(Mt=0);const vt=Te.sub(Fe)._unit();Fe=Fe.add(vt.mult(we))._round(),Te=Te.add(vt.mult(-Mt))._round(),we=Mt,ge=Ie}const yt=ne.vertexLength,Rt=te.length>4&&Xf(Fe,Te,$e);let Pt=Wf(Le,Oe,ke);if(oc(this.layoutVertexArray,Fe.x,Fe.y,He,st,0,0,Pt),oc(this.layoutVertexArray,Fe.x,Fe.y,He,st,0,1,Pt),Le+=qe,Pt=Wf(Le,Rt,!ke),Oe=Rt,oc(this.layoutVertexArray,Te.x,Te.y,He,st,0,0,Pt),oc(this.layoutVertexArray,Te.x,Te.y,He,st,0,1,Pt),ne.vertexLength+=4,this.indexArray.emplaceBack(yt+0,yt+1,yt+2),this.indexArray.emplaceBack(yt+1,yt+3,yt+2),ne.primitiveLength+=2,B){const Mt=W+(ze===1?te.length-2:ze-2),vt=ze===1?W:Mt+1;if(this.indexArray.emplaceBack(yt+1,Mt,yt+3),this.indexArray.emplaceBack(Mt,vt,yt+3),ne.primitiveLength+=2,ye===void 0&&(ye=yt),!Zf($e,te[ze],ee)){const oi=ze===te.length-1?ye:ne.vertexLength;this.indexArray.emplaceBack(yt+2,yt+3,oi),this.indexArray.emplaceBack(yt+3,oi+1,oi),this.indexArray.emplaceBack(yt+3,vt,oi+1),ne.primitiveLength+=3}ke=!ke}if(b){const Mt=this.layoutVertexExtArray,vt=_.projectTilePoint(Fe.x,Fe.y,a),oi=_.projectTilePoint(Te.x,Te.y,a),Et=_.upVector(a,Fe.x,Fe.y),Bt=_.upVector(a,Te.x,Te.y);sc(Mt,vt,Et),sc(Mt,vt,Et),sc(Mt,oi,Bt),sc(Mt,oi,Bt)}}S&&(W+=te.length-1)}}if(T&&T.polyCount.length>0){if(T.borders){T.vertexArrayOffset=this.centroidVertexArray.length;const H=T.borders,ee=this.featuresOnBorder.push(T)-1;for(let W=0;W<4;W++)H[W][0]!==Number.MAX_VALUE&&this.borders[W].push(ee)}this.encodeCentroid(T.borders?void 0:T.centroid(),T)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,h,a)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,n)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,i,n=!0){let a,c;if(e)if(e.y!==0){const d=i.span()._mult(this.tileToMeter);a=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(d.x/10)),c=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(d.y/10))}else a=Math.ceil(7*(e.x+450)),c=0;else a=0,c=+n;let h=n?this.centroidVertexArray.length:i.vertexArrayOffset;for(const d of i.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*d.edges+d.top);for(let m=0;m<d.top;m++)this.centroidVertexArray.emplace(h++,a,c);for(let m=0;m<2*d.edges;m++)this.centroidVertexArray.emplace(h++,0,c),this.centroidVertexArray.emplace(h++,a,c)}}}function $f(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function ty(t,e,i,n){const a=e.sub(t)._perp()._unit(),c=i.sub(e)._perp()._unit();return qf(t,e,i,$f(a,c),n)}function qf(t,e,i,n,a){const c=Math.sqrt(1-n*n);return Math.min(t.dist(e)/3,e.dist(i)/3,a*c/n)}function Zf(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function Xf(t,e,i){if(t.x<0||t.x>=bt||e.x<0||e.x>=bt||i.x<0||i.x>=bt)return!1;const n=i.sub(e),a=n.perp(),c=t.sub(e);return(n.x*c.x+n.y*c.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(c.x*c.x+c.y*c.y))>-.866&&a.x*c.x+a.y*c.y<0}function Wf(t,e,i){const n=e?2|t:-3&t;return i?1|n:-2&n}function Hf(){const t=Math.PI/32,e=Math.tan(t),i=Ru;return i*Math.sqrt(1+2*e*e)-i}function Yf(t,e,i){const n=1<<i.z,a=Nr(i.x/n),c=Nr((i.x+1)/n),h=ar(i.y/n),d=ar((i.y+1)/n);return function(m,_,b,T,S=0,M){const C=[];if(!m.length||!b||!T)return C;const D=(te,ye)=>{for(const ge of te)C.push({polygon:ge,bounds:ye})},B=Math.ceil(Math.log2(b)),H=Math.ceil(Math.log2(T)),ee=B-H,W=[];for(let te=0;te<Math.abs(ee);te++)W.push(ee>0?0:1);for(let te=0;te<Math.min(B,H);te++)W.push(0),W.push(1);let J=m;if(J=Wu(J,_[0].y-S,_[1].y+S,1),J=Wu(J,_[0].x-S,_[1].x+S,0),!J.length)return C;const ne=[];for(W.length?ne.push({polygons:J,bounds:_,depth:0}):D(J,_);ne.length;){const te=ne.pop(),ye=te.depth,ge=W[ye],Ie=te.bounds[0],Oe=te.bounds[1],we=ge===0?Ie.x:Ie.y,ke=ge===0?Oe.x:Oe.y,ze=M?M(ge,we,ke):.5*(we+ke),Le=Wu(te.polygons,we-S,ze+S,ge),Fe=Wu(te.polygons,ze-S,ke+S,ge);if(Le.length){const Te=[Ie,new Se(ge===0?ze:Oe.x,ge===1?ze:Oe.y)];W.length>ye+1?ne.push({polygons:Le,bounds:Te,depth:ye+1}):D(Le,Te)}if(Fe.length){const Te=[new Se(ge===0?ze:Ie.x,ge===1?ze:Ie.y),Oe];W.length>ye+1?ne.push({polygons:Fe,bounds:Te,depth:ye+1}):D(Fe,Te)}}return C}(t,e,Math.ceil((c-a)/11.25),Math.ceil((h-d)/11.25),1,(m,_,b)=>{if(m===0)return .5*(_+b);{const T=ar((i.y+_/bt)/n);return(Rn(.5*(ar((i.y+b/bt)/n)+T))*n-i.y)*bt}})}it(ac,"FillExtrusionBucket",{omit:["layers","features"]}),it(Gf,"PartMetadata");const iy=new ut({"fill-extrusion-edge-radius":new he(Me["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var ry={paint:new ut({"fill-extrusion-opacity":new he(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ve(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new he(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new he(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ve(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ve(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ve(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new he(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new he(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new he(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:iy};function Kf(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Hu{constructor(e,i,n){this.z=e,this.x=i,this.y=n,this.key=lc(0,e,e,i,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const n=function(c,h,d){var m=Kf(256*c,256*(h=Math.pow(2,d)-h-1),d),_=Kf(256*(c+1),256*(h+1),d);return m[0]+","+m[1]+","+_[0]+","+_[1]}(this.x,this.y,this.z),a=function(c,h,d){let m,_="";for(let b=c;b>0;b--)m=1<<b-1,_+=(h&m?1:0)+(d&m?2:0);return _}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Jf{constructor(e,i){this.wrap=e,this.canonical=i,this.key=lc(e,i.z,i.z,i.x,i.y)}}class vr{constructor(e,i,n,a,c){this.overscaledZ=e,this.wrap=i,this.canonical=new Hu(n,+a,+c),this.key=i===0&&e===n?this.canonical.key:lc(i,e,n,a,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new vr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return lc(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return lc(this.wrap*+i,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new vr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,n=2*this.canonical.x,a=2*this.canonical.y;return[new vr(i,this.wrap,i,n,a),new vr(i,this.wrap,i,n+1,a),new vr(i,this.wrap,i,n,a+1),new vr(i,this.wrap,i,n+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new vr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new vr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Jf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function lc(t,e,i,n,a){const c=1<<Math.min(i,22);let h=c*(a%c)+n%c;return t&&i<22&&(h+=c*c*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*h+i)+(e-i)}it(Hu,"CanonicalTileID"),it(vr,"OverscaledTileID",{omit:["projMatrix"]});class Ua extends Se{constructor(e,i,n){super(e,i),this.z=n}}function cc(t,e){return t.x*e.x+t.y*e.y}function Qf(t,e){if(t.length===1){let i=0;const n=e[i++];let a;for(;!a||n.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const c=e[i],h=t[0],d=a.sub(n),m=c.sub(n),_=h.sub(n),b=cc(d,d),T=cc(d,m),S=cc(m,m),M=cc(_,d),C=cc(_,m),D=b*S-T*T,B=(S*M-T*C)/D,H=(b*C-T*M)/D,ee=n.z*(1-B-H)+a.z*B+c.z*H;if(isFinite(ee))return ee}return 1/0}{let i=1/0;for(const n of e)i=Math.min(i,n.z);return i}}function em(t,e,i,n,a,c,h,d){const m=h*a.getElevationAt(t,e,!0,!0),_=c[0]!==0,b=_?c[1]===0?h*(c[0]/7-450):h*function(T,S,M){const C=Math.floor(S[0]/8),D=Math.floor(S[1]/8),B=10*(S[0]-8*C),H=10*(S[1]-8*D),ee=T.getElevationAt(C,D,!0,!0),W=T.getMeterToDEM(M),J=Math.floor(.5*(B*W-1)),ne=Math.floor(.5*(H*W-1)),te=T.tileCoordToPixel(C,D),ye=2*J+1,ge=2*ne+1,Ie=function(Fe,Te,$e,_t,He){return[Fe.getElevationAtPixel(Te,$e,!0),Fe.getElevationAtPixel(Te+He,$e,!0),Fe.getElevationAtPixel(Te,$e+He,!0),Fe.getElevationAtPixel(Te+_t,$e+He,!0)]}(T,te.x-J,te.y-ne,ye,ge),Oe=Math.abs(Ie[0]-Ie[1]),we=Math.abs(Ie[2]-Ie[3]),ke=Math.abs(Ie[0]-Ie[2])+Math.abs(Ie[1]-Ie[3]),ze=Math.min(.25,.5*W*(Oe+we)/ye),Le=Math.min(.25,.5*W*ke/ge);return ee+Math.max(ze*B,Le*H)}(a,c,d):m;return{base:m+(i===0)?-1:i,top:_?Math.max(b+n,m+i+2):m+n}}const ny=et([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:oy}=ny,sy=et([{name:"a_packed",components:4,type:"Float32"}]),{members:ay}=sy,ly=Xu.types,cy=Math.cos(Math.PI/180*37.5);class Yu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new gr,this.layoutVertexArray2=new Ar,this.indexArray=new sr,this.programConfigurations=new Rs(e.layers,e.zoom),this.segments=new Gi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,n,a){this.hasPattern=vp("line",this.layers,i);const c=this.layers[0].layout.get("line-sort-key"),h=[];for(const{feature:b,id:T,index:S,sourceLayerIndex:M}of e){const C=this.layers[0]._featureFilter.needGeometry,D=Bs(b,C);if(!this.layers[0]._featureFilter.filter(new ue(this.zoom),D,n))continue;const B=c?c.evaluate(D,{},n):void 0,H={id:T,properties:b.properties,type:b.type,sourceLayerIndex:M,index:S,geometry:C?D.geometry:io(b,n,a),patterns:{},sortKey:B};h.push(H)}c&&h.sort((b,T)=>b.sortKey-T.sortKey);const{lineAtlas:d,featureIndex:m}=i,_=this.addConstantDashes(d);for(const b of h){const{geometry:T,index:S,sourceLayerIndex:M}=b;if(_&&this.addFeatureDashes(b,d),this.hasPattern){const C=bp("line",this.layers,b,this.zoom,i);this.patternFeatures.push(C)}else this.addFeature(b,T,S,n,d.positions,i.availableImages);m.insert(e[S].feature,T,S,M,this.index)}}addConstantDashes(e){let i=!1;for(const n of this.layers){const a=n.paint.get("line-dasharray").value,c=n.layout.get("line-cap").value;if(a.kind!=="constant"||c.kind!=="constant")i=!0;else{const h=c.value,d=a.value;if(!d)continue;e.addDash(d,h)}}return i}addFeatureDashes(e,i){const n=this.zoom;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(c.kind==="constant"&&h.kind==="constant")continue;let d,m;if(c.kind==="constant"){if(d=c.value,!d)continue}else d=c.evaluate({zoom:n},e);m=h.kind==="constant"?h.value:h.evaluate({zoom:n},e),i.addDash(d,m),e.patterns[a.id]=i.getKey(d,m)}}update(e,i,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,n,a)}addFeatures(e,i,n,a,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ay)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oy),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,n,a,c,h){const d=this.layers[0].layout,m=d.get("line-join").evaluate(e,{}),_=d.get("line-cap").evaluate(e,{}),b=d.get("line-miter-limit"),T=d.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const S of i)this.addLine(S,e,m,_,b,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,h,a)}addLine(e,i,n,a,c,h){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<e.length-1;H++)this.totalDistance+=e[H].dist(e[H+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const d=ly[i.type]==="Polygon";let m=e.length;for(;m>=2&&e[m-1].equals(e[m-2]);)m--;let _=0;for(;_<m-1&&e[_].equals(e[_+1]);)_++;if(m<(d?3:2))return;n==="bevel"&&(c=1.05);const b=this.overscaling<=16?122880/(512*this.overscaling):0,T=this.segments.prepareSegment(10*m,this.layoutVertexArray,this.indexArray);let S,M,C,D,B;this.e1=this.e2=-1,d&&(S=e[m-2],B=e[_].sub(S)._unit()._perp());for(let H=_;H<m;H++){if(C=H===m-1?d?e[_+1]:void 0:e[H+1],C&&e[H].equals(C))continue;B&&(D=B),S&&(M=S),S=e[H],B=C?C.sub(S)._unit()._perp():D,D=D||B;let ee=D.add(B);ee.x===0&&ee.y===0||ee._unit();const W=D.x*B.x+D.y*B.y,J=ee.x*B.x+ee.y*B.y,ne=J!==0?1/J:1/0,te=2*Math.sqrt(2-2*J),ye=J<cy&&M&&C,ge=D.x*B.y-D.y*B.x>0;if(ye&&H>_){const we=S.dist(M);if(we>2*b){const ke=S.sub(S.sub(M)._mult(b/we)._round());this.updateDistance(M,ke),this.addCurrentVertex(ke,D,0,0,T),M=ke}}const Ie=M&&C;let Oe=Ie?n:d?"butt":a;if(Ie&&Oe==="round"&&(ne<h?Oe="miter":ne<=2&&(Oe="fakeround")),Oe==="miter"&&ne>c&&(Oe="bevel"),Oe==="bevel"&&(ne>2&&(Oe="flipbevel"),ne<c&&(Oe="miter")),M&&this.updateDistance(M,S),Oe==="miter")ee._mult(ne),this.addCurrentVertex(S,ee,0,0,T);else if(Oe==="flipbevel"){if(ne>100)ee=B.mult(-1);else{const we=ne*D.add(B).mag()/D.sub(B).mag();ee._perp()._mult(we*(ge?-1:1))}this.addCurrentVertex(S,ee,0,0,T),this.addCurrentVertex(S,ee.mult(-1),0,0,T)}else if(Oe==="bevel"||Oe==="fakeround"){const we=-Math.sqrt(ne*ne-1),ke=ge?we:0,ze=ge?0:we;if(M&&this.addCurrentVertex(S,D,ke,ze,T),Oe==="fakeround"){const Le=Math.round(180*te/Math.PI/20);for(let Fe=1;Fe<Le;Fe++){let Te=Fe/Le;if(Te!==.5){const _t=Te-.5;Te+=Te*_t*(Te-1)*((1.0904+W*(W*(3.55645-1.43519*W)-3.2452))*_t*_t+(.848013+W*(.215638*W-1.06021)))}const $e=B.sub(D)._mult(Te)._add(D)._unit()._mult(ge?-1:1);this.addHalfVertex(S,$e.x,$e.y,!1,ge,0,T)}}C&&this.addCurrentVertex(S,B,-ke,-ze,T)}else if(Oe==="butt")this.addCurrentVertex(S,ee,0,0,T);else if(Oe==="square"){const we=M?1:-1;M||this.addCurrentVertex(S,ee,we,we,T),this.addCurrentVertex(S,ee,0,0,T),M&&this.addCurrentVertex(S,ee,we,we,T)}else Oe==="round"&&(M&&(this.addCurrentVertex(S,D,0,0,T),this.addCurrentVertex(S,D,1,1,T,!0)),C&&(this.addCurrentVertex(S,B,-1,-1,T,!0),this.addCurrentVertex(S,B,0,0,T)));if(ye&&H<m-1){const we=S.dist(C);if(we>2*b){const ke=S.add(C.sub(S)._mult(b/we)._round());this.updateDistance(S,ke),this.addCurrentVertex(ke,B,0,0,T),S=ke}}}}addCurrentVertex(e,i,n,a,c,h=!1){const d=i.y*a-i.x,m=-i.y-i.x*a;this.addHalfVertex(e,i.x+i.y*n,i.y-i.x*n,h,!1,n,c),this.addHalfVertex(e,d,m,h,!0,-a,c)}addHalfVertex({x:e,y:i},n,a,c,h,d,m){this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(i<<1)+(h?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(d===0?0:d<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const _=m.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),m.primitiveLength++),h?this.e2=_:this.e1=_}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}it(Yu,"LineBucket",{omit:["layers","patternFeatures"]});const uy=new ut({"line-cap":new ve(Me.layout_line["line-cap"]),"line-join":new ve(Me.layout_line["line-join"]),"line-miter-limit":new he(Me.layout_line["line-miter-limit"]),"line-round-limit":new he(Me.layout_line["line-round-limit"]),"line-sort-key":new ve(Me.layout_line["line-sort-key"])});var tm={paint:new ut({"line-opacity":new ve(Me.paint_line["line-opacity"]),"line-color":new ve(Me.paint_line["line-color"]),"line-translate":new he(Me.paint_line["line-translate"]),"line-translate-anchor":new he(Me.paint_line["line-translate-anchor"]),"line-width":new ve(Me.paint_line["line-width"]),"line-gap-width":new ve(Me.paint_line["line-gap-width"]),"line-offset":new ve(Me.paint_line["line-offset"]),"line-blur":new ve(Me.paint_line["line-blur"]),"line-dasharray":new ve(Me.paint_line["line-dasharray"]),"line-pattern":new ve(Me.paint_line["line-pattern"]),"line-gradient":new nt(Me.paint_line["line-gradient"]),"line-trim-offset":new he(Me.paint_line["line-trim-offset"])}),layout:uy};const im=new class extends ve{possiblyEvaluate(t,e){return e=new ue(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=Ye({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}(tm.paint.properties["line-width"].specification);function rm(t,e){return e>0?e+2*t:t}im.useIntegerZoom=!0;const hy=et([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),py=et([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),dy=et([{name:"a_projected_pos",components:4,type:"Float32"}],4);et([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const fy=et([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),my=et([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);et([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const nm=et([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_y=et([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);et([{name:"triangle",components:3,type:"Uint16"}]),et([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),et([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),et([{type:"Float32",name:"offsetX"}]),et([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var lr=24;const On=128;function Tp(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new ue(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:a}=i;let c=0;for(;c<n.length&&n[c]<=t;)c++;c=Math.max(0,c-1);let h=c;for(;h<n.length&&n[h]<t+1;)h++;h=Math.min(n.length-1,h);const d=n[c],m=n[h];return i.kind==="composite"?{kind:"composite",minZoom:d,maxZoom:m,interpolationType:a}:{kind:"camera",minZoom:d,maxZoom:m,minSize:i.evaluate(new ue(d)),maxSize:i.evaluate(new ue(m)),interpolationType:a}}}function Ku(t,{uSize:e,uSizeT:i},{lowerSize:n,upperSize:a}){return t.kind==="source"?n/On:t.kind==="composite"?Zt(n/On,a/On,i):e}function ja(t,e){let i=0,n=0;if(t.kind==="constant")n=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:a,minZoom:c,maxZoom:h}=t,d=a?Tt(Xr.interpolationFactor(a,e,c,h),0,1):0;t.kind==="camera"?n=Zt(t.minSize,t.maxSize,d):i=d}return{uSizeT:i,uSize:n}}var gy=Object.freeze({__proto__:null,getSizeData:Tp,evaluateSizeForFeature:Ku,evaluateSizeForZoom:ja,SIZE_PACK_FACTOR:On});function yy(t,e,i){return t.sections.forEach(n=>{n.text=function(a,c,h){const d=c.layout.get("text-transform").evaluate(h,{});return d==="uppercase"?a=a.toLocaleUpperCase():d==="lowercase"&&(a=a.toLocaleLowerCase()),_e.applyArabicShaping&&(a=_e.applyArabicShaping(a)),a}(n.text,e,i)}),t}const uc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function xy(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}function vy(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}var hc=mi,om=function(t,e,i,n,a){var c,h,d=8*a-n-1,m=(1<<d)-1,_=m>>1,b=-7,T=i?a-1:0,S=i?-1:1,M=t[e+T];for(T+=S,c=M&(1<<-b)-1,M>>=-b,b+=d;b>0;c=256*c+t[e+T],T+=S,b-=8);for(h=c&(1<<-b)-1,c>>=-b,b+=n;b>0;h=256*h+t[e+T],T+=S,b-=8);if(c===0)c=1-_;else{if(c===m)return h?NaN:1/0*(M?-1:1);h+=Math.pow(2,n),c-=_}return(M?-1:1)*h*Math.pow(2,c-n)},sm=function(t,e,i,n,a,c){var h,d,m,_=8*c-a-1,b=(1<<_)-1,T=b>>1,S=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=n?0:c-1,C=n?1:-1,D=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(d=isNaN(e)?1:0,h=b):(h=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-h))<1&&(h--,m*=2),(e+=h+T>=1?S/m:S*Math.pow(2,1-T))*m>=2&&(h++,m/=2),h+T>=b?(d=0,h=b):h+T>=1?(d=(e*m-1)*Math.pow(2,a),h+=T):(d=e*Math.pow(2,T-1)*Math.pow(2,a),h=0));a>=8;t[i+M]=255&d,M+=C,d/=256,a-=8);for(h=h<<a|d,_+=a;_>0;t[i+M]=255&h,M+=C,h/=256,_-=8);t[i+M-C]|=128*D};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function mi(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}mi.Varint=0,mi.Fixed64=1,mi.Bytes=2,mi.Fixed32=5;var Ep=4294967296,am=1/Ep,lm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function oo(t){return t.type===mi.Bytes?t.readVarint()+t.pos:t.pos+1}function Na(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function cm(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var a=i.pos-1;a>=t;a--)i.buf[a+n]=i.buf[a]}function by(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function wy(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Ty(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Ey(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Sy(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Iy(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Ay(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function My(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Cy(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Ju(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Va(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function um(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function ky(t,e,i){e.glyphs=[],t===1&&i.readMessage(zy,e)}function zy(t,e,i){if(t===3){const{id:n,bitmap:a,width:c,height:h,left:d,top:m,advance:_}=i.readMessage(Py,{});e.glyphs.push({id:n,bitmap:new no({width:c+6,height:h+6},a),metrics:{width:c,height:h,left:d,top:m,advance:_}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function Py(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}function Sp(t){let e=0,i=0;for(const h of t)e+=h.w*h.h,i=Math.max(i,h.w);t.sort((h,d)=>d.h-h.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,c=0;for(const h of t)for(let d=n.length-1;d>=0;d--){const m=n[d];if(!(h.w>m.w||h.h>m.h)){if(h.x=m.x,h.y=m.y,c=Math.max(c,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===m.w&&h.h===m.h){const _=n.pop();d<n.length&&(n[d]=_)}else h.h===m.h?(m.x+=h.w,m.w-=h.w):h.w===m.w?(m.y+=h.h,m.h-=h.h):(n.push({x:m.x+h.w,y:m.y,w:m.w-h.w,h:h.h}),m.y+=h.h,m.h-=h.h);break}}return{w:a,h:c,fill:e/(a*c)||0}}mi.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),a=n>>3,c=this.pos;this.type=7&n,t(a,e,this),this.pos===c&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Ju(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=um(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Ju(this.buf,this.pos)+Ju(this.buf,this.pos+4)*Ep;return this.pos+=8,t},readSFixed64:function(){var t=Ju(this.buf,this.pos)+um(this.buf,this.pos+4)*Ep;return this.pos+=8,t},readFloat:function(){var t=om(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=om(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(a,c,h){var d,m,_=h.buf;if(d=(112&(m=_[h.pos++]))>>4,m<128||(d|=(127&(m=_[h.pos++]))<<3,m<128)||(d|=(127&(m=_[h.pos++]))<<10,m<128)||(d|=(127&(m=_[h.pos++]))<<17,m<128)||(d|=(127&(m=_[h.pos++]))<<24,m<128)||(d|=(1&(m=_[h.pos++]))<<31,m<128))return Na(a,d,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&lm?function(i,n,a){return lm.decode(i.subarray(n,a))}(this.buf,e,t):function(i,n,a){for(var c="",h=n;h<a;){var d,m,_,b=i[h],T=null,S=b>239?4:b>223?3:b>191?2:1;if(h+S>a)break;S===1?b<128&&(T=b):S===2?(192&(d=i[h+1]))==128&&(T=(31&b)<<6|63&d)<=127&&(T=null):S===3?(m=i[h+2],(192&(d=i[h+1]))==128&&(192&m)==128&&((T=(15&b)<<12|(63&d)<<6|63&m)<=2047||T>=55296&&T<=57343)&&(T=null)):S===4&&(m=i[h+2],_=i[h+3],(192&(d=i[h+1]))==128&&(192&m)==128&&(192&_)==128&&((T=(15&b)<<18|(63&d)<<12|(63&m)<<6|63&_)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,S=1):T>65535&&(T-=65536,c+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),c+=String.fromCharCode(T),h+=S}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==mi.Bytes)return t.push(this.readVarint(e));var i=oo(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==mi.Bytes)return t.push(this.readSVarint());var e=oo(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==mi.Bytes)return t.push(this.readBoolean());var e=oo(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==mi.Bytes)return t.push(this.readFloat());var e=oo(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==mi.Bytes)return t.push(this.readDouble());var e=oo(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==mi.Bytes)return t.push(this.readFixed32());var e=oo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==mi.Bytes)return t.push(this.readSFixed32());var e=oo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==mi.Bytes)return t.push(this.readFixed64());var e=oo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==mi.Bytes)return t.push(this.readSFixed64());var e=oo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===mi.Varint)for(;this.buf[this.pos++]>127;);else if(e===mi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===mi.Fixed32)this.pos+=4;else{if(e!==mi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Va(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Va(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Va(this.buf,-1&t,this.pos),Va(this.buf,Math.floor(t*am),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Va(this.buf,-1&t,this.pos),Va(this.buf,Math.floor(t*am),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var n,a;if(e>=0?(n=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(c,h,d){d.buf[d.pos++]=127&c|128,c>>>=7,d.buf[d.pos++]=127&c|128,c>>>=7,d.buf[d.pos++]=127&c|128,c>>>=7,d.buf[d.pos++]=127&c|128,d.buf[d.pos]=127&(c>>>=7)}(n,0,i),function(c,h){var d=(7&c)<<4;h.buf[h.pos++]|=d|((c>>>=3)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c)))))}(a,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(n,a,c){for(var h,d,m=0;m<a.length;m++){if((h=a.charCodeAt(m))>55295&&h<57344){if(!d){h>56319||m+1===a.length?(n[c++]=239,n[c++]=191,n[c++]=189):d=h;continue}if(h<56320){n[c++]=239,n[c++]=191,n[c++]=189,d=h;continue}h=d-55296<<10|h-56320|65536,d=null}else d&&(n[c++]=239,n[c++]=191,n[c++]=189,d=null);h<128?n[c++]=h:(h<2048?n[c++]=h>>6|192:(h<65536?n[c++]=h>>12|224:(n[c++]=h>>18|240,n[c++]=h>>12&63|128),n[c++]=h>>6&63|128),n[c++]=63&h|128)}return c}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&cm(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),sm(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),sm(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&cm(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,mi.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,by,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,wy,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Sy,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Ty,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Ey,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Iy,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Ay,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,My,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Cy,e)},writeBytesField:function(t,e){this.writeTag(t,mi.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,mi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,mi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,mi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,mi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,mi.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,mi.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,mi.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,mi.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,mi.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Ip{constructor(e,{pixelRatio:i,version:n,stretchX:a,stretchY:c,content:h}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=a,this.stretchY=c,this.content=h,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class hm{constructor(e,i){const n={},a={};this.haveRenderCallbacks=[];const c=[];this.addImages(e,n,c),this.addImages(i,a,c);const{w:h,h:d}=Sp(c),m=new Lr({width:h||1,height:d||1});for(const _ in e){const b=e[_],T=n[_].paddedRect;Lr.copy(b.data,m,{x:0,y:0},{x:T.x+1,y:T.y+1},b.data)}for(const _ in i){const b=i[_],T=a[_].paddedRect,S=T.x+1,M=T.y+1,C=b.data.width,D=b.data.height;Lr.copy(b.data,m,{x:0,y:0},{x:S,y:M},b.data),Lr.copy(b.data,m,{x:0,y:D-1},{x:S,y:M-1},{width:C,height:1}),Lr.copy(b.data,m,{x:0,y:0},{x:S,y:M+D},{width:C,height:1}),Lr.copy(b.data,m,{x:C-1,y:0},{x:S-1,y:M},{width:1,height:D}),Lr.copy(b.data,m,{x:0,y:0},{x:S+C,y:M},{width:1,height:D})}this.image=m,this.iconPositions=n,this.patternPositions=a}addImages(e,i,n){for(const a in e){const c=e[a],h={x:0,y:0,w:c.data.width+2,h:c.data.height+2};n.push(h),i[a]=new Ip(h,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),i),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),i)}patchUpdatedImage(e,i,n){if(!e||!i||e.version===i.version)return;e.version=i.version;const[a,c]=e.tl;n.update(i.data,void 0,{x:a,y:c})}}it(Ip,"ImagePosition"),it(hm,"ImageAtlas");const Gr={horizontal:1,vertical:2,horizontalOnly:3};class pc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const n=new pc;return n.scale=e||1,n.fontStack=i,n}static forImage(e){const i=new pc;return i.imageName=e,i}}class Ga{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const n=new Ga;for(let a=0;a<e.sections.length;a++){const c=e.sections[a];c.image?n.addImageSection(c):n.addTextSection(c,i)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,n){let a="";for(let c=0;c<i.length;c++){const h=i.charCodeAt(c+1)||null,d=i.charCodeAt(c-1)||null;a+=!n&&(h&&I(h)&&!uc[i[c+1]]||d&&I(d)&&!uc[i[c-1]])||!uc[i[c]]?i[c]:uc[i[c]]}return a}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&Qu[this.text.charCodeAt(n)];n++)e++;let i=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Qu[this.text.charCodeAt(n)];n--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const n=new Ga;return n.text=this.text.substring(e,i),n.sectionIndex=this.sectionIndex.slice(e,i),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(pc.forText(e.scale,e.fontStack||i));const n=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(n)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void $t("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(pc.forImage(i)),this.sectionIndex.push(this.sections.length-1)):$t("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ap(t,e,i,n,a,c,h,d,m,_,b,T,S,M,C){const D=Ga.fromFeature(t,a);T===Gr.vertical&&D.verticalizePunctuation(S);let B=[];const H=function(te,ye,ge,Ie,Oe,we){if(!te)return[];const ke=[],ze=function($e,_t,He,st,qe,yt){let Rt=0;for(let Pt=0;Pt<$e.length();Pt++){const Mt=$e.getSection(Pt);Rt+=pm($e.getCharCode(Pt),Mt,st,qe,_t,yt)}return Rt/Math.max(1,Math.ceil(Rt/He))}(te,ye,ge,Ie,Oe,we),Le=te.text.indexOf("")>=0;let Fe=0;for(let $e=0;$e<te.length();$e++){const _t=te.getSection($e),He=te.getCharCode($e);if(Qu[He]||(Fe+=pm(He,_t,Ie,Oe,ye,we)),$e<te.length()-1){const st=!((Te=He)<11904||!(Gl(Te)||wu(Te)||s(Te)||Ps(Te)||Iu(Te)||jl(Te)||Tu(Te)||Fo(Te)||Au(Te)||$l(Te)||Su(Te)||f(Te)||zs(Te)||Vl(Te)||Nl(Te)||Eu(Te)||za(Te)||r(Te)||Cu(Te)||Mu(Te)));(Dy[He]||st||_t.imageName)&&ke.push(fm($e+1,Fe,ze,ke,Ly(He,te.getCharCode($e+1),st&&Le),!1))}}var Te;return mm(fm(te.length(),Fe,ze,ke,0,!0))}(D,_,c,e,n,M),{processBidirectionalText:ee,processStyledBidirectionalText:W}=_e;if(ee&&D.sections.length===1){const te=ee(D.toString(),H);for(const ye of te){const ge=new Ga;ge.text=ye,ge.sections=D.sections;for(let Ie=0;Ie<ye.length;Ie++)ge.sectionIndex.push(0);B.push(ge)}}else if(W){const te=W(D.text,D.sectionIndex,H);for(const ye of te){const ge=new Ga;ge.text=ye[0],ge.sectionIndex=ye[1],ge.sections=D.sections,B.push(ge)}}else B=function(te,ye){const ge=[],Ie=te.text;let Oe=0;for(const we of ye)ge.push(te.substring(Oe,we)),Oe=we;return Oe<Ie.length&&ge.push(te.substring(Oe,Ie.length)),ge}(D,H);const J=[],ne={positionedLines:J,text:D.toString(),top:b[1],bottom:b[1],left:b[0],right:b[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(te,ye,ge,Ie,Oe,we,ke,ze,Le,Fe,Te,$e){let _t=0,He=0,st=0;const qe=ze==="right"?1:ze==="left"?0:.5;let yt=!1;for(const Et of Oe){const Bt=Et.getSections();for(const ci of Bt){if(ci.imageName)continue;const vi=ye[ci.fontStack];if(vi&&(yt=vi.ascender!==void 0&&vi.descender!==void 0,!yt))break}if(!yt)break}let Rt=0;for(const Et of Oe){Et.trim();const Bt=Et.getMaxScale(),ci=(Bt-1)*lr,vi={positionedGlyphs:[],lineOffset:0};te.positionedLines[Rt]=vi;const _i=vi.positionedGlyphs;let bi=0;if(!Et.length()){He+=we,++Rt;continue}let wi=0,zi=0;for(let si=0;si<Et.length();si++){const $i=Et.getSection(si),Ui=Et.getSectionIndex(si),Wt=Et.getCharCode(si);let Ei=$i.scale,Zi=null,ui=null,Ri=null,dr=lr,Qi=0;const er=!(Le===Gr.horizontal||!Te&&!A(Wt)||Te&&(Qu[Wt]||(Pt=Wt,Fl(Pt)||bu(Pt)||Ul(Pt)||l(Pt)||p(Pt))));if($i.imageName){const br=Ie[$i.imageName];if(!br)continue;Ri=$i.imageName,te.iconsInText=te.iconsInText||!0,ui=br.paddedRect;const tr=br.displaySize;Ei=Ei*lr/$e,Zi={width:tr[0],height:tr[1],left:1,top:-3,advance:er?tr[1]:tr[0],localGlyph:!1},Qi=yt?-Zi.height*Ei:Bt*lr-17-tr[1]*Ei,dr=Zi.advance;const lo=(er?tr[0]:tr[1])*Ei-lr*Bt;lo>0&&lo>bi&&(bi=lo)}else{const br=ge[$i.fontStack];if(!br)continue;br[Wt]&&(ui=br[Wt]);const tr=ye[$i.fontStack];if(!tr)continue;const lo=tr.glyphs[Wt];if(!lo)continue;if(Zi=lo.metrics,dr=Wt!==8203?lr:0,yt){const Ja=tr.ascender!==void 0?Math.abs(tr.ascender):0,Ec=tr.descender!==void 0?Math.abs(tr.descender):0,Sc=(Ja+Ec)*Ei;wi<Sc&&(wi=Sc,zi=(Ja-Ec)/2*Ei),Qi=-Ja*Ei}else Qi=(Bt-Ei)*lr-17}er?(te.verticalizable=!0,_i.push({glyph:Wt,imageName:Ri,x:_t,y:He+Qi,vertical:er,scale:Ei,localGlyph:Zi.localGlyph,fontStack:$i.fontStack,sectionIndex:Ui,metrics:Zi,rect:ui}),_t+=dr*Ei+Fe):(_i.push({glyph:Wt,imageName:Ri,x:_t,y:He+Qi,vertical:er,scale:Ei,localGlyph:Zi.localGlyph,fontStack:$i.fontStack,sectionIndex:Ui,metrics:Zi,rect:ui}),_t+=Zi.advance*Ei+Fe)}_i.length!==0&&(st=Math.max(_t-Fe,st),yt?_m(_i,qe,bi,zi,we*Bt/2):_m(_i,qe,bi,0,we/2)),_t=0;const Ji=we*Bt+bi;vi.lineOffset=Math.max(bi,ci),He+=Ji,++Rt}var Pt;const Mt=He,{horizontalAlign:vt,verticalAlign:oi}=Mp(ke);(function(Et,Bt,ci,vi,_i,bi){const wi=(Bt-ci)*_i,zi=-bi*vi;for(const Ji of Et)for(const si of Ji.positionedGlyphs)si.x+=wi,si.y+=zi})(te.positionedLines,qe,vt,oi,st,Mt),te.top+=-oi*Mt,te.bottom=te.top+Mt,te.left+=-vt*st,te.right=te.left+st,te.hasBaseline=yt}(ne,e,i,n,B,h,d,m,T,_,S,C),!function(te){for(const ye of te)if(ye.positionedGlyphs.length!==0)return!1;return!0}(J)&&ne}const Qu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Dy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function pm(t,e,i,n,a,c){if(e.imageName){const h=n[e.imageName];return h?h.displaySize[0]*e.scale*lr/c+a:0}{const h=i[e.fontStack],d=h&&h.glyphs[t];return d?d.metrics.advance*e.scale+a:0}}function dm(t,e,i,n){const a=Math.pow(t-e,2);return n?t<e?a/2:2*a:a+Math.abs(i)*i}function Ly(t,e,i){let n=0;return t===10&&(n-=1e4),i&&(n+=150),t!==40&&t!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function fm(t,e,i,n,a,c){let h=null,d=dm(e,i,a,c);for(const m of n){const _=dm(e-m.x,i,a,c)+m.badness;_<=d&&(h=m,d=_)}return{index:t,x:e,priorBreak:h,badness:d}}function mm(t){return t?mm(t.priorBreak).concat(t.index):[]}function Mp(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function _m(t,e,i,n,a){if(!(e||i||n||a))return;const c=t.length-1,h=t[c],d=(h.x+h.metrics.advance*h.scale)*e;for(let m=0;m<=c;m++)t[m].x-=d,t[m].y+=i+n+a}function Ry(t,e,i){const{horizontalAlign:n,verticalAlign:a}=Mp(i),c=e[0]-t.displaySize[0]*n,h=e[1]-t.displaySize[1]*a;return{image:t,top:h,bottom:h+t.displaySize[1],left:c,right:c+t.displaySize[0]}}function gm(t,e,i,n,a,c){const h=t.image;let d;if(h.content){const B=h.content,H=h.pixelRatio||1;d=[B[0]/H,B[1]/H,h.displaySize[0]-B[2]/H,h.displaySize[1]-B[3]/H]}const m=e.left*c,_=e.right*c;let b,T,S,M;i==="width"||i==="both"?(M=a[0]+m-n[3],T=a[0]+_+n[1]):(M=a[0]+(m+_-h.displaySize[0])/2,T=M+h.displaySize[0]);const C=e.top*c,D=e.bottom*c;return i==="height"||i==="both"?(b=a[1]+C-n[0],S=a[1]+D+n[2]):(b=a[1]+(C+D-h.displaySize[1])/2,S=b+h.displaySize[1]),{image:h,top:b,right:T,bottom:S,left:M,collisionPadding:d}}class so extends Se{constructor(e,i,n,a,c){super(e,i),this.angle=a,this.z=n,c!==void 0&&(this.segment=c)}clone(){return new so(this.x,this.y,this.z,this.angle,this.segment)}}function ym(t,e,i,n,a){if(e.segment===void 0)return!0;let c=e,h=e.segment+1,d=0;for(;d>-i/2;){if(h--,h<0)return!1;d-=t[h].dist(c),c=t[h]}d+=t[h].dist(t[h+1]),h++;const m=[];let _=0;for(;d<i/2;){const b=t[h],T=t[h+1];if(!T)return!1;let S=t[h-1].angleTo(b)-b.angleTo(T);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),m.push({distance:d,angleDelta:S}),_+=S;d-m[0].distance>n;)_-=m.shift().angleDelta;if(_>a)return!1;h++,d+=b.dist(T)}return!0}function xm(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function vm(t,e,i){return t?.6*e*i:0}function bm(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function By(t,e,i,n,a,c){const h=vm(i,a,c),d=bm(i,n)*c;let m=0;const _=xm(t)/2;for(let b=0;b<t.length-1;b++){const T=t[b],S=t[b+1],M=T.dist(S);if(m+M>_){const C=(_-m)/M,D=Zt(T.x,S.x,C),B=Zt(T.y,S.y,C),H=new so(D,B,0,S.angleTo(T),b);return!h||ym(t,H,d,h,e)?H:void 0}m+=M}}function Oy(t,e,i,n,a,c,h,d,m){const _=vm(n,c,h),b=bm(n,a),T=b*h,S=t[0].x===0||t[0].x===m||t[0].y===0||t[0].y===m;return e-T<e/4&&(e=T+e/4),wm(t,S?e/2*d%e:(b/2+2*c)*h*d%e,e,_,i,T,S,!1,m)}function wm(t,e,i,n,a,c,h,d,m){const _=c/2,b=xm(t);let T=0,S=e-i,M=[];for(let C=0;C<t.length-1;C++){const D=t[C],B=t[C+1],H=D.dist(B),ee=B.angleTo(D);for(;S+i<T+H;){S+=i;const W=(S-T)/H,J=Zt(D.x,B.x,W),ne=Zt(D.y,B.y,W);if(J>=0&&J<m&&ne>=0&&ne<m&&S-_>=0&&S+_<=b){const te=new so(J,ne,0,ee,C);te._round(),n&&!ym(t,te,c,n,a)||M.push(te)}}T+=H}return d||M.length||h||(M=wm(t,T/2,i,n,a,c,h,!0,m)),M}function Tm(t,e,i,n,a){const c=[];for(let h=0;h<t.length;h++){const d=t[h];let m;for(let _=0;_<d.length-1;_++){let b=d[_],T=d[_+1];b.x<e&&T.x<e||(b.x<e?b=new Se(e,b.y+(e-b.x)/(T.x-b.x)*(T.y-b.y))._round():T.x<e&&(T=new Se(e,b.y+(e-b.x)/(T.x-b.x)*(T.y-b.y))._round()),b.y<i&&T.y<i||(b.y<i?b=new Se(b.x+(i-b.y)/(T.y-b.y)*(T.x-b.x),i)._round():T.y<i&&(T=new Se(b.x+(i-b.y)/(T.y-b.y)*(T.x-b.x),i)._round()),b.x>=n&&T.x>=n||(b.x>=n?b=new Se(n,b.y+(n-b.x)/(T.x-b.x)*(T.y-b.y))._round():T.x>=n&&(T=new Se(n,b.y+(n-b.x)/(T.x-b.x)*(T.y-b.y))._round()),b.y>=a&&T.y>=a||(b.y>=a?b=new Se(b.x+(a-b.y)/(T.y-b.y)*(T.x-b.x),a)._round():T.y>=a&&(T=new Se(b.x+(a-b.y)/(T.y-b.y)*(T.x-b.x),a)._round()),m&&b.equals(m[m.length-1])||(m=[b],c.push(m)),m.push(T)))))}}return c}it(so,"Anchor");const dc=1e20;function Em(t,e,i,n,a,c,h,d,m){for(let _=e;_<e+n;_++)Sm(t,i*c+_,c,a,h,d,m);for(let _=i;_<i+a;_++)Sm(t,_*c+e,1,n,h,d,m)}function Sm(t,e,i,n,a,c,h){c[0]=0,h[0]=-dc,h[1]=dc,a[0]=t[e];for(let d=1,m=0,_=0;d<n;d++){a[d]=t[e+d*i];const b=d*d;do{const T=c[m];_=(a[d]-a[T]+b-T*T)/(d-T)/2}while(_<=h[m]&&--m>-1);m++,c[m]=d,h[m]=_,h[m+1]=dc}for(let d=0,m=0;d<n;d++){for(;h[m+1]<d;)m++;const _=c[m],b=d-_;t[e+d*i]=a[_]+b*b}}const Cp={none:0,ideographs:1,all:2};class $a{constructor(e,i,n){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const n=[];for(const a in e)for(const c of e[a])n.push({stack:a,id:c});Mr(n,({stack:a,id:c},h)=>{let d=this.entries[a];d||(d=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let m=d.glyphs[c];if(m!==void 0)return void h(null,{stack:a,id:c,glyph:m});if(m=this._tinySDF(d,a,c),m)return d.glyphs[c]=m,void h(null,{stack:a,id:c,glyph:m});const _=Math.floor(c/256);if(256*_>65535)return void h(new Error("glyphs > 65535 not supported"));if(d.ranges[_])return void h(null,{stack:a,id:c,glyph:m});let b=d.requests[_];b||(b=d.requests[_]=[],$a.loadGlyphRange(a,_,this.url,this.requestManager,(T,S)=>{if(S){d.ascender=S.ascender,d.descender=S.descender;for(const M in S.glyphs)this._doesCharSupportLocalGlyph(+M)||(d.glyphs[+M]=S.glyphs[+M]);d.ranges[_]=!0}for(const M of b)M(T,S);delete d.requests[_]})),b.push((T,S)=>{T?h(T):S&&h(null,{stack:a,id:c,glyph:S.glyphs[c]||null})})},(a,c)=>{if(a)i(a);else if(c){const h={};for(const{stack:d,id:m,glyph:_}of c)h[d]===void 0&&(h[d]={}),h[d].glyphs===void 0&&(h[d].glyphs={}),h[d].glyphs[m]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics},h[d].ascender=this.entries[d].ascender,h[d].descender=this.entries[d].descender;i(null,h)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Cp.none&&(this.localGlyphMode===Cp.all?!!this.localFontFamily:!!this.localFontFamily&&($l(e)||ql(e)||zs(e)||za(e)||Fo(e)))}_tinySDF(e,i,n){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(n))return;let c=e.tinySDF;if(!c){let D="400";/bold/i.test(i)?D="900":/medium/i.test(i)?D="500":/light/i.test(i)&&(D="200"),c=e.tinySDF=new $a.TinySDF({fontFamily:a,fontWeight:D,fontSize:48,buffer:6,radius:16}),c.fontWeight=D}if(this.localGlyphs[c.fontWeight][n])return this.localGlyphs[c.fontWeight][n];const h=String.fromCharCode(n),{data:d,width:m,height:_,glyphWidth:b,glyphHeight:T,glyphLeft:S,glyphTop:M,glyphAdvance:C}=c.draw(h);return this.localGlyphs[c.fontWeight][n]={id:n,bitmap:new no({width:m,height:_},d),metrics:{width:b/2,height:T/2,left:S/2,top:M/2-27,advance:C/2,localGlyph:!0}}}}function Im(t,e,i,n){const a=[],c=t.image,h=c.pixelRatio,d=c.paddedRect.w-2,m=c.paddedRect.h-2,_=t.right-t.left,b=t.bottom-t.top,T=c.stretchX||[[0,d]],S=c.stretchY||[[0,m]],M=(we,ke)=>we+ke[1]-ke[0],C=T.reduce(M,0),D=S.reduce(M,0),B=d-C,H=m-D;let ee=0,W=C,J=0,ne=D,te=0,ye=B,ge=0,Ie=H;if(c.content&&n){const we=c.content;ee=eh(T,0,we[0]),J=eh(S,0,we[1]),W=eh(T,we[0],we[2]),ne=eh(S,we[1],we[3]),te=we[0]-ee,ge=we[1]-J,ye=we[2]-we[0]-W,Ie=we[3]-we[1]-ne}const Oe=(we,ke,ze,Le)=>{const Fe=th(we.stretch-ee,W,_,t.left),Te=ih(we.fixed-te,ye,we.stretch,C),$e=th(ke.stretch-J,ne,b,t.top),_t=ih(ke.fixed-ge,Ie,ke.stretch,D),He=th(ze.stretch-ee,W,_,t.left),st=ih(ze.fixed-te,ye,ze.stretch,C),qe=th(Le.stretch-J,ne,b,t.top),yt=ih(Le.fixed-ge,Ie,Le.stretch,D),Rt=new Se(Fe,$e),Pt=new Se(He,$e),Mt=new Se(He,qe),vt=new Se(Fe,qe),oi=new Se(Te/h,_t/h),Et=new Se(st/h,yt/h),Bt=e*Math.PI/180;if(Bt){const _i=Math.sin(Bt),bi=Math.cos(Bt),wi=[bi,-_i,_i,bi];Rt._matMult(wi),Pt._matMult(wi),vt._matMult(wi),Mt._matMult(wi)}const ci=we.stretch+we.fixed,vi=ke.stretch+ke.fixed;return{tl:Rt,tr:Pt,bl:vt,br:Mt,tex:{x:c.paddedRect.x+1+ci,y:c.paddedRect.y+1+vi,w:ze.stretch+ze.fixed-ci,h:Le.stretch+Le.fixed-vi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:oi,pixelOffsetBR:Et,minFontScaleX:ye/h/_,minFontScaleY:Ie/h/b,isSDF:i}};if(n&&(c.stretchX||c.stretchY)){const we=Am(T,B,C),ke=Am(S,H,D);for(let ze=0;ze<we.length-1;ze++){const Le=we[ze],Fe=we[ze+1];for(let Te=0;Te<ke.length-1;Te++)a.push(Oe(Le,ke[Te],Fe,ke[Te+1]))}}else a.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:d+1},{fixed:0,stretch:m+1}));return a}function eh(t,e,i){let n=0;for(const a of t)n+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return n}function Am(t,e,i){const n=[{fixed:-1,stretch:0}];for(const[a,c]of t){const h=n[n.length-1];n.push({fixed:a-h.stretch,stretch:h.stretch}),n.push({fixed:a-h.stretch,stretch:h.stretch+(c-a)})}return n.push({fixed:e+1,stretch:i}),n}function th(t,e,i,n){return t/e*i+n}function ih(t,e,i,n){return t-e*i/n}function Fy(t,e,i,n){const a=e+t.positionedLines[n].lineOffset;return n===0?i+a/2:i+(a+(e+t.positionedLines[n-1].lineOffset))/2}$a.loadGlyphRange=function(t,e,i,n,a){const c=256*e,h=c+255,d=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${c}-${h}`),Er.Glyphs);En(d,(m,_)=>{if(m)a(m);else if(_){const b={},T=function(S){return new hc(S).readFields(ky,{})}(_);for(const S of T.glyphs)b[S.id]=S;a(null,{glyphs:b,ascender:T.ascender,descender:T.descender})}})},$a.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:a="sans-serif",fontWeight:c="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=i;const d=this.size=t+4*e,m=this._createCanvas(d),_=this.ctx=m.getContext("2d",{willReadFrequently:!0});_.font=`${h} ${c} ${t}px ${a}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:a,actualBoundingBoxRight:c}=this.ctx.measureText(t),h=Math.ceil(i),d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-a))),m=Math.min(this.size-this.buffer,h+Math.ceil(n)),_=d+2*this.buffer,b=m+2*this.buffer,T=Math.max(_*b,0),S=new Uint8ClampedArray(T),M={data:S,width:_,height:b,glyphWidth:d,glyphHeight:m,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(d===0||m===0)return M;const{ctx:C,buffer:D,gridInner:B,gridOuter:H}=this;C.clearRect(D,D,d,m),C.fillText(t,D,D+h);const ee=C.getImageData(D,D,d,m);H.fill(dc,0,T),B.fill(0,0,T);for(let W=0;W<m;W++)for(let J=0;J<d;J++){const ne=ee.data[4*(W*d+J)+3]/255;if(ne===0)continue;const te=(W+D)*_+J+D;if(ne===1)H[te]=0,B[te]=dc;else{const ye=.5-ne;H[te]=ye>0?ye*ye:0,B[te]=ye<0?ye*ye:0}}Em(H,0,0,_,b,_,this.f,this.v,this.z),Em(B,D,D,d,m,_,this.f,this.v,this.z);for(let W=0;W<T;W++){const J=Math.sqrt(H[W])-Math.sqrt(B[W]);S[W]=Math.round(255-255*(J/this.radius+this.cutoff))}return M}};class Uy{constructor(e=[],i=jy){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:n}=this,a=i[e];for(;e>0;){const c=e-1>>1,h=i[c];if(n(a,h)>=0)break;i[e]=h,e=c}i[e]=a}_down(e){const{data:i,compare:n}=this,a=this.length>>1,c=i[e];for(;e<a;){let h=1+(e<<1),d=i[h];const m=h+1;if(m<this.length&&n(i[m],d)<0&&(h=m,d=i[m]),n(d,c)>=0)break;i[e]=d,e=h}i[e]=c}}function jy(t,e){return t<e?-1:t>e?1:0}function Ny(t,e=1,i=!1){let n=1/0,a=1/0,c=-1/0,h=-1/0;const d=t[0];for(let M=0;M<d.length;M++){const C=d[M];(!M||C.x<n)&&(n=C.x),(!M||C.y<a)&&(a=C.y),(!M||C.x>c)&&(c=C.x),(!M||C.y>h)&&(h=C.y)}const m=Math.min(c-n,h-a);let _=m/2;const b=new Uy([],Vy);if(m===0)return new Se(n,a);for(let M=n;M<c;M+=m)for(let C=a;C<h;C+=m)b.push(new qa(M+_,C+_,_,t));let T=function(M){let C=0,D=0,B=0;const H=M[0];for(let ee=0,W=H.length,J=W-1;ee<W;J=ee++){const ne=H[ee],te=H[J],ye=ne.x*te.y-te.x*ne.y;D+=(ne.x+te.x)*ye,B+=(ne.y+te.y)*ye,C+=3*ye}return new qa(D/C,B/C,0,M)}(t),S=b.length;for(;b.length;){const M=b.pop();(M.d>T.d||!T.d)&&(T=M,i&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,S)),M.max-T.d<=e||(_=M.h/2,b.push(new qa(M.p.x-_,M.p.y-_,_,t)),b.push(new qa(M.p.x+_,M.p.y-_,_,t)),b.push(new qa(M.p.x-_,M.p.y+_,_,t)),b.push(new qa(M.p.x+_,M.p.y+_,_,t)),S+=4)}return i&&(console.log(`num probes: ${S}`),console.log(`best distance: ${T.d}`)),T.p}function Vy(t,e){return e.max-t.max}function qa(t,e,i,n){this.p=new Se(t,e),this.h=i,this.d=function(a,c){let h=!1,d=1/0;for(let m=0;m<c.length;m++){const _=c[m];for(let b=0,T=_.length,S=T-1;b<T;S=b++){const M=_[b],C=_[S];M.y>a.y!=C.y>a.y&&a.x<(C.x-M.x)*(a.y-M.y)/(C.y-M.y)+M.x&&(h=!h),d=Math.min(d,pf(a,M,C))}}return(h?1:-1)*Math.sqrt(d)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const kp=Number.POSITIVE_INFINITY,Gy=Math.sqrt(2);function Mm(t,[e,i]){let n=0,a=0;if(i===kp){e<0&&(e=0);const c=e/Gy;switch(t){case"top-right":case"top-left":a=c-7;break;case"bottom-right":case"bottom-left":a=7-c;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(t){case"top-right":case"bottom-right":n=-c;break;case"top-left":case"bottom-left":n=c;break;case"left":n=e;break;case"right":n=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}}return[n,a]}function $y(t,e,i,n,a,c,h,d,m,_){t.createArrays(),t.tilePixelRatio=bt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const b=t.layers[0].layout,T=t.layers[0]._unevaluatedLayout._values,S={};if(t.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:B}=t.textSizeData;S.compositeTextSizes=[T["text-size"].possiblyEvaluate(new ue(D),d),T["text-size"].possiblyEvaluate(new ue(B),d)]}if(t.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:B}=t.iconSizeData;S.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new ue(D),d),T["icon-size"].possiblyEvaluate(new ue(B),d)]}S.layoutTextSize=T["text-size"].possiblyEvaluate(new ue(m+1),d),S.layoutIconSize=T["icon-size"].possiblyEvaluate(new ue(m+1),d),S.textMaxSize=T["text-size"].possiblyEvaluate(new ue(18),d);const M=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point",C=b.get("text-size");for(const D of t.features){const B=b.get("text-font").evaluate(D,{},d).join(","),H=C.evaluate(D,{},d),ee=S.layoutTextSize.evaluate(D,{},d),W=(S.layoutIconSize.evaluate(D,{},d),{horizontal:{},vertical:void 0}),J=D.text;let ne,te=[0,0];if(J){const Ie=J.toString(),Oe=b.get("text-letter-spacing").evaluate(D,{},d)*lr,we=b.get("text-line-height").evaluate(D,{},d)*lr,ke=v(Ie)?Oe:0,ze=b.get("text-anchor").evaluate(D,{},d),Le=b.get("text-variable-anchor");if(!Le){const He=b.get("text-radial-offset").evaluate(D,{},d);te=He?Mm(ze,[He*lr,kp]):b.get("text-offset").evaluate(D,{},d).map(st=>st*lr)}let Fe=M?"center":b.get("text-justify").evaluate(D,{},d);const Te=b.get("symbol-placement")==="point",$e=Te?b.get("text-max-width").evaluate(D,{},d)*lr:1/0,_t=He=>{t.allowVerticalPlacement&&g(Ie)&&(W.vertical=Ap(J,e,i,a,B,$e,we,ze,He,ke,te,Gr.vertical,!0,ee,H))};if(!M&&Le){const He=Fe==="auto"?Le.map(qe=>zp(qe)):[Fe];let st=!1;for(let qe=0;qe<He.length;qe++){const yt=He[qe];if(!W.horizontal[yt])if(st)W.horizontal[yt]=W.horizontal[0];else{const Rt=Ap(J,e,i,a,B,$e,we,"center",yt,ke,te,Gr.horizontal,!1,ee,H);Rt&&(W.horizontal[yt]=Rt,st=Rt.positionedLines.length===1)}}_t("left")}else{if(Fe==="auto"&&(Fe=zp(ze)),Te||b.get("text-writing-mode").indexOf("horizontal")>=0||!g(Ie)){const He=Ap(J,e,i,a,B,$e,we,ze,Fe,ke,te,Gr.horizontal,!1,ee,H);He&&(W.horizontal[Fe]=He)}_t(Te?"left":Fe)}}let ye=!1;if(D.icon&&D.icon.name){const Ie=n[D.icon.name];Ie&&(ne=Ry(a[D.icon.name],b.get("icon-offset").evaluate(D,{},d),b.get("icon-anchor").evaluate(D,{},d)),ye=Ie.sdf,t.sdfIcons===void 0?t.sdfIcons=Ie.sdf:t.sdfIcons!==Ie.sdf&&$t("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ie.pixelRatio!==t.pixelRatio||b.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const ge=km(W.horizontal)||W.vertical;t.iconsInText||(t.iconsInText=!!ge&&ge.iconsInText),(ge||ne)&&qy(t,D,W,ne,n,S,ee,0,te,ye,h,d,_)}c&&t.generateCollisionDebugBuffers(m,t.collisionBoxArray)}function zp(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qy(t,e,i,n,a,c,h,d,m,_,b,T,S){let M=c.textMaxSize.evaluate(e,{},T);M===void 0&&(M=h);const C=t.layers[0].layout,D=C.get("icon-offset").evaluate(e,{},T),B=km(i.horizontal)||i.vertical,H=S.name==="globe",ee=h/24,W=t.tilePixelRatio*M/24,J=(ke=t.overscaling,t.zoom>18&&ke>2&&(ke>>=1),Math.max(bt/(512*ke),1)*C.get("symbol-spacing")),ne=C.get("text-padding")*t.tilePixelRatio,te=C.get("icon-padding")*t.tilePixelRatio,ye=gt(C.get("text-max-angle")),ge=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",Ie=C.get("icon-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",Oe=C.get("symbol-placement"),we=J/2;var ke;const ze=C.get("icon-text-fit");let Le;n&&ze!=="none"&&(t.allowVerticalPlacement&&i.vertical&&(Le=gm(n,i.vertical,ze,C.get("icon-text-fit-padding"),D,ee)),B&&(n=gm(n,B,ze,C.get("icon-text-fit-padding"),D,ee)));const Fe=(Te,$e,_t)=>{if($e.x<0||$e.x>=bt||$e.y<0||$e.y>=bt)return;let He=null;if(H){const{x:st,y:qe,z:yt}=S.projectTilePoint($e.x,$e.y,_t);He={anchor:new so(st,qe,yt,0,void 0),up:S.upVector(_t,$e.x,$e.y)}}(function(st,qe,yt,Rt,Pt,Mt,vt,oi,Et,Bt,ci,vi,_i,bi,wi,zi,Ji,si,$i,Ui,Wt,Ei,Zi,ui,Ri){const dr=st.addToLineVertexArray(qe,Rt);let Qi,er,br,tr,lo,Ja,Ec,Sc=0,f_=0,m_=0,__=0,Wp=-1,Hp=-1;const Vn={};let g_=Pa.exports("");const qs=yt?yt.anchor:qe;let Yp=0,Kp=0;if(Et._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Yp,Kp]=Et.layout.get("text-offset").evaluate(Wt,{},Ri).map(Rr=>Rr*lr):(Yp=Et.layout.get("text-radial-offset").evaluate(Wt,{},Ri)*lr,Kp=kp),st.allowVerticalPlacement&&Pt.vertical){const Rr=Pt.vertical;if(wi)Ja=Pp(Rr),oi&&(Ec=Pp(oi));else{const Br=Et.layout.get("text-rotate").evaluate(Wt,{},Ri)+90;br=rh(Bt,qs,qe,ci,vi,_i,Rr,bi,Br,zi),oi&&(tr=rh(Bt,qs,qe,ci,vi,_i,oi,si,Br))}}if(Mt){const Rr=Et.layout.get("icon-rotate").evaluate(Wt,{},Ri),Br=Et.layout.get("icon-text-fit")!=="none",Ic=Im(Mt,Rr,Zi,Br),Qp=oi?Im(oi,Rr,Zi,Br):void 0;er=rh(Bt,qs,qe,ci,vi,_i,Mt,si,Rr),Sc=4*Ic.length;const y_=st.iconSizeData;let Zs=null;y_.kind==="source"?(Zs=[On*Et.layout.get("icon-size").evaluate(Wt,{},Ri)],Zs[0]>Go&&$t(`${st.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):y_.kind==="composite"&&(Zs=[On*Ei.compositeIconSizes[0].evaluate(Wt,{},Ri),On*Ei.compositeIconSizes[1].evaluate(Wt,{},Ri)],(Zs[0]>Go||Zs[1]>Go)&&$t(`${st.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),st.addSymbols(st.icon,Ic,Zs,Ui,$i,Wt,!1,yt,qe,dr.lineStartIndex,dr.lineLength,-1,ui,Ri),Wp=st.icon.placedSymbolArray.length-1,Qp&&(f_=4*Qp.length,st.addSymbols(st.icon,Qp,Zs,Ui,$i,Wt,Gr.vertical,yt,qe,dr.lineStartIndex,dr.lineLength,-1,ui,Ri),Hp=st.icon.placedSymbolArray.length-1)}for(const Rr in Pt.horizontal){const Br=Pt.horizontal[Rr];Qi||(g_=Pa.exports(Br.text),wi?lo=Pp(Br):Qi=rh(Bt,qs,qe,ci,vi,_i,Br,bi,Et.layout.get("text-rotate").evaluate(Wt,{},Ri),zi));const Ic=Br.positionedLines.length===1;if(m_+=Cm(st,yt,qe,Br,vt,Et,wi,Wt,zi,dr,Pt.vertical?Gr.horizontal:Gr.horizontalOnly,Ic?Object.keys(Pt.horizontal):[Rr],Vn,Wp,Ei,ui,Ri),Ic)break}Pt.vertical&&(__+=Cm(st,yt,qe,Pt.vertical,vt,Et,wi,Wt,zi,dr,Gr.vertical,["vertical"],Vn,Hp,Ei,ui,Ri));let Ho=-1;const Jp=(Rr,Br)=>Rr?Math.max(Rr,Br):Br;Ho=Jp(lo,Ho),Ho=Jp(Ja,Ho),Ho=Jp(Ec,Ho);const T0=Ho>-1?1:0;st.glyphOffsetArray.length>=qo.MAX_GLYPHS&&$t("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Wt.sortKey!==void 0&&st.addToSortKeyRanges(st.symbolInstances.length,Wt.sortKey),st.symbolInstances.emplaceBack(qs.x,qs.y,qs.z,qe.x,qe.y,Vn.right>=0?Vn.right:-1,Vn.center>=0?Vn.center:-1,Vn.left>=0?Vn.left:-1,Vn.vertical>=0?Vn.vertical:-1,Wp,Hp,g_,Qi!==void 0?Qi:st.collisionBoxArray.length,Qi!==void 0?Qi+1:st.collisionBoxArray.length,br!==void 0?br:st.collisionBoxArray.length,br!==void 0?br+1:st.collisionBoxArray.length,er!==void 0?er:st.collisionBoxArray.length,er!==void 0?er+1:st.collisionBoxArray.length,tr||st.collisionBoxArray.length,tr?tr+1:st.collisionBoxArray.length,ci,m_,__,Sc,f_,T0,0,Yp,Kp,Ho)})(t,$e,He,Te,i,n,a,Le,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ne,ge,m,0,te,Ie,D,e,c,_,b,T)};if(Oe==="line")for(const Te of Tm(e.geometry,0,0,bt,bt)){const $e=Oy(Te,J,ye,i.vertical||B,n,24,W,t.overscaling,bt);for(const _t of $e){const He=B;He&&Zy(t,He.text,we,_t)||Fe(Te,_t,T)}}else if(Oe==="line-center"){for(const Te of e.geometry)if(Te.length>1){const $e=By(Te,ye,i.vertical||B,n,24,W);$e&&Fe(Te,$e,T)}}else if(e.type==="Polygon")for(const Te of xp(e.geometry,0)){const $e=Ny(Te,16);Fe(Te[0],new so($e.x,$e.y,0,0,void 0),T)}else if(e.type==="LineString")for(const Te of e.geometry)Fe(Te,new so(Te[0].x,Te[0].y,0,0,void 0),T);else if(e.type==="Point")for(const Te of e.geometry)for(const $e of Te)Fe([$e],new so($e.x,$e.y,0,0,void 0),T)}const Go=32640;function Cm(t,e,i,n,a,c,h,d,m,_,b,T,S,M,C,D,B){const H=function(J,ne,te,ye,ge,Ie,Oe,we){const ke=[];if(ne.positionedLines.length===0)return ke;const ze=ye.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,Le=function(He){const st=He[0],qe=He[1],yt=st*qe;return yt>0?[st,-qe]:yt<0?[-st,qe]:st===0?[qe,st]:[qe,-st]}(te);let Fe=Math.abs(ne.top-ne.bottom);for(const He of ne.positionedLines)Fe-=He.lineOffset;const Te=ne.positionedLines.length,$e=Fe/Te;let _t=ne.top-te[1];for(let He=0;He<Te;++He){const st=ne.positionedLines[He];_t=Fy(ne,$e,_t,He);for(const qe of st.positionedGlyphs){if(!qe.rect)continue;const yt=qe.rect||{};let Rt=4,Pt=!0,Mt=1,vt=0;if(qe.imageName){const ui=Oe[qe.imageName];if(!ui)continue;if(ui.sdf){$t("SDF images are not supported in formatted text and will be ignored.");continue}Pt=!1,Mt=ui.pixelRatio,Rt=1/Mt}const oi=(ge||we)&&qe.vertical,Et=qe.metrics.advance*qe.scale/2,Bt=qe.metrics,ci=qe.rect;if(ci===null)continue;we&&ne.verticalizable&&(vt=qe.imageName?Et-qe.metrics.width*qe.scale/2:0);const vi=ge?[qe.x+Et,qe.y]:[0,0];let _i=[0,0],bi=[0,0],wi=!1;ge||(oi?(bi=[qe.x+Et+Le[0],qe.y+Le[1]-vt],wi=!0):_i=[qe.x+Et+te[0],qe.y+te[1]-vt]);const zi=ci.w*qe.scale/(Mt*(qe.localGlyph?2:1)),Ji=ci.h*qe.scale/(Mt*(qe.localGlyph?2:1));let si,$i,Ui,Wt;if(oi){const ui=qe.y-_t,Ri=new Se(-Et,Et-ui),dr=-Math.PI/2,Qi=new Se(...bi);si=new Se(-Et+_i[0],_i[1]),si._rotateAround(dr,Ri)._add(Qi),si.x+=-ui+Et,si.y-=(Bt.left-Rt)*qe.scale;const er=qe.imageName?Bt.advance*qe.scale:lr*qe.scale,br=String.fromCharCode(qe.glyph);xy(br)?si.x+=(1-Rt)*qe.scale:vy(br)?si.x+=er-Bt.height*qe.scale+(-Rt-1)*qe.scale:si.x+=qe.imageName||Bt.width+2*Rt===ci.w&&Bt.height+2*Rt===ci.h?(er-Ji)/2:(er-(Bt.height+2*Rt)*qe.scale)/2,$i=new Se(si.x,si.y-zi),Ui=new Se(si.x+Ji,si.y),Wt=new Se(si.x+Ji,si.y-zi)}else{const ui=(Bt.left-Rt)*qe.scale-Et+_i[0],Ri=(-Bt.top-Rt)*qe.scale+_i[1],dr=ui+zi,Qi=Ri+Ji;si=new Se(ui,Ri),$i=new Se(dr,Ri),Ui=new Se(ui,Qi),Wt=new Se(dr,Qi)}if(ze){let ui;ui=ge?new Se(0,0):wi?new Se(Le[0],Le[1]):new Se(te[0],te[1]),si._rotateAround(ze,ui),$i._rotateAround(ze,ui),Ui._rotateAround(ze,ui),Wt._rotateAround(ze,ui)}const Ei=new Se(0,0),Zi=new Se(0,0);ke.push({tl:si,tr:$i,bl:Ui,br:Wt,tex:yt,writingMode:ne.writingMode,glyphOffset:vi,sectionIndex:qe.sectionIndex,isSDF:Pt,pixelOffsetTL:Ei,pixelOffsetBR:Zi,minFontScaleX:0,minFontScaleY:0})}}return ke}(0,n,m,c,h,d,a,t.allowVerticalPlacement),ee=t.textSizeData;let W=null;ee.kind==="source"?(W=[On*c.layout.get("text-size").evaluate(d,{},B)],W[0]>Go&&$t(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ee.kind==="composite"&&(W=[On*C.compositeTextSizes[0].evaluate(d,{},B),On*C.compositeTextSizes[1].evaluate(d,{},B)],(W[0]>Go||W[1]>Go)&&$t(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,H,W,m,h,d,b,e,i,_.lineStartIndex,_.lineLength,M,D,B);for(const J of T)S[J]=t.text.placedSymbolArray.length-1;return 4*H.length}function km(t){for(const e in t)return t[e];return null}function rh(t,e,i,n,a,c,h,d,m,_){let b=h.top,T=h.bottom,S=h.left,M=h.right;const C=h.collisionPadding;if(C&&(S-=C[0],b-=C[1],M+=C[2],T+=C[3]),m){const D=new Se(S,b),B=new Se(M,b),H=new Se(S,T),ee=new Se(M,T),W=gt(m);let J=new Se(0,0);_&&(J=new Se(_[0],_[1])),D._rotateAround(W,J),B._rotateAround(W,J),H._rotateAround(W,J),ee._rotateAround(W,J),S=Math.min(D.x,B.x,H.x,ee.x),M=Math.max(D.x,B.x,H.x,ee.x),b=Math.min(D.y,B.y,H.y,ee.y),T=Math.max(D.y,B.y,H.y,ee.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,S,b,M,T,d,n,a,c),t.length-1}function Pp(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Zy(t,e,i,n){const a=t.compareText;if(e in a){const c=a[e];for(let h=c.length-1;h>=0;h--)if(n.dist(c[h])<i)return!0}else a[e]=[];return a[e].push(n),!1}const Xy=et([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:zm}=Xy,Pm=et([{name:"a_pos_3",components:3,type:"Int16"}]);var fc=et([{name:"a_pos",type:"Int16",components:2}]);const ao=bt/Math.PI/2,Dp=2*en(1,0)*ao*Math.PI,Za=64,Xa=[Za,32,16],rn=-ao,nn=ao,Wy=[new xr([rn,rn,rn],[nn,nn,nn]),new xr([rn,rn,rn],[0,0,nn]),new xr([0,rn,rn],[nn,0,nn]),new xr([rn,0,rn],[0,nn,nn]),new xr([0,0,rn],[nn,nn,nn])];function Dm(t,e,i,n=!0){const a=Vr([],t._camera.position,t.worldSize),c=[e,i,1,1];js(c,c,t.pixelMatrixInverse),Ef(c,c,1/c[3]);const h=yr([],gn([],c,a)),d=t.globeMatrix,m=[d[12],d[13],d[14]],_=gn([],m,a),b=Hl(_),T=yr([],_),S=t.worldSize/(2*Math.PI),M=tn(T,h),C=Math.asin(S/b);if(C<Math.acos(M)){if(!n)return null;const Oe=[],we=[];Vr(Oe,h,b/M),yr(we,gn(we,Oe,_)),yr(h,ro(h,_,Vr(h,we,Math.tan(C)*b)))}const D=[];new hp(a,h).closestPointOnSphere(m,S,D);const B=yr([],vn(d,0)),H=yr([],vn(d,1)),ee=yr([],vn(d,2)),W=tn(B,D),J=tn(H,D),ne=tn(ee,D),te=ei(Math.asin(-J/S));let ye=ei(Math.atan2(W,ne));ye=t.center.lng+function(Oe,we){const ke=(we-Oe+180)%360-180;return ke<-180?ke+360:ke}(t.center.lng,ye);const ge=Ln(ye),Ie=Tt(Rn(te),0,1);return new La(ge,Ie)}class Hy{constructor(e,i,n){this.a=gn([],e,n),this.b=gn([],i,n),this.center=n;const a=yr([],this.a),c=yr([],this.b);this.angle=Math.acos(tn(a,c))}}function Lp(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(n,a,c,h){const d=Math.sin(c);return n*(Math.sin((1-h)*c)/d)+a*(Math.sin(h*c)/d)}(t.a[e],t.b[e],t.angle,Tt(i,0,1))+t.center[e]}function Fn(t){if(t.z<=1)return Wy[t.z+2*t.y+t.x];const e=Rp(nh(t));return xr.fromPoints(e)}function Vs(t,e,i){return Vr(t,t,1-i),Jl(t,t,e,i)}function Lm(t,e){const i=Ha(e.zoom);if(i===0)return Fn(t);const n=nh(t),a=Rp(n),c=Ln(n.getWest())*e.worldSize,h=Ln(n.getEast())*e.worldSize,d=Rn(n.getNorth())*e.worldSize,m=Rn(n.getSouth())*e.worldSize,_=[c,d,0],b=[h,d,0],T=[c,m,0],S=[h,m,0],M=sp([],e.globeMatrix);return Li(_,_,M),Li(b,b,M),Li(T,T,M),Li(S,S,M),a[0]=Vs(a[0],T,i),a[1]=Vs(a[1],S,i),a[2]=Vs(a[2],b,i),a[3]=Vs(a[3],_,i),xr.fromPoints(a)}function Rm(t,e,i){for(const n of t)Li(n,n,e),Vr(n,n,i)}function Yy(t,e,i){const n=e/t.worldSize,a=t.globeMatrix;if(i.z<=1){const ge=Fn(i).getCorners();return Rm(ge,a,n),xr.fromPoints(ge)}const c=nh(i),h=Rp(c);Rm(h,a,n);const d=Number.MAX_VALUE,m=[-d,-d,-d],_=[d,d,d];if(c.contains(t.center)){for(const Oe of h)Yl(_,_,Oe),Kl(m,m,Oe);m[2]=0;const ge=t.point,Ie=[ge.x*n,ge.y*n,0];return Yl(_,_,Ie),Kl(m,m,Ie),new xr(_,m)}const b=[a[12]*n,a[13]*n,a[14]*n],T=c.getCenter(),S=Tt(t.center.lat,-85.051129,Bn),M=Tt(T.lat,-85.051129,Bn),C=Ln(t.center.lng),D=Rn(S);let B=C-Ln(T.lng);const H=D-Rn(M);B>.5?B-=1:B<-.5&&(B+=1);let ee=0;Math.abs(B)>Math.abs(H)?ee=B>=0?1:3:(ee=H>=0?0:2,Jl(b,b,[a[4]*n,a[5]*n,a[6]*n],-Math.sin(gt(H>=0?c.getSouth():c.getNorth()))*ao));const W=h[ee],J=h[(ee+1)%4],ne=new Hy(W,J,b),te=[Lp(ne,0)||W[0],Lp(ne,1)||W[1],Lp(ne,2)||W[2]],ye=Ha(t.zoom);if(ye>0){const ge=function({x:Oe,y:we,z:ke},ze,Le,Fe,Te){const $e=1/(1<<ke);let _t=Oe*$e,He=_t+$e,st=we*$e,qe=st+$e,yt=0;const Rt=(_t+He)/2-Fe;return Rt>.5?yt=-1:Rt<-.5&&(yt=1),_t=((_t+yt)*ze-(Fe*=ze))*Le+Fe,He=((He+yt)*ze-Fe)*Le+Fe,st=(st*ze-(Te*=ze))*Le+Te,qe=(qe*ze-Te)*Le+Te,[[_t,qe,0],[He,qe,0],[He,st,0],[_t,st,0]]}(i,e,t._pixelsPerMercatorPixel,C,D);for(let Oe=0;Oe<h.length;Oe++)Vs(h[Oe],ge[Oe],ye);const Ie=ro([],ge[ee],ge[(ee+1)%4]);Vr(Ie,Ie,.5),Vs(te,Ie,ye)}for(const ge of h)Yl(_,_,ge),Kl(m,m,ge);return _[2]=Math.min(W[2],J[2]),Yl(_,_,te),Kl(m,m,te),new xr(_,m)}function nh({x:t,y:e,z:i}){const n=1/(1<<i),a=new qt(Nr(t*n),ar((e+1)*n)),c=new qt(Nr((t+1)*n),ar(e*n));return new Vo(a,c)}function Rp(t){const e=gt(t.getNorth()),i=gt(t.getSouth()),n=Math.cos(e),a=Math.cos(i),c=Math.sin(e),h=Math.sin(i),d=t.getWest(),m=t.getEast();return[Wa(a,h,d),Wa(a,h,m),Wa(n,c,m),Wa(n,c,d)]}function Wa(t,e,i,n=ao){return i=gt(i),[t*Math.sin(i)*n,-e*n,t*Math.cos(i)*n]}function mc(t,e,i){return Wa(Math.cos(gt(t)),Math.sin(gt(t)),e,i)}function _c(t,e,i,n){const a=1<<i.z,c=(t/bt+i.x)/a;return mc(ar((e/bt+i.y)/a),Nr(c),n)}function oh({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Bm=new Float64Array(16);function gc(t){const e=oh(t),i=xf(Bm,[e,e,e]);return Wl(i,i,((n=[])[0]=-(a=t.min)[0],n[1]=-a[1],n[2]=-a[2],n));var n,a}function Bp(t){const e=(n=t.min,(i=Bm)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i);var i,n;const a=1/oh(t);return Us(e,e,[a,a,a])}function Om(t,e,i,n,a){const c=function(m){const _=bt/(2*Math.PI);return m/(2*Math.PI)/_}(i),h=[t,e,-i/(2*Math.PI)],d=_n(new Float64Array(16));return Wl(d,d,h),Us(d,d,[c,c,c]),ap(d,d,gt(-a)),ju(d,d,gt(-n)),d}function Ha(t){return Wi(5,6,t)}function Fm(t,e){const i=mc(e.lat,e.lng),n=function(C){const D=mc(C._center.lat,C._center.lng);let B=up([],Ba(0,1,0),D);const H=vf([],-C.angle,D);B=Li(B,B,H),vf(H,-C._pitch,B);const ee=yr([],D);return Vr(ee,ee,C.cameraToCenterDistance/C.pixelsPerMeter*Dp),Li(ee,ee,H),ro([],D,ee)}(t);return h=(a=cp([],n,i))[0],d=a[1],m=a[2],_=(c=i)[0],b=c[1],T=c[2],M=(S=Math.sqrt(h*h+d*d+m*m)*Math.sqrt(_*_+b*b+T*T))&&tn(a,c)/S,Math.acos(Math.min(Math.max(M,-1),1));var a,c,h,d,m,_,b,T,S,M}function Op(t,e){return Fm(t,e)>Math.PI/2*1.01}const Um=gt(85),Ky=Math.cos(Um),Jy=Math.sin(Um);function jm(t,e){const i=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),c=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),h=Math.sin(t._pitch)*c+a;return Math.min(1.01*h,a*(1/t._horizonShift))}function Gs(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),n=t.x*i,a=(t.x+1)*i,c=t.y*i,h=(t.y+1)*i,d=Nr(n),m=Nr(a),_=ar(c),b=ar(h),T=e.project(d,_),S=e.project(m,_),M=e.project(m,b),C=e.project(d,b);let D=Math.min(T.x,S.x,M.x,C.x),B=Math.min(T.y,S.y,M.y,C.y),H=Math.max(T.x,S.x,M.x,C.x),ee=Math.max(T.y,S.y,M.y,C.y);const W=i/16;function J(te,ye,ge,Ie,Oe,we){const ke=(ge+Oe)/2,ze=(Ie+we)/2,Le=e.project(Nr(ke),ar(ze)),Fe=Math.max(0,D-Le.x,B-Le.y,Le.x-H,Le.y-ee);D=Math.min(D,Le.x),H=Math.max(H,Le.x),B=Math.min(B,Le.y),ee=Math.max(ee,Le.y),Fe>W&&(J(te,Le,ge,Ie,ke,ze),J(Le,ye,ke,ze,Oe,we))}J(T,S,n,c,a,c),J(S,M,a,c,a,h),J(M,C,a,h,n,h),J(C,T,n,h,n,c),D-=W,B-=W,H+=W,ee+=W;const ne=1/Math.max(H-D,ee-B);return{scale:ne,x:D*ne,y:B*ne,x2:H*ne,y2:ee*ne,projection:e}}const Qy=_n(new Float32Array(16));class $o{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new qt(0,0)}projectTilePoint(e,i,n){return{x:e,y:i,z:0}}locationPoint(e,i,n=!0){return e._coordinatePoint(e.locationCoordinate(i),n)}pixelsPerMeter(e,i){return en(1,e)*i}pixelSpaceConversion(e,i,n){return 1}farthestPixelDistance(e){return jm(e,e.pixelsPerMeter)}pointCoordinate(e,i,n,a){const c=e.horizonLineFromTop(!1),h=new Se(i,Math.max(c,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,a))}pointCoordinate3D(e,i,n){const a=new Se(i,n);if(e.elevation)return e.elevation.pointCoordinate(a);{const c=this.pointCoordinate(e,a.x,a.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const n=e.horizonLineFromTop();return i.y<n}createInversionMatrix(e,i){return Qy}createTileMatrix(e,i,n){let a,c,h;const d=n.canonical,m=_n(new Float64Array(16));if(this.isReprojectedInTileSpace){const _=Gs(d,this);a=1,c=_.x+n.wrap*_.scale,h=_.y,Us(m,m,[a/_.scale,a/_.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(d.z),c=(d.x+Math.pow(2,d.z)*n.wrap)*a,h=d.y*a;return Wl(m,m,[c,h,0]),Us(m,m,[a/bt,a/bt,1]),m}upVector(e,i,n){return[0,0,1]}upVectorScale(e,i,n){return{metersToTile:1}}}class e0 extends $o{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,n]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(gt(i));this.n=(a+Math.sin(gt(n)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n,c:a,r0:c}=this,h=gt(e-this.center[0]),d=gt(i),m=Math.sqrt(a-2*n*Math.sin(d))/n;return{x:m*Math.sin(h*n),y:m*Math.cos(h*n)-c,z:0}}unproject(e,i){const{n,c:a,r0:c}=this,h=c+i;let d=Math.atan2(e,Math.abs(h))*Math.sign(h);h*n<0&&(d-=Math.PI*Math.sign(e)*Math.sign(h));const m=gt(this.center[0])*n;d=fr(d,-Math.PI-m,Math.PI-m);const _=Tt(ei(d/n)+this.center[0],-180,180),b=Math.asin(Tt((a-(e*e+h*h)*n*n)/(2*n),-1,1)),T=Tt(ei(b),-85.051129,Bn);return new qt(_,T)}}const yc=1.340264,xc=-.081106,vc=893e-6,bc=.003796,sh=Math.sqrt(3)/2;class t0 extends $o{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(sh*Math.sin(i)),a=n*n,c=a*a*a;return{x:.5*(e*Math.cos(n)/(sh*(yc+3*xc*a+c*(7*vc+9*bc*a)))/Math.PI+.5),y:1-.5*(n*(yc+xc*a+c*(vc+bc*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,a=n*n,c=a*a*a;for(let b,T,S,M=0;M<12&&(T=n*(yc+xc*a+c*(vc+bc*a))-i,S=yc+3*xc*a+c*(7*vc+9*bc*a),b=T/S,n=Tt(n-b,-Math.PI/3,Math.PI/3),a=n*n,c=a*a*a,!(Math.abs(b)<1e-12));++M);const h=sh*e*(yc+3*xc*a+c*(7*vc+9*bc*a))/Math.cos(n),d=Math.asin(Math.sin(n)/sh),m=Tt(180*h/Math.PI,-180,180),_=Tt(180*d/Math.PI,-85.051129,Bn);return new qt(m,_)}}class i0 extends $o{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const n=360*(e-.5),a=Tt(360*(.5-i),-85.051129,Bn);return new qt(n,a)}}const Ya=Math.PI/2;function ah(t){return Math.tan((Ya+t)/2)}class r0 extends $o{constructor(e){super(e),this.center=e.center||[0,30];const[i,n]=this.parallels=e.parallels||[30,30];let a=gt(i),c=gt(n);this.southernCenter=a+c<0,this.southernCenter&&(a=-a,c=-c);const h=Math.cos(a),d=ah(a);this.n=a===c?Math.sin(a):Math.log(h/Math.cos(c))/Math.log(ah(c)/d),this.f=h*Math.pow(ah(a),this.n)/this.n}project(e,i){i=gt(i),this.southernCenter&&(i=-i),e=gt(e-this.center[0]);const n=1e-6,{n:a,f:c}=this;c>0?i<-Ya+n&&(i=-Ya+n):i>Ya-n&&(i=Ya-n);const h=c/Math.pow(ah(i),a);let d=h*Math.sin(a*e),m=c-h*Math.cos(a*e);return d=.5*(d/Math.PI+.5),m=.5*(m/Math.PI+.5),{x:d,y:this.southernCenter?m:1-m,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n,f:a}=this,c=a-i,h=Math.sign(c),d=Math.sign(n)*Math.sqrt(e*e+c*c);let m=Math.atan2(e,Math.abs(c))*h;c*n<0&&(m-=Math.PI*Math.sign(e)*h);const _=Tt(ei(m/n)+this.center[0],-180,180),b=Tt(ei(2*Math.atan(Math.pow(a/d,1/n))-Ya),-85.051129,Bn);return new qt(_,this.southernCenter?-b:b)}}class Nm extends $o{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Ln(e),y:Rn(i),z:0}}unproject(e,i){const n=Nr(e),a=ar(i);return new qt(n,a)}}const Vm=gt(Bn);class n0 extends $o{project(e,i){const n=(i=gt(i))*i,a=n*n;return{x:.5*((e=gt(e))*(.8707-.131979*n+a*(a*(.003971*n-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+n*(.015085+a*(.028874*n-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,a=25,c=0,h=n*n;do{h=n*n;const _=h*h;c=(n*(1.007226+h*(.015085+_*(.028874*h-.044475-.005916*_)))-i)/(1.007226+h*(.045255+_*(.259866*h-.311325-.005916*11*_))),n=Tt(n-c,-Vm,Vm)}while(Math.abs(c)>1e-6&&--a>0);h=n*n;const d=Tt(ei(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),m=ei(n);return new qt(d,m)}}const Gm=gt(Bn);class o0 extends $o{project(e,i){i=gt(i),e=gt(e);const n=Math.cos(i),a=2/Math.PI,c=Math.acos(n*Math.cos(e/2)),h=Math.sin(c)/c,d=.5*(e*a+2*n*Math.sin(e/2)/h)||0,m=.5*(i+Math.sin(i)/h)||0;return{x:.5*(d/Math.PI+.5),y:1-.5*(m/Math.PI+1),z:0}}unproject(e,i){let n=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,c=25;const h=1e-6;let d=0,m=0;do{const _=Math.cos(a),b=Math.sin(a),T=2*b*_,S=b*b,M=_*_,C=Math.cos(n/2),D=Math.sin(n/2),B=2*C*D,H=D*D,ee=1-M*C*C,W=ee?1/ee:0,J=ee?Math.acos(_*C)*Math.sqrt(1/ee):0,ne=.5*(2*J*_*D+2*n/Math.PI)-e,te=.5*(J*b+a)-i,ye=.5*W*(M*H+J*_*C*S)+1/Math.PI,ge=W*(B*T/4-J*b*D),Ie=.125*W*(T*D-J*b*M*B),Oe=.5*W*(S*C+J*H*_)+.5,we=ge*Ie-Oe*ye;d=(te*ge-ne*Oe)/we,m=(ne*Ie-te*ye)/we,n=Tt(n-d,-Math.PI,Math.PI),a=Tt(a-m,-Gm,Gm)}while((Math.abs(d)>h||Math.abs(m)>h)&&--c>0);return new qt(ei(n),ei(a))}}class $m extends $o{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(gt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:n,cosPhi:a}=this;return{x:gt(e)*a*n+.5,y:-Math.sin(gt(i))/a*n+.5,z:0}}unproject(e,i){const{scale:n,cosPhi:a}=this,c=-(i-.5)/n,h=Tt(ei((e-.5)/n)/a,-180,180),d=Math.asin(Tt(c*a,-1,1)),m=Tt(ei(d),-85.051129,Bn);return new qt(h,m)}}class s0 extends Nm{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,i,n){const a=_c(e,i,n);return Li(a,a,gc(Fn(n))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i){const n=mc(i.lat,i.lng),a=yr([],n),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Jl(n,n,a,en(1,0)*bt*c);const h=_n(new Float64Array(16));return Fs(h,e.pixelMatrix,e.globeMatrix),Li(n,n,h),new Se(n[0],n[1])}pixelsPerMeter(e,i){return en(1,0)*i}pixelSpaceConversion(e,i,n){const a=en(1,e)*i,c=Zt(en(1,45)*i,a,n);return this.pixelsPerMeter(e,i)/c}createTileMatrix(e,i,n){const a=Bp(Fn(n.canonical));return Fs(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:n}=e,a=gc(Fn(i));return ju(a,a,gt(n.lng)),ap(a,a,gt(n.lat)),Us(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,n,a){return Dm(e,i,n,!0)||new La(0,0)}pointCoordinate3D(e,i,n){const a=this.pointCoordinate(e,i,n,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!Dm(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(a,c){const h=a.cameraToCenterDistance,d=a._centerAltitude*c,m=a._camera,_=a._camera.forward(),b=ro([],Vr([],_,-h),[0,0,d]),T=a.worldSize/(2*Math.PI),S=[0,0,-T],M=a.width/a.height,C=Math.tan(a.fovAboveCenter),D=Vr([],m.up(),C),B=Vr([],m.right(),C*M),H=yr([],ro([],ro([],_,D),B)),ee=[];let W;if(new hp(b,H).closestPointOnSphere(S,T,ee)){const J=ro([],ee,S),ne=gn([],J,b);W=Math.cos(a.fovAboveCenter)*Hl(ne)}else{const J=gn([],b,S),ne=gn([],S,b);yr(ne,ne);const te=Hl(J)-T;W=Math.sqrt(te*(te+2*T));const ye=Math.acos(W/(T+te))-Math.acos(tn(_,ne));W*=Math.cos(ye)}return 1.01*W}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Ha(e.zoom);if(n>0){const a=jm(e,en(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Zt(i,a+c*(1-Math.cos(h)),Math.pow(n,10))}return i}upVector(e,i,n){return _c(i,n,e,1)}upVectorScale(e){return{metersToTile:Dp*oh(Fn(e))}}}function qm(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Nm(t);case"equirectangular":return new i0(t);case"naturalEarth":return new n0(t);case"equalEarth":return new t0(t);case"winkelTripel":return new o0(t);case"albers":return i?new $m(t):new e0(t);case"lambertConformalConic":return i?new $m(t):new r0(t);case"globe":return new s0(t)}throw new Error(`Invalid projection name: ${t.name}`)}const a0=Xu.types,l0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lh(t,e,i,n,a,c,h,d,m,_,b,T,S){const M=d?Math.min(Go,Math.round(d[0])):0,C=d?Math.min(Go,Math.round(d[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*a),c,h,(M<<1)+(m?1:0),C,16*_,16*b,256*T,256*S)}function ch(t,e,i,n,a,c,h){t.emplaceBack(e,i,n,a,c,h)}function uh(t,e,i,n,a){t.emplaceBack(e,i,n,a),t.emplaceBack(e,i,n,a),t.emplaceBack(e,i,n,a),t.emplaceBack(e,i,n,a)}function c0(t){for(const e of t.sections)if(N(e.text))return!0;return!1}class Fp{constructor(e){this.layoutVertexArray=new di,this.indexArray=new sr,this.programConfigurations=e,this.segments=new Gi,this.dynamicLayoutVertexArray=new Ar,this.opacityVertexArray=new Di,this.placedSymbolArray=new Gd,this.globeExtVertexArray=new Xt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,n,a){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,dy.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,l0,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,py.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}it(Fp,"SymbolBuffers");class Up{constructor(e,i,n){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new n,this.segments=new Gi,this.collisionVertexArray=new Ds,this.collisionVertexArrayExt=new dn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,fy.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,my.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}it(Up,"CollisionBuffers");class qo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_n([]),this.placementViewportMatrix=_n([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tp(this.zoom,i["text-size"]),this.iconSizeData=Tp(this.zoom,i["icon-size"]);const n=this.layers[0].layout,a=n.get("symbol-sort-key"),c=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(h=>Gr[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Fp(new Rs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Fp(new Rs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Zd,this.lineVertexArray=new Xd,this.symbolInstances=new qd}calculateGlyphDependencies(e,i,n,a,c){for(let h=0;h<e.length;h++)if(i[e.charCodeAt(h)]=!0,a&&c){const d=uc[e.charAt(h)];d&&(i[d.charCodeAt(0)]=!0)}}populate(e,i,n,a){const c=this.layers[0],h=c.layout,d=this.projection.name==="globe",m=h.get("text-font"),_=h.get("text-field"),b=h.get("icon-image"),T=(_.value.kind!=="constant"||_.value.value instanceof Yi&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),S=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,M=h.get("symbol-sort-key");if(this.features=[],!T&&!S)return;const C=i.iconDependencies,D=i.glyphDependencies,B=i.availableImages,H=new ue(this.zoom);for(const{feature:ee,id:W,index:J,sourceLayerIndex:ne}of e){const te=c._featureFilter.needGeometry,ye=Bs(ee,te);if(!c._featureFilter.filter(H,ye,n))continue;if(te||(ye.geometry=io(ee,n,a)),d&&ee.type!==1&&n.z<=5){const we=ye.geometry,ke=.98078528056,ze=(Le,Fe)=>tn(_c(Le.x,Le.y,n,1),_c(Fe.x,Fe.y,n,1))<ke;for(let Le=0;Le<we.length;Le++)we[Le]=cg(we[Le],ze)}let ge,Ie;if(T){const we=c.getValueAndResolveTokens("text-field",ye,n,B),ke=Yi.factory(we);c0(ke)&&(this.hasRTLText=!0),(!this.hasRTLText||ce()==="unavailable"||this.hasRTLText&&_e.isParsed())&&(ge=yy(ke,c,ye))}if(S){const we=c.getValueAndResolveTokens("icon-image",ye,n,B);Ie=we instanceof kr?we:kr.fromString(we)}if(!ge&&!Ie)continue;const Oe=this.sortFeaturesByKey?M.evaluate(ye,{},n):void 0;if(this.features.push({id:W,text:ge,icon:Ie,index:J,sourceLayerIndex:ne,geometry:ye.geometry,properties:ee.properties,type:a0[ee.type],sortKey:Oe}),Ie&&(C[Ie.name]=!0),ge){const we=m.evaluate(ye,{},n).join(","),ke=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gr.vertical)>=0;for(const ze of ge.sections)if(ze.image)C[ze.image.name]=!0;else{const Le=g(ge.toString()),Fe=ze.fontStack||we,Te=D[Fe]=D[Fe]||{};this.calculateGlyphDependencies(ze.text,Te,ke,this.allowVerticalPlacement,Le)}}}h.get("symbol-placement")==="line"&&(this.features=function(ee){const W={},J={},ne=[];let te=0;function ye(we){ne.push(ee[we]),te++}function ge(we,ke,ze){const Le=J[we];return delete J[we],J[ke]=Le,ne[Le].geometry[0].pop(),ne[Le].geometry[0]=ne[Le].geometry[0].concat(ze[0]),Le}function Ie(we,ke,ze){const Le=W[ke];return delete W[ke],W[we]=Le,ne[Le].geometry[0].shift(),ne[Le].geometry[0]=ze[0].concat(ne[Le].geometry[0]),Le}function Oe(we,ke,ze){const Le=ze?ke[0][ke[0].length-1]:ke[0][0];return`${we}:${Le.x}:${Le.y}`}for(let we=0;we<ee.length;we++){const ke=ee[we],ze=ke.geometry,Le=ke.text?ke.text.toString():null;if(!Le){ye(we);continue}const Fe=Oe(Le,ze),Te=Oe(Le,ze,!0);if(Fe in J&&Te in W&&J[Fe]!==W[Te]){const $e=Ie(Fe,Te,ze),_t=ge(Fe,Te,ne[$e].geometry);delete W[Fe],delete J[Te],J[Oe(Le,ne[_t].geometry,!0)]=_t,ne[$e].geometry=null}else Fe in J?ge(Fe,Te,ze):Te in W?Ie(Fe,Te,ze):(ye(we),W[Fe]=te-1,J[Te]=te-1)}return ne.filter(we=>we.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,W)=>ee.sortKey-W.sortKey)}update(e,i,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,n,a),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,n,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=qm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const n=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:c}of i)this.lineVertexArray.emplaceBack(a,c);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,i,n,a,c,h,d,m,_,b,T,S,M,C){const D=e.indexArray,B=e.layoutVertexArray,H=e.globeExtVertexArray,ee=e.segments.prepareSegment(4*i.length,B,D,this.canOverlap?h.sortKey:void 0),W=this.glyphOffsetArray.length,J=ee.vertexLength,ne=this.allowVerticalPlacement&&d===Gr.vertical?Math.PI/2:0,te=h.text&&h.text.sections;for(let ge=0;ge<i.length;ge++){const{tl:Ie,tr:Oe,bl:we,br:ke,tex:ze,pixelOffsetTL:Le,pixelOffsetBR:Fe,minFontScaleX:Te,minFontScaleY:$e,glyphOffset:_t,isSDF:He,sectionIndex:st}=i[ge],qe=ee.vertexLength,yt=_t[1];if(lh(B,_.x,_.y,Ie.x,yt+Ie.y,ze.x,ze.y,n,He,Le.x,Le.y,Te,$e),lh(B,_.x,_.y,Oe.x,yt+Oe.y,ze.x+ze.w,ze.y,n,He,Fe.x,Le.y,Te,$e),lh(B,_.x,_.y,we.x,yt+we.y,ze.x,ze.y+ze.h,n,He,Le.x,Fe.y,Te,$e),lh(B,_.x,_.y,ke.x,yt+ke.y,ze.x+ze.w,ze.y+ze.h,n,He,Fe.x,Fe.y,Te,$e),m){const{x:Rt,y:Pt,z:Mt}=m.anchor,[vt,oi,Et]=m.up;ch(H,Rt,Pt,Mt,vt,oi,Et),ch(H,Rt,Pt,Mt,vt,oi,Et),ch(H,Rt,Pt,Mt,vt,oi,Et),ch(H,Rt,Pt,Mt,vt,oi,Et),uh(e.dynamicLayoutVertexArray,Rt,Pt,Mt,ne)}else uh(e.dynamicLayoutVertexArray,_.x,_.y,_.z,ne);D.emplaceBack(qe,qe+1,qe+2),D.emplaceBack(qe+1,qe+2,qe+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_t[0]),ge!==i.length-1&&st===i[ge+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,h,h.index,{},M,C,te&&te[st])}const ye=m?m.anchor:_;e.placedSymbolArray.emplaceBack(ye.x,ye.y,ye.z,_.x,_.y,W,this.glyphOffsetArray.length-W,J,b,T,_.segment,n?n[0]:0,n?n[1]:0,a[0],a[1],d,0,!1,0,S,0)}_commitLayoutVertex(e,i,n,a,c,h,d){e.emplaceBack(i,n,a,c,h,Math.round(d.x),Math.round(d.y))}_addCollisionDebugVertices(e,i,n,a,c,h,d){const m=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),_=m.vertexLength,b=d.tileAnchorX,T=d.tileAnchorY;for(let M=0;M<4;M++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,a,c,h,b,T,new Se(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,c,h,b,T,new Se(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,c,h,b,T,new Se(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,a,c,h,b,T,new Se(e.x1,e.y2)),m.vertexLength+=4;const S=n.indexArray;S.emplaceBack(_,_+1),S.emplaceBack(_+1,_+2),S.emplaceBack(_+2,_+3),S.emplaceBack(_+3,_),m.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,n,a,c,h){for(let d=a;d<c;d++){const m=n.get(d),_=this.getSymbolInstanceTextSize(e,h,i,d);this._addCollisionDebugVertices(m,_,this.textCollisionBox,m.projectedAnchorX,m.projectedAnchorY,m.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,i,n,a,c,h){for(let d=a;d<c;d++){const m=n.get(d),_=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(m,_,this.iconCollisionBox,m.projectedAnchorX,m.projectedAnchorY,m.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Up(fi,nm.members,Qr),this.iconCollisionBox=new Up(fi,nm.members,Qr);const n=ja(this.iconSizeData,e),a=ja(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(a,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(a,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(n,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(n,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,i,n,a){const c=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),h=Ku(this.textSizeData,e,c)/lr;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,i,n){const a=this.icon.placedSymbolArray.get(n),c=Ku(this.iconSizeData,e,a);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,i,n){e.emplaceBack(i,-n,-n),e.emplaceBack(i,n,-n),e.emplaceBack(i,n,n),e.emplaceBack(i,-n,n)}_updateTextDebugCollisionBoxes(e,i,n,a,c,h){for(let d=a;d<c;d++){const m=n.get(d),_=this.getSymbolInstanceTextSize(e,h,i,d);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,m.padding)}}_updateIconDebugCollisionBoxes(e,i,n,a,c,h){for(let d=a;d<c;d++){const m=n.get(d),_=this.getSymbolInstanceIconSize(e,i,h);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,m.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=ja(this.iconSizeData,e),a=ja(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(a,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(a,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(n,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(n,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,n,a,c,h,d,m,_){const b={};if(i<n){const{x1:T,y1:S,x2:M,y2:C,padding:D,projectedAnchorX:B,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:W,tileAnchorY:J,featureIndex:ne}=e.get(i);b.textBox={x1:T,y1:S,x2:M,y2:C,padding:D,projectedAnchorX:B,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:W,tileAnchorY:J},b.textFeatureIndex=ne}if(a<c){const{x1:T,y1:S,x2:M,y2:C,padding:D,projectedAnchorX:B,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:W,tileAnchorY:J,featureIndex:ne}=e.get(a);b.verticalTextBox={x1:T,y1:S,x2:M,y2:C,padding:D,projectedAnchorX:B,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:W,tileAnchorY:J},b.verticalTextFeatureIndex=ne}if(h<d){const{x1:T,y1:S,x2:M,y2:C,padding:D,projectedAnchorX:B,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:W,tileAnchorY:J,featureIndex:ne}=e.get(h);b.iconBox={x1:T,y1:S,x2:M,y2:C,padding:D,projectedAnchorX:B,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:W,tileAnchorY:J},b.iconFeatureIndex=ne}if(m<_){const{x1:T,y1:S,x2:M,y2:C,padding:D,projectedAnchorX:B,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:W,tileAnchorY:J,featureIndex:ne}=e.get(m);b.verticalIconBox={x1:T,y1:S,x2:M,y2:C,padding:D,projectedAnchorX:B,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:W,tileAnchorY:J},b.verticalIconFeatureIndex=ne}return b}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const n=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const n=e.placedSymbolArray.get(i),a=n.vertexStartIndex+4*n.numGlyphs;for(let c=n.vertexStartIndex;c<a;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),n=Math.cos(e),a=[],c=[],h=[];for(let d=0;d<this.symbolInstances.length;++d){h.push(d);const m=this.symbolInstances.get(d);a.push(0|Math.round(i*m.tileAnchorX+n*m.tileAnchorY)),c.push(m.featureIndex)}return h.sort((d,m)=>a[d]-a[m]||c[m]-c[d]),h}addToSortKeyRanges(e,i){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===i?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const n=this.symbolInstances.get(i);this.featureSortOrder.push(n.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:d,placedIconSymbolIndex:m,verticalPlacedIconSymbolIndex:_}=n;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),c>=0&&c!==a&&this.addIndicesForPlacedSymbol(this.text,c),h>=0&&h!==c&&h!==a&&this.addIndicesForPlacedSymbol(this.text,h),d>=0&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&this.addIndicesForPlacedSymbol(this.icon,m),_>=0&&this.addIndicesForPlacedSymbol(this.icon,_)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}it(qo,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),qo.MAX_GLYPHS=65535,qo.addDynamicAttributes=uh;const u0=new ut({"symbol-placement":new he(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new he(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new he(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ve(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new he(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new he(Me.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new he(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new he(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new he(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new ve(Me.layout_symbol["icon-size"]),"icon-text-fit":new he(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new he(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new ve(Me.layout_symbol["icon-image"]),"icon-rotate":new ve(Me.layout_symbol["icon-rotate"]),"icon-padding":new he(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new he(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new ve(Me.layout_symbol["icon-offset"]),"icon-anchor":new ve(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new he(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new he(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new he(Me.layout_symbol["text-rotation-alignment"]),"text-field":new ve(Me.layout_symbol["text-field"]),"text-font":new ve(Me.layout_symbol["text-font"]),"text-size":new ve(Me.layout_symbol["text-size"]),"text-max-width":new ve(Me.layout_symbol["text-max-width"]),"text-line-height":new ve(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new ve(Me.layout_symbol["text-letter-spacing"]),"text-justify":new ve(Me.layout_symbol["text-justify"]),"text-radial-offset":new ve(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new he(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new ve(Me.layout_symbol["text-anchor"]),"text-max-angle":new he(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new he(Me.layout_symbol["text-writing-mode"]),"text-rotate":new ve(Me.layout_symbol["text-rotate"]),"text-padding":new he(Me.layout_symbol["text-padding"]),"text-keep-upright":new he(Me.layout_symbol["text-keep-upright"]),"text-transform":new ve(Me.layout_symbol["text-transform"]),"text-offset":new ve(Me.layout_symbol["text-offset"]),"text-allow-overlap":new he(Me.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new he(Me.layout_symbol["text-ignore-placement"]),"text-optional":new he(Me.layout_symbol["text-optional"])});var jp={paint:new ut({"icon-opacity":new ve(Me.paint_symbol["icon-opacity"]),"icon-color":new ve(Me.paint_symbol["icon-color"]),"icon-halo-color":new ve(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new ve(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ve(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new he(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new he(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new ve(Me.paint_symbol["text-opacity"]),"text-color":new ve(Me.paint_symbol["text-color"],{runtimeType:jr,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ve(Me.paint_symbol["text-halo-color"]),"text-halo-width":new ve(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new ve(Me.paint_symbol["text-halo-blur"]),"text-translate":new he(Me.paint_symbol["text-translate"]),"text-translate-anchor":new he(Me.paint_symbol["text-translate-anchor"])}),layout:u0};class Zm{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ur,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}it(Zm,"FormatSectionOverride",{omit:["defaultValue"]});class hh extends mn{constructor(e){super(e,jp)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const a=[];for(const c of n)a.indexOf(c)<0&&a.push(c);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,n,a){const c=this.layout.get(e).evaluate(i,{},n,a),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Ss(h.value)||!c?c:function(d,m){return m.replace(/{([^{}]+)}/g,(_,b)=>b in d?String(d[b]):"")}(i.properties,c)}createBucket(e){return new qo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of jp.paint.overridableProperties){if(!hh.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),n=new Zm(i),a=new Ta(n,i.property.specification);let c=null;c=i.value.kind==="constant"||i.value.kind==="source"?new Pn("source",a):new Ea("composite",a,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Pe(i.property,c,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,n){return!(!this.layout||i.isDataDriven()||n.isDataDriven())&&hh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const n=e.get("text-field"),a=jp.paint.properties[i];let c=!1;const h=d=>{for(const m of d)if(a.overrides&&a.overrides.hasOverride(m))return void(c=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Yi)h(n.value.value.sections);else if(n.value.kind==="source"){const d=_=>{c||(_ instanceof ds&&Vi(_.value)===Eo?h(_.value.sections):_ instanceof fs?h(_.sections):_.eachChild(d))},m=n.value;m._styleExpression&&d(m._styleExpression.expression)}return c}getProgramConfiguration(e){return new No(this,e)}}var h0={paint:new ut({"background-color":new he(Me.paint_background["background-color"]),"background-pattern":new he(Me.paint_background["background-pattern"]),"background-opacity":new he(Me.paint_background["background-opacity"])})},p0={paint:new ut({"raster-opacity":new he(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new he(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new he(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new he(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new he(Me.paint_raster["raster-saturation"]),"raster-contrast":new he(Me.paint_raster["raster-contrast"]),"raster-resampling":new he(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new he(Me.paint_raster["raster-fade-duration"])})};class d0 extends mn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var f0={paint:new ut({"sky-type":new he(Me.paint_sky["sky-type"]),"sky-atmosphere-sun":new he(Me.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new he(Me.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new he(Me.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new he(Me.paint_sky["sky-gradient-radius"]),"sky-gradient":new nt(Me.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new he(Me.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new he(Me.paint_sky["sky-atmosphere-color"]),"sky-opacity":new he(Me.paint_sky["sky-opacity"])})};function Np(t,e,i){const n=[0,0,1],a=Af([]);return Cf(a,a,i?-gt(t)+Math.PI:gt(t)),Mf(a,a,-gt(e)),Tf(n,n,a),yr(n,n)}const m0={circle:class extends mn{constructor(t){super(t,_g)}createBucket(t){return new rp(t)}queryRadius(t){const e=t;return Ra("circle-radius",this,e)+Ra("circle-stroke-width",this,e)+Fu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,n,a,c,h,d){const m=_f(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),_=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return kf(t,n,c,h,d,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",m,_)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new No(this,t)}},heatmap:class extends mn{createBucket(t){return new Pf(t)}constructor(t){super(t,Eg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Ra("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,n,a,c,h,d){const m=this.paint.get("heatmap-radius").evaluate(e,i);return kf(t,n,c,h,d,!0,!0,new Se(0,0),m)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new No(this,t)}},hillshade:class extends mn{constructor(t){super(t,Sg)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends mn{constructor(t){super(t,Ng)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new No(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new qu(t)}queryRadius(){return Fu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,n,a,c){return!t.queryGeometry.isAboveHorizon&&hf(mf(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends mn{constructor(t){super(t,ry)}createBucket(t){return new ac(t)}queryRadius(){return Fu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new No(this,t)}queryIntersectsFeature(t,e,i,n,a,c,h,d,m){const _=_f(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),b=this.paint.get("fill-extrusion-height").evaluate(e,i),T=this.paint.get("fill-extrusion-base").evaluate(e,i),S=[0,0],M=d&&c.elevation,C=c.elevation?c.elevation.exaggeration():1,D=t.tile.getBucket(this);if(M&&D instanceof ac){const J=D.centroidVertexArray,ne=m+1;ne<J.length&&(S[0]=J.geta_centroid_pos0(ne),S[1]=J.geta_centroid_pos1(ne))}if(S[0]===0&&S[1]===1)return!1;c.projection.name==="globe"&&(n=Yf([n],[new Se(0,0),new Se(bt,bt)],t.tileID.canonical).map(J=>J.polygon).flat());const B=M?d:null,[H,ee]=function(J,ne,te,ye,ge,Ie,Oe,we,ke,ze,Le){return J.projection.name==="globe"?function(Fe,Te,$e,_t,He,st,qe,yt,Rt,Pt,Mt){const vt=[],oi=[],Et=Fe.projection.upVectorScale(Mt,Fe.center.lat,Fe.worldSize).metersToTile,Bt=[0,0,0,1],ci=[0,0,0,1],vi=(bi,wi,zi,Ji)=>{bi[0]=wi,bi[1]=zi,bi[2]=Ji,bi[3]=1},_i=Hf();$e>0&&($e+=_i),_t+=_i;for(const bi of Te){const wi=[],zi=[];for(const Ji of bi){const si=Ji.x+He.x,$i=Ji.y+He.y,Ui=Fe.projection.projectTilePoint(si,$i,Mt),Wt=Fe.projection.upVector(Mt,Ji.x,Ji.y);let Ei=$e,Zi=_t;if(qe){const ui=em(si,$i,$e,_t,qe,yt,Rt,Pt);Ei+=ui.base,Zi+=ui.top}$e!==0?vi(Bt,Ui.x+Wt[0]*Et*Ei,Ui.y+Wt[1]*Et*Ei,Ui.z+Wt[2]*Et*Ei):vi(Bt,Ui.x,Ui.y,Ui.z),vi(ci,Ui.x+Wt[0]*Et*Zi,Ui.y+Wt[1]*Et*Zi,Ui.z+Wt[2]*Et*Zi),Li(Bt,Bt,st),Li(ci,ci,st),wi.push(new Ua(Bt[0],Bt[1],Bt[2])),zi.push(new Ua(ci[0],ci[1],ci[2]))}vt.push(wi),oi.push(zi)}return[vt,oi]}(J,ne,te,ye,ge,Ie,Oe,we,ke,ze,Le):Oe?function(Fe,Te,$e,_t,He,st,qe,yt,Rt){const Pt=[],Mt=[],vt=[0,0,0,1];for(const oi of Fe){const Et=[],Bt=[];for(const ci of oi){const vi=ci.x+_t.x,_i=ci.y+_t.y,bi=em(vi,_i,Te,$e,st,qe,yt,Rt);vt[0]=vi,vt[1]=_i,vt[2]=bi.base,vt[3]=1,js(vt,vt,He),vt[3]=Math.max(vt[3],1e-5);const wi=new Ua(vt[0]/vt[3],vt[1]/vt[3],vt[2]/vt[3]);vt[0]=vi,vt[1]=_i,vt[2]=bi.top,vt[3]=1,js(vt,vt,He),vt[3]=Math.max(vt[3],1e-5);const zi=new Ua(vt[0]/vt[3],vt[1]/vt[3],vt[2]/vt[3]);Et.push(wi),Bt.push(zi)}Pt.push(Et),Mt.push(Bt)}return[Pt,Mt]}(ne,te,ye,ge,Ie,Oe,we,ke,ze):function(Fe,Te,$e,_t,He){const st=[],qe=[],yt=He[8]*Te,Rt=He[9]*Te,Pt=He[10]*Te,Mt=He[11]*Te,vt=He[8]*$e,oi=He[9]*$e,Et=He[10]*$e,Bt=He[11]*$e;for(const ci of Fe){const vi=[],_i=[];for(const bi of ci){const wi=bi.x+_t.x,zi=bi.y+_t.y,Ji=He[0]*wi+He[4]*zi+He[12],si=He[1]*wi+He[5]*zi+He[13],$i=He[2]*wi+He[6]*zi+He[14],Ui=He[3]*wi+He[7]*zi+He[15],Wt=Ji+yt,Ei=si+Rt,Zi=$i+Pt,ui=Math.max(Ui+Mt,1e-5),Ri=Ji+vt,dr=si+oi,Qi=$i+Et,er=Math.max(Ui+Bt,1e-5);vi.push(new Ua(Wt/ui,Ei/ui,Zi/ui)),_i.push(new Ua(Ri/er,dr/er,Qi/er))}st.push(vi),qe.push(_i)}return[st,qe]}(ne,te,ye,ge,Ie)}(c,n,T,b,_,h,B,S,C,c.center.lat,t.tileID.canonical),W=t.queryGeometry;return function(J,ne,te){let ye=1/0;hf(te,ne)&&(ye=Qf(te,ne[0]));for(let ge=0;ge<ne.length;ge++){const Ie=ne[ge],Oe=J[ge];for(let we=0;we<Ie.length-1;we++){const ke=Ie[we],ze=[ke,Ie[we+1],Oe[we+1],Oe[we],ke];uf(te,ze)&&(ye=Math.min(ye,Qf(te,ze)))}}return ye!==1/0&&ye}(H,ee,W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends mn{constructor(t){super(t,tm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ha,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=im.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Yu(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new No(this,t)}queryRadius(t){const e=t,i=rm(Ra("line-width",this,e),Ra("line-gap-width",this,e)),n=Ra("line-offset",this,e);return i/2+Math.abs(n)+Fu(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,n,a,c){if(t.queryGeometry.isAboveHorizon)return!1;const h=mf(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),d=t.pixelToTileUnitsFactor/2*rm(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),m=this.paint.get("line-offset").evaluate(e,i);return m&&(n=function(_,b){const T=[],S=new Se(0,0);for(let M=0;M<_.length;M++){const C=_[M],D=[];for(let B=0;B<C.length;B++){const H=C[B-1],ee=C[B],W=C[B+1],J=B===0?S:ee.sub(H)._unit()._perp(),ne=B===C.length-1?S:W.sub(ee)._unit()._perp(),te=J._add(ne)._unit();te._mult(1/(te.x*ne.x+te.y*ne.y)),D.push(te._mult(b)._add(ee))}T.push(D)}return T}(n,m*t.pixelToTileUnitsFactor)),function(_,b,T){for(let S=0;S<b.length;S++){const M=b[S];if(_.length>=3){for(let C=0;C<M.length;C++)if(Os(_,M[C]))return!0}if(pg(_,M,T))return!0}return!1}(h,n,d)}isTileClipped(){return!0}},symbol:hh,background:class extends mn{constructor(t){super(t,h0)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends mn{constructor(t){super(t,p0)}getProgramIds(){return["raster"]}},sky:class extends mn{constructor(t){super(t,f0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=mp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),a=!n,c=t.style.light,h=c.properties.get("position");return a&&c.properties.get("anchor")==="viewport"&&$t("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Np(h.azimuthal,90-h.polar,e):Np(n[0],90-n[1],e)}const i=this.paint.get("sky-gradient-center");return Np(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class wc{constructor(e,i,n,a){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(i,a)}update(e,i,n){const{width:a,height:c}=e,{context:h}=this,{gl:d}=h,{HTMLImageElement:m,HTMLCanvasElement:_,HTMLVideoElement:b,ImageData:T,ImageBitmap:S}=re;if(d.bindTexture(d.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA&&(!i||i.premultiply!==!1)),n||this.size&&this.size[0]===a&&this.size[1]===c){const{x:M,y:C}=n||{x:0,y:0};e instanceof m||e instanceof _||e instanceof b||e instanceof T||S&&e instanceof S?d.texSubImage2D(d.TEXTURE_2D,0,M,C,d.RGBA,d.UNSIGNED_BYTE,e):d.texSubImage2D(d.TEXTURE_2D,0,M,C,a,c,d.RGBA,d.UNSIGNED_BYTE,e.data)}else this.size=[a,c],e instanceof m||e instanceof _||e instanceof b||e instanceof T||S&&e instanceof S?d.texImage2D(d.TEXTURE_2D,0,this.format,this.format,d.UNSIGNED_BYTE,e):d.texImage2D(d.TEXTURE_2D,0,this.format,a,c,0,this.format,d.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,i){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class _0{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class g0{constructor(){this.tasks={},this.taskQueue=[],gi(["process"],this),this.invoker=new _0(this.process),this.nextId=0}add(e,i){const n=this.nextId++,a=function({type:c,isSymbolTile:h,zoom:d}){return d=d||0,c==="message"?0:c!=="maybePrepare"||h?c!=="parseTile"||h?c==="parseTile"&&h?300-d:c==="maybePrepare"&&h?400-d:500:200-d:100-d}(i);if(a===0){qi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:i,priority:a,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){qi();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const c=this.tasks[this.taskQueue[a]];c.priority<i&&(i=c.priority,e=a)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class Xm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const n=e[i];this._stringToNumber[n]=i,this._numberToString[i]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const y0=["tile","layer","source","sourceLayer","state"];class Wm{constructor(e,i,n,a,c){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=n,this._y=a,this.properties=e.properties,this.id=c}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of y0)this[i]!==void 0&&(e[i]=this[i]);return e}}const on=32,Un=33,Zo=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,n=0,a=0,c=0,h=0,d=0;for(1&e?a=c=h=on:i=n=d=on;(e>>=1)>1;){const _=i+a>>1,b=n+c>>1;1&e?(a=i,c=n,i=h,n=d):(i=a,n=c,a=h,c=d),h=_,d=b}const m=4*t;Zo[m+0]=i,Zo[m+1]=n,Zo[m+2]=a,Zo[m+3]=c}const jn=new Uint16Array(2178),Xo=new Uint8Array(1089),ph=new Uint16Array(1089);function Hm(t){return t===0?-.03125:t===32?.03125:0}var Ym=et([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Km={type:2,extent:bt,loadGeometry:()=>[[new Se(0,0),new Se(8193,0),new Se(8193,8193),new Se(0,8193),new Se(0,0)]]};class Vp{constructor(e,i,n,a,c){this.tileID=e,this.uid=Ot(),this.uses=0,this.tileSize=i,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<ct.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Gs(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,c){const h={};if(!c)return h;for(const d of a){const m=d.layerIds.map(_=>c.getLayer(_)).filter(Boolean);if(m.length!==0){d.layers=m,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(_=>m.filter(b=>b.id===_)[0]));for(const _ of m)h[_.id]=d}}return h}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const c=this.buckets[a];if(c instanceof qo){if(this.hasSymbolBuckets=!0,!n)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const c=this.buckets[a];if(c instanceof qo&&c.hasRTLText){this.hasRTLText=!0,_e.isLoading()||_e.isLoaded()||ce()!=="deferred"||xe();break}}this.queryPadding=0;for(const a in this.buckets){const c=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(a).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Yh}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const a=this.buckets[n];a.uploadPending()&&a.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wc(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wc(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new wc(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,n,a,c,h,d,m){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:d,transform:h,params:c,tileTransform:this.tileTransform},e,i,n):{}}querySourceFeatures(e,i){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const a=n.loadVTLayers(),c=i?i.sourceLayer:"",h=a._geojsonTileLayer||a[c];if(!h)return;const d=Qn(i&&i.filter),{z:m,x:_,y:b}=this.tileID.canonical,T={z:m,x:_,y:b};for(let S=0;S<h.length;S++){const M=h.feature(S);if(d.needGeometry){const B=Bs(M,!0);if(!d.filter(new ue(this.tileID.overscaledZ),B,this.tileID.canonical))continue}else if(!d.filter(new ue(this.tileID.overscaledZ),M))continue;const C=n.getId(M,c),D=new Wm(M,m,_,b,C);D.tile=T,e.push(D)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const n=sn(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let a=!1;if(this.expirationTime>n)a=!1;else if(i)if(this.expirationTime<i)a=!0;else{const c=this.expirationTime-i;c?this.expirationTime=n+Math.max(c,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const n=this.latestFeatureIndex.loadVTLayers(),a=i.style.listImages();for(const c in this.buckets){if(!i.style.hasLayer(c))continue;const h=this.buckets[c],d=h.layers[0].sourceLayer||"_geojsonTileLayer",m=n[d],_=e[d];if(!m||!_||Object.keys(_).length===0)continue;if(h.update(_,m,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),h instanceof Yu||h instanceof qu){const T=i.style._getSourceCache(h.layers[0].source);i._terrain&&i._terrain.enabled&&T&&h.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(T.id,this.tileID)}const b=i&&i.style&&i.style.getLayer(c);b&&(this.queryPadding=Math.max(this.queryPadding,b.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ct.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ct.now()+e}setTexture(e,i){const n=i.context,a=n.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new wc(n,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax))}setDependencies(e,i){const n={};for(const a of i)n[a]=!0;this.dependencies[e]=n}hasDependency(e,i){for(const n of e){const a=this.dependencies[n];if(a){for(const c of i)if(a[c])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const n=io(Km,this.tileID.canonical,this.tileTransform)[0],a=new Yt,c=new Zl;for(let h=0;h<n.length;h++){const{x:d,y:m}=n[h];a.emplaceBack(d,m),c.emplaceBack(h)}c.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(c),this._tileDebugBuffer=e.createVertexBuffer(a,fc.members),this._tileDebugSegments=Gi.simpleSegment(0,0,a.length,c.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const n=io(Km,this.tileID.canonical,this.tileTransform)[0];let a,c;if(this.isRaster){const h=function(d,m){const _=Gs(d,m),b=Math.pow(2,d.z);for(let B=0;B<Un;B++)for(let H=0;H<Un;H++){const ee=Nr((d.x+(H+Hm(H))/on)/b),W=ar((d.y+(B+Hm(B))/on)/b),J=m.project(ee,W),ne=B*Un+H;jn[2*ne+0]=Math.round((J.x*_.scale-_.x)*bt),jn[2*ne+1]=Math.round((J.y*_.scale-_.y)*bt)}Xo.fill(0),ph.fill(0);for(let B=2045;B>=0;B--){const H=4*B,ee=Zo[H+0],W=Zo[H+1],J=Zo[H+2],ne=Zo[H+3],te=ee+J>>1,ye=W+ne>>1,ge=te+ye-W,Ie=ye+ee-te,Oe=W*Un+ee,we=ne*Un+J,ke=ye*Un+te,ze=Math.hypot((jn[2*Oe+0]+jn[2*we+0])/2-jn[2*ke+0],(jn[2*Oe+1]+jn[2*we+1])/2-jn[2*ke+1])>=16;if(Xo[ke]=Xo[ke]||(ze?1:0),B<1022){const Le=(W+Ie>>1)*Un+(ee+ge>>1),Fe=(ne+Ie>>1)*Un+(J+ge>>1);Xo[ke]=Xo[ke]||Xo[Le]||Xo[Fe]}}const T=new li,S=new sr;let M=0;function C(B,H){const ee=H*Un+B;return ph[ee]===0&&(T.emplaceBack(jn[2*ee+0],jn[2*ee+1],B*bt/on,H*bt/on),ph[ee]=++M),ph[ee]-1}function D(B,H,ee,W,J,ne){const te=B+ee>>1,ye=H+W>>1;if(Math.abs(B-J)+Math.abs(H-ne)>1&&Xo[ye*Un+te])D(J,ne,B,H,te,ye),D(ee,W,J,ne,te,ye);else{const ge=C(B,H),Ie=C(ee,W),Oe=C(J,ne);S.emplaceBack(ge,Ie,Oe)}}return D(0,0,on,on,on,0),D(on,on,0,0,0,on),{vertices:T,indices:S}}(this.tileID.canonical,i);a=h.vertices,c=h.indices}else{a=new li,c=new sr;for(const{x:d,y:m}of n)a.emplaceBack(d,m,0,0);const h=ec.exports(a.int16,void 0,4);for(let d=0;d<h.length;d+=3)c.emplaceBack(h[d],h[d+1],h[d+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,Ym.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(c),this._tileBoundsSegments=Gi.simpleSegment(0,0,a.length,c.length)}_makeGlobeTileDebugBuffers(e,i){const n=i.projection;if(!n||n.name!=="globe"||i.freezeTileCoverage)return;const a=this.tileID.canonical,c=gc(Lm(a,i)),h=Ha(i.zoom);let d;h>0&&(d=sp(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,a,i,c,d,h),this._makeGlobeTileDebugTextBuffer(e,a,i,c,d,h)}_globePoint(e,i,n,a,c,h,d){let m=_c(e,i,n);if(h){const _=1<<n.z,b=Ln(a.center.lng),T=Rn(a.center.lat),S=(n.x+.5)/_-b;let M=0;S>.5?M=-1:S<-.5&&(M=1);let C=(e/bt+n.x)/_+M,D=(i/bt+n.y)/_;C=(C-b)*a._pixelsPerMercatorPixel+b,D=(D-T)*a._pixelsPerMercatorPixel+T;const B=[C*a.worldSize,D*a.worldSize,0];Li(B,B,h),m=Vs(m,B,d)}return Li(m,m,c)}_makeGlobeTileDebugBorderBuffer(e,i,n,a,c,h){const d=new Yt,m=new Zl,_=new pi,b=(S,M,C,D,B)=>{const H=(C-S)/(B-1),ee=(D-M)/(B-1),W=d.length;for(let J=0;J<B;J++){const ne=S+J*H,te=M+J*ee;d.emplaceBack(ne,te);const ye=this._globePoint(ne,te,i,n,a,c,h);_.emplaceBack(ye[0],ye[1],ye[2]),m.emplaceBack(W+J)}},T=bt;b(0,0,T,0,16),b(T,0,T,T,16),b(T,T,0,T,16),b(0,T,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(d,fc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(_,Pm.members),this._tileDebugSegments=Gi.simpleSegment(0,0,d.length,m.length)}_makeGlobeTileDebugTextBuffer(e,i,n,a,c,h){const d=new Yt,m=new sr,_=new pi,b=25;m.reserve(32),d.reserve(b),_.reserve(b);const T=(S,M)=>b*S+M;for(let S=0;S<b;S++){const M=2048*S;for(let C=0;C<b;C++){const D=2048*C;d.emplaceBack(D,M);const B=this._globePoint(D,M,i,n,a,c,h);_.emplaceBack(B[0],B[1],B[2])}}for(let S=0;S<4;S++)for(let M=0;M<4;M++){const C=T(S,M),D=T(S,M+1),B=T(S+1,M),H=T(S+1,M+1);m.emplaceBack(C,D,B),m.emplaceBack(B,D,H)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(m),this._tileDebugTextBuffer=e.createVertexBuffer(d,fc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(_,Pm.members),this._tileDebugTextSegments=Gi.simpleSegment(0,0,b,32)}}class x0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,n){const a=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},Ye(this.stateChanges[e][a],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const c in this.state[e])c!==a&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][a]===null){this.deletedStates[e][a]={};for(const c in this.state[e][a])n[c]||(this.deletedStates[e][a][c]=null)}else for(const c in n)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][c]===null&&delete this.deletedStates[e][a][c]}removeFeatureState(e,i,n){if(this.deletedStates[e]===null)return;const a=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&i!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][n]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(n in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][n]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,i){const n=String(i),a=Ye({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const c=this.deletedStates[e][i];if(c===null)return{};for(const h in c)delete a[h]}return a}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const n={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const c={};for(const h in this.stateChanges[a])this.state[a][h]||(this.state[a][h]={}),Ye(this.state[a][h],this.stateChanges[a][h]),c[h]=this.state[a][h];n[a]=c}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const c={};if(this.deletedStates[a]===null)for(const h in this.state[a])c[h]={},this.state[a][h]={};else for(const h in this.deletedStates[a]){if(this.deletedStates[a][h]===null)this.state[a][h]={};else for(const d of Object.keys(this.deletedStates[a][h]))delete this.state[a][h][d];c[h]=this.state[a][h]}n[a]=n[a]||{},Ye(n[a],c)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const a in e)e[a].setFeatureState(n,i)}}class Jm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const n=this.toIdx(e,i);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Qm(t,e,i,n){let a=0,c=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(n[h])<1e-15){if(i[h]<t[h]||i[h]>e[h])return null}else{const d=1/n[h];let m=(t[h]-i[h])*d,_=(e[h]-i[h])*d;if(m>_){const b=m;m=_,_=b}if(m>a&&(a=m),_<c&&(c=_),a>c)return null}return a}function e_(t,e,i,n,a,c,h,d,m,_,b){const T=n-t,S=a-e,M=c-i,C=h-t,D=d-e,B=m-i,H=b[1]*B-b[2]*D,ee=b[2]*C-b[0]*B,W=b[0]*D-b[1]*C,J=T*H+S*ee+M*W;if(Math.abs(J)<1e-15)return null;const ne=1/J,te=_[0]-t,ye=_[1]-e,ge=_[2]-i,Ie=(te*H+ye*ee+ge*W)*ne;if(Ie<0||Ie>1)return null;const Oe=ye*M-ge*S,we=ge*T-te*M,ke=te*S-ye*T,ze=(b[0]*Oe+b[1]*we+b[2]*ke)*ne;return ze<0||Ie+ze>1?null:(C*Oe+D*we+B*ke)*ne}function t_(t,e,i){return(t-e)/(i-e)}function i_(t,e,i,n,a,c,h,d,m){const _=1<<i,b=c-n,T=h-a,S=(t+1)/_*b+n,M=(e+0)/_*T+a,C=(e+1)/_*T+a;d[0]=(t+0)/_*b+n,d[1]=M,m[0]=S,m[1]=C}class r_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(c){const h=Math.ceil(Math.log2(c.dim/8)),d=[];let m=Math.ceil(Math.pow(2,h));const _=1/m,b=(M,C,D,B,H)=>{const ee=B?1:0,W=(M+1)*D-ee,J=C*D,ne=(C+1)*D-ee;H[0]=M*D,H[1]=J,H[2]=W,H[3]=ne};let T=new Jm(m);const S=[];for(let M=0;M<m*m;M++){b(M%m,Math.floor(M/m),_,!1,S);const C=Wo(S[0],S[1],c),D=Wo(S[2],S[1],c),B=Wo(S[2],S[3],c),H=Wo(S[0],S[3],c);T.minimums.push(Math.min(C,D,B,H)),T.maximums.push(Math.max(C,D,B,H)),T.leaves.push(1)}for(d.push(T),m/=2;m>=1;m/=2){const M=d[d.length-1];T=new Jm(m);for(let C=0;C<m*m;C++){b(C%m,Math.floor(C/m),2,!0,S);const D=M.getElevation(S[0],S[1]),B=M.getElevation(S[2],S[1]),H=M.getElevation(S[2],S[3]),ee=M.getElevation(S[0],S[3]),W=M.isLeaf(S[0],S[1]),J=M.isLeaf(S[2],S[1]),ne=M.isLeaf(S[2],S[3]),te=M.isLeaf(S[0],S[3]),ye=Math.min(D.min,B.min,H.min,ee.min),ge=Math.max(D.max,B.max,H.max,ee.max),Ie=W&&J&&ne&&te;T.maximums.push(ge),T.minimums.push(ye),T.leaves.push(ge-ye<=5&&Ie?1:0)}d.push(T)}return d}(this.dem),n=i.length-1,a=i[n];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,n,0)}raycastRoot(e,i,n,a,c,h,d=1){return Qm([e,i,-100],[n,a,this.maximums[0]*d],c,h)}raycast(e,i,n,a,c,h,d=1){if(!this.nodeCount)return null;const m=this.raycastRoot(e,i,n,a,c,h,d);if(m==null)return null;const _=[],b=[],T=[],S=[],M=[{idx:0,t:m,nodex:0,nodey:0,depth:0}];for(;M.length>0;){const{idx:C,t:D,nodex:B,nodey:H,depth:ee}=M.pop();if(this.leaves[C]){i_(B,H,ee,e,i,n,a,T,S);const J=1<<ee,ne=(B+0)/J,te=(B+1)/J,ye=(H+0)/J,ge=(H+1)/J,Ie=Wo(ne,ye,this.dem)*d,Oe=Wo(te,ye,this.dem)*d,we=Wo(te,ge,this.dem)*d,ke=Wo(ne,ge,this.dem)*d,ze=e_(T[0],T[1],Ie,S[0],T[1],Oe,S[0],S[1],we,c,h),Le=e_(S[0],S[1],we,T[0],S[1],ke,T[0],T[1],Ie,c,h),Fe=Math.min(ze!==null?ze:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(Fe!==Number.MAX_VALUE)return Fe;{const Te=Jl([],c,h,D);if(n_(Ie,Oe,ke,we,t_(Te[0],T[0],S[0]),t_(Te[1],T[1],S[1]))>=Te[2])return D}continue}let W=0;for(let J=0;J<this._siblingOffset.length;J++){i_((B<<1)+this._siblingOffset[J][0],(H<<1)+this._siblingOffset[J][1],ee+1,e,i,n,a,T,S),T[2]=-100,S[2]=this.maximums[this.childOffsets[C]+J]*d;const ne=Qm(T,S,c,h);if(ne!=null){const te=ne;_[J]=te;let ye=!1;for(let ge=0;ge<W&&!ye;ge++)te>=_[b[ge]]&&(b.splice(ge,0,J),ye=!0);ye||(b[W]=J),W++}}for(let J=0;J<W;J++){const ne=b[J];M.push({idx:this.childOffsets[C]+ne,t:_[ne],nodex:(B<<1)+this._siblingOffset[ne][0],nodey:(H<<1)+this._siblingOffset[ne][1],depth:ee+1})}}return null}_addNode(e,i,n){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,n,a,c){if(e[a].isLeaf(i,n)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const h=a-1,d=e[h];let m=0,_=0;for(let b=0;b<this._siblingOffset.length;b++){const T=2*i+this._siblingOffset[b][0],S=2*n+this._siblingOffset[b][1],M=d.getElevation(T,S),C=d.isLeaf(T,S),D=this._addNode(M.min,M.max,C);C&&(m|=1<<b),_||(_=D)}for(let b=0;b<this._siblingOffset.length;b++)m&1<<b||this._construct(e,2*i+this._siblingOffset[b][0],2*n+this._siblingOffset[b][1],h,_+b)}}function n_(t,e,i,n,a,c){return Zt(Zt(t,i,c),Zt(e,n,c),a)}function Wo(t,e,i){const n=i.dim,a=Tt(t*n-.5,0,n-1),c=Tt(e*n-.5,0,n-1),h=Math.floor(a),d=Math.floor(c),m=Math.min(h+1,n-1),_=Math.min(d+1,n-1);return n_(i.get(h,d),i.get(m,d),i.get(h,_),i.get(m,_),a-h,c-d)}const o_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class dh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,n,a=!1,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return $t(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const h=this.dim=i.height-2,d=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=n||"mapbox",this.borderReady=a,!a){for(let m=0;m<h;m++)d[this._idx(-1,m)]=d[this._idx(0,m)],d[this._idx(h,m)]=d[this._idx(h-1,m)],d[this._idx(m,-1)]=d[this._idx(m,0)],d[this._idx(m,h)]=d[this._idx(m,h-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(h,-1)]=d[this._idx(h-1,0)],d[this._idx(-1,h)]=d[this._idx(0,h-1)],d[this._idx(h,h)]=d[this._idx(h-1,h-1)],c&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new r_(this)}get(e,i,n=!1){n&&(e=Tt(e,-1,this.dim),i=Tt(i,-1,this.dim));const a=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[a],this.pixels[a+1],this.pixels[a+2])}static getUnpackVector(e){return o_[e]}get unpackVector(){return o_[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,n){return(256*e*256+256*i+n)/10-1e4}_unpackTerrarium(e,i,n){return 256*e+i+n/256-32768}static pack(e,i){const n=[0,0,0,0],a=dh.getUnpackVector(i);let c=Math.floor((e+a[3])/a[2]);return n[2]=c%256,c=Math.floor(c/256),n[1]=c%256,c=Math.floor(c/256),n[0]=c,n}getPixels(){return new Lr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,c=i*this.dim+this.dim,h=n*this.dim,d=n*this.dim+this.dim;switch(i){case-1:a=c-1;break;case 1:c=a+1}switch(n){case-1:h=d-1;break;case 1:d=h+1}const m=-i*this.dim,_=-n*this.dim;for(let b=h;b<d;b++)for(let T=a;T<c;T++){const S=4*this._idx(T,b),M=4*this._idx(T+m,b+_);this.pixels[S+0]=e.pixels[M+0],this.pixels[S+1]=e.pixels[M+1],this.pixels[S+2]=e.pixels[M+2],this.pixels[S+3]=e.pixels[M+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}it(dh,"DEMData"),it(r_,"DemMinMaxQuadTree",{omit:["dem"]});class v0{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,n){const a=e.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const c={value:i,timeout:void 0};if(n!==void 0&&(c.timeout=setTimeout(()=>{this.remove(e,c)},n)),this.data[a].push(c),this.order.push(a),this.order.length>this.max){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const n=e.wrapped().key,a=i===void 0?0:this.data[n].indexOf(i),c=this.data[n][a];return this.data[n].splice(a,1),c.timeout&&clearTimeout(c.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(c.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const n in this.data)for(const a of this.data[n])e(a.value)||i.push(a);for(const n of i)this.remove(n.value.tileID,n)}}class Ka{constructor(e,i,n){this.func=e,this.mask=i,this.range=n}}Ka.ReadOnly=!1,Ka.ReadWrite=!0,Ka.disabled=new Ka(519,Ka.ReadOnly,[0,1]);const Gp=7680;class $p{constructor(e,i,n,a,c,h){this.test=e,this.ref=i,this.mask=n,this.fail=a,this.depthFail=c,this.pass=h}}$p.disabled=new $p({func:519,mask:0},0,0,Gp,Gp,Gp);class Nn{constructor(e,i,n){this.blendFunction=e,this.blendColor=i,this.mask=n}}Nn.Replace=[1,0],Nn.disabled=new Nn(Nn.Replace,ki.transparent,[!1,!1,!1,!1]),Nn.unblended=new Nn(Nn.Replace,ki.transparent,[!0,!0,!0,!0]),Nn.alphaBlended=new Nn([1,771],ki.transparent,[!0,!0,!0,!0]);const qp=1029,Zp=2305;class yn{constructor(e,i,n){this.enable=e,this.mode=i,this.frontFace=n}}yn.disabled=new yn(!1,qp,Zp),yn.backCCW=new yn(!0,qp,Zp),yn.backCW=new yn(!0,qp,2304),yn.frontCW=new yn(!0,1028,2304),yn.frontCCW=new yn(!0,1028,Zp);class $s extends Cr{constructor(e,i,n){super(),this.id=e,this._onlySymbols=n,i.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new v0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new x0,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const n=this._tiles[i];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Si(this._tiles).map(e=>e.tileID).sort(s_).map(e=>e.key)}getRenderableIds(e){const i=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&i.push(this._tiles[n]);return e?i.sort((n,a)=>{const c=n.tileID,h=a.tileID,d=new Se(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),m=new Se(h.canonical.x,h.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-h.overscaledZ||m.y-d.y||m.x-d.x}).map(n=>n.tileID.key):i.map(n=>n.tileID).sort(s_).map(n=>n.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=i),this._loadTile(n,this._tileLoaded.bind(this,n,e,i)))}_tileLoaded(e,i,n,a){if(a)if(e.state="errored",a.status!==404)this._source.fire(new An(a,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=ct.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new qr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let a=0;a<i.length;a++){const c=i[a];if(e.neighboringTiles&&e.neighboringTiles[c]){const h=this.getTileByID(c);n(e,h),n(h,e)}}function n(a,c){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let h=c.tileID.canonical.x-a.tileID.canonical.x;const d=c.tileID.canonical.y-a.tileID.canonical.y,m=Math.pow(2,a.tileID.canonical.z),_=c.tileID.key;h===0&&d===0||Math.abs(d)>1||(Math.abs(h)>1&&(Math.abs(h+m)===1?h+=m:Math.abs(h-m)===1&&(h-=m)),c.dem&&a.dem&&(a.dem.backfillBorder(c.dem,h,d),a.neighboringTiles&&a.neighboringTiles[_]&&(a.neighboringTiles[_].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,n,a){for(const c in this._tiles){let h=this._tiles[c];if(a[c]||!h.hasData()||h.tileID.overscaledZ<=i||h.tileID.overscaledZ>n)continue;let d=h.tileID;for(;h&&h.tileID.overscaledZ>i+1;){const _=h.tileID.scaledTo(h.tileID.overscaledZ-1);h=this._tiles[_.key],h&&h.hasData()&&(d=_)}let m=d;for(;m.overscaledZ>i;)if(m=m.scaledTo(m.overscaledZ-1),e[m.key]){a[d.key]=d;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=i?n:null}for(let n=e.overscaledZ-1;n>=i;n--){const a=e.scaledTo(n),c=this._getLoadedTile(a);if(c)return c}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const n=Math.ceil(e.width/i)+1,a=Math.ceil(e.height/i)+1,c=Math.floor(n*a*5),h=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,c):c,d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(d)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const n={};for(const a in this._tiles){const c=this._tiles[a];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+i),n[c.tileID.key]=c}this._tiles=n;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,i,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let a;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(d=>new vr(d.canonical.z,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y)):(a=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter(d=>this._source.hasTile(d)))):a=[];const c=this._updateRetainedTiles(a);if(a_(this._source.type)&&a.length!==0){const d={},m={},_=Object.keys(c);for(const T of _){const S=c[T],M=this._tiles[T];if(!M||M.fadeEndTime&&M.fadeEndTime<=ct.now())continue;const C=this.findLoadedParent(S,Math.max(S.overscaledZ-$s.maxOverzooming,this._source.minzoom));C&&(this._addTile(C.tileID),d[C.tileID.key]=C.tileID),m[T]=S}const b=a[a.length-1].overscaledZ;for(const T in this._tiles){const S=this._tiles[T];if(c[T]||!S.hasData())continue;let M=S.tileID;for(;M.overscaledZ>b;){M=M.scaledTo(M.overscaledZ-1);const C=this._tiles[M.key];if(C&&C.hasData()&&m[M.key]){c[T]=S.tileID;break}}}for(const T in d)c[T]||(this._coveredTiles[T]=!0,c[T]=d[T])}for(const d in c)this._tiles[d].clearFadeHold();const h=function(d,m){const _=[];for(const b in d)b in m||_.push(b);return _}(this._tiles,c);for(const d of h){const m=this._tiles[d];m.hasSymbolBuckets&&!m.holdingForFade()?m.setHoldDuration(this.map._fadeDuration):m.hasSymbolBuckets&&!m.symbolFadeFinished()||this._removeTile(+d)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const n={},a=e.reduce((_,b)=>Math.min(_,b.overscaledZ),1/0),c=e[0].overscaledZ,h=Math.max(c-$s.maxOverzooming,this._source.minzoom),d=Math.max(c+$s.maxUnderzooming,this._source.minzoom),m={};for(const _ of e){const b=this._addTile(_);i[_.key]=_,b.hasData()||a<this._source.maxzoom&&(m[_.key]=_)}this._retainLoadedChildren(m,a,d,i);for(const _ of e){let b=this._tiles[_.key];if(b.hasData())continue;if(_.canonical.z>=this._source.maxzoom){const S=_.children(this._source.maxzoom)[0],M=this.getTile(S);if(M&&M.hasData()){i[S.key]=S;continue}}else{const S=_.children(this._source.maxzoom);if(i[S[0].key]&&i[S[1].key]&&i[S[2].key]&&i[S[3].key])continue}let T=b.wasRequested();for(let S=_.overscaledZ-1;S>=h;--S){const M=_.scaledTo(S);if(n[M.key]||(n[M.key]=!0,b=this.getTile(M),!b&&T&&(b=this._addTile(M)),b&&(i[M.key]=M,T=b.wasRequested(),b.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let n,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){n=this._loadedParentTiles[a.key];break}i.push(a.key);const c=a.scaledTo(a.overscaledZ-1);if(n=this._getLoadedTile(c),n)break;a=c}for(const c of i)this._loadedParentTiles[c]=n}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const n=Boolean(i);if(!n){const a=this.map?this.map.painter:null;i=new Vp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,n||this._source.fire(new qr("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=i.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,n){const a=[],c=this.transform;if(!c)return a;const h=c.projection.name==="globe",d=Ln(c.center.lng);for(const m in this._tiles){const _=this._tiles[m];if(n&&_.clearQueryDebugViz(),_.holdingForFade())continue;let b;if(h){const T=_.tileID.canonical;if(T.z===0){const S=[Math.abs(Tt(d,...Tc(T,-1))-d),Math.abs(Tt(d,...Tc(T,1))-d)];b=[0,2*S.indexOf(Math.min(...S))-1]}else{const S=[Math.abs(Tt(d,...Tc(T,-1))-d),Math.abs(Tt(d,...Tc(T,0))-d),Math.abs(Tt(d,...Tc(T,1))-d)];b=[S.indexOf(Math.min(...S))-1]}}else b=[0];for(const T of b){const S=e.containsTile(_,c,i,T);S&&a.push(S)}}return a}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of i)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(a_(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=ct.now())return!0}return!1}setFeatureState(e,i,n){this._state.updateState(e=e||"_geojsonTileLayer",i,n)}removeFeatureState(e,i,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,n)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,n){const a=this._tiles[e];a&&a.setDependencies(i,n)}reloadTilesForDependencies(e,i){for(const n in this._tiles)this._tiles[n].hasDependency(e,i)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,i))}_preloadTiles(e,i){const n=new Map,a=Array.isArray(e)?e:[e],c=this.map.painter.terrain,h=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const d of a){const m=d.coveringTiles({tileSize:h,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const _ of m)n.set(_.key,_);this.usedForTerrain&&d.updateElevation(!1)}Mr(Array.from(n.values()),(d,m)=>{const _=new Vp(d,this._source.tileSize*d.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(_,b=>{this._source.type==="raster-dem"&&_.dem&&this._backfillDEM(_),m(b,_)})},i)}}function s_(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function a_(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Tc(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}$s.maxOverzooming=10,$s.maxUnderzooming=3;class fh{constructor(e,i,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=n}static create(e,i,n){const a=n||e.findDEMTileFor(i);if(!a||!a.dem)return;const c=a.dem,h=a.tileID,d=1<<i.canonical.z-h.canonical.z;return new fh(a,a.tileSize/bt/d,[(i.canonical.x/d-h.canonical.x)*c.dim,(i.canonical.y/d-h.canonical.y)*c.dim])}tileCoordToPixel(e,i){const n=i*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(n);return new Se(a,c)}getElevationAt(e,i,n,a){const c=e*this._scale+this._offset[0],h=i*this._scale+this._offset[1],d=Math.floor(c),m=Math.floor(h),_=this._dem;return a=!!a,n?Zt(Zt(_.get(d,m,a),_.get(d,m+1,a),h-m),Zt(_.get(d+1,m,a),_.get(d+1,m+1,a),h-m),c-d):_.get(d,m,a)}getElevationAtPixel(e,i,n){return this._dem.get(e,i,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*en(1,e)*this._dem.stride}}class l_{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Oo(bt,16,0),this.featureIndexArray=new Hd,this.promoteId=i}insert(e,i,n,a,c,h=0){const d=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,a,c,h);const m=this.grid;for(let _=0;_<i.length;_++){const b=i[_],T=[1/0,1/0,-1/0,-1/0];for(let S=0;S<b.length;S++){const M=b[S];T[0]=Math.min(T[0],M.x),T[1]=Math.min(T[1],M.y),T[2]=Math.max(T[2],M.x),T[3]=Math.max(T[3],M.y)}T[0]<bt&&T[1]<bt&&T[2]>=0&&T[3]>=0&&m.insert(d,T[0],T[1],T[2],T[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wp(new hc(this.rawTileData)).layers,this.sourceLayerCoder=new Xm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,n,a){this.loadVTLayers();const c=e.params||{},h=Qn(c.filter),d=e.tileResult,m=e.transform,_=d.bufferedTilespaceBounds,b=this.grid.query(_.min.x,_.min.y,_.max.x,_.max.y,(C,D,B,H)=>ff(d.bufferedTilespaceGeometry,C,D,B,H));b.sort(b0);let T=null;m.elevation&&b.length>0&&(T=fh.create(m.elevation,this.tileID));const S={};let M;for(let C=0;C<b.length;C++){const D=b[C];if(D===M)continue;M=D;const B=this.featureIndexArray.get(D);let H=null;this.loadMatchingFeature(S,B,h,c.layers,c.availableImages,i,n,a,(ee,W,J,ne=0)=>(H||(H=io(ee,this.tileID.canonical,e.tileTransform)),W.queryIntersectsFeature(d,ee,J,H,this.z,e.transform,e.pixelPosMatrix,T,ne)))}return S}loadMatchingFeature(e,i,n,a,c,h,d,m,_){const{featureIndex:b,bucketIndex:T,sourceLayerIndex:S,layoutVertexArrayOffset:M}=i,C=this.bucketLayerIDs[T];if(a&&!function(ee,W){for(let J=0;J<ee.length;J++)if(W.indexOf(ee[J])>=0)return!0;return!1}(a,C))return;const D=this.sourceLayerCoder.decode(S),B=this.vtLayers[D].feature(b);if(n.needGeometry){const ee=Bs(B,!0);if(!n.filter(new ue(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!n.filter(new ue(this.tileID.overscaledZ),B))return;const H=this.getId(B,D);for(let ee=0;ee<C.length;ee++){const W=C[ee];if(a&&a.indexOf(W)<0)continue;const J=h[W];if(!J)continue;let ne={};H!==void 0&&m&&(ne=m.getState(J.sourceLayer||"_geojsonTileLayer",H));const te=Ye({},d[W]);te.paint=c_(te.paint,J.paint,B,ne,c),te.layout=c_(te.layout,J.layout,B,ne,c);const ye=!_||_(B,J,ne,M);if(!ye)continue;const ge=new Wm(B,this.z,this.x,this.y,H);ge.layer=te;let Ie=e[W];Ie===void 0&&(Ie=e[W]=[]),Ie.push({featureIndex:b,feature:ge,intersectionZ:ye})}}lookupSymbolFeatures(e,i,n,a,c,h,d,m){const _={};this.loadVTLayers();const b=Qn(c);for(const T of e)this.loadMatchingFeature(_,{bucketIndex:n,sourceLayerIndex:a,featureIndex:T,layoutVertexArrayOffset:0},b,h,d,m,i);return _}loadFeature(e){const{featureIndex:i,sourceLayerIndex:n}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(n),c=this.vtFeatures[a];if(c[i])return c[i];const h=this.vtLayers[a].feature(i);return c[i]=h,h}hasLayer(e){for(const i of this.bucketLayerIDs)for(const n of i)if(e===n)return!0;return!1}getId(e,i){let n=e.id;if(this.promoteId){const a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];a!=null&&(n=e.properties[a]),typeof n=="boolean"&&(n=Number(n))}return n}}function c_(t,e,i,n,a){return Ii(t,(c,h)=>{const d=e instanceof je?e.get(h):null;return d&&d.evaluate?d.evaluate(i,n,a):d})}function b0(t,e){return e-t}it(l_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class u_{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new no({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const n=this.getKey(e,i);return this.positions[n]}trim(){const e=this.width,i=this.height=Gt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,n){const a=[];let c=e.length%2==1?-e[e.length-1]*n:0,h=e[0]*n,d=!0;a.push({left:c,right:h,isDash:d,zeroLength:e[0]===0});let m=e[0];for(let _=1;_<e.length;_++){d=!d;const b=e[_];c=m*n,m+=b,h=m*n,a.push({left:c,right:h,isDash:d,zeroLength:b===0})}return a}addRoundDash(e,i,n){const a=i/2;for(let c=-n;c<=n;c++){const h=this.width*(this.nextRow+n+c);let d=0,m=e[d];for(let _=0;_<this.width;_++){_/m.right>1&&(m=e[++d]);const b=Math.abs(_-m.left),T=Math.abs(_-m.right),S=Math.min(b,T);let M;const C=c/n*(a+1);if(m.isDash){const D=a-Math.abs(C);M=Math.sqrt(S*S+D*D)}else M=a-Math.sqrt(S*S+C*C);this.image.data[h+_]=Math.max(0,Math.min(255,M+128))}}}addRegularDash(e,i){for(let m=e.length-1;m>=0;--m){const _=e[m],b=e[m+1];_.zeroLength?e.splice(m,1):b&&b.isDash===_.isDash&&(b.left=_.left,e.splice(m,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const c=this.width*this.nextRow;let h=0,d=e[h];for(let m=0;m<this.width;m++){m/d.right>1&&(d=e[++h]);const _=Math.abs(m-d.left),b=Math.abs(m-d.right),T=Math.min(_,b);this.image.data[c+m]=Math.max(0,Math.min(255,(d.isDash?T:-T)+i+128))}}addDash(e,i){const n=this.getKey(e,i);if(this.positions[n])return this.positions[n];const a=i==="round",c=a?7:0,h=2*c+1;if(this.nextRow+h>this.height)return $t("LineAtlas out of space"),null;e.length===0&&e.push(1);let d=0;for(let b=0;b<e.length;b++)e[b]<0&&($t("Negative value is found in line dasharray, replacing values with 0"),e[b]=0),d+=e[b];if(d!==0){const b=this.width/d,T=this.getDashRanges(e,this.width,b);a?this.addRoundDash(T,b,c):this.addRegularDash(T,i==="square"?.5*b:0)}const m=this.nextRow+c;this.nextRow+=h;const _={tl:[m,c],br:[d,0]};return this.positions[n]=_,_}}it(u_,"LineAtlas");class h_{constructor(e){const i={},n=[];for(const d in e){const m=e[d],_=i[d]={};for(const b in m.glyphs){const T=m.glyphs[+b];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const S=T.metrics.localGlyph?2:1,M={x:0,y:0,w:T.bitmap.width+2*S,h:T.bitmap.height+2*S};n.push(M),_[b]=M}}const{w:a,h:c}=Sp(n),h=new no({width:a||1,height:c||1});for(const d in e){const m=e[d];for(const _ in m.glyphs){const b=m.glyphs[+_];if(!b||b.bitmap.width===0||b.bitmap.height===0)continue;const T=i[d][_],S=b.metrics.localGlyph?2:1;no.copy(b.bitmap,h,{x:0,y:0},{x:T.x+S,y:T.y+S},b.bitmap)}}this.image=h,this.positions=i}}it(h_,"GlyphAtlas");class w0{constructor(e){this.tileID=new vr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Gs(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,n,a,c){this.status="parsing",this.data=e,this.collisionBoxArray=new Yh;const h=new Xm(Object.keys(e.layers).sort()),d=new l_(this.tileID,this.promoteId);d.bucketLayerIDs=[];const m={},_=new u_(256,256),b={featureIndex:d,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:_,availableImages:n},T=i.familiesBySource[this.source];for(const ne in T){const te=e.layers[ne];if(!te)continue;let ye=!1,ge=!1;for(const we of T[ne])we[0].type==="symbol"?ye=!0:ge=!0;if(this.isSymbolTile===!0&&!ye||this.isSymbolTile===!1&&!ge)continue;te.version===1&&$t(`Vector tile source "${this.source}" layer "${ne}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ie=h.encode(ne),Oe=[];for(let we=0;we<te.length;we++){const ke=te.feature(we),ze=d.getId(ke,ne);Oe.push({feature:ke,id:ze,index:we,sourceLayerIndex:Ie})}for(const we of T[ne]){const ke=we[0];this.isSymbolTile!==void 0&&ke.type==="symbol"!==this.isSymbolTile||ke.minzoom&&this.zoom<Math.floor(ke.minzoom)||ke.maxzoom&&this.zoom>=ke.maxzoom||ke.visibility!=="none"&&(Xp(we,this.zoom,n),(m[ke.id]=ke.createBucket({index:d.bucketLayerIDs.length,layers:we,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ie,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:n})).populate(Oe,b,this.tileID.canonical,this.tileTransform),d.bucketLayerIDs.push(we.map(ze=>ze.id)))}}let S,M,C,D;_.trim();const B={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},H=Ii(b.glyphDependencies,ne=>Object.keys(ne).map(Number));Object.keys(H).length?a.send("getGlyphs",{uid:this.uid,stacks:H},(ne,te)=>{S||(S=ne,M=te,J.call(this))},void 0,!1,B):M={};const ee=Object.keys(b.iconDependencies);ee.length?a.send("getImages",{icons:ee,source:this.source,tileID:this.tileID,type:"icons"},(ne,te)=>{S||(S=ne,C=te,J.call(this))},void 0,!1,B):C={};const W=Object.keys(b.patternDependencies);function J(){if(S)return c(S);if(M&&C&&D){const ne=new h_(M),te=new hm(C,D);for(const ye in m){const ge=m[ye];ge instanceof qo?(Xp(ge.layers,this.zoom,n),$y(ge,M,ne.positions,C,te.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):ge.hasPattern&&(ge instanceof Yu||ge instanceof qu||ge instanceof ac)&&(Xp(ge.layers,this.zoom,n),ge.addFeatures(b,this.tileID.canonical,te.patternPositions,n,this.tileTransform))}this.status="done",c(null,{buckets:Si(m).filter(ye=>!ye.isEmpty()),featureIndex:d,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ne.image,lineAtlas:_,imageAtlas:te,glyphMap:this.returnDependencies?M:null,iconMap:this.returnDependencies?C:null,glyphPositions:this.returnDependencies?ne.positions:null})}}W.length?a.send("getImages",{icons:W,source:this.source,tileID:this.tileID,type:"patterns"},(ne,te)=>{S||(S=ne,D=te,J.call(this))},void 0,!1,B):D={},J.call(this)}}function Xp(t,e,i){const n=new ue(e);for(const a of t)a.recalculate(n,i)}class p_{constructor(e){this.entries={},this.scheduler=e}request(e,i,n,a){const c=this.entries[e]=this.entries[e]||{callbacks:[]};if(c.result){const[h,d]=c.result;return this.scheduler?this.scheduler.add(()=>{a(h,d)},i):a(h,d),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=n((h,d)=>{c.result=[h,d];for(const m of c.callbacks)this.scheduler?this.scheduler.add(()=>{m(h,d)},i):m(h,d);setTimeout(()=>delete this.entries[e],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(h=>h!==a),c.callbacks.length||(c.cancel(),delete this.entries[e]))}}}function d_(t,e,i){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const c=En(t.request,(h,d,m,_)=>{h?a(h):d&&a(null,{vectorTile:i?void 0:new wp(new hc(d)),rawData:d,cacheControl:m,expires:_})});return()=>{c.cancel(),a()}},e)}o.ARRAY_TYPE=Dr,o.AUTH_ERR_MSG=vo,o.Aabb=xr,o.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},gi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=qi()?t:re,this.scheduler=new g0}send(t,e,i,n,a=!1,c){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=c,this.callbacks[h]=i);const d=po(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:t,hasCallback:!!i,targetMapId:n,mustQueue:a,sourceMapId:this.mapId,data:Dn(e,d)},d),{cancel:()=>{i&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[i];delete this.cancelCallbacks[i],n&&n.cancel()}else if(e.mustQueue||qi()){const n=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),n&&n.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if(e.type==="<response>"){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(ks(e.error)):i(null,ks(e.data)))}else{const i=po(this.globalScope)?void 0:[],n=e.hasCallback?(c,h)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:c?Dn(c):null,data:Dn(h,i)},i)}:c=>{},a=ks(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,n);else if(this.parent.getWorkerSource){const c=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,c[0],a.source)[c[1]](a,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Hu,o.Color=ki,o.ColorMode=Nn,o.CullFaceMode=yn,o.DEMData=dh,o.DataConstantProperty=he,o.DedupedRequest=p_,o.DepthMode=Ka,o.EXTENT=bt,o.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,n=1<<i,a=Math.floor(t.x),c=Math.floor((t.x-a)*n),h=Math.floor(t.y*n),d=this.findDEMTileFor(new vr(i,a,i,c,h));return!(!d||!d.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const n=this._source();if(!n||t.y<0||t.y>1)return e;const a=n.getSource().maxzoom,c=1<<a,h=Math.floor(t.x),d=t.x-h,m=new vr(a,h,a,Math.floor(d*c),Math.floor(t.y*c)),_=this.findDEMTileFor(m);if(!_||!_.dem)return e;const b=_.dem,T=1<<_.tileID.canonical.z,S=(d*T-_.tileID.canonical.x)*b.dim,M=(t.y*T-_.tileID.canonical.y)*b.dim,C=Math.floor(S),D=Math.floor(M);return(i?this.exaggeration():1)*Zt(Zt(b.get(C,D),b.get(C,D+1),M-D),Zt(b.get(C+1,D),b.get(C+1,D+1),M-D),S-C)}getAtTileOffset(t,e,i){const n=1<<t.canonical.z;return this.getAtPointOrZero(new La(t.wrap+(t.canonical.x+e/bt)/n,(t.canonical.y+i/bt)/n))}getAtTileOffsetFunc(t,e,i,n){return a=>{const c=this.getAtTileOffset(t,a.x,a.y),h=n.upVector(t.canonical,a.x,a.y);return Vr(h,h,c*n.upVectorScale(t.canonical,e,i).metersToTile),h}}getForTilePoints(t,e,i,n){if(this.isUsingMockSource())return!1;const a=fh.create(this,t,n);return!!a&&(e.forEach(c=>{c[2]=this.exaggeration()*a.getElevationAt(c[0],c[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,n=e.tileID,a=1<<t.canonical.z-n.canonical.z;let c=t.canonical.x/a-n.canonical.x,h=t.canonical.y/a-n.canonical.y,d=0;for(let m=0;m<t.canonical.z-n.canonical.z&&!i.leaves[d];m++){c*=2,h*=2;const _=2*Math.floor(h)+Math.floor(c);d=i.childOffsets[d]+_,c%=1,h%=1}return{min:this.exaggeration()*i.minimums[d],max:this.exaggeration()*i.maximums[d]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=An,o.EvaluationParameters=ue,o.Event=qr,o.Evented=Cr,o.FillExtrusionBucket=ac,o.Frustum=dp,o.FrustumCorners=pp,o.GLOBE_METERS_TO_ECEF=Dp,o.GLOBE_RADIUS=ao,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new Yt,i=new sr,n=65;for(let a=0;a<n;a++)for(let c=0;c<n;c++)e.emplaceBack(c,a);this._gridSegments=[];for(let a=0,c=0;a<Xa.length;a++){const h=Xa[a];for(let m=0;m<h;m++)for(let _=0;_<64;_++){const b=m*n+_;i.emplaceBack(b+1,b,b+n),i.emplaceBack(b+n,b+n+1,b+1)}const d=64*h*2;this._gridSegments.push(Gi.simpleSegment(0,c,(h+1)*n,d)),c+=d}this._gridBuffer=t.createVertexBuffer(e,fc.members),this._gridIndexBuffer=t.createIndexBuffer(i,!0)}_createPoles(t){const e=new sr;for(let a=0;a<=Za;a++)e.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new Ls,n=new Ls;this._poleSegments=[];for(let a=0,c=0;a<5;a++){const h=360/(1<<a);i.emplaceBack(0,-ao,0,.5,0),n.emplaceBack(0,-ao,0,.5,1);for(let d=0;d<=Za;d++){const m=d/Za,_=Zt(0,h,m),[b,T,S]=Wa(Ky,Jy,_,ao);i.emplaceBack(b,T,S,m,0),n.emplaceBack(b,T,S,m,1)}this._poleSegments.push(Gi.simpleSegment(c,0,66,64)),c+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,zm,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,zm,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new Qr,n=Za,a=n+1;this._wireframeSegments=[];for(let c=0,h=0;c<Xa.length;c++){const d=Xa[c];for(let _=0;_<d;_++)for(let b=0;b<n;b++){const T=_*a+b;i.emplaceBack(T,T+1),i.emplaceBack(T,T+a),i.emplaceBack(T,T+a+1)}const m=d*n*3;this._wireframeSegments.push(Gi.simpleSegment(0,h,(d+1)*a,m)),h+=m}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=$a,o.ImagePosition=Ip,o.LivePerformanceUtils=Ke,o.LngLat=qt,o.LngLatBounds=Vo,o.LocalGlyphMode=Cp,o.MAX_MERCATOR_LATITUDE=Bn,o.MercatorCoordinate=La,o.ONE_EM=lr,o.OverscaledTileID=vr,o.PerformanceMarkers=De,o.Properties=ut,o.RGBAImage=Lr,o.Ray=hp,o.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ne,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Fr(t))return t;const i=Ur(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Fr(t))return t;const i=Ur(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,n){if(!Fr(t))return t;const a=Ur(t);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),i&&a.params.push(`language=${i}`),n&&a.params.push(`worldview=${n}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,n){const a=Ur(t);return Fr(t)?(a.path=`/styles/v1${a.path}/sprite${e}${i}`,this._makeAPIURL(a,this._customAccessToken||n)):(a.path+=`${e}${i}`,In(a))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Fr(t))return t;const n=Ur(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&n.authority!=="raster"&&i===512?"@2x":""}${We.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${Ge.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${Ge.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(c){for(const h of c){const d=h.match(/^access_token=(.*)$/);if(d)return d[1]}return null}(n.params)||Ge.ACCESS_TOKEN;return Ge.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(t,e){const i=Ur(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+=`raster/${i.path.replace(`/${Ge.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${i.path.replace(`/${Ge.TILE_URL_VERSION}/`,"")}`;let a=i.params;return e&&(a=a.filter(c=>!c.match(/^access_token=/))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(t,e){const i=!!e&&Fr(e),n=[];for(const a of t.tiles||[])bo(a)?n.push(this.canonicalizeTileURL(a,i)):n.push(a);return n}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=Ur(Ge.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,t.protocol==="http"){const a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if(n.path!=="/"&&(t.path=`${n.path}${t.path}`),!Ge.REQUIRE_ACCESS_TOKEN)return In(t);if(e=e||Ge.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(a=>a.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),In(t)}},o.ResourceType=Er,o.SegmentVector=Gi,o.SourceCache=$s,o.StencilMode=$p,o.StructArrayLayout1ui2=Zl,o.StructArrayLayout2f1f2i16=pr,o.StructArrayLayout2i4=Yt,o.StructArrayLayout2ui4=Qr,o.StructArrayLayout3f12=dn,o.StructArrayLayout3ui6=sr,o.StructArrayLayout4i8=li,o.StructArrayLayout5f20=Ls,o.Texture=wc,o.Tile=Vp,o.Transitionable=Ae,o.Uniform1f=Du,o.Uniform1i=class extends eo{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends eo{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},o.Uniform3f=class extends eo{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},o.Uniform4f=tf,o.UniformColor=rf,o.UniformMatrix2f=class extends eo{constructor(t){super(t),this.current=ig}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let n=0;n<4;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},o.UniformMatrix3f=class extends eo{constructor(t){super(t),this.current=tg}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let n=0;n<9;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.UniformMatrix4f=class extends eo{constructor(t){super(t),this.current=eg}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let n=1;n<16;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},o.UnwrappedTileID=Jf,o.ValidationError=Qe,o.VectorTileFeature=Xu,o.VectorTileWorkerSource=class extends Cr{constructor(t,e,i,n,a){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=a||d_,this.loading={},this.loaded={},this.deduped=new p_(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,n=t&&t.request,a=n&&n.collectResourceTiming,c=this.loading[i]=new w0(t);c.abort=this.loadVectorData(t,(h,d)=>{const m=!this.loading[i];if(delete this.loading[i],m||h||!d)return c.status="done",m||(this.loaded[i]=c),e(h);const _=d.rawData,b={};d.expires&&(b.expires=d.expires),d.cacheControl&&(b.cacheControl=d.cacheControl),c.vectorTile=d.vectorTile||new wp(new hc(_));const T=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(S,M)=>{if(S||!M)return e(S);const C={};if(a){const D=pt(n);D.length>0&&(C.resourceTiming=JSON.parse(JSON.stringify(D)))}e(null,Ye({rawTileData:_.slice(0)},M,b,C))})};this.isSpriteLoaded?T():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(T,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):T()}),this.loaded=this.loaded||{},this.loaded[i]=c})}reloadTile(t,e){const i=this.loaded,n=t.uid,a=this;if(i&&i[n]){const c=i[n];c.showCollisionBoxes=t.showCollisionBoxes,c.enableTerrain=!!t.enableTerrain,c.projection=t.projection,c.tileTransform=Gs(t.tileID.canonical,t.projection);const h=(d,m)=>{const _=c.reloadCallback;_&&(delete c.reloadCallback,c.parse(c.vectorTile,a.layerIndex,this.availableImages,a.actor,_)),e(d,m)};c.status==="parsing"?c.reloadCallback=h:c.status==="done"&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,h):h())}}abortTile(t,e){const i=t.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()}},o.WritingMode=Gr,o.add=ro,o.addDynamicAttributes=uh,o.adjoint=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],h=e[4],d=e[5],m=e[6],_=e[7],b=e[8];return t[0]=h*b-d*_,t[1]=a*_-n*b,t[2]=n*d-a*h,t[3]=d*m-c*b,t[4]=i*b-a*m,t[5]=a*c-i*d,t[6]=c*_-h*m,t[7]=n*m-i*_,t[8]=i*h-n*c,t},o.asyncAll=Mr,o.bezier=ii,o.bindAll=gi,o.boundsAttributes=Ym,o.bufferConvexPolygon=function(t,e){const i=[];for(let n=0;n<t.length;n++){const a=fr(n-1,-1,t.length-1),c=fr(n+1,-1,t.length-1),h=t[n],d=t[c],m=t[a].sub(h).unit(),_=d.sub(h).unit(),b=_.angleWithSep(m.x,m.y),T=m.add(_).unit().mult(-1*e/Math.sin(b/2));i.push(h.add(T))}return i},o.cacheEntryPossiblyAdded=function(t){_o++,_o>es&&(t.getActor().send("enforceCacheSizeLimit",fo),_o=0)},o.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:n}=t.point,a=Om(i,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Fs(a,a,Bp(Fn(e)))},o.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:n,lat:a}=t._center;return Om(e,i,t.worldSize,n,a)},o.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/en(1,t.center.lat),n=_n(new Float64Array(16));return Wl(n,n,[t.point.x,t.point.y,0]),Us(n,n,[i,i,e]),Float32Array.from(n)},o.circumferenceAtLatitude=Qh,o.clamp=Tt,o.clearTileCache=function(t){if(!mo())return;const e=re.caches.delete(Hs);t&&e.catch(t).then(()=>t())},o.clipLine=Tm,o.clone=function(t){var e=new Dr(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=Mi,o.collisionCircleLayout=_y,o.config=Ge,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new Dr(16);return Dr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=gf,o.createExpression=zn,o.createLayout=et,o.createStyleLayer=function(t){return t.type==="custom"?new d0(t):new m0[t.type](t)},o.cross=up,o.degToRad=gt,o.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},o.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},o.dot=tn,o.earthRadius=Ru,o.ease=ji,o.easeCubicInOut=Tr,o.ecefToLatLng=function([t,e,i]){const n=Math.hypot(t,e,i),a=Math.atan2(t,i),c=.5*Math.PI-Math.acos(-e/n);return new qt(ei(a),ei(c))},o.emitValidationErrors=yu,o.endsWith=ri,o.enforceCacheSizeLimit=function(t){wn(),cr&&cr.then(e=>{e.keys().then(i=>{for(let n=0;n<i.length-t;n++)e.delete(i[n])})})},o.evaluateSizeForFeature=Ku,o.evaluateSizeForZoom=ja,o.evaluateVariableOffset=Mm,o.evented=ie,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=ct,o.exported$1=We,o.extend=Ye,o.extend$1=ln,o.fillExtrusionHeightLift=Hf,o.filterObject=Ai,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],h=i+i,d=n+n,m=a+a,_=i*h,b=n*h,T=n*d,S=a*h,M=a*d,C=a*m,D=c*h,B=c*d,H=c*m;return t[0]=1-T-C,t[1]=b+H,t[2]=S-B,t[3]=0,t[4]=b-H,t[5]=1-_-C,t[6]=M+D,t[7]=0,t[8]=S+B,t[9]=M-D,t[10]=1-_-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=xf,o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return rr[e]},o.getAABBPointSquareDist=function(t,e,i){let n=0;for(let a=0;a<2;++a){const c=i?i[a]:0;t[a]>c&&(n+=(t[a]-c)*(t[a]-c)),e[a]<c&&(n+=(c-e[a])*(c-e[a]))}return n},o.getAnchorAlignment=Mp,o.getAnchorJustification=zp,o.getBounds=function(t){let e=1/0,i=1/0,n=-1/0,a=-1/0;for(const c of t)e=Math.min(e,c.x),i=Math.min(i,c.y),n=Math.max(n,c.x),a=Math.max(a,c.y);return{min:new Se(e,i),max:new Se(n,a)}},o.getColumn=vn,o.getGridMatrix=function(t,e,i,n){const a=e.getNorth(),c=e.getSouth(),h=e.getWest(),d=e.getEast(),m=1<<t.z,_=d-h,b=a-c,T=_/Za,S=-b/Xa[i],M=[0,T,0,S,0,0,a,h,0];if(t.z>0){const C=180/n;yf(M,M,[C/_+1,0,0,0,C/b+1,0,-.5*C/T,.5*C/S,1])}return M[2]=m,M[5]=t.x,M[8]=t.y,M},o.getImage=xo,o.getJSON=function(t,e){return Tn(Ye(t,{type:"json"}),e)},o.getLatitudinalLod=function(t){const e=80.051129;t=Tt(t,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(gt(t))),3);return Math.round(i*(Xa.length-1))},o.getMapSessionAPI=le,o.getPerformanceMeasurement=pt,o.getProjection=qm,o.getRTLTextPluginStatus=ce,o.getReferrer=go,o.getTilePoint=function(t,{x:e,y:i},n=0){return new Se(((e-n)*t.scale-t.x)*bt,(i*t.scale-t.y)*bt)},o.getTileVec3=function(t,e,i=0){return Ba(((e.x-i)*t.scale-t.x)*bt,(e.y*t.scale-t.y)*bt,sf(e.z,e.y))},o.getVideo=function(t,e){const i=re.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let n=0;n<t.length;n++){const a=re.document.createElement("source");rs(t[n])||(i.crossOrigin="Anonymous"),a.src=t[n],i.appendChild(a)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=_n(new Float64Array(16));return Fs(i,t.pixelMatrix,t.globeMatrix),Li(e,e,i),new Se(e[0],e[1])},o.globeDenormalizeECEF=Bp,o.globeECEFOrigin=function(t,e){const i=[0,0,0];return Li(i,i,gc(Fn(e.canonical))),Li(i,i,t),i},o.globeNormalizeECEF=gc,o.globePixelsToTileUnits=function(t,e){return bt/(512*Math.pow(2,t))*oh(Fn(e))},o.globePoleMatrixForTile=function(t,e,i){const n=_n(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return ju(n,i.globeMatrix,a),Float32Array.from(n)},o.globeTileBounds=Fn,o.globeTiltAtLngLat=Fm,o.globeToMercatorTransition=Ha,o.globeUseCustomAntiAliasing=function(t,e,i){const n=Ha(i.zoom),a=t.style.map._antialias,c=!!e.extStandardDerivatives,h=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return n===0&&!a&&!h&&c},o.identity=_n,o.identity$1=Af,o.invert=sp,o.isFullscreen=function(){return!!re.document.fullscreenElement||!!re.document.webkitFullscreenElement},o.isLngLatBehindGlobe=Op,o.isMapAuthenticated=function(t){return me.has(t)},o.isMapboxURL=Fr,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!po(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=ar,o.latLngToECEF=mc,o.len=xg,o.length=Hl,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.lngFromMercatorX=Nr,o.loadVectorTile=d_,o.makeRequest=Tn,o.mapValue=function(t,e,i,n,a){return Tt((t-e)/(i-e)*(a-n)+n,n,a)},o.mercatorScale=af,o.mercatorXfromLng=Ln,o.mercatorYfromLat=Rn,o.mercatorZfromAltitude=en,o.mul=gg,o.mul$1=yg,o.multiply=Fs,o.multiply$1=yf,o.multiply$2=wf,o.nextPowerOfTwo=Gt,o.normalize=yr,o.normalize$1=vg,o.normalize$2=Sf,o.number=Zt,o.ortho=function(t,e,i,n,a,c,h){var d=1/(e-i),m=1/(n-a),_=1/(c-h);return t[0]=-2*d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*_,t[11]=0,t[12]=(e+i)*d,t[13]=(a+n)*m,t[14]=(h+c)*_,t[15]=1,t},o.pbf=hc,o.perspective=function(t,e,i,n,a){var c,h=1/Math.tan(e/2);return t[0]=h/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=(a+n)*(c=1/(n-a)),t[14]=2*a*n*c):(t[10]=-1,t[14]=-2*n),t},o.pick=function(t,e){const i={};for(let n=0;n<e.length;n++){const a=e[n];a in t&&(i[a]=t[a])}return i},o.plugin=_e,o.pointGeometry=Se,o.polesInViewport=function(t){const e=_n(new Float64Array(16));Fs(e,t.pixelMatrix,t.globeMatrix);const i=[0,rn,0],n=[0,nn,0];return Li(i,i,e),Li(n,n,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Op(t,new qt(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Op(t,new qt(t.center.lat,-90))]},o.polygonContainsPoint=Os,o.polygonIntersectsBox=ff,o.polygonIntersectsPolygon=uf,o.polygonizeBounds=function(t,e,i=0,n=!0){const a=new Se(i,i),c=t.sub(a),h=e.add(a),d=[c,new Se(h.x,c.y),h,new Se(c.x,h.y)];return n&&d.push(c.clone()),d},o.posAttributes=fc,o.postMapLoadEvent=K,o.postPerformanceEvent=de,o.postTurnstileEvent=L,o.potpack=Sp,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=ei,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:X,pluginURL:G}),ie.on("pluginStateChange",t),t},o.removeAuthState=function(t){me.delete(t)},o.renderColorRamp=mp,o.resample=lf,o.rotateX=ap,o.rotateX$1=Mf,o.rotateY=ju,o.rotateY$1=Cf,o.rotateZ=function(t,e,i){var n=Math.sin(i),a=Math.cos(i),c=e[0],h=e[1],d=e[2],m=e[3],_=e[4],b=e[5],T=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*a+_*n,t[1]=h*a+b*n,t[2]=d*a+T*n,t[3]=m*a+S*n,t[4]=_*a-c*n,t[5]=b*a-h*n,t[6]=T*a-d*n,t[7]=S*a-m*n,t},o.rotateZ$1=function(t,e,i){i*=.5;var n=e[0],a=e[1],c=e[2],h=e[3],d=Math.sin(i),m=Math.cos(i);return t[0]=n*m+a*d,t[1]=a*m-n*d,t[2]=c*m+h*d,t[3]=h*m-c*d,t},o.scale=Us,o.scale$1=Ef,o.scale$2=Vr,o.scaleAndAdd=Jl,o.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},o.setCacheLimits=function(t,e){fo=t,es=e},o.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},o.setRTLTextPlugin=function(t,e,i=!1){if(X===j||X===V||X===F)throw new Error("setRTLTextPlugin cannot be called multiple times.");G=ct.resolveURL(t),X=j,U=e,oe(),i||xe()},o.smoothstep=Wi,o.spec=Me,o.squaredLength=function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},o.storeAuthState=function(t,e){e?me.add(t):me.delete(t)},o.sub=gn,o.subtract=cp,o.symbolSize=gy,o.tileAABB=function(t,e,i,n,a,c,h,d,m){if(m.name==="globe")return Yy(t,e,new Hu(i,n,a));const _=Gs({z:i,x:n,y:a},m);return new xr([(c+_.x/_.scale)*e,e*(_.y/_.scale),h],[(c+_.x2/_.scale)*e,e*(_.y2/_.scale),d])},o.tileCornersToBounds=nh,o.tileTransform=Gs,o.transformMat3=function(t,e,i){var n=e[0],a=e[1],c=e[2];return t[0]=n*i[0]+a*i[3]+c*i[6],t[1]=n*i[1]+a*i[4]+c*i[7],t[2]=n*i[2]+a*i[5]+c*i[8],t},o.transformMat4=Li,o.transformMat4$1=js,o.transformQuat=Tf,o.transitionTileAABBinECEF=Lm,o.translate=Wl,o.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=Y,o.uniqueId=Ot,o.updateGlobeVertexNormal=function(t,e,i,n,a){const c=5*e+2;t.float32[c+0]=i,t.float32[c+1]=n,t.float32[c+2]=a},o.validateCustomStyleLayer=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=t=>pn(Cs(t)),o.validateFog=t=>pn(_u(t)),o.validateLayer=t=>pn(Ma(t)),o.validateLight=t=>pn(mu(t)),o.validateSource=t=>pn(du(t)),o.validateStyle=Ol,o.validateTerrain=t=>pn(Ca(t)),o.values=Si,o.vectorTile=Zu,o.version=Ce,o.warnOnce=$t,o.window=re,o.wrap=fr}),Q(["./shared"],function(o){function re(Z){if(typeof Z=="number"||typeof Z=="boolean"||typeof Z=="string"||Z==null)return JSON.stringify(Z);if(Array.isArray(Z)){let L="[";for(const q of Z)L+=`${re(q)},`;return`${L}]`}let z="{";for(const L of Object.keys(Z).sort())z+=`${L}:${re(Z[L])},`;return`${z}}`}function Ce(Z){let z="";for(const L of o.refProperties)z+=`/${re(Z[L])}`;return z}class Xe{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,L){for(const K of z)this._layerConfigs[K.id]=K,(this._layers[K.id]=o.createStyleLayer(K)).compileFilter(),this.keyCache[K.id]&&delete this.keyCache[K.id];for(const K of L)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const q=function(K,se){const de={};for(let le=0;le<K.length;le++){const me=se&&se[K[le].id]||Ce(K[le]);se&&(se[K[le].id]=me);let De=de[me];De||(De=de[me]=[]),De.push(K[le])}const pe=[];for(const le in de)pe.push(de[le]);return pe}(o.values(this._layerConfigs),this.keyCache);for(const K of q){const se=K.map(Ke=>this._layers[Ke.id]),de=se[0];if(de.visibility==="none")continue;const pe=de.source||"";let le=this.familiesBySource[pe];le||(le=this.familiesBySource[pe]={});const me=de.sourceLayer||"_geojsonTileLayer";let De=le[me];De||(De=le[me]=[]),De.push(se)}}}class Ge{loadTile(z,L){const{uid:q,encoding:K,rawImageData:se,padding:de,buildQuadTree:pe}=z,le=o.window.ImageBitmap&&se instanceof o.window.ImageBitmap?this.getImageData(se,de):se;L(null,new o.DEMData(q,le,K,de<1,pe))}getImageData(z,L){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const q=this.offscreenCanvasContext.getImageData(-L,-L,z.width+2*L,z.height+2*L);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),q}}var We=function Z(z,L){var q,K=z&&z.type;if(K==="FeatureCollection")for(q=0;q<z.features.length;q++)Z(z.features[q],L);else if(K==="GeometryCollection")for(q=0;q<z.geometries.length;q++)Z(z.geometries[q],L);else if(K==="Feature")Z(z.geometry,L);else if(K==="Polygon")Ve(z.coordinates,L);else if(K==="MultiPolygon")for(q=0;q<z.coordinates.length;q++)Ve(z.coordinates[q],L);return z};function Ve(Z,z){if(Z.length!==0){Ze(Z[0],z);for(var L=1;L<Z.length;L++)Ze(Z[L],!z)}}function Ze(Z,z){for(var L=0,q=0,K=0,se=Z.length,de=se-1;K<se;de=K++){var pe=(Z[K][0]-Z[de][0])*(Z[de][1]+Z[K][1]),le=L+pe;q+=Math.abs(L)>=Math.abs(pe)?L-le+pe:pe-le+L,L=le}L+q>=0!=!!z&&Z.reverse()}const Ft=o.VectorTileFeature.prototype.toGeoJSON;class Ct{constructor(z){this._feature=z,this.extent=o.EXTENT,this.type=z.type,this.properties=z.tags,"id"in z&&!isNaN(z.id)&&(this.id=parseInt(z.id,10))}loadGeometry(){if(this._feature.type===1){const z=[];for(const L of this._feature.geometry)z.push([new o.pointGeometry(L[0],L[1])]);return z}{const z=[];for(const L of this._feature.geometry){const q=[];for(const K of L)q.push(new o.pointGeometry(K[0],K[1]));z.push(q)}return z}}toGeoJSON(z,L,q){return Ft.call(this,z,L,q)}}class rt{constructor(z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=z.length,this._features=z}feature(z){return new Ct(this._features[z])}}var Ne={exports:{}},at=o.pointGeometry,St=o.vectorTile.VectorTileFeature,Se=dt;function dt(Z,z){this.options=z||{},this.features=Z,this.length=Z.length}function Pi(Z,z){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=z||4096}dt.prototype.feature=function(Z){return new Pi(this.features[Z],this.options.extent)},Pi.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var z=0;z<Z.length;z++){for(var L=Z[z],q=[],K=0;K<L.length;K++)q.push(new at(L[K][0],L[K][1]));this.geometry.push(q)}return this.geometry},Pi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,z=1/0,L=-1/0,q=1/0,K=-1/0,se=0;se<Z.length;se++)for(var de=Z[se],pe=0;pe<de.length;pe++){var le=de[pe];z=Math.min(z,le.x),L=Math.max(L,le.x),q=Math.min(q,le.y),K=Math.max(K,le.y)}return[z,q,L,K]},Pi.prototype.toGeoJSON=St.prototype.toGeoJSON;var kt=o.pbf,gt=Se;function ei(Z){var z=new kt;return function(L,q){for(var K in L.layers)q.writeMessage(3,rr,L.layers[K])}(Z,z),z.finish()}function rr(Z,z){var L;z.writeVarintField(15,Z.version||1),z.writeStringField(1,Z.name||""),z.writeVarintField(5,Z.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<Z.length;L++)q.feature=Z.feature(L),z.writeMessage(2,Tr,q);var K=q.keys;for(L=0;L<K.length;L++)z.writeStringField(3,K[L]);var se=q.values;for(L=0;L<se.length;L++)z.writeMessage(4,fr,se[L])}function Tr(Z,z){var L=Z.feature;L.id!==void 0&&z.writeVarintField(1,L.id),z.writeMessage(2,ii,Z),z.writeVarintField(3,L.type),z.writeMessage(4,Wi,L)}function ii(Z,z){var L=Z.feature,q=Z.keys,K=Z.values,se=Z.keycache,de=Z.valuecache;for(var pe in L.properties){var le=L.properties[pe],me=se[pe];if(le!==null){me===void 0&&(q.push(pe),se[pe]=me=q.length-1),z.writeVarint(me);var De=typeof le;De!=="string"&&De!=="boolean"&&De!=="number"&&(le=JSON.stringify(le));var Ke=De+":"+le,Be=de[Ke];Be===void 0&&(K.push(le),de[Ke]=Be=K.length-1),z.writeVarint(Be)}}}function ji(Z,z){return(z<<3)+(7&Z)}function Tt(Z){return Z<<1^Z>>31}function Wi(Z,z){for(var L=Z.loadGeometry(),q=Z.type,K=0,se=0,de=L.length,pe=0;pe<de;pe++){var le=L[pe],me=1;q===1&&(me=le.length),z.writeVarint(ji(1,me));for(var De=q===3?le.length-1:le.length,Ke=0;Ke<De;Ke++){Ke===1&&q!==1&&z.writeVarint(ji(2,De-1));var Be=le[Ke].x-K,mt=le[Ke].y-se;z.writeVarint(Tt(Be)),z.writeVarint(Tt(mt)),K+=Be,se+=mt}q===3&&z.writeVarint(ji(7,1))}}function fr(Z,z){var L=typeof Z;L==="string"?z.writeStringField(1,Z):L==="boolean"?z.writeBooleanField(7,Z):L==="number"&&(Z%1!=0?z.writeDoubleField(3,Z):Z<0?z.writeSVarintField(6,Z):z.writeVarintField(5,Z))}function Mr(Z,z,L,q,K,se){if(K-q<=L)return;const de=q+K>>1;Si(Z,z,de,q,K,se%2),Mr(Z,z,L,q,de-1,se+1),Mr(Z,z,L,de+1,K,se+1)}function Si(Z,z,L,q,K,se){for(;K>q;){if(K-q>600){const me=K-q+1,De=L-q+1,Ke=Math.log(me),Be=.5*Math.exp(2*Ke/3),mt=.5*Math.sqrt(Ke*Be*(me-Be)/me)*(De-me/2<0?-1:1);Si(Z,z,L,Math.max(q,Math.floor(L-De*Be/me+mt)),Math.min(K,Math.floor(L+(me-De)*Be/me+mt)),se)}const de=z[2*L+se];let pe=q,le=K;for(Ye(Z,z,q,L),z[2*K+se]>de&&Ye(Z,z,q,K);pe<le;){for(Ye(Z,z,pe,le),pe++,le--;z[2*pe+se]<de;)pe++;for(;z[2*le+se]>de;)le--}z[2*q+se]===de?Ye(Z,z,q,le):(le++,Ye(Z,z,le,K)),le<=L&&(q=le+1),L<=le&&(K=le-1)}}function Ye(Z,z,L,q){ft(Z,L,q),ft(z,2*L,2*q),ft(z,2*L+1,2*q+1)}function ft(Z,z,L){const q=Z[z];Z[z]=Z[L],Z[L]=q}function Ot(Z,z,L,q){const K=Z-L,se=z-q;return K*K+se*se}Ne.exports=ei,Ne.exports.fromVectorTileJs=ei,Ne.exports.fromGeojsonVt=function(Z,z){z=z||{};var L={};for(var q in Z)L[q]=new gt(Z[q].features,z),L[q].name=q,L[q].version=z.version,L[q].extent=z.extent;return ei({layers:L})},Ne.exports.GeoJSONWrapper=gt;const Ut=Z=>Z[0],Gt=Z=>Z[1];class ti{constructor(z,L=Ut,q=Gt,K=64,se=Float64Array){this.nodeSize=K,this.points=z;const de=z.length<65536?Uint16Array:Uint32Array,pe=this.ids=new de(z.length),le=this.coords=new se(2*z.length);for(let me=0;me<z.length;me++)pe[me]=me,le[2*me]=L(z[me]),le[2*me+1]=q(z[me]);Mr(pe,le,K,0,pe.length-1,0)}range(z,L,q,K){return function(se,de,pe,le,me,De,Ke){const Be=[0,se.length-1,0],mt=[];let pt,lt;for(;Be.length;){const wt=Be.pop(),Dt=Be.pop(),Kt=Be.pop();if(Dt-Kt<=Ke){for(let yi=Kt;yi<=Dt;yi++)pt=de[2*yi],lt=de[2*yi+1],pt>=pe&&pt<=me&&lt>=le&&lt<=De&&mt.push(se[yi]);continue}const ct=Math.floor((Kt+Dt)/2);pt=de[2*ct],lt=de[2*ct+1],pt>=pe&&pt<=me&&lt>=le&&lt<=De&&mt.push(se[ct]);const hi=(wt+1)%2;(wt===0?pe<=pt:le<=lt)&&(Be.push(Kt),Be.push(ct-1),Be.push(hi)),(wt===0?me>=pt:De>=lt)&&(Be.push(ct+1),Be.push(Dt),Be.push(hi))}return mt}(this.ids,this.coords,z,L,q,K,this.nodeSize)}within(z,L,q){return function(K,se,de,pe,le,me){const De=[0,K.length-1,0],Ke=[],Be=le*le;for(;De.length;){const mt=De.pop(),pt=De.pop(),lt=De.pop();if(pt-lt<=me){for(let hi=lt;hi<=pt;hi++)Ot(se[2*hi],se[2*hi+1],de,pe)<=Be&&Ke.push(K[hi]);continue}const wt=Math.floor((lt+pt)/2),Dt=se[2*wt],Kt=se[2*wt+1];Ot(Dt,Kt,de,pe)<=Be&&Ke.push(K[wt]);const ct=(mt+1)%2;(mt===0?de-le<=Dt:pe-le<=Kt)&&(De.push(lt),De.push(wt-1),De.push(ct)),(mt===0?de+le>=Dt:pe+le>=Kt)&&(De.push(wt+1),De.push(pt),De.push(ct))}return Ke}(this.ids,this.coords,z,L,q,this.nodeSize)}}const gi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Z=>Z},ri=Math.fround||(Ii=new Float32Array(1),Z=>(Ii[0]=+Z,Ii[0]));var Ii;class Ai{constructor(z){this.options=an(Object.create(gi),z),this.trees=new Array(this.options.maxZoom+1)}load(z){const{log:L,minZoom:q,maxZoom:K,nodeSize:se}=this.options;L&&console.time("total time");const de=`prepare ${z.length} points`;L&&console.time(de),this.points=z;let pe=[];for(let le=0;le<z.length;le++)z[le].geometry&&pe.push(Oi(z[le],le));this.trees[K+1]=new ti(pe,po,Qo,se,Float32Array),L&&console.timeEnd(de);for(let le=K;le>=q;le--){const me=+Date.now();pe=this._cluster(pe,le),this.trees[le]=new ti(pe,po,Qo,se,Float32Array),L&&console.log("z%d: %d clusters in %dms",le,pe.length,+Date.now()-me)}return L&&console.timeEnd("total time"),this}getClusters(z,L){let q=((z[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,z[1]));let se=z[2]===180?180:((z[2]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)q=-180,se=180;else if(q>se){const De=this.getClusters([q,K,180,de],L),Ke=this.getClusters([-180,K,se,de],L);return De.concat(Ke)}const pe=this.trees[this._limitZoom(L)],le=pe.range(It(q),qi(de),It(se),qi(K)),me=[];for(const De of le){const Ke=pe.points[De];me.push(Ke.numPoints?$t(Ke):this.points[Ke.index])}return me}getChildren(z){const L=this._getOriginId(z),q=this._getOriginZoom(z),K="No cluster with the specified id.",se=this.trees[q];if(!se)throw new Error(K);const de=se.points[L];if(!de)throw new Error(K);const pe=this.options.radius/(this.options.extent*Math.pow(2,q-1)),le=se.within(de.x,de.y,pe),me=[];for(const De of le){const Ke=se.points[De];Ke.parentId===z&&me.push(Ke.numPoints?$t(Ke):this.points[Ke.index])}if(me.length===0)throw new Error(K);return me}getLeaves(z,L,q){const K=[];return this._appendLeaves(K,z,L=L||10,q=q||0,0),K}getTile(z,L,q){const K=this.trees[this._limitZoom(z)],se=Math.pow(2,z),{extent:de,radius:pe}=this.options,le=pe/de,me=(q-le)/se,De=(q+1+le)/se,Ke={features:[]};return this._addTileFeatures(K.range((L-le)/se,me,(L+1+le)/se,De),K.points,L,q,se,Ke),L===0&&this._addTileFeatures(K.range(1-le/se,me,1,De),K.points,se,q,se,Ke),L===se-1&&this._addTileFeatures(K.range(0,me,le/se,De),K.points,-1,q,se,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(z){let L=this._getOriginZoom(z)-1;for(;L<=this.options.maxZoom;){const q=this.getChildren(z);if(L++,q.length!==1)break;z=q[0].properties.cluster_id}return L}_appendLeaves(z,L,q,K,se){const de=this.getChildren(L);for(const pe of de){const le=pe.properties;if(le&&le.cluster?se+le.point_count<=K?se+=le.point_count:se=this._appendLeaves(z,le.cluster_id,q,K,se):se<K?se++:z.push(pe),z.length===q)break}return se}_addTileFeatures(z,L,q,K,se,de){for(const pe of z){const le=L[pe],me=le.numPoints;let De,Ke,Be;if(me)De=Ci(le),Ke=le.x,Be=le.y;else{const lt=this.points[le.index];De=lt.properties,Ke=It(lt.geometry.coordinates[0]),Be=qi(lt.geometry.coordinates[1])}const mt={type:1,geometry:[[Math.round(this.options.extent*(Ke*se-q)),Math.round(this.options.extent*(Be*se-K))]],tags:De};let pt;me?pt=le.id:this.options.generateId?pt=le.index:this.points[le.index].id&&(pt=this.points[le.index].id),pt!==void 0&&(mt.id=pt),de.features.push(mt)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,L){const q=[],{radius:K,extent:se,reduce:de,minPoints:pe}=this.options,le=K/(se*Math.pow(2,L));for(let me=0;me<z.length;me++){const De=z[me];if(De.zoom<=L)continue;De.zoom=L;const Ke=this.trees[L+1],Be=Ke.within(De.x,De.y,le),mt=De.numPoints||1;let pt=mt;for(const lt of Be){const wt=Ke.points[lt];wt.zoom>L&&(pt+=wt.numPoints||1)}if(pt>mt&&pt>=pe){let lt=De.x*mt,wt=De.y*mt,Dt=de&&mt>1?this._map(De,!0):null;const Kt=(me<<5)+(L+1)+this.points.length;for(const ct of Be){const hi=Ke.points[ct];if(hi.zoom<=L)continue;hi.zoom=L;const yi=hi.numPoints||1;lt+=hi.x*yi,wt+=hi.y*yi,hi.parentId=Kt,de&&(Dt||(Dt=this._map(De,!0)),de(Dt,this._map(hi)))}De.parentId=Kt,q.push(Mi(lt/pt,wt/pt,Kt,pt,Dt))}else if(q.push(De),pt>1)for(const lt of Be){const wt=Ke.points[lt];wt.zoom<=L||(wt.zoom=L,q.push(wt))}}return q}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,L){if(z.numPoints)return L?an({},z.properties):z.properties;const q=this.points[z.index].properties,K=this.options.map(q);return L&&K===q?an({},K):K}}function Mi(Z,z,L,q,K){return{x:ri(Z),y:ri(z),zoom:1/0,id:L,parentId:-1,numPoints:q,properties:K}}function Oi(Z,z){const[L,q]=Z.geometry.coordinates;return{x:ri(It(L)),y:ri(qi(q)),zoom:1/0,index:z,parentId:-1}}function $t(Z){return{type:"Feature",id:Z.id,properties:Ci(Z),geometry:{type:"Point",coordinates:[(z=Z.x,360*(z-.5)),sn(Z.y)]}};var z}function Ci(Z){const z=Z.numPoints,L=z>=1e4?`${Math.round(z/1e3)}k`:z>=1e3?Math.round(z/100)/10+"k":z;return an(an({},Z.properties),{cluster:!0,cluster_id:Z.id,point_count:z,point_count_abbreviated:L})}function It(Z){return Z/360+.5}function qi(Z){const z=Math.sin(Z*Math.PI/180),L=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return L<0?0:L>1?1:L}function sn(Z){const z=(180-360*Z)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function an(Z,z){for(const L in z)Z[L]=z[L];return Z}function po(Z){return Z.x}function Qo(Z){return Z.y}function vn(Z,z,L,q){for(var K,se=q,de=L-z>>1,pe=L-z,le=Z[z],me=Z[z+1],De=Z[L],Ke=Z[L+1],Be=z+3;Be<L;Be+=3){var mt=Hs(Z[Be],Z[Be+1],le,me,De,Ke);if(mt>se)K=Be,se=mt;else if(mt===se){var pt=Math.abs(Be-de);pt<pe&&(K=Be,pe=pt)}}se>q&&(K-z>3&&vn(Z,z,K,q),Z[K+2]=se,L-K>3&&vn(Z,K,L,q))}function Hs(Z,z,L,q,K,se){var de=K-L,pe=se-q;if(de!==0||pe!==0){var le=((Z-L)*de+(z-q)*pe)/(de*de+pe*pe);le>1?(L=K,q=se):le>0&&(L+=de*le,q+=pe*le)}return(de=Z-L)*de+(pe=z-q)*pe}function cr(Z,z,L,q){var K={id:Z===void 0?null:Z,type:z,geometry:L,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(se){var de=se.geometry,pe=se.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")bn(se,de);else if(pe==="Polygon"||pe==="MultiLineString")for(var le=0;le<de.length;le++)bn(se,de[le]);else if(pe==="MultiPolygon")for(le=0;le<de.length;le++)for(var me=0;me<de[le].length;me++)bn(se,de[le][me])}(K),K}function bn(Z,z){for(var L=0;L<z.length;L+=3)Z.minX=Math.min(Z.minX,z[L]),Z.minY=Math.min(Z.minY,z[L+1]),Z.maxX=Math.max(Z.maxX,z[L]),Z.maxY=Math.max(Z.maxY,z[L+1])}function fo(Z,z,L,q){if(z.geometry){var K=z.geometry.coordinates,se=z.geometry.type,de=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),pe=[],le=z.id;if(L.promoteId?le=z.properties[L.promoteId]:L.generateId&&(le=q||0),se==="Point")es(K,pe);else if(se==="MultiPoint")for(var me=0;me<K.length;me++)es(K[me],pe);else if(se==="LineString")mo(K,pe,de,!1);else if(se==="MultiLineString"){if(L.lineMetrics){for(me=0;me<K.length;me++)mo(K[me],pe=[],de,!1),Z.push(cr(le,"LineString",pe,z.properties));return}wn(K,pe,de,!1)}else if(se==="Polygon")wn(K,pe,de,!0);else{if(se!=="MultiPolygon"){if(se==="GeometryCollection"){for(me=0;me<z.geometry.geometries.length;me++)fo(Z,{id:le,geometry:z.geometry.geometries[me],properties:z.properties},L,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(me=0;me<K.length;me++){var De=[];wn(K[me],De,de,!0),pe.push(De)}}Z.push(cr(le,se,pe,z.properties))}}function es(Z,z){z.push(ts(Z[0])),z.push(_o(Z[1])),z.push(0)}function mo(Z,z,L,q){for(var K,se,de=0,pe=0;pe<Z.length;pe++){var le=ts(Z[pe][0]),me=_o(Z[pe][1]);z.push(le),z.push(me),z.push(0),pe>0&&(de+=q?(K*me-le*se)/2:Math.sqrt(Math.pow(le-K,2)+Math.pow(me-se,2))),K=le,se=me}var De=z.length-3;z[2]=1,vn(z,0,De,L),z[De+2]=1,z.size=Math.abs(de),z.start=0,z.end=z.size}function wn(Z,z,L,q){for(var K=0;K<Z.length;K++){var se=[];mo(Z[K],se,L,q),z.push(se)}}function ts(Z){return Z/360+.5}function _o(Z){var z=Math.sin(Z*Math.PI/180),L=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return L<0?0:L>1?1:L}function Er(Z,z,L,q,K,se,de,pe){if(q/=z,se>=(L/=z)&&de<q)return Z;if(de<L||se>=q)return null;for(var le=[],me=0;me<Z.length;me++){var De=Z[me],Ke=De.geometry,Be=De.type,mt=K===0?De.minX:De.minY,pt=K===0?De.maxX:De.maxY;if(mt>=L&&pt<q)le.push(De);else if(!(pt<L||mt>=q)){var lt=[];if(Be==="Point"||Be==="MultiPoint")is(Ke,lt,L,q,K);else if(Be==="LineString")go(Ke,lt,L,q,K,!1,pe.lineMetrics);else if(Be==="MultiLineString")En(Ke,lt,L,q,K,!1);else if(Be==="Polygon")En(Ke,lt,L,q,K,!0);else if(Be==="MultiPolygon")for(var wt=0;wt<Ke.length;wt++){var Dt=[];En(Ke[wt],Dt,L,q,K,!0),Dt.length&&lt.push(Dt)}if(lt.length){if(pe.lineMetrics&&Be==="LineString"){for(wt=0;wt<lt.length;wt++)le.push(cr(De.id,Be,lt[wt],De.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(lt.length===1?(Be="LineString",lt=lt[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=lt.length===3?"Point":"MultiPoint"),le.push(cr(De.id,Be,lt,De.tags))}}}return le.length?le:null}function is(Z,z,L,q,K){for(var se=0;se<Z.length;se+=3){var de=Z[se+K];de>=L&&de<=q&&(z.push(Z[se]),z.push(Z[se+1]),z.push(Z[se+2]))}}function go(Z,z,L,q,K,se,de){for(var pe,le,me=Tn(Z),De=K===0?Ys:yo,Ke=Z.start,Be=0;Be<Z.length-3;Be+=3){var mt=Z[Be],pt=Z[Be+1],lt=Z[Be+2],wt=Z[Be+3],Dt=Z[Be+4],Kt=K===0?mt:pt,ct=K===0?wt:Dt,hi=!1;de&&(pe=Math.sqrt(Math.pow(mt-wt,2)+Math.pow(pt-Dt,2))),Kt<L?ct>L&&(le=De(me,mt,pt,wt,Dt,L),de&&(me.start=Ke+pe*le)):Kt>q?ct<q&&(le=De(me,mt,pt,wt,Dt,q),de&&(me.start=Ke+pe*le)):rs(me,mt,pt,lt),ct<L&&Kt>=L&&(le=De(me,mt,pt,wt,Dt,L),hi=!0),ct>q&&Kt<=q&&(le=De(me,mt,pt,wt,Dt,q),hi=!0),!se&&hi&&(de&&(me.end=Ke+pe*le),z.push(me),me=Tn(Z)),de&&(Ke+=pe)}var yi=Z.length-3;mt=Z[yi],pt=Z[yi+1],lt=Z[yi+2],(Kt=K===0?mt:pt)>=L&&Kt<=q&&rs(me,mt,pt,lt),yi=me.length-3,se&&yi>=3&&(me[yi]!==me[0]||me[yi+1]!==me[1])&&rs(me,me[0],me[1],me[2]),me.length&&z.push(me)}function Tn(Z){var z=[];return z.size=Z.size,z.start=Z.start,z.end=Z.end,z}function En(Z,z,L,q,K,se){for(var de=0;de<Z.length;de++)go(Z[de],z,L,q,K,se,!1)}function rs(Z,z,L,q){Z.push(z),Z.push(L),Z.push(q)}function Ys(Z,z,L,q,K,se){var de=(se-z)/(q-z);return Z.push(se),Z.push(L+(K-L)*de),Z.push(1),de}function yo(Z,z,L,q,K,se){var de=(se-L)/(K-L);return Z.push(z+(q-z)*de),Z.push(se),Z.push(1),de}function Sn(Z,z){for(var L=[],q=0;q<Z.length;q++){var K,se=Z[q],de=se.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")K=xo(se.geometry,z);else if(de==="MultiLineString"||de==="Polygon"){K=[];for(var pe=0;pe<se.geometry.length;pe++)K.push(xo(se.geometry[pe],z))}else if(de==="MultiPolygon")for(K=[],pe=0;pe<se.geometry.length;pe++){for(var le=[],me=0;me<se.geometry[pe].length;me++)le.push(xo(se.geometry[pe][me],z));K.push(le)}L.push(cr(se.id,de,K,se.tags))}return L}function xo(Z,z){var L=[];L.size=Z.size,Z.start!==void 0&&(L.start=Z.start,L.end=Z.end);for(var q=0;q<Z.length;q+=3)L.push(Z[q]+z,Z[q+1],Z[q+2]);return L}function vo(Z,z){if(Z.transformed)return Z;var L,q,K,se=1<<Z.z,de=Z.x,pe=Z.y;for(L=0;L<Z.features.length;L++){var le=Z.features[L],me=le.geometry,De=le.type;if(le.geometry=[],De===1)for(q=0;q<me.length;q+=2)le.geometry.push(Fr(me[q],me[q+1],z,se,de,pe));else for(q=0;q<me.length;q++){var Ke=[];for(K=0;K<me[q].length;K+=2)Ke.push(Fr(me[q][K],me[q][K+1],z,se,de,pe));le.geometry.push(Ke)}}return Z.transformed=!0,Z}function Fr(Z,z,L,q,K,se){return[Math.round(L*(Z*q-K)),Math.round(L*(z*q-se))]}function bo(Z,z,L,q,K){for(var se=z===K.maxZoom?0:K.tolerance/((1<<z)*K.extent),de={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:q,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<Z.length;pe++){de.numFeatures++,Ks(de,Z[pe],se,K);var le=Z[pe].minX,me=Z[pe].minY,De=Z[pe].maxX,Ke=Z[pe].maxY;le<de.minX&&(de.minX=le),me<de.minY&&(de.minY=me),De>de.maxX&&(de.maxX=De),Ke>de.maxY&&(de.maxY=Ke)}return de}function Ks(Z,z,L,q){var K=z.geometry,se=z.type,de=[];if(se==="Point"||se==="MultiPoint")for(var pe=0;pe<K.length;pe+=3)de.push(K[pe]),de.push(K[pe+1]),Z.numPoints++,Z.numSimplified++;else if(se==="LineString")wo(de,K,Z,L,!1,!1);else if(se==="MultiLineString"||se==="Polygon")for(pe=0;pe<K.length;pe++)wo(de,K[pe],Z,L,se==="Polygon",pe===0);else if(se==="MultiPolygon")for(var le=0;le<K.length;le++){var me=K[le];for(pe=0;pe<me.length;pe++)wo(de,me[pe],Z,L,!0,pe===0)}if(de.length){var De=z.tags||null;if(se==="LineString"&&q.lineMetrics){for(var Ke in De={},z.tags)De[Ke]=z.tags[Ke];De.mapbox_clip_start=K.start/K.size,De.mapbox_clip_end=K.end/K.size}var Be={geometry:de,type:se==="Polygon"||se==="MultiPolygon"?3:se==="LineString"||se==="MultiLineString"?2:1,tags:De};z.id!==null&&(Be.id=z.id),Z.features.push(Be)}}function wo(Z,z,L,q,K,se){var de=q*q;if(q>0&&z.size<(K?de:q))L.numPoints+=z.length/3;else{for(var pe=[],le=0;le<z.length;le+=3)(q===0||z[le+2]>de)&&(L.numSimplified++,pe.push(z[le]),pe.push(z[le+1])),L.numPoints++;K&&function(me,De){for(var Ke=0,Be=0,mt=me.length,pt=mt-2;Be<mt;pt=Be,Be+=2)Ke+=(me[Be]-me[pt])*(me[Be+1]+me[pt+1]);if(Ke>0===De)for(Be=0,mt=me.length;Be<mt/2;Be+=2){var lt=me[Be],wt=me[Be+1];me[Be]=me[mt-2-Be],me[Be+1]=me[mt-1-Be],me[mt-2-Be]=lt,me[mt-1-Be]=wt}}(pe,se),Z.push(pe)}}function qn(Z,z){var L=(z=this.options=function(K,se){for(var de in se)K[de]=se[de];return K}(Object.create(this.options),z)).debug;if(L&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function(K,se){var de=[];if(K.type==="FeatureCollection")for(var pe=0;pe<K.features.length;pe++)fo(de,K.features[pe],se,pe);else fo(de,K.type==="Feature"?K:{geometry:K},se);return de}(Z,z);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function(K,se){var de=se.buffer/se.extent,pe=K,le=Er(K,1,-1-de,de,0,-1,2,se),me=Er(K,1,1-de,2+de,0,-1,2,se);return(le||me)&&(pe=Er(K,1,-de,1+de,0,-1,2,se)||[],le&&(pe=Sn(le,1).concat(pe)),me&&(pe=pe.concat(Sn(me,-1)))),pe}(q,z),q.length&&this.splitTile(q,0,0,0),L&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function To(Z,z,L){return 32*((1<<Z)*L+z)+Z}function Ur(Z,z){const L=Z.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const q=this._geoJSONIndex.getTile(L.z,L.x,L.y);if(!q)return z(null,null);const K=new rt(q.features);let se=Ne.exports(K);se.byteOffset===0&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),z(null,{vectorTile:K,rawData:se.buffer})}qn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},qn.prototype.splitTile=function(Z,z,L,q,K,se,de){for(var pe=[Z,z,L,q],le=this.options,me=le.debug;pe.length;){q=pe.pop(),L=pe.pop(),z=pe.pop(),Z=pe.pop();var De=1<<z,Ke=To(z,L,q),Be=this.tiles[Ke];if(!Be&&(me>1&&console.time("creation"),Be=this.tiles[Ke]=bo(Z,z,L,q,le),this.tileCoords.push({z,x:L,y:q}),me)){me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,L,q,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));var mt="z"+z;this.stats[mt]=(this.stats[mt]||0)+1,this.total++}if(Be.source=Z,K){if(z===le.maxZoom||z===K)continue;var pt=1<<K-z;if(L!==Math.floor(se/pt)||q!==Math.floor(de/pt))continue}else if(z===le.indexMaxZoom||Be.numPoints<=le.indexMaxPoints)continue;if(Be.source=null,Z.length!==0){me>1&&console.time("clipping");var lt,wt,Dt,Kt,ct,hi,yi=.5*le.buffer/le.extent,qr=.5-yi,An=.5+yi,Cr=1+yi;lt=wt=Dt=Kt=null,ct=Er(Z,De,L-yi,L+An,0,Be.minX,Be.maxX,le),hi=Er(Z,De,L+qr,L+Cr,0,Be.minX,Be.maxX,le),Z=null,ct&&(lt=Er(ct,De,q-yi,q+An,1,Be.minY,Be.maxY,le),wt=Er(ct,De,q+qr,q+Cr,1,Be.minY,Be.maxY,le),ct=null),hi&&(Dt=Er(hi,De,q-yi,q+An,1,Be.minY,Be.maxY,le),Kt=Er(hi,De,q+qr,q+Cr,1,Be.minY,Be.maxY,le),hi=null),me>1&&console.timeEnd("clipping"),pe.push(lt||[],z+1,2*L,2*q),pe.push(wt||[],z+1,2*L,2*q+1),pe.push(Dt||[],z+1,2*L+1,2*q),pe.push(Kt||[],z+1,2*L+1,2*q+1)}}},qn.prototype.getTile=function(Z,z,L){var q=this.options,K=q.extent,se=q.debug;if(Z<0||Z>24)return null;var de=1<<Z,pe=To(Z,z=(z%de+de)%de,L);if(this.tiles[pe])return vo(this.tiles[pe],K);se>1&&console.log("drilling down to z%d-%d-%d",Z,z,L);for(var le,me=Z,De=z,Ke=L;!le&&me>0;)me--,De=Math.floor(De/2),Ke=Math.floor(Ke/2),le=this.tiles[To(me,De,Ke)];return le&&le.source?(se>1&&console.log("found parent tile z%d-%d-%d",me,De,Ke),se>1&&console.time("drilling down"),this.splitTile(le.source,me,De,Ke,Z,z,L),se>1&&console.timeEnd("drilling down"),this.tiles[pe]?vo(this.tiles[pe],K):null):null};class In extends o.VectorTileWorkerSource{constructor(z,L,q,K,se){super(z,L,q,K,Ur),se&&(this.loadGeoJSON=se)}loadData(z,L){const q=z&&z.request,K=q&&q.collectResourceTiming;this.loadGeoJSON(z,(se,de)=>{if(se||!de)return L(se);if(typeof de!="object")return L(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{We(de,!0);try{if(z.filter){const le=o.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(De=>`${De.key}: ${De.message}`).join(", "));de={type:"FeatureCollection",features:de.features.filter(De=>le.value.evaluate({zoom:0},De))}}this._geoJSONIndex=z.cluster?new Ai(function({superclusterOptions:le,clusterProperties:me}){if(!me||!le)return le;const De={},Ke={},Be={accumulated:null,zoom:0},mt={properties:null},pt=Object.keys(me);for(const lt of pt){const[wt,Dt]=me[lt],Kt=o.createExpression(Dt),ct=o.createExpression(typeof wt=="string"?[wt,["accumulated"],["get",lt]]:wt);De[lt]=Kt.value,Ke[lt]=ct.value}return le.map=lt=>{mt.properties=lt;const wt={};for(const Dt of pt)wt[Dt]=De[Dt].evaluate(Be,mt);return wt},le.reduce=(lt,wt)=>{mt.properties=wt;for(const Dt of pt)Be.accumulated=lt[Dt],lt[Dt]=Ke[Dt].evaluate(Be,mt)},le}(z)).load(de.features):function(le,me){return new qn(le,me)}(de,z.geojsonVtOptions)}catch(le){return L(le)}this.loaded={};const pe={};if(K){const le=o.getPerformanceMeasurement(q);le&&(pe.resourceTiming={},pe.resourceTiming[z.source]=JSON.parse(JSON.stringify(le)))}L(null,pe)}})}reloadTile(z,L){const q=this.loaded;return q&&q[z.uid]?super.reloadTile(z,L):this.loadTile(z,L)}loadGeoJSON(z,L){if(z.request)o.getJSON(z.request,L);else{if(typeof z.data!="string")return L(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));try{return L(null,JSON.parse(z.data))}catch{return L(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(z,L){try{L(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(q){L(q)}}getClusterChildren(z,L){try{L(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(q){L(q)}}getClusterLeaves(z,L){try{L(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(q){L(q)}}}class ns{constructor(z){this.self=z,this.actor=new o.Actor(z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:In},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(L,q)=>{if(this.workerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.workerSourceTypes[L]=q},this.self.registerRTLTextPlugin=L=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=L.applyArabicShaping,o.plugin.processBidirectionalText=L.processBidirectionalText,o.plugin.processStyledBidirectionalText=L.processStyledBidirectionalText}}clearCaches(z,L,q){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z],q()}checkIfReady(z,L,q){q()}setReferrer(z,L){this.referrer=L}spriteLoaded(z,L){this.isSpriteLoaded[z]=L;for(const q in this.workerSources[z]){const K=this.workerSources[z][q];for(const se in K)K[se]instanceof o.VectorTileWorkerSource&&(K[se].isSpriteLoaded=L,K[se].fire(new o.Event("isSpriteLoaded")))}}setImages(z,L,q){this.availableImages[z]=L;for(const K in this.workerSources[z]){const se=this.workerSources[z][K];for(const de in se)se[de].availableImages=L}q()}enableTerrain(z,L,q){this.terrain=L,q()}setProjection(z,L){this.projections[z]=o.getProjection(L)}setLayers(z,L,q){this.getLayerIndex(z).replace(L),q()}updateLayers(z,L,q){this.getLayerIndex(z).update(L.layers,L.removedIds),q()}loadTile(z,L,q){const K=this.enableTerrain?o.extend({enableTerrain:this.terrain},L):L;K.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,L.type,L.source).loadTile(K,q)}loadDEMTile(z,L,q){const K=this.enableTerrain?o.extend({buildQuadTree:this.terrain},L):L;this.getDEMWorkerSource(z,L.source).loadTile(K,q)}reloadTile(z,L,q){const K=this.enableTerrain?o.extend({enableTerrain:this.terrain},L):L;K.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,L.type,L.source).reloadTile(K,q)}abortTile(z,L,q){this.getWorkerSource(z,L.type,L.source).abortTile(L,q)}removeTile(z,L,q){this.getWorkerSource(z,L.type,L.source).removeTile(L,q)}removeSource(z,L,q){if(!this.workerSources[z]||!this.workerSources[z][L.type]||!this.workerSources[z][L.type][L.source])return;const K=this.workerSources[z][L.type][L.source];delete this.workerSources[z][L.type][L.source],K.removeSource!==void 0?K.removeSource(L,q):q()}loadWorkerSource(z,L,q){try{this.self.importScripts(L.url),q()}catch(K){q(K.toString())}}syncRTLPluginState(z,L,q){try{o.plugin.setState(L);const K=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&K!=null){this.self.importScripts(K);const se=o.plugin.isParsed();q(se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),se)}}catch(K){q(K.toString())}}getAvailableImages(z){let L=this.availableImages[z];return L||(L=[]),L}getLayerIndex(z){let L=this.layerIndexes[z];return L||(L=this.layerIndexes[z]=new Xe),L}getWorkerSource(z,L,q){if(this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][L]||(this.workerSources[z][L]={}),!this.workerSources[z][L][q]){const K={send:(se,de,pe,le,me,De)=>{this.actor.send(se,de,pe,z,me,De)},scheduler:this.actor.scheduler};this.workerSources[z][L][q]=new this.workerSourceTypes[L](K,this.getLayerIndex(z),this.getAvailableImages(z),this.isSpriteLoaded[z])}return this.workerSources[z][L][q]}getDEMWorkerSource(z,L){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][L]||(this.demWorkerSources[z][L]=new Ge),this.demWorkerSources[z][L]}enforceCacheSizeLimit(z,L){o.enforceCacheSizeLimit(L)}getWorkerPerformanceMetrics(z,L,q){q(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ns(self)),ns}),Q(["./shared"],function(o){function re(l,r){if(Array.isArray(l)){if(!Array.isArray(r)||l.length!==r.length)return!1;for(let s=0;s<l.length;s++)if(!re(l[s],r[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&r!==null){if(typeof r!="object"||Object.keys(l).length!==Object.keys(r).length)return!1;for(const s in l)if(!re(l[s],r[s]))return!1;return!0}return l===r}var Ce=Xe;function Xe(l){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,p,f=new Blob([""],{type:"text/javascript"}),g=URL.createObjectURL(f);try{p=new Worker(g),u=!0}catch{u=!1}return p&&p.terminate(),URL.revokeObjectURL(g),u}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var u=document.createElement("canvas");u.width=u.height=1;var p=u.getContext("2d");if(!p)return!1;var f=p.getImageData(0,0,1,1);return f&&f.width===u.width}()?(Ge[s=r&&r.failIfMajorPerformanceCaveat]===void 0&&(Ge[s]=function(u){var p,f=function(g){var v=document.createElement("canvas"),w=Object.create(Xe.webGLContextAttributes);return w.failIfMajorPerformanceCaveat=g,v.getContext("webgl",w)||v.getContext("experimental-webgl",w)}(u);if(!f)return!1;try{p=f.createShader(f.VERTEX_SHADER)}catch{return!1}return!(!p||f.isContextLost())&&(f.shaderSource(p,"void main() {}"),f.compileShader(p),f.getShaderParameter(p,f.COMPILE_STATUS)===!0)}(s)),Ge[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(l)}var Ge={};function We(l,r,s){const u=o.window.document.createElement(l);return r!==void 0&&(u.className=r),s&&s.appendChild(u),u}function Ve(l,r,s){const u=o.window.document.createElementNS("http://www.w3.org/2000/svg",l);for(const p of Object.keys(r))u.setAttributeNS(null,p,r[p]);return s&&s.appendChild(u),u}Xe.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ze=o.window.document&&o.window.document.documentElement.style,Ft=Ze&&Ze.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ct;function rt(){Ze&&Ft&&(Ct=Ze[Ft],Ze[Ft]="none")}function Ne(){Ze&&Ft&&(Ze[Ft]=Ct)}function at(l){l.preventDefault(),l.stopPropagation(),o.window.removeEventListener("click",at,!0)}function St(){o.window.addEventListener("click",at,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",at,!0)},0)}function Se(l,r){const s=l.getBoundingClientRect();return kt(l,s,r)}function dt(l,r){const s=l.getBoundingClientRect(),u=[];for(let p=0;p<r.length;p++)u.push(kt(l,s,r[p]));return u}function Pi(l){return o.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function kt(l,r,s){const u=l.offsetWidth===r.width?1:l.offsetWidth/r.width;return new o.pointGeometry((s.clientX-r.left)*u,(s.clientY-r.top)*u)}function gt(l,r){var s=r[0],u=r[1],p=r[2],f=r[3],g=s*f-p*u;return g?(l[0]=f*(g=1/g),l[1]=-u*g,l[2]=-p*g,l[3]=s*g,l):null}function ei(l){const{userImage:r}=l;return!!(r&&r.render&&r.render())&&(l.data.replace(new Uint8Array(r.data.buffer)),!0)}class rr extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:s,callback:u}of this.requestors)this._notify(s,u);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,s){this._validate(r,s)&&(this.images[r]=s)}_validate(r,s){let u=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),u=!1),u}_validateStretch(r,s){if(!r)return!0;let u=0;for(const p of r){if(p[0]<u||p[1]<p[0]||s<p[1])return!1;u=p[1]}return!0}_validateContent(r,s){return!(r&&(r.length!==4||r[0]<0||s.data.width<r[0]||r[1]<0||s.data.height<r[1]||r[2]<0||s.data.width<r[2]||r[3]<0||s.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,s){s.version=this.images[r].version+1,this.images[r]=s,this.updatedImages[r]=!0}removeImage(r){const s=this.images[r];delete this.images[r],delete this.patterns[r],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,s){let u=!0;if(!this.isLoaded())for(const p of r)this.images[p]||(u=!1);this.isLoaded()||u?this._notify(r,s):this.requestors.push({ids:r,callback:s})}_notify(r,s){const u={};for(const p of r){this.images[p]||this.fire(new o.Event("styleimagemissing",{id:p}));const f=this.images[p];f?u[p]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:Boolean(f.userImage&&f.userImage.render)}:o.warnOnce(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,u)}getPixelSize(){const{width:r,height:s}=this.atlasImage;return{width:r,height:s}}getPattern(r){const s=this.patterns[r],u=this.getImage(r);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const p={w:u.data.width+2,h:u.data.height+2,x:0,y:0},f=new o.ImagePosition(p,u);this.patterns[r]={bin:p,position:f}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const s=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(r,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const f in this.patterns)r.push(this.patterns[f].bin);const{w:s,h:u}=o.potpack(r),p=this.atlasImage;p.resize({width:s||1,height:u||1});for(const f in this.patterns){const{bin:g}=this.patterns[f],v=g.x+1,w=g.y+1,A=this.images[f].data,I=A.width,P=A.height;o.RGBAImage.copy(A,p,{x:0,y:0},{x:v,y:w},{width:I,height:P}),o.RGBAImage.copy(A,p,{x:0,y:P-1},{x:v,y:w-1},{width:I,height:1}),o.RGBAImage.copy(A,p,{x:0,y:0},{x:v,y:w+P},{width:I,height:1}),o.RGBAImage.copy(A,p,{x:I-1,y:0},{x:v-1,y:w},{width:1,height:P}),o.RGBAImage.copy(A,p,{x:0,y:0},{x:v+I,y:w},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const s of r){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.images[s];ei(u)&&this.updateImage(s,u)}}}const Tr=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(l,r){return function([s,u,p]){const f=o.degToRad(u+90),g=o.degToRad(p);return{x:s*Math.cos(f)*Math.sin(g),y:s*Math.sin(f)*Math.sin(g),z:s*Math.cos(g),azimuthal:u,polar:p}}(l.expression.evaluate(r))}interpolate(l,r,s){return{x:o.number(l.x,r.x,s),y:o.number(l.y,r.y,s),z:o.number(l.z,r.z,s),azimuthal:o.number(l.azimuthal,r.azimuthal,s),polar:o.number(l.polar,r.polar,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),ii="-transition";class ji extends o.Evented{constructor(r){super(),this._transitionable=new o.Transitionable(Tr),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,s={}){if(!this._validate(o.validateLight,r,s))for(const u in r){const p=r[u];o.endsWith(u,ii)?this._transitionable.setTransition(u.slice(0,-ii.length),p):this._transitionable.setValue(u,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,u){return(!u||u.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Tt=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),Wi="-transition";class fr extends o.Evented{constructor(r,s){super(),this._transitionable=new o.Transitionable(Tt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(r){for(const s in r){const u=r[s];o.endsWith(s,Wi)?this._transitionable.setTransition(s.slice(0,-Wi.length),u):this._transitionable.setValue(s,u)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function Mr(l,r,s,u){const p=o.smoothstep(45,65,s),[f,g]=Si(l,u),v=o.length(r);let w=1-Math.min(1,Math.exp((v-f)/(g-f)*-6));return w*=w*w,w=Math.min(1,1.00747*w),w*p*l.alpha}function Si(l,r){const s=.5/Math.tan(.5*r);return[l.range[0]+s,l.range[1]+s]}const Ye=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),ft="-transition";class Ot extends o.Evented{constructor(r,s){super(),this._transitionable=new o.Transitionable(Ye),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=s}get state(){const r=this._transform,s=r.projection.name==="globe",u=o.globeToMercatorTransition(r.zoom),p=this.properties.get("range"),f=[.5,3];return{range:s?[o.number(f[0],p[0],u),o.number(f[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,s={}){if(!this._validate(o.validateFog,r,s)){for(const u of Object.keys(o.spec.fog))r&&r[u]===void 0&&(r[u]=o.spec.fog[u].default);for(const u in r){const p=r[u];o.endsWith(u,ft)?this._transitionable.setTransition(u.slice(0,-ft.length),p):this._transitionable.setValue(u,p)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,r))*s.a}getOpacityAtLatLng(r,s){return this._transform.projection.supportsFog?function(u,p,f){const g=o.MercatorCoordinate.fromLngLat(p),v=f.elevation?f.elevation.getAtPointOrZero(g):0,w=[g.x,g.y,v];return o.transformMat4(w,w,f.mercatorFogMatrix),Mr(u,w,f.pitch,f._fov)}(this.state,r,s):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Si(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,u){return(!u||u.validate!==!1)&&o.emitValidationErrors(this,r.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Ut{constructor(r,s){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const u=this.workerPool.acquire(this.id);for(let p=0;p<u.length;p++){const f=new Ut.Actor(u[p],s,this.id);f.name=`Worker ${p}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,s,u){o.asyncAll(this.actors,(p,f)=>{p.send(r,s,f)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Gt(l,r,s){return r*(o.EXTENT/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}Ut.Actor=o.Actor;class ti{constructor(r,s,u,p){this.screenBounds=r,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(r,s){let u,p;if(r instanceof o.pointGeometry||typeof r[0]=="number"){const f=o.pointGeometry.convert(r);u=[f],p=s.isPointAboveHorizon(f)}else{const f=o.pointGeometry.convert(r[0]),g=o.pointGeometry.convert(r[1]);u=[f,g],p=o.polygonizeBounds(f,g).every(v=>s.isPointAboveHorizon(v))}return new ti(u,s.getCameraPoint(),p,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const s=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],p=o.polygonizeBounds(s,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(p[3]=this.cameraPoint)),o.bufferConvexPolygon(p,r)}bufferedCameraGeometryGlobe(r){const s=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],p=o.polygonizeBounds(s,u,r),f=this.cameraPoint.clone();switch(3*((f.y>s.y)+(f.y>u.y))+((f.x>s.x)+(f.x>u.x))){case 0:p[0]=f,p[4]=f.clone();break;case 1:p.splice(1,0,f);break;case 2:p[1]=f;break;case 3:p.splice(4,0,f);break;case 5:p.splice(2,0,f);break;case 6:p[3]=f;break;case 7:p.splice(3,0,f);break;case 8:p[2]=f}return p}containsTile(r,s,u,p=0){const f=r.queryPadding/s._pixelsPerMercatorPixel+1,g=u?this._bufferedCameraMercator(f,s):this._bufferedScreenMercator(f,s);let v=r.tileID.wrap+(g.unwrapped?p:0);const w=g.polygon.map(F=>o.getTilePoint(r.tileTransform,F,v));if(!o.polygonIntersectsBox(w,0,0,o.EXTENT,o.EXTENT))return;v=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const A=this.screenGeometryMercator.polygon.map(F=>o.getTileVec3(r.tileTransform,F,v)),I=A.map(F=>new o.pointGeometry(F[0],F[1])),P=s.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),R=o.getTileVec3(r.tileTransform,P,v),N=A.map(F=>{const U=o.sub(F,F,R);return o.normalize(U,U),new o.Ray(R,U)}),j=Gt(r,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:N,bufferedTilespaceGeometry:w,bufferedTilespaceBounds:(V=o.getBounds(w),V.min.x=o.clamp(V.min.x,0,o.EXTENT),V.min.y=o.clamp(V.min.y,0,o.EXTENT),V.max.x=o.clamp(V.max.x,0,o.EXTENT),V.max.y=o.clamp(V.max.y,0,o.EXTENT),V),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:j};var V}_bufferedScreenMercator(r,s){const u=Ii(r);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),s):{polygon:this.bufferedScreenGeometry(r).map(f=>s.pointCoordinate3D(f)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(r,s){const u=Ii(r);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),s):{polygon:this.bufferedCameraGeometry(r).map(f=>s.pointCoordinate3D(f)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(r,s){const u=function(f,g){const v=o.multiply([],g.pixelMatrix,g.globeMatrix),w=[0,-o.GLOBE_RADIUS,0,1],A=[0,o.GLOBE_RADIUS,0,1],I=[0,0,0,1];o.transformMat4$1(w,w,v),o.transformMat4$1(A,A,v),o.transformMat4$1(I,I,v);const P=new o.pointGeometry(w[0]/w[3],w[1]/w[3]),R=new o.pointGeometry(A[0]/A[3],A[1]/A[3]),N=o.polygonContainsPoint(f,P)&&w[3]<I[3],j=o.polygonContainsPoint(f,R)&&A[3]<I[3];if(!N&&!j)return null;const V=function(ce,xe,_e){for(let ue=1;ue<ce.length;ue++){const Ue=ri(xe.pointCoordinate3D(ce[ue-1]).x),fe=ri(xe.pointCoordinate3D(ce[ue]).x);if(_e<0){if(Ue<fe)return{idx:ue,t:-Ue/(fe-1-Ue)}}else if(fe<Ue)return{idx:ue,t:(1-Ue)/(fe+1-Ue)}}return null}(f,g,N?-1:1);if(!V)return null;const{idx:F,t:U}=V;let X=F>1?gi(f.slice(0,F),g):[],G=F<f.length?gi(f.slice(F),g):[];X=X.map(ce=>new o.pointGeometry(ri(ce.x),ce.y)),G=G.map(ce=>new o.pointGeometry(ri(ce.x),ce.y));const Y=[...X];Y.length===0&&Y.push(G[G.length-1]);const oe=o.number(Y[Y.length-1].y,(G.length===0?X[0]:G[0]).y,U);let ie;return ie=N?[new o.pointGeometry(0,oe),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,oe)]:[new o.pointGeometry(1,oe),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,oe)],Y.push(...ie),G.length===0?Y.push(X[0]):Y.push(...G),{polygon:Y.map(ce=>new o.MercatorCoordinate(ce.x,ce.y)),unwrapped:!1}}(r,s);if(u)return u;const p=function(f,g){let v=!1,w=-1/0,A=0;for(let P=0;P<f.length-1;P++)f[P].x>w&&(w=f[P].x,A=P);for(let P=0;P<f.length-1;P++){const R=(A+P)%(f.length-1),N=f[R],j=f[R+1];Math.abs(N.x-j.x)>.5&&(N.x<j.x?(N.x+=1,R===0&&(f[f.length-1].x+=1)):(j.x+=1,R+1===f.length-1&&(f[0].x+=1)),v=!0)}const I=o.mercatorXfromLng(g.center.lng);return v&&I<Math.abs(I-1)&&f.forEach(P=>{P.x-=1}),{polygon:f,unwrapped:v}}(gi(r,s).map(f=>new o.pointGeometry(ri(f.x),f.y)),s);return{polygon:p.polygon.map(f=>new o.MercatorCoordinate(f.x,f.y)),unwrapped:p.unwrapped}}}function gi(l,r){return o.resample(l,s=>{const u=r.pointCoordinate3D(s);s.x=u.x,s.y=u.y},1/256)}function ri(l){return l<0?1+l%1:l%1}function Ii(l){return 100*l|0}function Ai(l,r,s,u,p){const f=function(g,v){if(g)return p(g);if(v){l.url&&v.tiles&&l.tiles&&delete l.tiles;const w=o.pick(o.extend(v,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(w.vectorLayers=v.vector_layers,w.vectorLayerIds=w.vectorLayers.map(A=>A.id)),w.tiles=r.canonicalizeTileset(w,l.url),p(null,w)}};return l.url?o.getJSON(r.transformRequest(r.normalizeSourceURL(l.url,null,s,u),o.ResourceType.Source),f):o.exported.frame(()=>f(null,l))}class Mi{constructor(r,s,u){this.bounds=o.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const s=Math.pow(2,r.z),u=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),p=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),f=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),g=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return r.x>=u&&r.x<f&&r.y>=p&&r.y<g}}class Oi{constructor(r,s,u){this.context=r;const p=r.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(u),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $t={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ci{constructor(r,s,u,p){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=r;const f=r.gl;this.buffer=f.createBuffer(),r.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,s){for(let u=0;u<this.attributes.length;u++){const p=s.attributes[this.attributes[u].name];p!==void 0&&r.enableVertexAttribArray(p)}}setVertexAttribPointers(r,s,u){for(let p=0;p<this.attributes.length;p++){const f=this.attributes[p],g=s.attributes[f.name];g!==void 0&&r.vertexAttribPointer(g,f.components,r[$t[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class It{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qi extends It{getDefault(){return o.Color.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class sn extends It{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class an extends It{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class po extends It{getDefault(){return[!0,!0,!0,!0]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Qo extends It{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class vn extends It{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Hs extends It{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const s=this.current;(r.func!==s.func||r.ref!==s.ref||r.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class cr extends It{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class bn extends It{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=r,this.dirty=!1}}class fo extends It{getDefault(){return[0,1]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class es extends It{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=r,this.dirty=!1}}class mo extends It{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class wn extends It{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.BLEND):s.disable(s.BLEND),this.current=r,this.dirty=!1}}class ts extends It{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class _o extends It{getDefault(){return o.Color.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Er extends It{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class is extends It{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=r,this.dirty=!1}}class go extends It{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Tn extends It{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class En extends It{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class rs extends It{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ys extends It{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class yo extends It{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Sn extends It{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class xo extends It{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class vo extends It{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Fr extends It{getDefault(){return null}set(r){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class bo extends It{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Ks extends It{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class wo extends It{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class qn extends It{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class To extends It{constructor(r,s){super(r),this.context=r,this.parent=s}getDefault(){return null}}class Ur extends To{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class In extends To{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ns extends In{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Z{constructor(r,s,u,p){this.context=r,this.width=s,this.height=u;const f=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Ur(r,f),p&&(this.depthAttachment=new In(r,f))}destroy(){const r=this.context.gl,s=this.colorAttachment.get();if(s&&r.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&r.deleteRenderbuffer(u)}r.deleteFramebuffer(this.framebuffer)}}class z{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new qi(this),this.clearDepth=new sn(this),this.clearStencil=new an(this),this.colorMask=new po(this),this.depthMask=new Qo(this),this.stencilMask=new vn(this),this.stencilFunc=new Hs(this),this.stencilOp=new cr(this),this.stencilTest=new bn(this),this.depthRange=new fo(this),this.depthTest=new es(this),this.depthFunc=new mo(this),this.blend=new wn(this),this.blendFunc=new ts(this),this.blendColor=new _o(this),this.blendEquation=new Er(this),this.cullFace=new is(this),this.cullFaceSide=new go(this),this.frontFace=new Tn(this),this.program=new En(this),this.activeTexture=new rs(this),this.viewport=new Ys(this),this.bindFramebuffer=new yo(this),this.bindRenderbuffer=new Sn(this),this.bindTexture=new xo(this),this.bindVertexBuffer=new vo(this),this.bindElementBuffer=new Fr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new bo(this),this.pixelStoreUnpack=new Ks(this),this.pixelStoreUnpackPremultiplyAlpha=new wo(this),this.pixelStoreUnpackFlipY=new qn(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,s){return new Oi(this,r,s)}createVertexBuffer(r,s,u){return new Ci(this,r,s,u)}createRenderbuffer(r,s,u){const p=this.gl,f=p.createRenderbuffer();return this.bindRenderbuffer.set(f),p.renderbufferStorage(p.RENDERBUFFER,r,s,u),this.bindRenderbuffer.set(null),f}createFramebuffer(r,s,u){return new Z(this,r,s,u)}clear({color:r,depth:s,stencil:u}){const p=this.gl;let f=0;r&&(f|=p.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(f|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(f|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(f)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){re(r.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class L extends o.Evented{constructor(r,s,u,p){super(),this.id=r,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ai(this._options,this.map._requestManager,null,null,(r,s)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new Mi(s.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(s.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,s){const u=o.exported.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);r.request=o.getImage(this.map._requestManager.transformRequest(p,o.ResourceType.Tile),(f,g,v,w)=>(delete r.request,r.aborted?(r.state="unloaded",s(null)):f?(r.state="errored",s(f)):g?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:v,expires:w}),r.setTexture(g,this.map.painter),r.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void s(null)):s(null)))}static loadTileData(r,s,u){r.setTexture(s,u)}static unloadTileData(r,s){r.texture&&s.saveTileTexture(r.texture)}abortTile(r,s){r.request&&(r.request.cancel(),delete r.request),s()}unloadTile(r,s){r.texture&&this.map.painter.saveTileTexture(r.texture),s()}hasTransition(){return!1}}let q;function K(l,r,s,u,p,f,g,v){const w=[l,s,p,r,u,f,1,1,1],A=[g,v,1],I=o.adjoint([],w),[P,R,N]=o.transformMat3(A,A,o.transpose(I,I));return o.multiply$1(w,[P,0,0,0,R,0,0,0,N],w)}class se extends o.Evented{constructor(r,s,u,p){super(),this.id=r,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s,this._dirty=!1}load(r,s){this._loaded=s||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(u,p)=>{if(this._imageRequest=null,this._loaded=!0,u)this.fire(new o.ErrorEvent(u));else if(p){const{HTMLImageElement:f}=o.window;this.image=p instanceof f?o.exported.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const s=r.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(u){let p=1/0,f=1/0,g=-1/0,v=-1/0;for(const P of u)p=Math.min(p,P.x),f=Math.min(f,P.y),g=Math.max(g,P.x),v=Math.max(v,P.y);const w=Math.max(g-p,v-f),A=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),I=Math.pow(2,A);return new o.CanonicalTileID(A,Math.floor((p+g)/2*I),Math.floor((f+v)/2*I))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const w in this.tiles){const A=this.tiles[w];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}if(this._boundsArray)return;const s=o.tileTransform(this.tileID,this.map.transform.projection),[u,p,f,g]=this.coordinates.map(w=>{const A=s.projection.project(w[0],w[1]);return o.getTilePoint(s,A)._round()});this.perspectiveTransform=function(w,A,I,P,R,N,j,V,F,U){const X=K(0,0,w,0,0,A,w,A),G=K(I,P,R,N,j,V,F,U);return o.multiply$1(G,o.adjoint(X,X),G),[G[6]/G[8]*w/o.EXTENT,G[7]/G[8]*A/o.EXTENT]}(this.width,this.height,u.x,u.y,p.x,p.y,g.x,g.y,f.x,f.y);const v=this._boundsArray=new o.StructArrayLayout4i8;v.emplaceBack(u.x,u.y,0,0),v.emplaceBack(p.x,p.y,o.EXTENT,0),v.emplaceBack(g.x,g.y,0,o.EXTENT),v.emplaceBack(f.x,f.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(v,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,s=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(r,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,s){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},s(null)):(r.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const de={vector:class extends o.Evented{constructor(l,r,s,u){if(super(),this.id=l,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(r,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(l){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map._worldview;this._tileJSONRequest=Ai(this._options,this.map._requestManager,r,s,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.ErrorEvent(u))):p&&(o.extend(this,p),p.bounds&&(this.tileBounds=new Mi(p.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(p.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(u)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const l=this.map.style._getSourceCaches(this.id);for(const r of l)r.clearTiles()})}setSourceProperty(l){l(),this.reload()}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(l,r){const s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(s,o.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(u.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=r:l.request=l.actor.send("reloadTile",u,p.bind(this));else if(l.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",u,p.bind(this),void 0,!0);else{const f=o.loadVectorTile.call({deduped:this._deduped},u,(g,v)=>{g||!v?p.call(this,g):(u.data={cacheControl:v.cacheControl,expires:v.expires,rawData:v.rawData.slice(0)},l.actor&&l.actor.send("loadTile",u,p.bind(this),void 0,!0))},!0);l.request={cancel:f}}function p(f,g){return delete l.request,l.aborted?r(null):f&&f.status!==404?r(f):(g&&g.resourceTiming&&(l.resourceTiming=g.resourceTiming),this.map._refreshExpiredTiles&&g&&l.setExpiryData(g),l.loadVectorData(g,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:L,"raster-dem":class extends L{constructor(l,r,s,u){super(l,r,s,u),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(l,r){const s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,f){p&&(l.state="errored",r(p)),f&&(l.dem=f,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",r(null))}l.request=o.getImage(this.map._requestManager.transformRequest(s,o.ResourceType.Tile),function(p,f,g,v){if(delete l.request,l.aborted)l.state="unloaded",r(null);else if(p)l.state="errored",r(p);else if(f){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:g,expires:v});const w=o.window.ImageBitmap&&f instanceof o.window.ImageBitmap&&(q==null&&(q=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),q),A=1-(f.width-o.prevPowerOfTwo(f.width))/2;A<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const I=w?f:o.exported.getImageData(f,A),P={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:I,encoding:this.encoding,padding:A};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",P,u.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){const r=l.canonical,s=Math.pow(2,r.z),u=(r.x-1+s)%s,p=r.x===0?l.wrap-1:l.wrap,f=(r.x+1+s)%s,g=r.x+1===s?l.wrap+1:l.wrap,v={};return v[new o.OverscaledTileID(l.overscaledZ,p,r.z,u,r.y).key]={backfilled:!1},v[new o.OverscaledTileID(l.overscaledZ,g,r.z,f,r.y).key]={backfilled:!1},r.y>0&&(v[new o.OverscaledTileID(l.overscaledZ,p,r.z,u,r.y-1).key]={backfilled:!1},v[new o.OverscaledTileID(l.overscaledZ,l.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},v[new o.OverscaledTileID(l.overscaledZ,g,r.z,f,r.y-1).key]={backfilled:!1}),r.y+1<s&&(v[new o.OverscaledTileID(l.overscaledZ,p,r.z,u,r.y+1).key]={backfilled:!1},v[new o.OverscaledTileID(l.overscaledZ,l.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},v[new o.OverscaledTileID(l.overscaledZ,g,r.z,f,r.y+1).key]={backfilled:!1}),v}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded"}},geojson:class extends o.Evented{constructor(l,r,s,u){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(u),this._data=r.data,this._options=o.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const p=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*p,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*p,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*p,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}getClusterExpansionZoom(l,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},r),this}getClusterChildren(l,r){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},r),this}getClusterLeaves(l,r,s,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:r,offset:s},u),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const l=o.extend({},this.workerOptions),r=this._data;typeof r=="string"?(l.request=this.map._requestManager.transformRequest(o.exported.resolveURL(r),o.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(s,u)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.ErrorEvent(s));else{const p={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&u&&u.resourceTiming&&u.resourceTiming[this.id]&&(p.resourceTiming=u.resourceTiming[this.id]),this.fire(new o.Event("data",p)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,r){const s=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(s,{type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(u,p)=>(delete l.request,l.unloadVectorData(),l.aborted?r(null):u?r(u):(l.loadVectorData(p,this.map.painter,s==="reloadTile"),r(null))),void 0,s==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends se{constructor(l,r,s,u){super(l,r,s,u),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const r of l.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.ResourceType.Source).url);o.getVideo(this.urls,(r,s)=>{this._loaded=!0,r?this.fire(new o.ErrorEvent(r)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const r=this.video.seekable;l<r.start(0)||l>r.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,r=l.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(l,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:se,canvas:class extends se{constructor(l,r,s,u){super(l,r,s,u),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(f=>typeof f!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends o.Evented{constructor(l,r,s,u){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=r,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Mi(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this._map=l,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:r,y:s,z:u}=l.canonical;return this._implementation.hasTile({x:r,y:s,z:u})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,r){const{x:s,y:u,z:p}=l.tileID.canonical,f=new o.window.AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:s,y:u,z:p},{signal:f.signal})).then(function(g){return delete l.request,l.aborted?(l.state="unloaded",r(null)):g===void 0?(l.state="errored",r(null)):g===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",r(null)):function(v){return v instanceof o.window.ImageData||v instanceof o.window.HTMLCanvasElement||v instanceof o.window.ImageBitmap||v instanceof o.window.HTMLImageElement}(g)?(this.loadTileData(l,g),l.state="loaded",void r(null)):(l.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(g=>{g.code!==20&&(l.state="errored",r(g))}),l.request.cancel=()=>f.abort()}loadTileData(l,r){L.loadTileData(l,r,this._map.painter)}unloadTileData(l){L.unloadTileData(l,this._map.painter)}unloadTile(l,r){if(this.unloadTileData(l),this._implementation.unloadTile){const{x:s,y:u,z:p}=l.tileID.canonical;this._implementation.unloadTile({x:s,y:u,z:p})}r()}abortTile(l,r){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},pe=function(l,r,s,u){const p=new de[r.type](l,r,s,u);if(p.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${p.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],p),p};function le(l,r){const s=o.identity([]);return o.scale(s,s,[.5*l.width,.5*-l.height,1]),o.translate(s,s,[1,-1,0]),o.multiply(s,s,l.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(s)}function me(l,r,s,u,p,f,g,v=!1){const w=l.tilesIn(u,g,v);w.sort(Ke);const A=[];for(const P of w)A.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(r,s,l._state,P,p,f,le(l.transform,P.tile.tileID),v)});const I=function(P){const R={},N={};for(const j of P){const V=j.queryResults,F=j.wrappedTileID,U=N[F]=N[F]||{};for(const X in V){const G=V[X],Y=U[X]=U[X]||{},oe=R[X]=R[X]||[];for(const ie of G)Y[ie.featureIndex]||(Y[ie.featureIndex]=!0,oe.push(ie))}}return R}(A);for(const P in I)I[P].forEach(R=>{const N=R.feature,j=N.layer;j&&j.type!=="background"&&j.type!=="sky"&&(N.source=j.source,j["source-layer"]&&(N.sourceLayer=j["source-layer"]),N.state=N.id!==void 0?l.getFeatureState(j["source-layer"],N.id):{})});return I}function De(l,r){const s=l.getRenderableIds().map(f=>l.getTileByID(f)),u=[],p={};for(let f=0;f<s.length;f++){const g=s[f],v=g.tileID.canonical.key;p[v]||(p[v]=!0,g.querySourceFeatures(u,r))}return u}function Ke(l,r){const s=l.tileID,u=r.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}function Be(){return Ps.workerClass!=null?new Ps.workerClass:new o.window.Worker(Ps.workerUrl)}const mt="mapboxgl_preloaded_worker_pool";class pt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<pt.workerCount;)this.workers.push(new Be);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mt]}numActive(){return Object.keys(this.active).length}}let lt;function wt(){return lt||(lt=new pt),lt}function Dt(l,r){const s={};for(const u in l)u!=="ref"&&(s[u]=l[u]);return o.refProperties.forEach(u=>{u in r&&(s[u]=r[u])}),s}function Kt(l){l=l.slice();const r=Object.create(null);for(let s=0;s<l.length;s++)r[l[s].id]=l[s];for(let s=0;s<l.length;s++)"ref"in l[s]&&(l[s]=Dt(l[s],r[l[s].ref]));return l}pt.workerCount=2;const ct={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function hi(l,r,s){s.push({command:ct.addSource,args:[l,r[l]]})}function yi(l,r,s){r.push({command:ct.removeSource,args:[l]}),s[l]=!0}function qr(l,r,s,u){yi(l,s,u),hi(l,r,s)}function An(l,r,s){let u;for(u in l[s])if(l[s].hasOwnProperty(u)&&u!=="data"&&!re(l[s][u],r[s][u]))return!1;for(u in r[s])if(r[s].hasOwnProperty(u)&&u!=="data"&&!re(l[s][u],r[s][u]))return!1;return!0}function Cr(l,r,s,u,p,f){let g;for(g in r=r||{},l=l||{})l.hasOwnProperty(g)&&(re(l[g],r[g])||s.push({command:f,args:[u,g,r[g],p]}));for(g in r)r.hasOwnProperty(g)&&!l.hasOwnProperty(g)&&(re(l[g],r[g])||s.push({command:f,args:[u,g,r[g],p]}))}function Me(l){return l.id}function ln(l,r){return l[r.id]=r,l}class Ni{constructor(r,s){this.reset(r,s)}reset(r,s){this.points=r||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.clamp(r,0,1);let s=1,u=this._distances[s];const p=r*this.paddedLength+this.padding;for(;u<p&&s<this._distances.length;)u=this._distances[++s];const f=s-1,g=this._distances[f],v=u-g,w=v>0?(p-g)/v:0;return this.points[f].mult(1-w).add(this.points[s].mult(w))}}class cn{constructor(r,s,u){const p=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(r/u),this.yCellCount=Math.ceil(s/u);for(let g=0;g<this.xCellCount*this.yCellCount;g++)p.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=s,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,s,u,p,f){this._forEachCell(s,u,p,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(f)}insertCircle(r,s,u,p){this._forEachCell(s-p,u-p,s+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(s),this.circles.push(u),this.circles.push(p)}_insertBoxCell(r,s,u,p,f,g){this.boxCells[f].push(g)}_insertCircleCell(r,s,u,p,f,g){this.circleCells[f].push(g)}_query(r,s,u,p,f,g){if(u<0||r>this.width||p<0||s>this.height)return!f&&[];const v=[];if(r<=0&&s<=0&&this.width<=u&&this.height<=p){if(f)return!0;for(let w=0;w<this.boxKeys.length;w++)v.push({key:this.boxKeys[w],x1:this.bboxes[4*w],y1:this.bboxes[4*w+1],x2:this.bboxes[4*w+2],y2:this.bboxes[4*w+3]});for(let w=0;w<this.circleKeys.length;w++){const A=this.circles[3*w],I=this.circles[3*w+1],P=this.circles[3*w+2];v.push({key:this.circleKeys[w],x1:A-P,y1:I-P,x2:A+P,y2:I+P})}return g?v.filter(g):v}return this._forEachCell(r,s,u,p,this._queryCell,v,{hitTest:f,seenUids:{box:{},circle:{}}},g),f?v.length>0:v}_queryCircle(r,s,u,p,f){const g=r-u,v=r+u,w=s-u,A=s+u;if(v<0||g>this.width||A<0||w>this.height)return!p&&[];const I=[];return this._forEachCell(g,w,v,A,this._queryCellCircle,I,{hitTest:p,circle:{x:r,y:s,radius:u},seenUids:{box:{},circle:{}}},f),p?I.length>0:I}query(r,s,u,p,f){return this._query(r,s,u,p,!1,f)}hitTest(r,s,u,p,f){return this._query(r,s,u,p,!0,f)}hitTestCircle(r,s,u,p){return this._queryCircle(r,s,u,!0,p)}_queryCell(r,s,u,p,f,g,v,w){const A=v.seenUids,I=this.boxCells[f];if(I!==null){const R=this.bboxes;for(const N of I)if(!A.box[N]){A.box[N]=!0;const j=4*N;if(r<=R[j+2]&&s<=R[j+3]&&u>=R[j+0]&&p>=R[j+1]&&(!w||w(this.boxKeys[N]))){if(v.hitTest)return g.push(!0),!0;g.push({key:this.boxKeys[N],x1:R[j],y1:R[j+1],x2:R[j+2],y2:R[j+3]})}}}const P=this.circleCells[f];if(P!==null){const R=this.circles;for(const N of P)if(!A.circle[N]){A.circle[N]=!0;const j=3*N;if(this._circleAndRectCollide(R[j],R[j+1],R[j+2],r,s,u,p)&&(!w||w(this.circleKeys[N]))){if(v.hitTest)return g.push(!0),!0;{const V=R[j],F=R[j+1],U=R[j+2];g.push({key:this.circleKeys[N],x1:V-U,y1:F-U,x2:V+U,y2:F+U})}}}}}_queryCellCircle(r,s,u,p,f,g,v,w){const A=v.circle,I=v.seenUids,P=this.boxCells[f];if(P!==null){const N=this.bboxes;for(const j of P)if(!I.box[j]){I.box[j]=!0;const V=4*j;if(this._circleAndRectCollide(A.x,A.y,A.radius,N[V+0],N[V+1],N[V+2],N[V+3])&&(!w||w(this.boxKeys[j])))return g.push(!0),!0}}const R=this.circleCells[f];if(R!==null){const N=this.circles;for(const j of R)if(!I.circle[j]){I.circle[j]=!0;const V=3*j;if(this._circlesCollide(N[V],N[V+1],N[V+2],A.x,A.y,A.radius)&&(!w||w(this.circleKeys[j])))return g.push(!0),!0}}}_forEachCell(r,s,u,p,f,g,v,w){const A=this._convertToXCellCoord(r),I=this._convertToYCellCoord(s),P=this._convertToXCellCoord(u),R=this._convertToYCellCoord(p);for(let N=A;N<=P;N++)for(let j=I;j<=R;j++)if(f.call(this,r,s,u,p,this.xCellCount*j+N,g,v,w))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,s,u,p,f,g){const v=p-r,w=f-s,A=u+g;return A*A>v*v+w*w}_circleAndRectCollide(r,s,u,p,f,g,v){const w=(g-p)/2,A=Math.abs(r-(p+w));if(A>w+u)return!1;const I=(v-f)/2,P=Math.abs(s-(f+I));if(P>I+u)return!1;if(A<=w||P<=I)return!0;const R=A-w,N=P-I;return R*R+N*N<=u*u}}const Lh=Math.tan(85*Math.PI/180);function Sr(l,r,s,u,p,f,g){const v=o.create();if(s)if(f.name==="globe"){const w=o.calculateGlobeLabelMatrix(p,r);o.multiply(v,v,w)}else{const w=gt([],g);v[0]=w[0],v[1]=w[1],v[4]=w[2],v[5]=w[3],u||o.rotateZ(v,v,p.angle)}else o.multiply(v,p.labelPlaneMatrix,l);return v}function Js(l,r,s,u,p,f,g){const v=Sr(l,r,s,u,p,f,g);return f.name==="globe"&&s||(v[2]=v[6]=v[10]=v[14]=0),v}function Lc(l,r,s,u,p,f,g){if(s){if(f.name==="globe"){const v=Sr(l,r,s,u,p,f,g);return o.invert(v,v),o.multiply(v,l,v),v}{const v=o.clone(l),w=o.identity([]);return w[0]=g[0],w[1]=g[1],w[4]=g[2],w[5]=g[3],o.multiply(v,v,w),u||o.rotateZ(v,v,-p.angle),v}}return p.glCoordMatrix}function ur(l,r,s,u){const p=[l,r,s,1];s?o.transformMat4$1(p,p,u):Ti(p,p,u);const f=p[3];return p[0]/=f,p[1]/=f,p[2]/=f,p}function Je(l,r){return Math.min(.5+l/r*.5,1.5)}function jt(l,r){const s=l[0]/l[3],u=l[1]/l[3];return s>=-r[0]&&s<=r[0]&&u>=-r[1]&&u<=r[1]}function Lt(l,r,s,u,p,f,g,v,w,A){const I=s.transform,P=u?l.textSizeData:l.iconSizeData,R=o.evaluateSizeForZoom(P,s.transform.zoom),N=I.projection.name==="globe",j=[256/s.width*2+1,256/s.height*2+1],V=u?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;V.clear();let F=null;N&&(F=u?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const U=l.lineVertexArray,X=u?l.text.placedSymbolArray:l.icon.placedSymbolArray,G=s.transform.width/s.transform.height;let Y,oe=!1;for(let ie=0;ie<X.length;ie++){const ce=X.get(ie),{numGlyphs:xe,writingMode:_e}=ce;if(_e!==o.WritingMode.vertical||oe||Y===o.WritingMode.horizontal||(oe=!0),Y=_e,(ce.hidden||_e===o.WritingMode.vertical)&&!oe){Hi(xe,V);continue}oe=!1;const ue=new o.pointGeometry(ce.tileAnchorX,ce.tileAnchorY);let{x:Ue,y:fe,z:Ae}=I.projection.projectTilePoint(ue.x,ue.y,A.canonical);if(w){const[ut,ot,xt]=w(ue);Ue+=ut,fe+=ot,Ae+=xt}const be=[Ue,fe,Ae,1];if(o.transformMat4$1(be,be,r),!jt(be,j)){Hi(xe,V);continue}const Re=Je(s.transform.cameraToCenterDistance,be[3]),Ee=o.evaluateSizeForFeature(P,R,ce),Pe=g?Ee/Re:Ee*Re,je=ur(Ue,fe,Ae,p);if(je[3]<=0){Hi(xe,V);continue}let he={};const ve=g?null:w,nt=zt(ce,Pe,!1,v,r,p,f,l.glyphOffsetArray,U,V,F,je,ue,he,G,ve,I.projection,A,g);oe=nt.useVertical,ve&&nt.needsFlipping&&(he={}),(nt.notEnoughRoom||oe||nt.needsFlipping&&zt(ce,Pe,!0,v,r,p,f,l.glyphOffsetArray,U,V,F,je,ue,he,G,ve,I.projection,A,g).notEnoughRoom)&&Hi(xe,V)}u?(l.text.dynamicLayoutVertexBuffer.updateData(V),F&&l.text.globeExtVertexBuffer.updateData(F)):(l.icon.dynamicLayoutVertexBuffer.updateData(V),F&&l.icon.globeExtVertexBuffer.updateData(F))}function jr(l,r,s,u,p,f,g,v,w,A,I,P,R,N,j,V){const{lineStartIndex:F,glyphStartIndex:U,segment:X}=v,G=U+v.numGlyphs,Y=F+v.lineLength,oe=r.getoffsetX(U),ie=r.getoffsetX(G-1),ce=Mn(l*oe,s,u,p,f,g,X,F,Y,w,A,I,P,R,!0,N,j,V);if(!ce)return null;const xe=Mn(l*ie,s,u,p,f,g,X,F,Y,w,A,I,P,R,!0,N,j,V);return xe?{first:ce,last:xe}:null}function Zn(l,r,s,u){return l===o.WritingMode.horizontal&&Math.abs(u)>Math.abs(s)?{useVertical:!0}:l===o.WritingMode.vertical?u>0?{needsFlipping:!0}:null:r!==0&&function(p,f){return p===0||Math.abs(f/p)>Lh}(s,u)?r===1?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function zt(l,r,s,u,p,f,g,v,w,A,I,P,R,N,j,V,F,U,X){const G=r/24,Y=l.lineOffsetX*G,oe=l.lineOffsetY*G,{lineStartIndex:ie,glyphStartIndex:ce,numGlyphs:xe,segment:_e,writingMode:ue,flipState:Ue}=l,fe=ie+l.lineLength,Ae=be=>{if(I){const[je,he,ve]=be.up,nt=A.length;o.updateGlobeVertexNormal(I,nt+0,je,he,ve),o.updateGlobeVertexNormal(I,nt+1,je,he,ve),o.updateGlobeVertexNormal(I,nt+2,je,he,ve),o.updateGlobeVertexNormal(I,nt+3,je,he,ve)}const[Re,Ee,Pe]=be.point;o.addDynamicAttributes(A,Re,Ee,Pe,be.angle)};if(xe>1){const be=jr(G,v,Y,oe,s,P,R,l,w,f,N,V,!1,F,U,X);if(!be)return{notEnoughRoom:!0};if(u&&!s){let[Re,Ee,Pe]=be.first.point,[je,he,ve]=be.last.point;[Re,Ee]=ur(Re,Ee,Pe,g),[je,he]=ur(je,he,ve,g);const nt=Zn(ue,Ue,(je-Re)*j,he-Ee);if(l.flipState=nt&&nt.needsFlipping?1:2,nt)return nt}Ae(be.first);for(let Re=ce+1;Re<ce+xe-1;Re++){const Ee=Mn(G*v.getoffsetX(Re),Y,oe,s,P,R,_e,ie,fe,w,f,N,V,!1,!1,F,U,X);if(!Ee)return A.length-=4*(Re-ce),{notEnoughRoom:!0};Ae(Ee)}Ae(be.last)}else{if(u&&!s){const Re=ur(R.x,R.y,0,p),Ee=ie+_e+1,Pe=new o.pointGeometry(w.getx(Ee),w.gety(Ee)),je=ur(Pe.x,Pe.y,0,p),he=je[3]>0?je:Eo(R,Pe,Re,1,p,void 0,F,U.canonical),ve=Zn(ue,Ue,(he[0]-Re[0])*j,he[1]-Re[1]);if(l.flipState=ve&&ve.needsFlipping?1:2,ve)return ve}const be=Mn(G*v.getoffsetX(ce),Y,oe,s,P,R,_e,ie,fe,w,f,N,V,!1,!1,F,U,X);if(!be)return{notEnoughRoom:!0};Ae(be)}return{}}function os(l,r,s,u,p){const{x:f,y:g,z:v}=u.projectTilePoint(l.x,l.y,r);if(!p)return ur(f,g,v,s);const[w,A,I]=p(l);return ur(f+w,g+A,v+I,s)}function Eo(l,r,s,u,p,f,g,v){const w=os(l.sub(r)._unit()._add(l),v,p,g,f);return o.sub(w,s,w),o.normalize(w,w),o.scaleAndAdd(w,s,w,u)}function Mn(l,r,s,u,p,f,g,v,w,A,I,P,R,N,j,V,F,U){const X=u?l-r:l+r;let G=X>0?1:-1,Y=0;u&&(G*=-1,Y=Math.PI),G<0&&(Y+=Math.PI);let oe=v+g+(G>0?0:1)|0,ie=p,ce=p,xe=0,_e=0;const ue=Math.abs(X),Ue=[],fe=[];let Ae=f,be=Ae;const Re=()=>Eo(be,Ae,ce,ue-xe+1,I,R,V,F.canonical);for(;xe+_e<=ue;){if(oe+=G,oe<v||oe>=w)return null;if(ce=ie,be=Ae,Ue.push(ce),N&&fe.push(be),Ae=new o.pointGeometry(A.getx(oe),A.gety(oe)),ie=P[oe],!ie){const xt=os(Ae,F.canonical,I,V,R);ie=xt[3]>0?P[oe]=xt:Re()}xe+=_e,_e=o.distance(ce,ie)}j&&R&&(P[oe]&&(ie=Re(),_e=o.distance(ce,ie)),P[oe]=ie);const Ee=(ue-xe)/_e,Pe=Ae.sub(be)._mult(Ee)._add(be),je=o.sub([],ie,ce),he=o.scaleAndAdd([],ce,je,Ee);let ve=[0,0,1],nt=je[0],ut=je[1];if(U&&(ve=V.upVector(F.canonical,Pe.x,Pe.y),ve[0]!==0||ve[1]!==0||ve[2]!==1)){const xt=[ve[2],0,-ve[0]],At=o.cross([],ve,xt);o.normalize(xt,xt),o.normalize(At,At),nt=o.dot(je,xt),ut=o.dot(je,At)}if(s){const xt=o.cross([],ve,je);o.normalize(xt,xt),o.scaleAndAdd(he,he,xt,s*G)}const ot=Y+Math.atan2(ut,nt);return Ue.push(he),N&&fe.push(Pe),{point:he,angle:ot,path:Ue,tilePath:fe,up:ve}}function Hi(l,r){const s=r.length,u=s+4*l;r.resize(u),r.float32.fill(-1/0,4*s,4*u)}function Ti(l,r,s){const u=r[0],p=r[1];return l[0]=s[0]*u+s[4]*p+s[12],l[1]=s[1]*u+s[5]*p+s[13],l[3]=s[3]*u+s[7]*p+s[15],l}const Zr=100;class ss{constructor(r,s,u=new cn(r.width+200,r.height+200,25),p=new cn(r.width+200,r.height+200,25)){this.transform=r,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Zr,this.screenBottomBoundary=r.height+Zr,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=s}placeCollisionBox(r,s,u,p,f,g,v,w){let A=u.projectedAnchorX,I=u.projectedAnchorY,P=u.projectedAnchorZ;const R=u.elevation,N=u.tileID,j=r.getProjection();if(R&&N){const[ie,ce,xe]=j.upVector(N.canonical,u.tileAnchorX,u.tileAnchorY),_e=j.upVectorScale(N.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=ie*R*_e,I+=ce*R*_e,P+=xe*R*_e}const V=this.projectAndGetPerspectiveRatio(v,A,I,P,u.tileID,j.name==="globe"||!!R||this.transform.pitch>0,j),F=g*V.perspectiveRatio,U=(u.x1*s+p.x-u.padding)*F+V.point.x,X=(u.y1*s+p.y-u.padding)*F+V.point.y,G=(u.x2*s+p.x+u.padding)*F+V.point.x,Y=(u.y2*s+p.y+u.padding)*F+V.point.y,oe=V.perspectiveRatio<=.55||V.occluded;return!this.isInsideGrid(U,X,G,Y)||!f&&this.grid.hitTest(U,X,G,Y,w)||oe?{box:[],offscreen:!1,occluded:V.occluded}:{box:[U,X,G,Y],offscreen:this.isOffscreen(U,X,G,Y),occluded:!1}}placeCollisionCircles(r,s,u,p,f,g,v,w,A,I,P,R,N,j,V){const F=[],U=this.transform.elevation,X=r.getProjection(),G=U?U.getAtTileOffsetFunc(V,this.transform.center.lat,this.transform.worldSize,X):null,Y=new o.pointGeometry(u.tileAnchorX,u.tileAnchorY);let{x:oe,y:ie,z:ce}=X.projectTilePoint(Y.x,Y.y,V.canonical);if(G){const[Pe,je,he]=G(Y);oe+=Pe,ie+=je,ce+=he}const xe=X.name==="globe",_e=this.projectAndGetPerspectiveRatio(v,oe,ie,ce,V,xe||!!U||this.transform.pitch>0,X),{perspectiveRatio:ue}=_e,Ue=(P?g/ue:g*ue)/o.ONE_EM,fe=ur(oe,ie,ce,w),Ae=_e.signedDistanceFromCamera>0?jr(Ue,f,u.lineOffsetX*Ue,u.lineOffsetY*Ue,!1,fe,Y,u,p,w,{},U&&!P?G:null,P&&!!U,X,V,P):null;let be=!1,Re=!1,Ee=!0;if(Ae&&!_e.occluded){const Pe=.5*N*ue+j,je=new o.pointGeometry(-100,-100),he=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ve=new Ni,{first:nt,last:ut}=Ae,ot=nt.path.length;let xt=[];for(let et=ot-1;et>=1;et--)xt.push(nt.path[et]);for(let et=1;et<ut.path.length;et++)xt.push(ut.path[et]);const At=2.5*Pe;A&&(xt=xt.map(([et,ni,Yt],pi)=>(G&&!xe&&(Yt=G(pi<ot-1?nt.tilePath[ot-1-pi]:ut.tilePath[pi-ot+2])[2]),ur(et,ni,Yt,A))),xt.some(et=>et[3]<=0)&&(xt=[]));let ht=[];if(xt.length>0){let et=1/0,ni=-1/0,Yt=1/0,pi=-1/0;for(const li of xt)et=Math.min(et,li[0]),Yt=Math.min(Yt,li[1]),ni=Math.max(ni,li[0]),pi=Math.max(pi,li[1]);ni>=je.x&&et<=he.x&&pi>=je.y&&Yt<=he.y&&(ht=[xt.map(li=>new o.pointGeometry(li[0],li[1]))],(et<je.x||ni>he.x||Yt<je.y||pi>he.y)&&(ht=o.clipLine(ht,je.x,je.y,he.x,he.y)))}for(const et of ht){ve.reset(et,.25*Pe);let ni=0;ni=ve.length<=.5*Pe?1:Math.ceil(ve.paddedLength/At)+1;for(let Yt=0;Yt<ni;Yt++){const pi=Yt/Math.max(ni-1,1),li=ve.lerp(pi),gr=li.x+Zr,Ar=li.y+Zr;F.push(gr,Ar,Pe,0);const hr=gr-Pe,Yr=Ar-Pe,xi=gr+Pe,di=Ar+Pe;if(Ee=Ee&&this.isOffscreen(hr,Yr,xi,di),Re=Re||this.isInsideGrid(hr,Yr,xi,di),!s&&this.grid.hitTestCircle(gr,Ar,Pe,R)&&(be=!0,!I))return{circles:[],offscreen:!1,collisionDetected:be,occluded:!1}}}}return{circles:!I&&be||!Re?[]:F,offscreen:Ee,collisionDetected:be,occluded:_e.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let u=1/0,p=1/0,f=-1/0,g=-1/0;for(const I of r){const P=new o.pointGeometry(I.x+Zr,I.y+Zr);u=Math.min(u,P.x),p=Math.min(p,P.y),f=Math.max(f,P.x),g=Math.max(g,P.y),s.push(P)}const v=this.grid.query(u,p,f,g).concat(this.ignoredGrid.query(u,p,f,g)),w={},A={};for(const I of v){const P=I.key;if(w[P.bucketInstanceId]===void 0&&(w[P.bucketInstanceId]={}),w[P.bucketInstanceId][P.featureIndex])continue;const R=[new o.pointGeometry(I.x1,I.y1),new o.pointGeometry(I.x2,I.y1),new o.pointGeometry(I.x2,I.y2),new o.pointGeometry(I.x1,I.y2)];o.polygonIntersectsPolygon(s,R)&&(w[P.bucketInstanceId][P.featureIndex]=!0,A[P.bucketInstanceId]===void 0&&(A[P.bucketInstanceId]=[]),A[P.bucketInstanceId].push(P.featureIndex))}return A}insertCollisionBox(r,s,u,p,f){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:f},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,s,u,p,f){const g=s?this.ignoredGrid:this.grid,v={bucketInstanceId:u,featureIndex:p,collisionGroupID:f};for(let w=0;w<r.length;w+=4)g.insertCircle(v,r[w],r[w+1],r[w+2])}projectAndGetPerspectiveRatio(r,s,u,p,f,g,v){const w=[s,u,p,1];let A=!1;if(p||this.transform.pitch>0){o.transformMat4$1(w,w,r);const P=v.name==="globe";this.fogState&&f&&!P&&(A=function(N,j,V,F,U,X){const G=X.calculateFogTileMatrix(U),Y=[j,V,F];return o.transformMat4(Y,Y,G),Mr(N,Y,X.pitch,X._fov)}(this.fogState,s,u,p,f.toUnwrapped(),this.transform)>.9)}else Ti(w,w,r);const I=w[3];return{point:new o.pointGeometry((w[0]/I+1)/2*this.transform.width+Zr,(-w[1]/I+1)/2*this.transform.height+Zr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/I*.5,1.5),signedDistanceFromCamera:I,occluded:g&&w[2]>I||A}}isOffscreen(r,s,u,p){return u<Zr||r>=this.screenRightBoundary||p<Zr||s>this.screenBottomBoundary}isInsideGrid(r,s,u,p){return u>=0&&r<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const r=o.identity([]);return o.translate(r,r,[-100,-100,0]),r}}function as(l,r,s){const u=r.createTileMatrix(l,l.worldSize,s.toUnwrapped());return o.multiply(new Float32Array(16),l.projMatrix,u)}function ls(l,r,s){if(r.projection.name===s.projection.name)return l.projMatrix;const u=s.clone();return u.setProjection(r.projection),as(u,r.getProjection(),l)}function cs(l,r,s){return r.name===s.projection.name?l.projMatrix:as(s,r,l)}class sl{constructor(r,s,u,p){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?s:-s))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Cn{constructor(r,s,u,p,f,g=!1){this.text=new sl(r?r.text:null,s,u,f),this.icon=new sl(r?r.icon:null,s,p,f),this.clipped=g}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class us{constructor(r,s,u,p=!1){this.text=r,this.icon=s,this.skipFade=u,this.clipped=p}}class Qs{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class al{constructor(r,s,u,p,f){this.bucketInstanceId=r,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=f}}class mr{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const s=++this.maxGroupID;this.collisionGroups[r]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[r]}}function ki(l,r,s,u,p){const{horizontalAlign:f,verticalAlign:g}=o.getAnchorAlignment(l),v=-(f-.5)*r,w=-(g-.5)*s,A=o.evaluateVariableOffset(l,u);return new o.pointGeometry(v+A[0]*p,w+A[1]*p)}function hs(l,r,s,u,p){const f=new o.pointGeometry(l,r);return s&&f._rotate(u?p:-p),f}class ll{constructor(r,s,u,p,f){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new ss(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new mr(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,s,u,p){const f=u.getBucket(s),g=u.latestFeatureIndex;if(!f||!g||s.id!==f.layerIds[0])return;const v=f.layers[0].layout,w=u.collisionBoxArray,A=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),I=u.tileSize/o.EXTENT,P=u.tileID.toUnwrapped();this.transform.setProjection(f.projection);const R=(N=u.tileID,j=f.getProjection(),V=this.transform,j.name===this.projection?V.calculateProjMatrix(N.toUnwrapped()):as(V,j,N));var N,j,V;const F=v.get("text-pitch-alignment")==="map",U=v.get("text-rotation-alignment")==="map";s.compileFilter();const X=s.dynamicFilter(),G=s.dynamicFilterNeedsFeature(),Y=this.transform.calculatePixelsToTileUnitsMatrix(u),oe=Js(R,u.tileID.canonical,F,U,this.transform,f.getProjection(),Y);let ie=null;if(F){const _e=Lc(R,u.tileID.canonical,F,U,this.transform,f.getProjection(),Y);ie=o.multiply([],this.transform.labelPlaneMatrix,_e)}let ce=null;X&&u.latestFeatureIndex&&(ce={unwrappedTileID:P,dynamicFilter:X,dynamicFilterNeedsFeature:G,featureIndex:u.latestFeatureIndex}),this.retainedQueryData[f.bucketInstanceId]=new al(f.bucketInstanceId,g,f.sourceLayerIndex,f.index,u.tileID);const xe={bucket:f,layout:v,posMatrix:R,textLabelPlaneMatrix:oe,labelToScreenMatrix:ie,clippingData:ce,scale:A,textPixelRatio:I,holdingForFade:u.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(f.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(f.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(p)for(const _e of f.sortKeyRanges){const{sortKey:ue,symbolInstanceStart:Ue,symbolInstanceEnd:fe}=_e;r.push({sortKey:ue,symbolInstanceStart:Ue,symbolInstanceEnd:fe,parameters:xe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:xe})}attemptAnchorPlacement(r,s,u,p,f,g,v,w,A,I,P,R,N,j,V,F,U,X){const{textOffset0:G,textOffset1:Y,crossTileID:oe}=R,ie=[G,Y],ce=ki(r,u,p,ie,f),xe=this.collisionIndex.placeCollisionBox(j,f,s,hs(ce.x,ce.y,g,v,this.transform.angle),P,w,A,I.predicate);if(F){const _e=j.getSymbolInstanceIconSize(X,this.transform.zoom,R.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(j,_e,F,hs(ce.x,ce.y,g,v,this.transform.angle),P,w,A,I.predicate).box.length===0)return}if(xe.box.length>0){let _e;return this.prevPlacement&&this.prevPlacement.variableOffsets[oe]&&this.prevPlacement.placements[oe]&&this.prevPlacement.placements[oe].text&&(_e=this.prevPlacement.variableOffsets[oe].anchor),this.variableOffsets[oe]={textOffset:ie,width:u,height:p,anchor:r,textScale:f,prevAnchor:_e},this.markUsedJustification(j,r,R,V),j.allowVerticalPlacement&&(this.markUsedOrientation(j,V,R),this.placedOrientations[oe]=V),{shift:ce,placedGlyphBoxes:xe}}}placeLayerBucketPart(r,s,u,p){const{bucket:f,layout:g,posMatrix:v,textLabelPlaneMatrix:w,labelToScreenMatrix:A,clippingData:I,textPixelRatio:P,holdingForFade:R,collisionBoxArray:N,partiallyEvaluatedTextSize:j,partiallyEvaluatedIconSize:V,collisionGroup:F}=r.parameters,U=g.get("text-optional"),X=g.get("icon-optional"),G=g.get("text-allow-overlap"),Y=g.get("icon-allow-overlap"),oe=g.get("text-rotation-alignment")==="map",ie=g.get("text-pitch-alignment")==="map",ce=g.get("icon-text-fit")!=="none",xe=g.get("symbol-z-order")==="viewport-y";this.transform.setProjection(f.projection);let _e=G&&(Y||!f.hasIconData()||X),ue=Y&&(G||!f.hasTextData()||U);!f.collisionArrays&&N&&f.deserializeCollisionBoxes(N),u&&p&&f.updateCollisionDebugBuffers(this.transform.zoom,N);const Ue=(fe,Ae,be)=>{const{crossTileID:Re,numVerticalGlyphVertices:Ee}=fe;if(I){const xi={zoom:this.transform.zoom,pitch:this.transform.pitch};let di=null;if(I.dynamicFilterNeedsFeature){const Xt=this.retainedQueryData[f.bucketInstanceId];di=I.featureIndex.loadFeature({featureIndex:fe.featureIndex,bucketIndex:Xt.bucketIndex,sourceLayerIndex:Xt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(xi,di,this.retainedQueryData[f.bucketInstanceId].tileID.canonical,new o.pointGeometry(fe.tileAnchorX,fe.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[Re]=new us(!1,!1,!1,!0),void(s[Re]=!0)}if(s[Re])return;if(R)return void(this.placements[Re]=new us(!1,!1,!1));let Pe=!1,je=!1,he=!0,ve=!1,nt=!1,ut=null,ot={box:null,offscreen:null,occluded:null},xt={box:null,offscreen:null,occluded:null},At=null,ht=null,et=null,ni=0,Yt=0,pi=0;be.textFeatureIndex?ni=be.textFeatureIndex:fe.useRuntimeCollisionCircles&&(ni=fe.featureIndex),be.verticalTextFeatureIndex&&(Yt=be.verticalTextFeatureIndex);const li=xi=>{xi.tileID=this.retainedQueryData[f.bucketInstanceId].tileID;const di=this.transform.elevation;(di||xi.elevation)&&(xi.elevation=di?di.getAtTileOffset(xi.tileID,xi.tileAnchorX,xi.tileAnchorY):0)},gr=be.textBox;if(gr){li(gr);const xi=Xt=>{let Di=o.WritingMode.horizontal;if(f.allowVerticalPlacement&&!Xt&&this.prevPlacement){const or=this.prevPlacement.placedOrientations[Re];or&&(this.placedOrientations[Re]=or,Di=or,this.markUsedOrientation(f,Di,fe))}return Di},di=(Xt,Di)=>{if(f.allowVerticalPlacement&&Ee>0&&be.verticalTextBox){for(const or of f.writingModes)if(or===o.WritingMode.vertical?(ot=Di(),xt=ot):ot=Xt(),ot&&ot.box&&ot.box.length)break}else ot=Xt()};if(g.get("text-variable-anchor")){let Xt=g.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Re]){const fi=this.prevPlacement.variableOffsets[Re];Xt.indexOf(fi.anchor)>0&&(Xt=Xt.filter(pr=>pr!==fi.anchor),Xt.unshift(fi.anchor))}const Di=(fi,pr,Ds)=>{const dn=f.getSymbolInstanceTextSize(j,fe,this.transform.zoom,Ae),sr=(fi.x2-fi.x1)*dn+2*fi.padding,Pr=(fi.y2-fi.y1)*dn+2*fi.padding,Kr=ce&&!Y?pr:null;Kr&&li(Kr);let Jr={box:[],offscreen:!1,occluded:!1};const Ls=G?2*Xt.length:Xt.length;for(let Uo=0;Uo<Ls;++Uo){const Qr=this.attemptAnchorPlacement(Xt[Uo%Xt.length],fi,sr,Pr,dn,oe,ie,P,v,F,Uo>=Xt.length,fe,Ae,f,Ds,Kr,j,V);if(Qr&&(Jr=Qr.placedGlyphBoxes,Jr&&Jr.box&&Jr.box.length)){Pe=!0,ut=Qr.shift;break}}return Jr};di(()=>Di(gr,be.iconBox,o.WritingMode.horizontal),()=>{const fi=be.verticalTextBox;return fi&&li(fi),f.allowVerticalPlacement&&!(ot&&ot.box&&ot.box.length)&&Ee>0&&fi?Di(fi,be.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ot&&(Pe=ot.box,he=ot.offscreen,ve=ot.occluded);const or=xi(ot&&ot.box);if(!Pe&&this.prevPlacement){const fi=this.prevPlacement.variableOffsets[Re];fi&&(this.variableOffsets[Re]=fi,this.markUsedJustification(f,fi.anchor,fe,or))}}else{const Xt=(Di,or)=>{const fi=f.getSymbolInstanceTextSize(j,fe,this.transform.zoom,Ae),pr=this.collisionIndex.placeCollisionBox(f,fi,Di,new o.pointGeometry(0,0),G,P,v,F.predicate);return pr&&pr.box&&pr.box.length&&(this.markUsedOrientation(f,or,fe),this.placedOrientations[Re]=or),pr};di(()=>Xt(gr,o.WritingMode.horizontal),()=>{const Di=be.verticalTextBox;return f.allowVerticalPlacement&&Ee>0&&Di?(li(Di),Xt(Di,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),xi(ot&&ot.box&&ot.box.length)}}if(At=ot,Pe=At&&At.box&&At.box.length>0,he=At&&At.offscreen,ve=At&&At.occluded,fe.useRuntimeCollisionCircles){const xi=f.text.placedSymbolArray.get(fe.centerJustifiedTextSymbolIndex>=0?fe.centerJustifiedTextSymbolIndex:fe.verticalPlacedTextSymbolIndex),di=o.evaluateSizeForFeature(f.textSizeData,j,xi),Xt=g.get("text-padding");ht=this.collisionIndex.placeCollisionCircles(f,G,xi,f.lineVertexArray,f.glyphOffsetArray,di,v,w,A,u,ie,F.predicate,fe.collisionCircleDiameter*di/o.ONE_EM,Xt,this.retainedQueryData[f.bucketInstanceId].tileID),Pe=G||ht.circles.length>0&&!ht.collisionDetected,he=he&&ht.offscreen,ve=ht.occluded}if(be.iconFeatureIndex&&(pi=be.iconFeatureIndex),be.iconBox){const xi=di=>{li(di);const Xt=ce&&ut?hs(ut.x,ut.y,oe,ie,this.transform.angle):new o.pointGeometry(0,0),Di=f.getSymbolInstanceIconSize(V,this.transform.zoom,fe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(f,Di,di,Xt,Y,P,v,F.predicate)};xt&&xt.box&&xt.box.length&&be.verticalIconBox?(et=xi(be.verticalIconBox),je=et.box.length>0):(et=xi(be.iconBox),je=et.box.length>0),he=he&&et.offscreen,nt=et.occluded}const Ar=U||fe.numHorizontalGlyphVertices===0&&Ee===0,hr=X||fe.numIconVertices===0;if(Ar||hr?hr?Ar||(je=je&&Pe):Pe=je&&Pe:je=Pe=je&&Pe,Pe&&At&&At.box&&this.collisionIndex.insertCollisionBox(At.box,g.get("text-ignore-placement"),f.bucketInstanceId,xt&&xt.box&&Yt?Yt:ni,F.ID),je&&et&&this.collisionIndex.insertCollisionBox(et.box,g.get("icon-ignore-placement"),f.bucketInstanceId,pi,F.ID),ht&&(Pe&&this.collisionIndex.insertCollisionCircles(ht.circles,g.get("text-ignore-placement"),f.bucketInstanceId,ni,F.ID),u)){const xi=f.bucketInstanceId;let di=this.collisionCircleArrays[xi];di===void 0&&(di=this.collisionCircleArrays[xi]=new Qs);for(let Xt=0;Xt<ht.circles.length;Xt+=4)di.circles.push(ht.circles[Xt+0]),di.circles.push(ht.circles[Xt+1]),di.circles.push(ht.circles[Xt+2]),di.circles.push(ht.collisionDetected?1:0)}const Yr=f.projection.name!=="globe";_e=_e&&(Yr||!ve),ue=ue&&(Yr||!nt),this.placements[Re]=new us(Pe||_e,je||ue,he||f.justReloaded),s[Re]=!0};if(xe){const fe=f.getSortedSymbolIndexes(this.transform.angle);for(let Ae=fe.length-1;Ae>=0;--Ae){const be=fe[Ae];Ue(f.symbolInstances.get(be),be,f.collisionArrays[be])}}else for(let fe=r.symbolInstanceStart;fe<r.symbolInstanceEnd;fe++)Ue(f.symbolInstances.get(fe),fe,f.collisionArrays[fe]);if(u&&f.bucketInstanceId in this.collisionCircleArrays){const fe=this.collisionCircleArrays[f.bucketInstanceId];o.invert(fe.invProjMatrix,v),fe.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(r,s,u,p){const{leftJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:g,rightJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,crossTileID:A}=u,I=o.getAnchorJustification(s),P=p===o.WritingMode.vertical?w:I==="left"?f:I==="center"?g:I==="right"?v:-1;f>=0&&(r.text.placedSymbolArray.get(f).crossTileID=P>=0&&f!==P?0:A),g>=0&&(r.text.placedSymbolArray.get(g).crossTileID=P>=0&&g!==P?0:A),v>=0&&(r.text.placedSymbolArray.get(v).crossTileID=P>=0&&v!==P?0:A),w>=0&&(r.text.placedSymbolArray.get(w).crossTileID=P>=0&&w!==P?0:A)}markUsedOrientation(r,s,u){const p=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,f=s===o.WritingMode.vertical?s:0,{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:A}=u,I=r.text.placedSymbolArray;g>=0&&(I.get(g).placedOrientation=p),v>=0&&(I.get(v).placedOrientation=p),w>=0&&(I.get(w).placedOrientation=p),A>=0&&(I.get(A).placedOrientation=f)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(r):1,f=s?s.opacities:{},g=s?s.variableOffsets:{},v=s?s.placedOrientations:{};for(const w in this.placements){const A=this.placements[w],I=f[w];I?(this.opacities[w]=new Cn(I,p,A.text,A.icon,null,A.clipped),u=u||A.text!==I.text.placed||A.icon!==I.icon.placed):(this.opacities[w]=new Cn(null,p,A.text,A.icon,A.skipFade,A.clipped),u=u||A.text||A.icon)}for(const w in f){const A=f[w];if(!this.opacities[w]){const I=new Cn(A,p,!1,!1);I.isHidden()||(this.opacities[w]=I,u=u||A.text.placed||A.icon.placed)}}for(const w in g)this.variableOffsets[w]||!this.opacities[w]||this.opacities[w].isHidden()||(this.variableOffsets[w]=g[w]);for(const w in v)this.placedOrientations[w]||!this.opacities[w]||this.opacities[w].isHidden()||(this.placedOrientations[w]=v[w]);u?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:r)}updateLayerOpacities(r,s){const u={};for(const p of s){const f=p.getBucket(r);f&&p.latestFeatureIndex&&r.id===f.layerIds[0]&&this.updateBucketOpacities(f,u,p.collisionBoxArray)}}updateBucketOpacities(r,s,u){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const p=r.layers[0].layout,f=!!r.layers[0].dynamicFilter(),g=new Cn(null,0,!1,!1,!0),v=p.get("text-allow-overlap"),w=p.get("icon-allow-overlap"),A=p.get("text-variable-anchor"),I=p.get("text-rotation-alignment")==="map",P=p.get("text-pitch-alignment")==="map",R=p.get("icon-text-fit")!=="none",N=new Cn(null,0,v&&(w||!r.hasIconData()||p.get("icon-optional")),w&&(v||!r.hasTextData()||p.get("text-optional")),!0);!r.collisionArrays&&u&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(u);const j=(F,U,X)=>{for(let G=0;G<U/4;G++)F.opacityVertexArray.emplaceBack(X)};let V=0;for(let F=0;F<r.symbolInstances.length;F++){const U=r.symbolInstances.get(F),{numHorizontalGlyphVertices:X,numVerticalGlyphVertices:G,crossTileID:Y,numIconVertices:oe}=U;let ie=this.opacities[Y];s[Y]?ie=g:ie||(ie=N,this.opacities[Y]=ie),s[Y]=!0;const ce=X>0||G>0,xe=oe>0,_e=this.placedOrientations[Y],ue=_e===o.WritingMode.vertical,Ue=_e===o.WritingMode.horizontal||_e===o.WritingMode.horizontalOnly;if(!ce&&!xe||ie.isHidden()||V++,ce){const fe=Xi(ie.text);j(r.text,X,ue?So:fe),j(r.text,G,Ue?So:fe);const Ae=ie.text.isHidden(),{leftJustifiedTextSymbolIndex:be,centerJustifiedTextSymbolIndex:Re,rightJustifiedTextSymbolIndex:Ee,verticalPlacedTextSymbolIndex:Pe}=U,je=r.text.placedSymbolArray,he=Ae||ue?1:0;be>=0&&(je.get(be).hidden=he),Re>=0&&(je.get(Re).hidden=he),Ee>=0&&(je.get(Ee).hidden=he),Pe>=0&&(je.get(Pe).hidden=Ae||Ue?1:0);const ve=this.variableOffsets[Y];ve&&this.markUsedJustification(r,ve.anchor,U,_e);const nt=this.placedOrientations[Y];nt&&(this.markUsedJustification(r,"left",U,nt),this.markUsedOrientation(r,nt,U))}if(xe){const fe=Xi(ie.icon),{placedIconSymbolIndex:Ae,verticalPlacedIconSymbolIndex:be}=U,Re=r.icon.placedSymbolArray,Ee=ie.icon.isHidden()?1:0;Ae>=0&&(j(r.icon,oe,ue?So:fe),Re.get(Ae).hidden=Ee),be>=0&&(j(r.icon,U.numVerticalIconVertices,Ue?So:fe),Re.get(be).hidden=Ee)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const fe=r.collisionArrays[F];if(fe){let Ae=new o.pointGeometry(0,0),be=!0;if(fe.textBox||fe.verticalTextBox){if(A){const Ee=this.variableOffsets[Y];Ee?(Ae=ki(Ee.anchor,Ee.width,Ee.height,Ee.textOffset,Ee.textScale),I&&Ae._rotate(P?this.transform.angle:-this.transform.angle)):be=!1}f&&(be=!ie.clipped),fe.textBox&&Yi(r.textCollisionBox.collisionVertexArray,ie.text.placed,!be||ue,Ae.x,Ae.y),fe.verticalTextBox&&Yi(r.textCollisionBox.collisionVertexArray,ie.text.placed,!be||Ue,Ae.x,Ae.y)}const Re=be&&Boolean(!Ue&&fe.verticalIconBox);fe.iconBox&&Yi(r.iconCollisionBox.collisionVertexArray,ie.icon.placed,Re,R?Ae.x:0,R?Ae.y:0),fe.verticalIconBox&&Yi(r.iconCollisionBox.collisionVertexArray,ie.icon.placed,!Re,R?Ae.x:0,R?Ae.y:0)}}}if(r.fullyClipped=V===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const F=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=F.invProjMatrix,r.placementViewportMatrix=F.viewportMatrix,r.collisionCircleArray=F.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>r}setStale(){this.stale=!0}}function Yi(l,r,s,u,p){l.emplaceBack(r?1:0,s?1:0,u||0,p||0),l.emplaceBack(r?1:0,s?1:0,u||0,p||0),l.emplaceBack(r?1:0,s?1:0,u||0,p||0),l.emplaceBack(r?1:0,s?1:0,u||0,p||0)}const kr=Math.pow(2,25),Rc=Math.pow(2,24),ea=Math.pow(2,17),Vi=Math.pow(2,16),ps=Math.pow(2,9),cl=Math.pow(2,8),ds=Math.pow(2,1);function Xi(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const r=l.placed?1:0,s=Math.floor(127*l.opacity);return s*kr+r*Rc+s*ea+r*Vi+s*ps+r*cl+s*ds+r}const So=0;class ul{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,s,u,p,f){const g=this._bucketParts;for(;this._currentTileIndex<r.length;)if(s.getBucketParts(g,p,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((v,w)=>v.sortKey-w.sortKey));this._currentPartIndex<g.length;){const v=g[this._currentPartIndex];if(s.placeLayerBucketPart(v,this._seenCrossTileIDs,u,v.symbolInstanceStart===0),this._currentPartIndex++,f())return!0}return!1}}class un{constructor(r,s,u,p,f,g,v,w){this.placement=new ll(r,f,g,v,w),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(r,s,u){const p=o.exported.now(),f=()=>{const g=o.exported.now()-p;return!this._forceFullPlacement&&g>2};for(;this._currentPlacementIndex>=0;){const g=s[r[this._currentPlacementIndex]],v=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=v)&&(!g.maxzoom||g.maxzoom>v)){if(this._inProgressLayer||(this._inProgressLayer=new ul(g)),this._inProgressLayer.continuePlacement(u[g.source],this.placement,this._showCollisionBoxes,g,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const fs=512/o.EXTENT/2;class ta{constructor(r,s,u){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(let p=0;p<s.length;p++){const f=s.get(p),g=f.key;this.indexedSymbolInstances[g]||(this.indexedSymbolInstances[g]=[]),this.indexedSymbolInstances[g].push({crossTileID:f.crossTileID,coord:this.getScaledCoordinates(f,r)})}}getScaledCoordinates(r,s){const u=fs/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*o.EXTENT+r.tileAnchorX)*u),y:Math.floor((s.canonical.y*o.EXTENT+r.tileAnchorY)*u)}}findMatches(r,s,u){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let f=0;f<r.length;f++){const g=r.get(f);if(g.crossTileID)continue;const v=this.indexedSymbolInstances[g.key];if(!v)continue;const w=this.getScaledCoordinates(g,s);for(const A of v)if(Math.abs(A.coord.x-w.x)<=p&&Math.abs(A.coord.y-w.y)<=p&&!u[A.crossTileID]){u[A.crossTileID]=!0,g.crossTileID=A.crossTileID;break}}}}class Rh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const s=Math.round((r-this.lng)/360);if(s!==0)for(const u in this.indexes){const p=this.indexes[u],f={};for(const g in p){const v=p[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+s),f[v.tileID.key]=v}this.indexes[u]=f}this.lng=r}addBucket(r,s,u){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let f=0;f<s.symbolInstances.length;f++)s.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const p=this.usedCrossTileIDs[r.overscaledZ];for(const f in this.indexes){const g=this.indexes[f];if(Number(f)>r.overscaledZ)for(const v in g){const w=g[v];w.tileID.isChildOf(r)&&w.findMatches(s.symbolInstances,r,p)}else{const v=g[r.scaledTo(Number(f)).key];v&&v.findMatches(s.symbolInstances,r,p)}}for(let f=0;f<s.symbolInstances.length;f++){const g=s.symbolInstances.get(f);g.crossTileID||(g.crossTileID=u.generate(),p[g.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new ta(r,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(r,s){for(const u in s.indexedSymbolInstances)for(const p of s.indexedSymbolInstances[u])delete this.usedCrossTileIDs[r][p.crossTileID]}removeStaleBuckets(r){let s=!1;for(const u in this.indexes){const p=this.indexes[u];for(const f in p)r[p[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[f]),delete p[f],s=!0)}return s}}class Xn{constructor(){this.layerIndexes={},this.crossTileIDs=new Rh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,s,u,p){let f=this.layerIndexes[r.id];f===void 0&&(f=this.layerIndexes[r.id]=new hl);let g=!1;const v={};p.name!=="globe"&&f.handleWrapJump(u);for(const w of s){const A=w.getBucket(r);A&&r.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(w.tileID,A,this.crossTileIDs)&&(g=!0),v[A.bucketInstanceId]=!0)}return f.removeStaleBuckets(v)&&(g=!0),g}pruneUnusedLayers(r){const s={};r.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}const ia=(l,r)=>o.emitValidationErrors(l,r&&r.filter(s=>s.identifier!=="source.canvas")),Bc=o.pick(ct,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Io=o.pick(ct,["setCenter","setZoom","setBearing","setPitch"]),kn={version:8,layers:[],sources:{}},ra={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ki extends o.Evented{constructor(r,s={}){super(),this.map=r,this.dispatcher=new Ut(wt(),this),this.imageManager=new rr,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(r._requestManager,s.localFontFamily?o.LocalGlyphMode.all:s.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.crossTileSymbolIndex=new Xn,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const u=this;this._rtlTextPluginCallback=Ki.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(f,g)=>{if(o.triggerPluginCompletionEvent(f),g&&g.every(v=>v))for(const v in u._sourceCaches){const w=u._sourceCaches[v],A=w.getSource().type;A!=="vector"&&A!=="geojson"||w.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const f=this.getSource(p.sourceId);if(f&&f.vectorLayerIds)for(const g in this._layers){const v=this._layers[g];v.source===f.id&&this._validateLayer(v)}})}loadURL(r,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const u=typeof s.validate=="boolean"?s.validate:!o.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,s.accessToken);const p=this.map._requestManager.transformRequest(r,o.ResourceType.Style);this._request=o.getJSON(p,(f,g)=>{this._request=null,f?this.fire(new o.ErrorEvent(f)):g&&this._load(g,u)})}loadJSON(r,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(r,s.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(kn,!1)}_updateLayerCount(r,s){const u=s?1:-1;r.is3D()&&(this._num3DLayers+=u),r.type==="circle"&&(this._numCircleLayers+=u),r.type==="symbol"&&(this._numSymbolLayers+=u)}_load(r,s){if(s&&ia(this,o.validateStyle(r)))return;this._loaded=!0,this.stylesheet=o.clone$1(r),this._updateMapProjection();for(const p in r.sources)this.addSource(p,r.sources[p],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const u=Kt(this.stylesheet.layers);this._order=u.map(p=>p.id),this._layers={},this._serializedLayers={};for(let p of u)p=o.createStyleLayer(p),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize(),this._updateLayerCount(p,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ji(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(s,u,p){let f,g,v;const w=o.exported.devicePixelRatio>1?"@2x":"";let A=o.getJSON(u.transformRequest(u.normalizeSpriteURL(s,w,".json"),o.ResourceType.SpriteJSON),(R,N)=>{A=null,v||(v=R,f=N,P())}),I=o.getImage(u.transformRequest(u.normalizeSpriteURL(s,w,".png"),o.ResourceType.SpriteImage),(R,N)=>{I=null,v||(v=R,g=N,P())});function P(){if(v)p(v);else if(f&&g){const R=o.exported.getImageData(g),N={};for(const j in f){const{width:V,height:F,x:U,y:X,sdf:G,pixelRatio:Y,stretchX:oe,stretchY:ie,content:ce}=f[j],xe=new o.RGBAImage({width:V,height:F});o.RGBAImage.copy(R,xe,{x:U,y:X},{x:0,y:0},{width:V,height:F}),N[j]={data:xe,pixelRatio:Y,sdf:G,stretchX:oe,stretchY:ie,content:ce}}p(null,N)}}return{cancel(){A&&(A.cancel(),A=null),I&&(I.cancel(),I=null)}}}(r,this.map._requestManager,(s,u)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(u)for(const p in u)this.imageManager.addImage(p,u[p]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(r){const s=this.getSource(r.source);if(!s)return;const u=r.sourceLayer;u&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(u)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${u}" does not exist on source "${s.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const s=[];for(const u of r){const p=this._layers[u];p.type!=="custom"&&s.push(p.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&ra[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const s=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(p.length||f.length)&&this._updateWorkerLayers(p,f);for(const g in this._updatedSources){const v=this._updatedSources[g];v==="reload"?this._reloadSource(g):v==="clear"&&this._clearSource(g)}this._updateTilesForChangedImages();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const u={};for(const p in this._sourceCaches){const f=this._sourceCaches[p];u[p]=f.used,f.used=!1}for(const p of this._order){const f=this._layers[p];if(f.recalculate(r,this._availableImages),!f.isHidden(r.zoom)){const v=this._getLayerSourceCache(f);v&&(v.used=!0)}const g=this.map.painter;if(g){const v=f.getProgramIds();if(!v)continue;const w=f.getProgramConfiguration(r.zoom);for(const A of v)g.useProgram(A,w)}}for(const p in u){const f=this._sourceCaches[p];u[p]!==f.used&&f.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),ia(this,o.validateStyle(r)))return!1;(r=o.clone$1(r)).layers=Kt(r.layers);const s=function(p,f){if(!p)return[{command:ct.setStyle,args:[f]}];let g=[];try{if(!re(p.version,f.version))return[{command:ct.setStyle,args:[f]}];re(p.center,f.center)||g.push({command:ct.setCenter,args:[f.center]}),re(p.zoom,f.zoom)||g.push({command:ct.setZoom,args:[f.zoom]}),re(p.bearing,f.bearing)||g.push({command:ct.setBearing,args:[f.bearing]}),re(p.pitch,f.pitch)||g.push({command:ct.setPitch,args:[f.pitch]}),re(p.sprite,f.sprite)||g.push({command:ct.setSprite,args:[f.sprite]}),re(p.glyphs,f.glyphs)||g.push({command:ct.setGlyphs,args:[f.glyphs]}),re(p.transition,f.transition)||g.push({command:ct.setTransition,args:[f.transition]}),re(p.light,f.light)||g.push({command:ct.setLight,args:[f.light]}),re(p.fog,f.fog)||g.push({command:ct.setFog,args:[f.fog]}),re(p.projection,f.projection)||g.push({command:ct.setProjection,args:[f.projection]});const v={},w=[];(function(P,R,N,j){let V;for(V in R=R||{},P=P||{})P.hasOwnProperty(V)&&(R.hasOwnProperty(V)||yi(V,N,j));for(V in R)R.hasOwnProperty(V)&&(P.hasOwnProperty(V)?re(P[V],R[V])||(P[V].type==="geojson"&&R[V].type==="geojson"&&An(P,R,V)?N.push({command:ct.setGeoJSONSourceData,args:[V,R[V].data]}):qr(V,R,N,j)):hi(V,R,N))})(p.sources,f.sources,w,v);const A=[];p.layers&&p.layers.forEach(P=>{P.source&&v[P.source]?g.push({command:ct.removeLayer,args:[P.id]}):A.push(P)});let I=p.terrain;I&&v[I.source]&&(g.push({command:ct.setTerrain,args:[void 0]}),I=void 0),g=g.concat(w),re(I,f.terrain)||g.push({command:ct.setTerrain,args:[f.terrain]}),function(P,R,N){R=R||[];const j=(P=P||[]).map(Me),V=R.map(Me),F=P.reduce(ln,{}),U=R.reduce(ln,{}),X=j.slice(),G=Object.create(null);let Y,oe,ie,ce,xe,_e,ue;for(Y=0,oe=0;Y<j.length;Y++)ie=j[Y],U.hasOwnProperty(ie)?oe++:(N.push({command:ct.removeLayer,args:[ie]}),X.splice(X.indexOf(ie,oe),1));for(Y=0,oe=0;Y<V.length;Y++)ie=V[V.length-1-Y],X[X.length-1-Y]!==ie&&(F.hasOwnProperty(ie)?(N.push({command:ct.removeLayer,args:[ie]}),X.splice(X.lastIndexOf(ie,X.length-oe),1)):oe++,_e=X[X.length-Y],N.push({command:ct.addLayer,args:[U[ie],_e]}),X.splice(X.length-Y,0,ie),G[ie]=!0);for(Y=0;Y<V.length;Y++)if(ie=V[Y],ce=F[ie],xe=U[ie],!G[ie]&&!re(ce,xe))if(re(ce.source,xe.source)&&re(ce["source-layer"],xe["source-layer"])&&re(ce.type,xe.type)){for(ue in Cr(ce.layout,xe.layout,N,ie,null,ct.setLayoutProperty),Cr(ce.paint,xe.paint,N,ie,null,ct.setPaintProperty),re(ce.filter,xe.filter)||N.push({command:ct.setFilter,args:[ie,xe.filter]}),re(ce.minzoom,xe.minzoom)&&re(ce.maxzoom,xe.maxzoom)||N.push({command:ct.setLayerZoomRange,args:[ie,xe.minzoom,xe.maxzoom]}),ce)ce.hasOwnProperty(ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Cr(ce[ue],xe[ue],N,ie,ue.slice(6),ct.setPaintProperty):re(ce[ue],xe[ue])||N.push({command:ct.setLayerProperty,args:[ie,ue,xe[ue]]}));for(ue in xe)xe.hasOwnProperty(ue)&&!ce.hasOwnProperty(ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Cr(ce[ue],xe[ue],N,ie,ue.slice(6),ct.setPaintProperty):re(ce[ue],xe[ue])||N.push({command:ct.setLayerProperty,args:[ie,ue,xe[ue]]}))}else N.push({command:ct.removeLayer,args:[ie]}),_e=X[X.lastIndexOf(ie)+1],N.push({command:ct.addLayer,args:[xe,_e]})}(A,f.layers,g)}catch(v){console.warn("Unable to compute style diff:",v),g=[{command:ct.setStyle,args:[f]}]}return g}(this.serialize(),r).filter(p=>!(p.command in Io));if(s.length===0)return!1;const u=s.filter(p=>!(p.command in Bc));if(u.length>0)throw new Error(`Unimplemented: ${u.map(p=>p.command).join(", ")}.`);return s.forEach(p=>{p.command!=="setTransition"&&p.command!=="setProjection"&&this[p.command].apply(this,p.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,s){return this.getImage(r)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,s),this._afterImageUpdated(r),this)}updateImage(r,s){this.imageManager.updateImage(r,s)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,s,u={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateSource,`sources.${r}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=pe(r,s,this.dispatcher,this);p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:p.serialize(),sourceId:r}));const f=g=>{const v=(g?"symbol:":"other:")+r,w=this._sourceCaches[v]=new o.SourceCache(v,p,g);(g?this._symbolSourceCaches:this._otherSourceCaches)[r]=w,w.style=this,w.onAdd(this.map)};f(!1),s.type!=="vector"&&s.type!=="geojson"||f(!0),p.onAdd&&p.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const s=this.getSource(r);if(!s)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new o.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const u=this._getSourceCaches(r);for(const p of u)delete this._sourceCaches[p.id],delete this._updatedSources[p.id],p.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,s){this._checkLoaded(),this.getSource(r).setData(s),this._changed=!0}getSource(r){const s=this._getSourceCache(r);return s&&s.getSource()}_getSources(){const r=[];for(const s in this._otherSourceCaches){const u=this._getSourceCache(s);u&&r.push(u.getSource())}return r}addLayer(r,s,u={}){this._checkLoaded();const p=r.id;if(this.getLayer(p))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${p}" already exists on this map`)));let f;if(r.type==="custom"){if(ia(this,o.validateCustomStyleLayer(r)))return;f=o.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(p,r.source),r=o.clone$1(r),r=o.extend(r,{source:p})),this._validate(o.validateLayer,`layers.${p}`,r,{arrayIndex:-1},u))return;f=o.createStyleLayer(r),this._validateLayer(f),f.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[f.id]=f.serialize(),this._updateLayerCount(f,!0)}const g=s?this._order.indexOf(s):this._order.length;if(s&&g===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(g,0,p),this._layerOrderChanged=!0,this._layers[p]=f;const v=this._getLayerSourceCache(f);if(this._removedLayers[p]&&f.source&&v&&f.type!=="custom"){const w=this._removedLayers[p];delete this._removedLayers[p],w.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",v.pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,s){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===s)return;const u=this._order.indexOf(r);this._order.splice(u,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(p,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const s=this._layers[r];if(!s)return void this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const u=this._order.indexOf(r);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=s,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const s in this._layers)if(this._layers[s].type===r)return!0;return!1}setLayerZoomRange(r,s,u){this._checkLoaded();const p=this.getLayer(r);p?p.minzoom===s&&p.maxzoom===u||(s!=null&&(p.minzoom=s),u!=null&&(p.maxzoom=u),this._updateLayer(p)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,s,u={}){this._checkLoaded();const p=this.getLayer(r);if(p){if(!re(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(o.validateFilter,`layers.${p.id}.filter`,s,{layerType:p.type},u)||(p.filter=o.clone$1(s),this._updateLayer(p)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const s=this.getLayer(r);return s&&o.clone$1(s.filter)}setLayoutProperty(r,s,u,p={}){this._checkLoaded();const f=this.getLayer(r);f?re(f.getLayoutProperty(s),u)||(f.setLayoutProperty(s,u,p),this._updateLayer(f)):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,s){const u=this.getLayer(r);if(u)return u.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,s,u,p={}){this._checkLoaded();const f=this.getLayer(r);f?re(f.getPaintProperty(s),u)||(f.setPaintProperty(s,u,p)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,s){const u=this.getLayer(r);return u&&u.getPaintProperty(s)}setFeatureState(r,s){this._checkLoaded();const u=r.source,p=r.sourceLayer,f=this.getSource(u);if(!f)return void this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const g=f.type;if(g==="geojson"&&p)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(g==="vector"&&!p)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const v=this._getSourceCaches(u);for(const w of v)w.setFeatureState(p,r.id,s)}removeFeatureState(r,s){this._checkLoaded();const u=r.source,p=this.getSource(u);if(!p)return void this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const f=p.type,g=f==="vector"?r.sourceLayer:void 0;if(f==="vector"&&!g)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const v=this._getSourceCaches(u);for(const w of v)w.removeFeatureState(g,r.id,s)}getFeatureState(r){this._checkLoaded();const s=r.source,u=r.sourceLayer,p=this.getSource(s);if(p){if(p.type!=="vector"||u)return r.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(u,r.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const s in this._sourceCaches){const u=this._sourceCaches[s].getSource();r[u.id]||(r[u.id]=u.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const s=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",s.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const s=g=>this._layers[g].type==="fill-extrusion",u={},p=[];for(let g=this._order.length-1;g>=0;g--){const v=this._order[g];if(s(v)){u[v]=g;for(const w of r){const A=w[v];if(A)for(const I of A)p.push(I)}}}p.sort((g,v)=>v.intersectionZ-g.intersectionZ);const f=[];for(let g=this._order.length-1;g>=0;g--){const v=this._order[g];if(s(v))for(let w=p.length-1;w>=0;w--){const A=p[w].feature;if(u[A.layer.id]<g)break;f.push(A),p.pop()}else for(const w of r){const A=w[v];if(A)for(const I of A)f.push(I.feature)}}return f}queryRenderedFeatures(r,s,u){s&&s.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const A=this._layers[w];if(!A)return this.fire(new o.ErrorEvent(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];p[A.source]=!0}}const f=[];s.availableImages=this._availableImages;const g=s&&s.layers?s.layers.some(w=>{const A=this.getLayer(w);return A&&A.is3D()}):this.has3DLayers(),v=ti.createFromScreenPoints(r,u);for(const w in this._sourceCaches){const A=this._sourceCaches[w].getSource().id;s.layers&&!p[A]||f.push(me(this._sourceCaches[w],this._layers,this._serializedLayers,v,s,u,g,!!this.map._showQueryGeometry))}return this.placement&&f.push(function(w,A,I,P,R,N,j){const V={},F=N.queryRenderedSymbols(P),U=[];for(const X of Object.keys(F).map(Number))U.push(j[X]);U.sort(Ke);for(const X of U){const G=X.featureIndex.lookupSymbolFeatures(F[X.bucketInstanceId],A,X.bucketIndex,X.sourceLayerIndex,R.filter,R.layers,R.availableImages,w);for(const Y in G){const oe=V[Y]=V[Y]||[],ie=G[Y];ie.sort((ce,xe)=>{const _e=X.featureSortOrder;if(_e){const ue=_e.indexOf(ce.featureIndex);return _e.indexOf(xe.featureIndex)-ue}return xe.featureIndex-ce.featureIndex});for(const ce of ie)oe.push(ce)}}for(const X in V)V[X].forEach(G=>{const Y=G.feature,oe=I(w[X]).getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=oe});return V}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),v.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(r,s){s&&s.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",s.filter,null,s);const u=this._getSourceCaches(r);let p=[];for(const f of u)p=p.concat(De(f,s));return p}addSourceType(r,s,u){return Ki.getSourceType(r)?u(new Error(`A source type called "${r}" already exists.`)):(Ki.setSourceType(r,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:s.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(r,s={}){this._checkLoaded();const u=this.light.getLight();let p=!1;for(const g in r)if(!re(r[g],u[g])){p=!0;break}if(!p)return;const f=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,s),this.light.updateTransitions(f)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,s=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(s===1){if(typeof r.source=="object"){const u="terrain-dem-src";this.addSource(u,r.source),r=o.clone$1(r),r=o.extend(r,{source:u})}if(this._validate(o.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&s!==this.terrain.drapeRenderMode)this._createTerrain(r,s);else{const u=this.terrain,p=u.get();for(const f of Object.keys(o.spec.terrain))!r.hasOwnProperty(f)&&o.spec.terrain[f].default&&(r[f]=o.spec.terrain[f].default);for(const f in r)if(!re(r[f],p[f])){u.set(r),this.stylesheet.terrain=r;const g=this._setTransitionParameters({duration:0});u.updateTransitions(g);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const s=this.fog=new Ot(r,this.map.transform);this.stylesheet.fog=r;const u=this._setTransitionParameters({duration:0});s.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,u=s.get();Object.keys(r).length===0&&s.set(r);for(const p in r)if(!re(r[p],u[p])){s.set(r),this.stylesheet.fog=r;const f=this._setTransitionParameters({duration:0});s.updateTransitions(f);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:o.exported.now(),transition:o.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(u=>this.isLayerDraped(this._layers[u])),s=this._order.filter(u=>!this.isLayerDraped(this._layers[u]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...s)}_createTerrain(r,s){const u=this.terrain=new fr(r,s);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const p=this._setTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="symbol"&&this._updateLayer(s)}}_validate(r,s,u,p,f={}){return(!f||f.validate!==!1)&&ia(this,r.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:u,styleSpec:o.spec},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const s=this._getSourceCaches(r);for(const u of s)u.clearTiles()}_reloadSource(r){const s=this._getSourceCaches(r);for(const u of s)u.resume(),u.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const s in this._sourceCaches)this._sourceCaches[s].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const s=this._sourceCaches[r];s.resume(),s.reload()}}_updatePlacement(r,s,u,p,f=!1){let g=!1,v=!1;const w={};for(const A of this._order){const I=this._layers[A];if(I.type!=="symbol")continue;if(!w[I.source]){const R=this._getLayerSourceCache(I);if(!R)continue;w[I.source]=R.getRenderableIds(!0).map(N=>R.getTileByID(N)).sort((N,j)=>j.tileID.overscaledZ-N.tileID.overscaledZ||(N.tileID.isLessThan(j.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(I,w[I.source],r.center.lng,r.projection);g=g||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),f=f||this._layerOrderChanged||u===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(f||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),r.zoom))&&(this.pauseablePlacement=new un(r,this._order,f,s,u,p,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,w),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),v=!0),g&&this.pauseablePlacement.placement.setStale()),v||g)for(const A of this._order){const I=this._layers[A];I.type==="symbol"&&this.placement.updateLayerOpacities(I,w[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,s,u){this.imageManager.getImages(s.icons,u),this._updateTilesForChangedImages();const p=f=>{f&&f.setDependencies(s.tileID.key,s.type,s.icons)};p(this._otherSourceCaches[s.source]),p(this._symbolSourceCaches[s.source])}getGlyphs(r,s,u){this.glyphManager.getGlyphs(s.stacks,u)}getResource(r,s,u){return o.makeRequest(s,u)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const s=[];return this._otherSourceCaches[r]&&s.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&s.push(this._symbolSourceCaches[r]),s}_isSourceCacheLoaded(r){const s=this._getSourceCaches(r);return s.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):s.every(u=>u.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ki.getSourceType=function(l){return de[l]},Ki.setSourceType=function(l,r){de[l]=r},Ki.registerForPluginStateChange=o.registerForPluginStateChange;var na=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,ms="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Oc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Fc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,oa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Uc={},sa={};const _s=[];Wn(na,_s),Wn(Oc,_s),Wn(Fc,_s),Wn(oa,_s),Uc=Jt("",Oc),sa=Jt(oa,Fc);const pl=Jt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),jc=na,gs=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var dl={background:Jt(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Jt(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Jt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Jt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Jt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Jt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Jt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Jt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Jt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Jt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Jt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Jt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Jt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Jt(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Jt(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Jt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Jt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Jt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Jt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Jt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Jt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Jt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Jt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Jt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ms),skyboxGradient:Jt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ms),skyboxCapture:Jt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Jt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Jt(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Wn(l,r){const s=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of s)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const f of p)r.includes(f)||r.push(f)}}function Jt(l,r){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),p={},f=[..._s];return Wn(l,f),Wn(r,f),{fragmentSource:l=l.replace(s,(g,v,w,A,I)=>(p[I]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${I}
varying ${w} ${A} ${I};
#else
uniform ${w} ${A} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${w} ${A} ${I} = u_${I};
#endif
`)),vertexSource:r=r.replace(s,(g,v,w,A,I)=>{const P=A==="float"?"vec2":"vec4",R=I.match(/color/)?"color":P;return p[I]?v==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${w} ${P} a_${I};
varying ${w} ${A} ${I};
#else
uniform ${w} ${A} u_${I};
#endif
`:R==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${w} ${A} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${R}(a_${I}, u_${I}_t);
#else
    ${w} ${A} ${I} = u_${I};
#endif
`:v==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${w} ${P} a_${I};
#else
uniform ${w} ${A} u_${I};
#endif
`:R==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${w} ${A} ${I} = a_${I};
#else
    ${w} ${A} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${w} ${A} ${I} = unpack_mix_${R}(a_${I}, u_${I}_t);
#else
    ${w} ${A} ${I} = u_${I};
#endif
`}),staticAttributes:u,usedDefines:f}}class Nc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,s,u,p,f,g,v){this.context=r;let w=this.boundPaintVertexBuffers.length!==p.length;for(let I=0;!w&&I<p.length;I++)this.boundPaintVertexBuffers[I]!==p[I]&&(w=!0);let A=this.boundDynamicVertexBuffers.length!==v.length;for(let I=0;!A&&I<v.length;I++)this.boundDynamicVertexBuffers[I]!==v[I]&&(A=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||w||A||this.boundIndexBuffer!==f||this.boundVertexOffset!==g)this.freshBind(s,u,p,f,g,v);else{r.bindVertexArrayOES.set(this.vao);for(const I of v)I&&I.bind();f&&f.dynamicDraw&&f.bind()}}freshBind(r,s,u,p,f,g){let v;const w=r.numAttributes,A=this.context,I=A.gl;if(A.extVertexArrayObject)this.vao&&this.destroy(),this.vao=A.extVertexArrayObject.createVertexArrayOES(),A.bindVertexArrayOES.set(this.vao),v=0,this.boundProgram=r,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=f,this.boundDynamicVertexBuffers=g;else{v=A.currentNumAttributes||0;for(let P=w;P<v;P++)I.disableVertexAttribArray(P)}s.enableAttributes(I,r),s.bind(),s.setVertexAttribPointers(I,r,f);for(const P of u)P.enableAttributes(I,r),P.bind(),P.setVertexAttribPointers(I,r,f);for(const P of g)P&&(P.enableAttributes(I,r),P.bind(),P.setVertexAttribPointers(I,r,f));p&&p.bind(),A.currentNumAttributes=w}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ys(l,r){const s=Math.pow(2,r.canonical.z),u=r.canonical.y;return[new o.MercatorCoordinate(0,u/s).toLngLat().lat,new o.MercatorCoordinate(0,(u+1)/s).toLngLat().lat]}function fl(l,r,s,u,p,f,g){const v=l.context,w=v.gl,A=s.fbo;if(!A)return;l.prepareDrawTile();const I=l.useProgram("hillshade");v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,A.colorAttachment.get());const P=((V,F,U,X)=>{const G=U.paint.get("hillshade-shadow-color"),Y=U.paint.get("hillshade-highlight-color"),oe=U.paint.get("hillshade-accent-color");let ie=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(ie-=V.transform.angle);const ce=!V.options.moving;return{u_matrix:X||V.transform.calculateProjMatrix(F.tileID.toUnwrapped(),ce),u_image:0,u_latrange:ys(0,F.tileID),u_light:[U.paint.get("hillshade-exaggeration"),ie],u_shadow:G,u_highlight:Y,u_accent:oe}})(l,s,u,l.terrain?r.projMatrix:null);l.prepareDrawProgram(v,I,r.toUnwrapped());const{tileBoundsBuffer:R,tileBoundsIndexBuffer:N,tileBoundsSegments:j}=l.getTileBoundsBuffers(s);I.draw(v,w.TRIANGLES,p,f,g,o.CullFaceMode.disabled,P,u.id,R,N,j)}function Ao(l,r,s){if(!r.needsDEMTextureUpload)return;const u=l.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||l.getTileTexture(s.stride);const f=s.getPixels();r.demTexture?r.demTexture.update(f,{premultiply:!1}):r.demTexture=new o.Texture(u,f,p.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function aa(l,r,s,u,p,f){const g=l.context,v=g.gl;if(!r.dem)return;const w=r.dem;if(g.activeTexture.set(v.TEXTURE1),Ao(l,r,w),!r.demTexture)return;r.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const A=w.dim;g.activeTexture.set(v.TEXTURE0);let I=r.fbo;if(!I){const j=new o.Texture(g,{width:A,height:A,data:null},v.RGBA);j.bind(v.LINEAR,v.CLAMP_TO_EDGE),I=r.fbo=g.createFramebuffer(A,A,!0),I.colorAttachment.set(j.texture)}g.bindFramebuffer.set(I.framebuffer),g.viewport.set([0,0,A,A]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:R,tileBoundsSegments:N}=l.getMercatorTileBoundsBuffers();l.useProgram("hillshadePrepare").draw(g,v.TRIANGLES,u,p,f,o.CullFaceMode.disabled,((j,V)=>{const F=V.stride,U=o.create();return o.ortho(U,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(U,U,[0,-o.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[F,F],u_zoom:j.overscaledZ,u_unpack:V.unpackVector}})(r.tileID,w),s.id,P,R,N),r.needsHillshadePrepare=!1}const xs=l=>({u_matrix:new o.UniformMatrix4f(l),u_image0:new o.Uniform1i(l),u_skirt_height:new o.Uniform1f(l)}),la=(l,r)=>({u_matrix:l,u_image0:0,u_skirt_height:r}),ml=(l,r,s,u,p,f,g,v,w,A,I,P,R,N)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:s,u_zoom_transition:p,u_merc_center:f,u_image0:0,u_frustum_tl:g,u_frustum_tr:v,u_frustum_br:w,u_frustum_bl:A,u_globe_pos:I,u_globe_radius:P,u_viewport:R,u_grid_matrix:N?Float32Array.from(N):new Float32Array(9)});function ca(l,r){return l!=null&&r!=null&&!(!l.hasData()||!r.hasData())&&l.demTexture!=null&&r.demTexture!=null&&l.tileID.key!==r.tileID.key}const Hn=new class{constructor(){this.operations={}}newMorphing(l,r,s,u,p){if(l in this.operations){const f=this.operations[l];f.to.tileID.key!==s.tileID.key&&(f.queued=s)}else this.operations[l]={startTime:u,phase:0,duration:p,from:r,to:s,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const r=this.operations[l];return{from:r.from,to:r.to,phase:r.phase}}update(l){for(const r in this.operations){const s=this.operations[r];for(s.phase=(l-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,l)){delete this.operations[r];break}}}_nextOp(l,r){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=r,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},Mo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ua(l,r){const s=1<<l.z;return!r&&(l.x===0||l.x===s-1)||l.y===0||l.y===s-1}const vs=l=>({u_matrix:l});function ha(l,r,s,u,p){if(p>0){const f=o.exported.now(),g=(f-l.timeAdded)/p,v=r?(f-r.timeAdded)/p:-1,w=s.getSource(),A=u.coveringZoomLevel({tileSize:w.tileSize,roundZoom:w.roundZoom}),I=!r||Math.abs(r.tileID.overscaledZ-A)>Math.abs(l.tileID.overscaledZ-A),P=I&&l.refreshedUponExpiration?1:o.clamp(I?g:1-v,0,1);return l.refreshedUponExpiration&&g>=1&&(l.refreshedUponExpiration=!1),r?{opacity:1,mix:1-P}:{opacity:P,mix:0}}return{opacity:1,mix:0}}class Zt extends o.SourceCache{constructor(r){const s={type:"raster-dem",maxzoom:r.transform.maxZoom},u=new Ut(wt(),null),p=pe("mock-dem",s,u,r.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,s){r.state="loaded",s(null)}}class pa extends o.SourceCache{constructor(r){const s=pe("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Ut(wt(),null),r.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,s,u){if(r.freezeTileCoverage)return;this.transform=r;const p=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((f,g)=>{if(f[g.key]="",!this._tiles[g.key]){const v=new o.Tile(g,this._source.tileSize*g.overscaleFactor(),r.tileZoom);v.state="loaded",this._tiles[g.key]=v}return f},{});for(const f in this._tiles)f in p||(this.freeFBO(f),this._tiles[f].unloadVectorData(),delete this._tiles[f])}freeFBO(r){const s=this.proxyCachedFBO[r];if(s!==void 0){const u=Object.values(s);this.renderCachePool.push(...u),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class _l extends o.OverscaledTileID{constructor(r,s,u){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=s,this.projMatrix=u}}class Vc extends o.Elevation{constructor(r,s){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,f]=function(w){const A=new o.StructArrayLayout4i8,I=new o.StructArrayLayout3ui6,P=131;A.reserve(17161),I.reserve(33800);const R=o.EXTENT/128,N=o.EXTENT+R/2,j=N+R;for(let F=-R;F<j;F+=R)for(let U=-R;U<j;U+=R){const X=U<0||U>N||F<0||F>N?24575:0,G=o.clamp(Math.round(U),0,o.EXTENT),Y=o.clamp(Math.round(F),0,o.EXTENT);A.emplaceBack(G+X,Y,G,Y)}const V=(F,U)=>{const X=U*P+F;I.emplaceBack(X+1,X,X+P),I.emplaceBack(X+P,X+P+1,X+1)};for(let F=1;F<129;F++)for(let U=1;U<129;U++)V(U,F);return[0,129].forEach(F=>{for(let U=0;U<130;U++)V(U,F),V(F,U)}),[A,I,32768]}(),g=r.context;this.gridBuffer=g.createVertexBuffer(u,o.boundsAttributes.members),this.gridIndexBuffer=g.createIndexBuffer(p),this.gridSegments=o.SegmentVector.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,u.length,f),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new pa(s.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const v=g.gl;this._overlapStencilMode=new o.StencilMode({func:v.GEQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Zt(s.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,s,u){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const p=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(p.get("source")),this._exaggeration=p.get("exaggeration");const f=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const g=this.getScaledDemTileSize();this.sourceCache.update(s,g,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,f(),this._initializing=!0),f(),s.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=s.getIds().map(w=>{const A=s.getTileByID(w).tileID;return A.projMatrix=u.calculateProjMatrix(A.toUnwrapped()),A});(function(w,A){const I=A.transform.pointCoordinate(A.transform.getCameraPoint()),P=new o.pointGeometry(I.x,I.y);w.sort((R,N)=>{if(N.overscaledZ-R.overscaledZ)return N.overscaledZ-R.overscaledZ;const j=new o.pointGeometry(R.canonical.x+(1<<R.canonical.z)*R.wrap,R.canonical.y),V=new o.pointGeometry(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),F=P.mult(1<<R.canonical.z);return F.x-=.5,F.y-=.5,F.distSqr(j)-F.distSqr(V)})})(p,this.painter),this._previousZoom=u.zoom;const f=this.proxyToSource||{};this.proxyToSource={},p.forEach(w=>{this.proxyToSource[w.key]={}}),this.terrainTileForTile={};const g=this._style._sourceCaches;for(const w in g){const A=g[w];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,r[w],f),A.usedForTerrain))continue;const I=r[w];A.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[s.id]=p.map(w=>new _l(w,w.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(f),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const v={};this._visibleDemTiles=[];for(const w of this.proxyCoords){const A=this.terrainTileForTile[w.key];if(!A)continue;const I=A.tileID.key;I in v||(this._visibleDemTiles.push(A),v[I]=I)}}_assignTerrainTiles(r){this._initializing||r.forEach(s=>{if(this.terrainTileForTile[s.key])return;const u=this._findTileCoveringTileID(s,this.sourceCache);u&&(this.terrainTileForTile[s.key]=u)})}_prepareDEMTextures(){const r=this.painter.context,s=r.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],f=p.dem;!f||p.demTexture&&!p.needsDEMTextureUpload||(r.activeTexture.set(s.TEXTURE1),Ao(this.painter,p,f))}}_prepareDemTileUniforms(r,s,u,p){if(!s||s.demTexture==null)return!1;const f=r.tileID.canonical,g=Math.pow(2,s.tileID.canonical.z-f.z),v=p||"";return u[`u_dem_tl${v}`]=[f.x*g%1,f.y*g%1],u[`u_dem_scale${v}`]=g,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,s=r.gl;if(!this._emptyDepthBufferTexture){const u=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(r,u,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const s=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const f=p.dem.tree.minimums[0];return f>0&&r++,u+f},0);return r?s/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,s=r.gl;r.activeTexture.set(s.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(u,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let f=this._emptyDEMTexture;return f?f.update(p,{premultiply:!1}):f=this._emptyDEMTexture=new o.Texture(r,p,s.RGBA,{premultiply:!1}),f}setupElevationDraw(r,s,u){const p=this.painter.context,f=p.gl,g=(v=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(v),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var v;g.u_dem_size=this.sourceCache.getSource().tileSize,g.u_exaggeration=this.exaggeration();let w=null,A=null,I=1;if(u&&u.morphing&&this._useVertexMorphing){const P=u.morphing.srcDemTile,R=u.morphing.dstDemTile;I=u.morphing.phase,P&&R&&(this._prepareDemTileUniforms(r,P,g,"_prev")&&(A=P),this._prepareDemTileUniforms(r,R,g)&&(w=R))}if(A&&w?(p.activeTexture.set(f.TEXTURE2),w.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE,f.NEAREST),p.activeTexture.set(f.TEXTURE4),A.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE,f.NEAREST),g.u_dem_lerp=I):(w=this.terrainTileForTile[r.tileID.key],p.activeTexture.set(f.TEXTURE2),(this._prepareDemTileUniforms(r,w,g)?w.demTexture:this.emptyDEMTexture).bind(f.NEAREST,f.CLAMP_TO_EDGE)),p.activeTexture.set(f.TEXTURE3),u&&u.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),this._depthFBO&&(g.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),g.u_depth_size_inv=[1,1]),u&&u.useMeterToDem&&w){const P=(1<<w.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;g.u_meter_to_dem=P}if(u&&u.labelPlaneMatrixInv&&(g.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),s.setTerrainUniformValues(p,g),this.painter.transform.projection.name==="globe"){const P=this.globeUniformValues(this.painter.transform,r.tileID.canonical,u&&u.useDenormalizedUpVectorScale);s.setGlobeUniformValues(p,P)}}globeUniformValues(r,s,u){const p=r.projection;return{u_tile_tl_up:p.upVector(s,0,0),u_tile_tr_up:p.upVector(s,o.EXTENT,0),u_tile_br_up:p.upVector(s,o.EXTENT,o.EXTENT),u_tile_bl_up:p.upVector(s,0,o.EXTENT),u_tile_up_scale:u?o.GLOBE_METERS_TO_ECEF:p.upVectorScale(s,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const s=this.painter,u=this.painter.context;r.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,f,g,v,w){if(p.transform.projection.name==="globe")(function(A,I,P,R,N){const j=A.context,V=j.gl;let F,U;const X=A.options.showTerrainWireframe?2:0,G=A.transform,Y=o.globeUseCustomAntiAliasing(A,j,G),oe=(Re,Ee)=>{if(U===Re)return;const Pe=[Mo[Re],"PROJECTION_GLOBE_VIEW"];Y&&Pe.push("CUSTOM_ANTIALIASING"),Ee&&Pe.push(Mo[X]),F=A.useProgram("globeRaster",null,Pe),U=Re},ie=A.colorModeForRenderPass(),ce=new o.DepthMode(V.LEQUAL,o.DepthMode.ReadWrite,A.depthRangeFor3D);Hn.update(N);const xe=o.calculateGlobeMercatorMatrix(G),_e=[o.mercatorXfromLng(G.center.lng),o.mercatorYfromLat(G.center.lat)],ue=X?[!1,!0]:[!1],Ue=A.globeSharedBuffers,fe=[G.width*o.exported.devicePixelRatio,G.height*o.exported.devicePixelRatio],Ae=Float32Array.from(G.globeMatrix),be={useDenormalizedUpVectorScale:!0};if(ue.forEach(Re=>{U=-1;const Ee=Re?V.LINES:V.TRIANGLES;for(const Pe of R){const je=P.getTile(Pe),he=o.StencilMode.disabled,ve=I.prevTerrainTileForTile[Pe.key],nt=I.terrainTileForTile[Pe.key];ca(ve,nt)&&Hn.newMorphing(Pe.key,ve,nt,N,250),j.activeTexture.set(V.TEXTURE0),je.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const ut=Hn.getMorphValuesForProxy(Pe.key),ot=ut?1:0;ut&&o.extend$1(be,{morphing:{srcDemTile:ut.from,dstDemTile:ut.to,phase:o.easeCubicInOut(ut.phase)}});const xt=o.tileCornersToBounds(Pe.canonical),At=o.getLatitudinalLod(xt.getCenter().lat),ht=o.getGridMatrix(Pe.canonical,xt,At,G.worldSize/G._pixelsPerMercatorPixel),et=o.globeNormalizeECEF(o.globeTileBounds(Pe.canonical)),ni=ml(G.projMatrix,Ae,xe,et,o.globeToMercatorTransition(G.zoom),_e,G.frustumCorners.TL,G.frustumCorners.TR,G.frustumCorners.BR,G.frustumCorners.BL,G.globeCenterInViewSpace,G.globeRadius,fe,ht);if(oe(ot,Re),I.setupElevationDraw(je,F,be),A.prepareDrawProgram(j,F,Pe.toUnwrapped()),Ue){const[Yt,pi,li]=Re?Ue.getWirefameBuffers(A.context,At):Ue.getGridBuffers(At);F.draw(j,Ee,ce,he,ie,o.CullFaceMode.backCCW,ni,"globe_raster",Yt,pi,li)}}}),Ue){const Re=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Y&&Re.push("CUSTOM_ANTIALIASING"),F=A.useProgram("globeRaster",null,Re);for(const Ee of R){const{x:Pe,y:je,z:he}=Ee.canonical,ve=je===0,nt=je===(1<<he)-1,[ut,ot,xt,At]=Ue.getPoleBuffers(he);if(At&&(ve||nt)){const ht=P.getTile(Ee);j.activeTexture.set(V.TEXTURE0),ht.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let et=o.globePoleMatrixForTile(he,Pe,G);const ni=o.globeNormalizeECEF(o.globeTileBounds(Ee.canonical)),Yt=(pi,li)=>pi.draw(j,V.TRIANGLES,ce,o.StencilMode.disabled,ie,o.CullFaceMode.disabled,ml(G.projMatrix,et,et,ni,0,_e,G.frustumCorners.TL,G.frustumCorners.TR,G.frustumCorners.BR,G.frustumCorners.BL,G.globeCenterInViewSpace,G.globeRadius,fe),"globe_pole_raster",li,xt,At);I.setupElevationDraw(ht,F,be),A.prepareDrawProgram(j,F,Ee.toUnwrapped()),ve&&Yt(F,ut),nt&&(et=o.scale(o.create(),et,[1,-1,1]),Yt(F,ot))}}}})(p,f,g,v,w);else{const A=p.context,I=A.gl;let P,R;const N=p.options.showTerrainWireframe?2:0,j=(G,Y)=>{if(R===G)return;const oe=[Mo[G]];Y&&oe.push(Mo[N]),P=p.useProgram("terrainRaster",null,oe),R=G},V=p.colorModeForRenderPass(),F=new o.DepthMode(I.LEQUAL,o.DepthMode.ReadWrite,p.depthRangeFor3D);Hn.update(w);const U=p.transform,X=6*Math.pow(1.5,22-U.zoom)*f.exaggeration();(N?[!1,!0]:[!1]).forEach(G=>{R=-1;const Y=G?I.LINES:I.TRIANGLES,[oe,ie]=G?f.getWirefameBuffer():[f.gridIndexBuffer,f.gridSegments];for(const ce of v){const xe=g.getTile(ce),_e=o.StencilMode.disabled,ue=f.prevTerrainTileForTile[ce.key],Ue=f.terrainTileForTile[ce.key];ca(ue,Ue)&&Hn.newMorphing(ce.key,ue,Ue,w,250),A.activeTexture.set(I.TEXTURE0),xe.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const fe=Hn.getMorphValuesForProxy(ce.key),Ae=fe?1:0;let be;fe&&(be={morphing:{srcDemTile:fe.from,dstDemTile:fe.to,phase:o.easeCubicInOut(fe.phase)}});const Re=la(ce.projMatrix,ua(ce.canonical,U.renderWorldCopies)?X/10:X);j(Ae,G),f.setupElevationDraw(xe,P,be),p.prepareDrawProgram(A,P,ce.toUnwrapped()),P.draw(A,Y,F,_e,V,o.CullFaceMode.backCCW,Re,"terrain_raster",f.gridBuffer,oe,ie)}})}}(s,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const s=this.painter,u=this.painter.context,p=this.proxySourceCache,f=this.proxiedCoords[p.id],g=this._drapedRenderBatches.shift(),v=[],w=s.style.order;let A=0;for(const I of f){const P=p.getTileByID(I.proxyTileKey),R=p.proxyCachedFBO[I.key]?p.proxyCachedFBO[I.key][r]:void 0,N=R!==void 0?p.renderCache[R]:this.pool[A++],j=R!==void 0;if(P.texture=N.tex,j&&!N.dirty){v.push(P.tileID);continue}let V;u.bindFramebuffer.set(N.fb.framebuffer),this.renderedToTile=!1,N.dirty&&(u.clear({color:o.Color.transparent,stencil:0}),N.dirty=!1);for(let F=g.start;F<=g.end;++F){const U=s.style._layers[w[F]];if(U.isHidden(s.transform.zoom))continue;const X=s.style._getLayerSourceCache(U),G=X?this.proxyToSource[I.key][X.id]:[I];if(!G)continue;const Y=G;u.viewport.set([0,0,N.fb.width,N.fb.height]),V!==(X?X.id:null)&&(this._setupStencil(N,G,U,X),V=X?X.id:null),s.renderLayer(s,X,U,Y)}this.renderedToTile?(N.dirty=!0,v.push(P.tileID)):j||--A,A===5&&(A=0,this.renderToBackBuffer(v))}return this.renderToBackBuffer(v),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),g.end+1}postRender(){}renderCacheEfficiency(r){const s=r.order.length;if(s===0)return{efficiency:100};let u,p=0,f=0,g=!1;for(let v=0;v<s;++v){const w=r._layers[r.order[v]];this._style.isLayerDraped(w)?(g&&++p,++f):g||(g=!0,u=w.id)}return f===0?{efficiency:100}:{efficiency:100*(1-p/f),firstUndrapedLayer:u}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{r=Math.min(r,s.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,s,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(f=>f.dem).map(f=>{const g=f.tileID,v=1<<g.overscaledZ,{x:w,y:A}=g.canonical,I=w/v,P=(w+1)/v,R=A/v,N=(A+1)/v;return{minx:I,miny:R,maxx:P,maxy:N,t:f.dem.tree.raycastRoot(I,R,P,N,r,s,u),tile:f}});p.sort((f,g)=>(f.t!==null?f.t:Number.MAX_VALUE)-(g.t!==null?g.t:Number.MAX_VALUE));for(const f of p){if(f.t==null)return null;const g=f.tile.dem.tree.raycast(f.minx,f.miny,f.maxx,f.maxy,r,s,u);if(g!=null)return g}return null}_createFBO(){const r=this.painter.context,s=r.gl,u=this.drapeBufferSize;r.activeTexture.set(s.TEXTURE0);const p=new o.Texture(r,{width:u[0],height:u[1],data:null},s.RGBA);p.bind(s.LINEAR,s.CLAMP_TO_EDGE);const f=r.createFramebuffer(u[0],u[1],!1);return f.colorAttachment.set(p.texture),f.depthAttachment=new ns(r,f.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,f.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):f.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:f,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const s=this._style._layers[r],u=s.isHidden(this.painter.transform.zoom);return s.type!=="custom"&&!u&&s.hasTransition()})}_clearRasterFadeFromRenderCache(){let r=!1;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof L){r=!0;break}if(r)for(let s=0;s<this._style.order.length;++s){const u=this._style._layers[this._style.order[s]],p=u.isHidden(this.painter.transform.zoom),f=this._style._getLayerSourceCache(u);if(u.type!=="raster"||p||!f)continue;const g=u.paint.get("raster-fade-duration");for(const v of this.proxyCoords){const w=this.proxyToSource[v.key][f.id];if(w)for(const A of w){const I=ha(f.getTile(A),f.findLoadedParent(A,0),f,this.painter.transform,g);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(f.id,A)}}}}_setupDrapedRenderBatches(){const r=this._style.order,s=r.length;if(s===0)return;const u=[];let p,f=0,g=this._style._layers[r[f]];for(;!this._style.isLayerDraped(g)&&g.isHidden(this.painter.transform.zoom)&&++f<s;)g=this._style._layers[r[f]];for(;f<s;++f){const v=this._style._layers[r[f]];v.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(v)?p===void 0&&(p=f):p!==void 0&&(u.push({start:p,end:f-1}),p=void 0))}p!==void 0&&u.push({start:p,end:f-1}),this._drapedRenderBatches=u}_setupRenderCache(r){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const g=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let v=0;v<g.length;++v){const w=Object.values(g[v]);s.renderCachePool.push(...w)}}return}this._clearRasterFadeFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let g=u.length-1;g>=0;g--){const v=u[g];if(s.getTileByID(v.key),s.proxyCachedFBO[v.key]!==void 0){const w=r[v.key],A=this.proxyToSource[v.key];let I=0;for(const P in A){const R=A[P],N=w[P];if(!N||N.length!==R.length||R.some((j,V)=>j!==N[V]||p[P]&&p[P].hasOwnProperty(j.key))){I=-1;break}++I}for(const P in s.proxyCachedFBO[v.key])s.renderCache[s.proxyCachedFBO[v.key][P]].dirty=I<0||I!==Object.values(w).length}}const f=[...this._drapedRenderBatches];f.sort((g,v)=>v.end-v.start-(g.end-g.start));for(const g of f)for(const v of u){if(s.proxyCachedFBO[v.key])continue;let w=s.renderCachePool.pop();w===void 0&&s.renderCache.length<50&&(w=s.renderCache.length,s.renderCache.push(this._createFBO())),w!==void 0&&(s.proxyCachedFBO[v.key]={},s.proxyCachedFBO[v.key][g.start]=w,s.renderCache[w].dirty=!0)}this._tilesDirty={}}_setupStencil(r,s,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const f=this.painter.context,g=f.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let v;if(u.isTileClipped())v=s.length,this._overlapStencilMode.test={func:g.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);v=1,this._overlapStencilMode.test={func:g.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+v>255&&(f.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=v,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(r,s){const u=this.painter,p=this.painter.context,f=p.gl;u._tileClippingMaskIDs={},p.setColorMode(o.ColorMode.disabled),p.setDepthMode(o.DepthMode.disabled);const g=u.useProgram("clippingMask");for(const v of r){const w=u._tileClippingMaskIDs[v.key]=--s;g.draw(p,f.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:f.ALWAYS,mask:0},w,255,f.KEEP,f.KEEP,f.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,vs(v.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(r){const s=this.painter.transform;if(r.x<0||r.x>s.width||r.y<0||r.y>s.height)return null;const u=[r.x,r.y,1,1];o.transformMat4$1(u,u,s.pixelMatrixInverse),o.scale$1(u,u,1/u[3]),u[0]/=s.worldSize,u[1]/=s.worldSize;const p=s._camera.position,f=o.mercatorZfromAltitude(1,s.center.lat),g=[p[0],p[1],p[2]/f,0],v=o.subtract([],u.slice(0,3),g);o.normalize(v,v);const w=this.raycast(g,v,this._exaggeration);return w!==null&&w?(o.scaleAndAdd(g,g,v,w),g[3]=g[2],g[2]*=f,g):null}drawDepth(){const r=this.painter,s=r.context,u=this.proxySourceCache,p=Math.ceil(r.width),f=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===p&&this._depthFBO.height===f||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const g=s.gl,v=s.createFramebuffer(p,f,!0);s.activeTexture.set(g.TEXTURE0);const w=new o.Texture(s,{width:p,height:f,data:null},g.RGBA);w.bind(g.NEAREST,g.CLAMP_TO_EDGE),v.colorAttachment.set(w.texture);const A=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,p,f);v.depthAttachment.set(A),this._depthFBO=v,this._depthTexture=w}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,p,f]),function(g,v,w,A){if(g.transform.projection.name==="globe")return;const I=g.context,P=I.gl;I.clear({depth:1});const R=g.useProgram("terrainDepth"),N=new o.DepthMode(P.LESS,o.DepthMode.ReadWrite,g.depthRangeFor3D);for(const j of A){const V=w.getTile(j),F=la(j.projMatrix,0);v.setupElevationDraw(V,R),R.draw(I,P.TRIANGLES,N,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,F,"terrain_depth",v.gridBuffer,v.gridIndexBuffer,v.gridNoSkirtSegments)}}(r,this,u,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,s,u){if(r.getSource()instanceof se)return this._setupProxiedCoordsForImageSource(r,s,u);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const p=this.proxiedCoords[r.id]=[],f=this.proxyCoords;for(let v=0;v<f.length;v++){const w=f[v],A=this._findTileCoveringTileID(w,r);if(A){const I=this._createProxiedId(w,A,u[w.key]&&u[w.key][r.id]);p.push(I),this.proxyToSource[w.key][r.id]=[I]}}let g=!1;for(let v=0;v<s.length;v++){const w=r.getTile(s[v]);if(!w||!w.hasData())continue;const A=this._findTileCoveringTileID(w.tileID,this.proxySourceCache);if(A&&A.tileID.canonical.z!==w.tileID.canonical.z){const I=this.proxyToSource[A.tileID.key][r.id],P=this._createProxiedId(A.tileID,w,u[A.tileID.key]&&u[A.tileID.key][r.id]);I?I.splice(I.length-1,0,P):this.proxyToSource[A.tileID.key][r.id]=[P],p.push(P),g=!0}}this._sourceTilesOverlap[r.id]=g}_setupProxiedCoordsForImageSource(r,s,u){if(!r.getSource().loaded())return;const p=this.proxiedCoords[r.id]=[],f=this.proxyCoords,g=r.getSource(),v=new o.pointGeometry(g.tileID.x,g.tileID.y)._div(1<<g.tileID.z),w=g.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((I,P)=>(I.min.x=Math.min(I.min.x,P.x-v.x),I.min.y=Math.min(I.min.y,P.y-v.y),I.max.x=Math.max(I.max.x,P.x-v.x),I.max.y=Math.max(I.max.y,P.y-v.y),I),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(I,P)=>{const R=I.wrap+I.canonical.x/(1<<I.canonical.z),N=I.canonical.y/(1<<I.canonical.z),j=o.EXTENT/(1<<I.canonical.z),V=P.wrap+P.canonical.x/(1<<P.canonical.z),F=P.canonical.y/(1<<P.canonical.z);return R+j<V+w.min.x||R>V+w.max.x||N+j<F+w.min.y||N>F+w.max.y};for(let I=0;I<f.length;I++){const P=f[I];for(let R=0;R<s.length;R++){const N=r.getTile(s[R]);if(!N||!N.hasData()||A(P,N.tileID))continue;const j=this._createProxiedId(P,N,u[P.key]&&u[P.key][r.id]),V=this.proxyToSource[P.key][r.id];V?V.push(j):this.proxyToSource[P.key][r.id]=[j],p.push(j)}}}_createProxiedId(r,s,u){let p=this.orthoMatrix;if(u){const f=u.find(g=>g.key===s.tileID.key);if(f)return f}if(s.tileID.key!==r.key){const f=r.canonical.z-s.tileID.canonical.z;let g,v,w;p=o.create();const A=s.tileID.wrap-r.wrap<<r.overscaledZ;f>0?(g=o.EXTENT>>f,v=g*((s.tileID.canonical.x<<f)-r.canonical.x+A),w=g*((s.tileID.canonical.y<<f)-r.canonical.y)):(g=o.EXTENT<<-f,v=o.EXTENT*(s.tileID.canonical.x-(r.canonical.x+A<<-f)),w=o.EXTENT*(s.tileID.canonical.y-(r.canonical.y<<-f))),o.ortho(p,0,g,0,g,0,1),o.translate(p,p,[v,w,0])}return new _l(s.tileID,r.key,p)}_findTileCoveringTileID(r,s){let u=s.getTile(r);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[s.id],f=p[r.key];if(u=f?s.getTileByID(f):null,u&&u.hasData()||f===null)return u;let g=u?u.tileID:r,v=g.overscaledZ;const w=s.getSource().minzoom,A=[];if(!f){const P=s.getSource().maxzoom;if(r.canonical.z>=P){const R=r.canonical.z-P;s.getSource().reparseOverscaled?(v=Math.max(r.canonical.z+2,s.transform.tileZoom),g=new o.OverscaledTileID(v,r.wrap,P,r.canonical.x>>R,r.canonical.y>>R)):R!==0&&(v=P,g=new o.OverscaledTileID(v,r.wrap,P,r.canonical.x>>R,r.canonical.y>>R))}g.key!==r.key&&(A.push(g.key),u=s.getTile(g))}const I=P=>{A.forEach(R=>{p[R]=P}),A.length=0};for(v-=1;v>=w&&(!u||!u.hasData());v--){u&&I(u.tileID.key);const P=g.calculateScaledKey(v);if(u=s.getTileByID(P),u&&u.hasData())break;const R=p[P];if(R===null)break;R===void 0?A.push(P):u=s.getTileByID(R)}return I(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,s){let u=this._tilesDirty[r];u||(u=this._tilesDirty[r]={}),u[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(s){let u=0;const p=new o.StructArrayLayout2ui4,f=131;for(let g=1;g<129;g++){for(let v=1;v<129;v++)u=g*f+v,p.emplaceBack(u,u+1),p.emplaceBack(u,u+f),p.emplaceBack(u+1,u+f),g===128&&p.emplaceBack(u+f,u+f+1);p.emplaceBack(u+1,u+1+f)}return p}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class gl{static cacheKey(r,s,u,p){let f=`${s}${p?p.cacheKey:""}`;for(const g of u)r.usedDefines.includes(g)&&(f+=`/${g}`);return f}constructor(r,s,u,p,f,g){const v=r.gl;this.program=v.createProgram();const w=function(F){const U=[];for(let X=0;X<F.length;X++){if(F[X]===null)continue;const G=F[X].split(" ");U.push(G.pop())}return U}(u.staticAttributes),A=p?p.getBinderAttributes():[],I=w.concat(A);let P=p?p.defines():[];P=P.concat(g.map(F=>`#define ${F}`));const R=P.concat(r.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(gs):gs,gs,jc,pl.fragmentSource,sa.fragmentSource,u.fragmentSource).join(`
`),N=P.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,jc,pl.vertexSource,sa.vertexSource,Uc.vertexSource,u.vertexSource).join(`
`),j=v.createShader(v.FRAGMENT_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);v.shaderSource(j,R),v.compileShader(j),v.attachShader(this.program,j);const V=v.createShader(v.VERTEX_SHADER);if(v.isContextLost())this.failedToCreate=!0;else{v.shaderSource(V,N),v.compileShader(V),v.attachShader(this.program,V),this.attributes={},this.numAttributes=I.length;for(let F=0;F<this.numAttributes;F++)I[F]&&(v.bindAttribLocation(this.program,F,I[F]),this.attributes[I[F]]=F);v.linkProgram(this.program),v.deleteShader(V),v.deleteShader(j),this.fixedUniforms=f(r),this.binderUniforms=p?p.getUniforms(r):[],g.includes("TERRAIN")&&(this.terrainUniforms=(F=>({u_dem:new o.Uniform1i(F),u_dem_prev:new o.Uniform1i(F),u_dem_unpack:new o.Uniform4f(F),u_dem_tl:new o.Uniform2f(F),u_dem_scale:new o.Uniform1f(F),u_dem_tl_prev:new o.Uniform2f(F),u_dem_scale_prev:new o.Uniform1f(F),u_dem_size:new o.Uniform1f(F),u_dem_lerp:new o.Uniform1f(F),u_exaggeration:new o.Uniform1f(F),u_depth:new o.Uniform1i(F),u_depth_size_inv:new o.Uniform2f(F),u_meter_to_dem:new o.Uniform1f(F),u_label_plane_matrix_inv:new o.UniformMatrix4f(F)}))(r)),g.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new o.Uniform3f(F),u_tile_tr_up:new o.Uniform3f(F),u_tile_br_up:new o.Uniform3f(F),u_tile_bl_up:new o.Uniform3f(F),u_tile_up_scale:new o.Uniform1f(F)}))(r)),g.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new o.UniformMatrix4f(F),u_fog_range:new o.Uniform2f(F),u_fog_color:new o.Uniform4f(F),u_fog_horizon_blend:new o.Uniform1f(F),u_fog_temporal_offset:new o.Uniform1f(F),u_frustum_tl:new o.Uniform3f(F),u_frustum_tr:new o.Uniform3f(F),u_frustum_br:new o.Uniform3f(F),u_frustum_bl:new o.Uniform3f(F),u_globe_pos:new o.Uniform3f(F),u_globe_radius:new o.Uniform1f(F),u_globe_transition:new o.Uniform1f(F),u_is_globe:new o.Uniform1i(F),u_viewport:new o.Uniform2f(F)}))(r))}}setTerrainUniformValues(r,s){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const p in s)u[p]&&u[p].set(this.program,p,s[p])}}setGlobeUniformValues(r,s){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const p in s)u[p]&&u[p].set(this.program,p,s[p])}}setFogUniformValues(r,s){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const p in s)u[p].set(this.program,p,s[p])}}draw(r,s,u,p,f,g,v,w,A,I,P,R,N,j,V){const F=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(u),r.setStencilMode(p),r.setColorMode(f),r.setCullFace(g);for(const X of Object.keys(this.fixedUniforms))this.fixedUniforms[X].set(this.program,X,v[X]);j&&j.setUniforms(this.program,r,this.binderUniforms,R,{zoom:N});const U={[F.LINES]:2,[F.TRIANGLES]:3,[F.LINE_STRIP]:1}[s];for(const X of P.get()){const G=X.vaos||(X.vaos={});(G[w]||(G[w]=new Nc)).bind(r,this,A,j?j.getPaintVertexBuffers():[],I,X.vertexOffset,V||[]),F.drawElements(s,X.primitiveLength*U,F.UNSIGNED_SHORT,X.primitiveOffset*U*2)}}}function da(l,r){const s=Math.pow(2,r.tileID.overscaledZ),u=r.tileSize*Math.pow(2,l.transform.tileZoom)/s,p=u*(r.tileID.canonical.x+r.tileID.wrap*s),f=u*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/Gt(r,1,l.transform.tileZoom),u_pixel_coord_upper:[p>>16,f>>16],u_pixel_coord_lower:[65535&p,65535&f]}}const Gc=o.create(),$c=(l,r,s,u,p,f,g,v,w,A,I)=>{const P=r.style.light,R=P.properties.get("position"),N=[R.x,R.y,R.z],j=o.create$1();P.properties.get("anchor")==="viewport"&&(o.fromRotation(j,-r.transform.angle),o.transformMat3(N,N,j));const V=P.properties.get("color"),F=r.transform,U={u_matrix:l,u_lightpos:N,u_lightintensity:P.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+s,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:p,u_edge_radius:f};return F.projection.name==="globe"&&(U.u_tile_id=[g.canonical.x,g.canonical.y,1<<g.canonical.z],U.u_zoom_transition=w,U.u_inv_rot_matrix=I,U.u_merc_center=A,U.u_up_dir=F.projection.upVector(new o.CanonicalTileID(0,0,0),A[0]*o.EXTENT,A[1]*o.EXTENT),U.u_height_lift=v),U},Bh=(l,r,s,u,p,f,g,v,w,A,I,P)=>{const R=$c(l,r,s,u,p,f,g,w,A,I,P),N={u_height_factor:-Math.pow(2,g.overscaledZ)/v.tileSize/8};return o.extend(R,da(r,v),N)},fa=l=>({u_matrix:l}),ma=(l,r,s)=>o.extend(fa(l),da(r,s)),yl=(l,r)=>({u_matrix:l,u_world:r}),xl=(l,r,s,u)=>o.extend(ma(l,r,s),{u_world:u}),qc=o.create(),Zc=(l,r,s,u,p,f)=>{const g=l.transform,v=g.projection.name==="globe";let w;if(f.paint.get("circle-pitch-alignment")==="map")if(v){const I=o.globePixelsToTileUnits(g.zoom,r.canonical)*g._pixelsPerMercatorPixel;w=Float32Array.from([I,0,0,I])}else w=g.calculatePixelsToTileUnitsMatrix(s);else w=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:g.cameraToCenterDistance,u_matrix:l.translatePosMatrix(r.projMatrix,s,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:qc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(v){A.u_inv_rot_matrix=u,A.u_merc_center=p,A.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],A.u_zoom_transition=o.globeToMercatorTransition(g.zoom);const I=p[0]*o.EXTENT,P=p[1]*o.EXTENT;A.u_up_dir=g.projection.upVector(new o.CanonicalTileID(0,0,0),I,P)}return A},Oh=l=>{const r=[];return l.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},bs=(l,r,s,u)=>{const p=o.EXTENT/s.tileSize;return{u_matrix:l,u_camera_to_center_distance:r.getCameraToCenterDistance(u),u_extrude_scale:[r.pixelsToGLUnits[0]/p,r.pixelsToGLUnits[1]/p]}},Co=(l,r,s=1)=>({u_matrix:l,u_color:r,u_overlay:0,u_overlay_scale:s}),Xc=o.create(),_a=(l,r,s,u,p,f,g)=>{const v=l.transform,w=v.projection.name==="globe",A=w?o.globePixelsToTileUnits(v.zoom,r.canonical)*v._pixelsPerMercatorPixel:Gt(s,1,f),I={u_matrix:r.projMatrix,u_extrude_scale:A,u_intensity:g,u_inv_rot_matrix:Xc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(w){I.u_inv_rot_matrix=u,I.u_merc_center=p,I.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],I.u_zoom_transition=o.globeToMercatorTransition(v.zoom);const P=p[0]*o.EXTENT,R=p[1]*o.EXTENT;I.u_up_dir=v.projection.upVector(new o.CanonicalTileID(0,0,0),P,R)}return I},vl=(l,r,s,u,p,f,g)=>{const v=l.transform,w=v.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:bl(l,r,s,u),u_pixels_to_tile_units:w,u_device_pixel_ratio:f,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:ya(s)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ga(r,l.transform),u_alpha_discard_threshold:0,u_trim_offset:g}},Xr=(l,r,s,u,p)=>{const f=l.transform;return{u_matrix:bl(l,r,s,u),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:p,u_image:0,u_tile_units_to_pixels:ga(r,f),u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ga(l,r){return 1/Gt(l,1,r.tileZoom)}function bl(l,r,s,u){return l.translatePosMatrix(u||r.tileID.projMatrix,r,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}function ya(l){const r=l.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const Wc=(l,r,s,u,p,f)=>{return{u_matrix:l,u_tl_parent:r,u_scale_parent:s,u_fade_t:u.mix,u_opacity:u.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(v=p.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(g=p.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:wl(p.paint.get("raster-hue-rotate")),u_perspective_transform:f};var g,v};function wl(l){l*=Math.PI/180;const r=Math.sin(l),s=Math.cos(l);return[(2*s+1)/3,(-Math.sqrt(3)*r-s+1)/3,(Math.sqrt(3)*r-s+1)/3]}const Hc=o.create(),xa=(l,r,s,u,p,f,g,v,w,A,I,P,R,N,j,V)=>{const F=p.transform,U={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_rotate_symbol:+s,u_aspect_ratio:F.width/F.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:g,u_coord_matrix:v,u_is_text:+w,u_pitch_with_map:+u,u_texsize:A,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Hc,u_up_vector:[0,-1,0]};return V.name==="globe"&&(U.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],U.u_zoom_transition=P,U.u_inv_rot_matrix=N,U.u_merc_center=R,U.u_camera_forward=F._camera.forward(),U.u_ecef_origin=o.globeECEFOrigin(F.globeMatrix,I.toUnwrapped()),U.u_tile_matrix=Float32Array.from(F.globeMatrix),U.u_up_vector=j),U},Yc=(l,r,s,u,p,f,g,v,w,A,I,P,R,N,j,V,F)=>o.extend(xa(l,r,s,u,p,f,g,v,w,A,P,R,N,j,V,F),{u_gamma_scale:u?p.transform.cameraToCenterDistance*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+I}),va=(l,r,s,u,p,f,g,v,w,A,I,P,R,N,j,V)=>o.extend(Yc(l,r,s,u,p,f,g,v,!0,w,!0,I,P,R,N,j,V),{u_texsize_icon:A,u_texture_icon:1}),Fh=(l,r,s)=>({u_matrix:l,u_opacity:r,u_color:s}),Tl=(l,r,s,u,p)=>o.extend(function(f,g,v){const w=g.imageManager.getPattern(f.toString()),{width:A,height:I}=g.imageManager.getPixelSize(),P=Math.pow(2,v.tileID.overscaledZ),R=v.tileSize*Math.pow(2,g.transform.tileZoom)/P,N=R*(v.tileID.canonical.x+v.tileID.wrap*P),j=R*v.tileID.canonical.y;return{u_image:0,u_pattern_tl:w.tl,u_pattern_br:w.br,u_texsize:[A,I],u_pattern_size:w.displaySize,u_tile_units_to_pixels:1/Gt(v,1,g.transform.tileZoom),u_pixel_coord_upper:[N>>16,j>>16],u_pixel_coord_lower:[65535&N,65535&j]}}(u,s,p),{u_matrix:l,u_opacity:r}),Uh={fillExtrusion:l=>({u_matrix:new o.UniformMatrix4f(l),u_lightpos:new o.Uniform3f(l),u_lightintensity:new o.Uniform1f(l),u_lightcolor:new o.Uniform3f(l),u_vertical_gradient:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_edge_radius:new o.Uniform1f(l),u_ao:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_up_dir:new o.Uniform3f(l),u_height_lift:new o.Uniform1f(l)}),fillExtrusionPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_lightpos:new o.Uniform3f(l),u_lightintensity:new o.Uniform1f(l),u_lightcolor:new o.Uniform3f(l),u_vertical_gradient:new o.Uniform1f(l),u_height_factor:new o.Uniform1f(l),u_edge_radius:new o.Uniform1f(l),u_ao:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_up_dir:new o.Uniform3f(l),u_height_lift:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l)}),fill:l=>({u_matrix:new o.UniformMatrix4f(l)}),fillPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l)}),fillOutline:l=>({u_matrix:new o.UniformMatrix4f(l),u_world:new o.Uniform2f(l)}),fillOutlinePattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_world:new o.Uniform2f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l)}),circle:l=>({u_camera_to_center_distance:new o.Uniform1f(l),u_extrude_scale:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_up_dir:new o.Uniform3f(l)}),collisionBox:l=>({u_matrix:new o.UniformMatrix4f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_extrude_scale:new o.Uniform2f(l)}),collisionCircle:l=>({u_matrix:new o.UniformMatrix4f(l),u_inv_matrix:new o.UniformMatrix4f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_viewport_size:new o.Uniform2f(l)}),debug:l=>({u_color:new o.UniformColor(l),u_matrix:new o.UniformMatrix4f(l),u_overlay:new o.Uniform1i(l),u_overlay_scale:new o.Uniform1f(l)}),clippingMask:l=>({u_matrix:new o.UniformMatrix4f(l)}),heatmap:l=>({u_extrude_scale:new o.Uniform1f(l),u_intensity:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_up_dir:new o.Uniform3f(l)}),heatmapTexture:l=>({u_image:new o.Uniform1i(l),u_color_ramp:new o.Uniform1i(l),u_opacity:new o.Uniform1f(l)}),hillshade:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_latrange:new o.Uniform2f(l),u_light:new o.Uniform2f(l),u_shadow:new o.UniformColor(l),u_highlight:new o.UniformColor(l),u_accent:new o.UniformColor(l)}),hillshadePrepare:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_dimension:new o.Uniform2f(l),u_zoom:new o.Uniform1f(l),u_unpack:new o.Uniform4f(l)}),line:l=>({u_matrix:new o.UniformMatrix4f(l),u_pixels_to_tile_units:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_units_to_pixels:new o.Uniform2f(l),u_dash_image:new o.Uniform1i(l),u_gradient_image:new o.Uniform1i(l),u_image_height:new o.Uniform1f(l),u_texsize:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l),u_alpha_discard_threshold:new o.Uniform1f(l),u_trim_offset:new o.Uniform2f(l)}),linePattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_texsize:new o.Uniform2f(l),u_pixels_to_tile_units:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_units_to_pixels:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l),u_alpha_discard_threshold:new o.Uniform1f(l)}),raster:l=>({u_matrix:new o.UniformMatrix4f(l),u_tl_parent:new o.Uniform2f(l),u_scale_parent:new o.Uniform1f(l),u_fade_t:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_image0:new o.Uniform1i(l),u_image1:new o.Uniform1i(l),u_brightness_low:new o.Uniform1f(l),u_brightness_high:new o.Uniform1f(l),u_saturation_factor:new o.Uniform1f(l),u_contrast_factor:new o.Uniform1f(l),u_spin_weights:new o.Uniform3f(l),u_perspective_transform:new o.Uniform2f(l)}),symbolIcon:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_camera_forward:new o.Uniform3f(l),u_tile_matrix:new o.UniformMatrix4f(l),u_up_vector:new o.Uniform3f(l),u_ecef_origin:new o.Uniform3f(l),u_texture:new o.Uniform1i(l)}),symbolSDF:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_texture:new o.Uniform1i(l),u_gamma_scale:new o.Uniform1f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_camera_forward:new o.Uniform3f(l),u_tile_matrix:new o.UniformMatrix4f(l),u_up_vector:new o.Uniform3f(l),u_ecef_origin:new o.Uniform3f(l),u_is_halo:new o.Uniform1i(l)}),symbolTextAndIcon:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_texsize_icon:new o.Uniform2f(l),u_texture:new o.Uniform1i(l),u_texture_icon:new o.Uniform1i(l),u_gamma_scale:new o.Uniform1f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_is_halo:new o.Uniform1i(l)}),background:l=>({u_matrix:new o.UniformMatrix4f(l),u_opacity:new o.Uniform1f(l),u_color:new o.UniformColor(l)}),backgroundPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_opacity:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_pattern_tl:new o.Uniform2f(l),u_pattern_br:new o.Uniform2f(l),u_texsize:new o.Uniform2f(l),u_pattern_size:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l)}),terrainRaster:xs,terrainDepth:xs,skybox:l=>({u_matrix:new o.UniformMatrix4f(l),u_sun_direction:new o.Uniform3f(l),u_cubemap:new o.Uniform1i(l),u_opacity:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l)}),skyboxGradient:l=>({u_matrix:new o.UniformMatrix4f(l),u_color_ramp:new o.Uniform1i(l),u_center_direction:new o.Uniform3f(l),u_radius:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l)}),skyboxCapture:l=>({u_matrix_3f:new o.UniformMatrix3f(l),u_sun_direction:new o.Uniform3f(l),u_sun_intensity:new o.Uniform1f(l),u_color_tint_r:new o.Uniform4f(l),u_color_tint_m:new o.Uniform4f(l),u_luminance:new o.Uniform1f(l)}),globeRaster:l=>({u_proj_matrix:new o.UniformMatrix4f(l),u_globe_matrix:new o.UniformMatrix4f(l),u_normalize_matrix:new o.UniformMatrix4f(l),u_merc_matrix:new o.UniformMatrix4f(l),u_zoom_transition:new o.Uniform1f(l),u_merc_center:new o.Uniform2f(l),u_image0:new o.Uniform1i(l),u_grid_matrix:new o.UniformMatrix3f(l),u_frustum_tl:new o.Uniform3f(l),u_frustum_tr:new o.Uniform3f(l),u_frustum_br:new o.Uniform3f(l),u_frustum_bl:new o.Uniform3f(l),u_globe_pos:new o.Uniform3f(l),u_globe_radius:new o.Uniform1f(l),u_viewport:new o.Uniform2f(l)}),globeAtmosphere:l=>({u_frustum_tl:new o.Uniform3f(l),u_frustum_tr:new o.Uniform3f(l),u_frustum_br:new o.Uniform3f(l),u_frustum_bl:new o.Uniform3f(l),u_horizon:new o.Uniform1f(l),u_transition:new o.Uniform1f(l),u_fadeout_range:new o.Uniform1f(l),u_color:new o.Uniform4f(l),u_high_color:new o.Uniform4f(l),u_space_color:new o.Uniform4f(l),u_star_intensity:new o.Uniform1f(l),u_star_density:new o.Uniform1f(l),u_star_size:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l),u_horizon_angle:new o.Uniform1f(l),u_rotation_matrix:new o.UniformMatrix4f(l)})};let ko;function Kc(l,r,s,u,p,f,g){const v=l.context,w=v.gl,A=l.transform,I=l.useProgram("collisionBox"),P=[];let R=0,N=0;for(let Y=0;Y<u.length;Y++){const oe=u[Y],ie=r.getTile(oe),ce=ie.getBucket(s);if(!ce)continue;const xe=ls(oe,ce,A);let _e=xe;p[0]===0&&p[1]===0||(_e=l.translatePosMatrix(xe,ie,p,f));const ue=g?ce.textCollisionBox:ce.iconCollisionBox,Ue=ce.collisionCircleArray;if(Ue.length>0){const fe=o.create(),Ae=_e;o.mul(fe,ce.placementInvProjMatrix,A.glCoordMatrix),o.mul(fe,fe,ce.placementViewportMatrix),P.push({circleArray:Ue,circleOffset:N,transform:Ae,invTransform:fe,projection:ce.getProjection()}),R+=Ue.length/4,N=R}ue&&(l.terrain&&l.terrain.setupElevationDraw(ie,I),I.draw(v,w.LINES,o.DepthMode.disabled,o.StencilMode.disabled,l.colorModeForRenderPass(),o.CullFaceMode.disabled,bs(_e,A,ie,ce.getProjection()),s.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,null,A.zoom,null,[ue.collisionVertexBuffer,ue.collisionVertexBufferExt]))}if(!g||!P.length)return;const j=l.useProgram("collisionCircle"),V=new o.StructArrayLayout2f1f2i16;V.resize(4*R),V._trim();let F=0;for(const Y of P)for(let oe=0;oe<Y.circleArray.length/4;oe++){const ie=4*oe,ce=Y.circleArray[ie+0],xe=Y.circleArray[ie+1],_e=Y.circleArray[ie+2],ue=Y.circleArray[ie+3];V.emplace(F++,ce,xe,_e,ue,0),V.emplace(F++,ce,xe,_e,ue,1),V.emplace(F++,ce,xe,_e,ue,2),V.emplace(F++,ce,xe,_e,ue,3)}(!ko||ko.length<2*R)&&(ko=function(Y){const oe=2*Y,ie=new o.StructArrayLayout3ui6;ie.resize(oe),ie._trim();for(let ce=0;ce<oe;ce++){const xe=6*ce;ie.uint16[xe+0]=4*ce+0,ie.uint16[xe+1]=4*ce+1,ie.uint16[xe+2]=4*ce+2,ie.uint16[xe+3]=4*ce+2,ie.uint16[xe+4]=4*ce+3,ie.uint16[xe+5]=4*ce+0}return ie}(R));const U=v.createIndexBuffer(ko,!0),X=v.createVertexBuffer(V,o.collisionCircleLayout.members,!0);for(const Y of P){const oe={u_matrix:Y.transform,u_inv_matrix:Y.invTransform,u_camera_to_center_distance:(G=A).getCameraToCenterDistance(Y.projection),u_viewport_size:[G.width,G.height]};j.draw(v,w.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,l.colorModeForRenderPass(),o.CullFaceMode.disabled,oe,s.id,X,U,o.SegmentVector.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,A.zoom)}var G;X.destroy(),U.destroy()}const ws=o.create();function jh({width:l,height:r,anchor:s,textOffset:u,textScale:p},f){const{horizontalAlign:g,verticalAlign:v}=o.getAnchorAlignment(s),w=-(g-.5)*l,A=-(v-.5)*r,I=o.evaluateVariableOffset(s,u);return new o.pointGeometry((w/p+I[0])*f,(A/p+I[1])*f)}function Jc(l,r,s,u,p,f,g,v,w,A,I){const P=l.text.placedSymbolArray,R=l.text.dynamicLayoutVertexArray,N=l.icon.dynamicLayoutVertexArray,j={},V=l.getProjection(),F=cs(v,V,f),U=f.elevation,X=V.upVectorScale(v.canonical,f.center.lat,f.worldSize).metersToTile;R.clear();for(let G=0;G<P.length;G++){const Y=P.get(G),{tileAnchorX:oe,tileAnchorY:ie,numGlyphs:ce}=Y,xe=l.allowVerticalPlacement&&!Y.placedOrientation,_e=Y.hidden||!Y.crossTileID||xe?null:u[Y.crossTileID];if(_e){let ue=0,Ue=0,fe=0;if(U){const nt=U?U.getAtTileOffset(v,oe,ie):0,[ut,ot,xt]=V.upVector(v.canonical,oe,ie);ue=nt*ut*X,Ue=nt*ot*X,fe=nt*xt*X}let[Ae,be,Re,Ee]=ur(Y.projectedAnchorX+ue,Y.projectedAnchorY+Ue,Y.projectedAnchorZ+fe,s?F:g);const Pe=Je(f.getCameraToCenterDistance(V),Ee);let je=p.evaluateSizeForFeature(l.textSizeData,A,Y)*Pe/o.ONE_EM;s&&(je*=l.tilePixelRatio/w);const he=jh(_e,je);s?({x:Ae,y:be,z:Re}=V.projectTilePoint(oe+he.x,ie+he.y,v.canonical),[Ae,be,Re]=ur(Ae+ue,be+Ue,Re+fe,g)):(r&&he._rotate(-f.angle),Ae+=he.x,be+=he.y,Re=0);const ve=l.allowVerticalPlacement&&Y.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let nt=0;nt<ce;nt++)o.addDynamicAttributes(R,Ae,be,Re,ve);I&&Y.associatedIconIndex>=0&&(j[Y.associatedIconIndex]={x:Ae,y:be,z:Re,angle:ve})}else Hi(ce,R)}if(I){N.clear();const G=l.icon.placedSymbolArray;for(let Y=0;Y<G.length;Y++){const oe=G.get(Y),{numGlyphs:ie}=oe,ce=j[Y];if(oe.hidden||!ce)Hi(ie,N);else{const{x:xe,y:_e,z:ue,angle:Ue}=ce;for(let fe=0;fe<ie;fe++)o.addDynamicAttributes(N,xe,_e,ue,Ue)}}l.icon.dynamicLayoutVertexBuffer.updateData(N)}l.text.dynamicLayoutVertexBuffer.updateData(R)}function Qc(l,r,s){return s.iconsInText&&r?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Yn(l,r,s,u,p,f,g,v,w,A,I,P){const R=l.context,N=R.gl,j=l.transform,V=v==="map",F=w==="map",U=V&&s.layout.get("symbol-placement")!=="point",X=V&&!F&&!U,G=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Y=!1;const oe=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),ie=[o.mercatorXfromLng(j.center.lng),o.mercatorYfromLat(j.center.lat)],ce=s.layout.get("text-variable-anchor"),xe=j.projection.name==="globe",_e=[],ue=[0,-1,0];let Ue=ue;!xe&&!j.mercatorFromTransition||V||(Ue=function(fe){const Ae=fe._camera.getWorldToCamera(fe.worldSize,1),be=o.multiply([],Ae,fe.globeMatrix);o.invert(be,be);const Re=[0,0,0],Ee=[0,1,0,0];return o.transformMat4$1(Ee,Ee,be),Re[0]=Ee[0],Re[1]=Ee[1],Re[2]=Ee[2],o.normalize(Re,Re),Re}(j));for(const fe of u){const Ae=r.getTile(fe),be=Ae.getBucket(s);if(!be||be.projection.name==="mercator"&&xe)continue;const Re=p?be.text:be.icon;if(!Re||be.fullyClipped||!Re.segments.get().length)continue;const Ee=Re.programConfigurations.get(s.id),Pe=p||be.sdfIcons,je=p?be.textSizeData:be.iconSizeData,he=F||j.pitch!==0,ve=o.evaluateSizeForZoom(je,j.zoom);let nt,ut,ot,xt,At=[0,0],ht=null;if(p){if(ut=Ae.glyphAtlasTexture,ot=N.LINEAR,nt=Ae.glyphAtlasTexture.size,be.iconsInText){At=Ae.imageAtlasTexture.size,ht=Ae.imageAtlasTexture;const Pr=je.kind==="composite"||je.kind==="camera";xt=he||l.options.rotating||l.options.zooming||Pr?N.LINEAR:N.NEAREST}}else{const Pr=s.layout.get("icon-size").constantOr(0)!==1||be.iconsNeedLinear;ut=Ae.imageAtlasTexture,ot=Pe||l.options.rotating||l.options.zooming||Pr||he?N.LINEAR:N.NEAREST,nt=Ae.imageAtlasTexture.size}const et=be.projection.name==="globe",ni=et?Ue:ue,Yt=et?o.globeToMercatorTransition(j.zoom):0,pi=cs(fe,be.getProjection(),j),li=j.calculatePixelsToTileUnitsMatrix(Ae),gr=Sr(pi,Ae.tileID.canonical,F,V,j,be.getProjection(),li),Ar=l.terrain&&F&&U?o.invert(o.create(),gr):ws,hr=Lc(pi,Ae.tileID.canonical,F,V,j,be.getProjection(),li),Yr=ce&&be.hasTextData(),xi=s.layout.get("icon-text-fit")!=="none"&&Yr&&be.hasIconData();if(U){const Pr=j.elevation,Kr=Pr?Pr.getAtTileOffsetFunc(fe,j.center.lat,j.worldSize,be.getProjection()):null,Jr=Js(pi,Ae.tileID.canonical,F,V,j,be.getProjection(),li);Lt(be,pi,l,p,Jr,hr,F,A,Kr,fe)}const di=U||p&&ce||xi,Xt=l.translatePosMatrix(pi,Ae,f,g),Di=di?ws:gr,or=l.translatePosMatrix(hr,Ae,f,g,!0),fi=be.getProjection().createInversionMatrix(j,fe.canonical),pr=[];l.terrainRenderModeElevated()&&F&&pr.push("PITCH_WITH_MAP_TERRAIN"),et&&pr.push("PROJECTION_GLOBE_VIEW"),di&&pr.push("PROJECTED_POS_ON_VIEWPORT");const Ds=Pe&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let dn;dn=Pe?be.iconsInText?va(je.kind,ve,X,F,l,Xt,Di,or,nt,At,fe,Yt,ie,fi,ni,be.getProjection()):Yc(je.kind,ve,X,F,l,Xt,Di,or,p,nt,!0,fe,Yt,ie,fi,ni,be.getProjection()):xa(je.kind,ve,X,F,l,Xt,Di,or,p,nt,fe,Yt,ie,fi,ni,be.getProjection());const sr={program:l.useProgram(Qc(Pe,p,be),Ee,pr),buffers:Re,uniformValues:dn,atlasTexture:ut,atlasTextureIcon:ht,atlasInterpolation:ot,atlasInterpolationIcon:xt,isSDF:Pe,hasHalo:Ds,tile:Ae,labelPlaneMatrixInv:Ar};if(G&&be.canOverlap){Y=!0;const Pr=Re.segments.get();for(const Kr of Pr)_e.push({segments:new o.SegmentVector([Kr]),sortKey:Kr.sortKey,state:sr})}else _e.push({segments:Re.segments,sortKey:0,state:sr})}Y&&_e.sort((fe,Ae)=>fe.sortKey-Ae.sortKey);for(const fe of _e){const Ae=fe.state;if(l.terrain&&l.terrain.setupElevationDraw(Ae.tile,Ae.program,{useDepthForOcclusion:!xe,labelPlaneMatrixInv:Ae.labelPlaneMatrixInv}),R.activeTexture.set(N.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,N.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(R.activeTexture.set(N.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,N.CLAMP_TO_EDGE)),Ae.isSDF){const be=Ae.uniformValues;Ae.hasHalo&&(be.u_is_halo=1,eu(Ae.buffers,fe.segments,s,l,Ae.program,oe,I,P,be)),be.u_is_halo=0}eu(Ae.buffers,fe.segments,s,l,Ae.program,oe,I,P,Ae.uniformValues)}}function eu(l,r,s,u,p,f,g,v,w){const A=u.context,I=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.globeExtVertexBuffer];p.draw(A,A.gl.TRIANGLES,f,g,v,o.CullFaceMode.disabled,w,s.id,l.layoutVertexBuffer,l.indexBuffer,r,s.paint,u.transform.zoom,l.programConfigurations.get(s.id),I)}function tu(l,r,s,u,p,f,g){const v=l.context.gl,w=s.paint.get("fill-pattern"),A=w&&w.constantOr(1);let I,P,R,N,j;g?(P=A&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=v.LINES):(P=A?"fillPattern":"fill",I=v.TRIANGLES);for(const V of u){const F=r.getTile(V);if(A&&!F.patternsLoaded())continue;const U=F.getBucket(s);if(!U)continue;l.prepareDrawTile();const X=U.programConfigurations.get(s.id),G=l.useProgram(P,X);A&&(l.context.activeTexture.set(v.TEXTURE0),F.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),X.updatePaintBuffers());const Y=w.constantOr(null);if(Y&&F.imageAtlas){const ie=F.imageAtlas.patternPositions[Y.toString()];ie&&X.setConstantPatternPositions(ie)}const oe=l.translatePosMatrix(V.projMatrix,F,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(g){N=U.indexBuffer2,j=U.segments2;const ie=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[v.drawingBufferWidth,v.drawingBufferHeight];R=P==="fillOutlinePattern"&&A?xl(oe,l,F,ie):yl(oe,ie)}else N=U.indexBuffer,j=U.segments,R=A?ma(oe,l,F):fa(oe);l.prepareDrawProgram(l.context,G,V.toUnwrapped()),G.draw(l.context,I,p,l.stencilModeForClipping(V),f,o.CullFaceMode.disabled,R,s.id,U.layoutVertexBuffer,N,j,s.paint,l.transform.zoom,X)}}function El(l,r,s,u,p,f,g){const v=l.context,w=v.gl,A=l.transform,I=s.paint.get("fill-extrusion-pattern"),P=I.constantOr(1),R=s.paint.get("fill-extrusion-opacity"),N=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),s.paint.get("fill-extrusion-ambient-occlusion-radius")],j=s.layout.get("fill-extrusion-edge-radius"),V=A.projection.name==="globe"?o.fillExtrusionHeightLift():0,F=A.projection.name==="globe",U=F?o.globeToMercatorTransition(A.zoom):0,X=[o.mercatorXfromLng(A.center.lng),o.mercatorYfromLat(A.center.lat)],G=[];F&&(G.push("PROJECTION_GLOBE_VIEW"),l.style.terrainSetForDrapingOnly()&&G.push("TERRAIN")),N[0]>0&&G.push("FAUX_AO");for(const Y of u){const oe=r.getTile(Y),ie=oe.getBucket(s);if(!ie||ie.projection.name!==A.projection.name)continue;const ce=ie.programConfigurations.get(s.id),xe=l.useProgram(P?"fillExtrusionPattern":"fillExtrusion",ce,G);if(l.terrain){const Re=l.terrain;if(l.style.terrainSetForDrapingOnly())Re.setupElevationDraw(oe,xe,{useMeterToDem:!0});else{if(!ie.enableTerrain)continue;if(Re.setupElevationDraw(oe,xe,{useMeterToDem:!0}),Nh(v,r,Y,ie,s,Re),!ie.centroidVertexBuffer){const Ee=xe.attributes.a_centroid_pos;Ee!==void 0&&w.vertexAttrib2f(Ee,0,0)}}}P&&(l.context.activeTexture.set(w.TEXTURE0),oe.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ce.updatePaintBuffers());const _e=I.constantOr(null);if(_e&&oe.imageAtlas){const Re=oe.imageAtlas.patternPositions[_e.toString()];Re&&ce.setConstantPatternPositions(Re)}const ue=l.translatePosMatrix(Y.projMatrix,oe,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ue=A.projection.createInversionMatrix(A,Y.canonical),fe=s.paint.get("fill-extrusion-vertical-gradient"),Ae=P?Bh(ue,l,fe,R,N,j,Y,oe,V,U,X,Ue):$c(ue,l,fe,R,N,j,Y,V,U,X,Ue);l.prepareDrawProgram(v,xe,Y.toUnwrapped());const be=[];l.terrain&&be.push(ie.centroidVertexBuffer),F&&be.push(ie.layoutVertexExtBuffer),xe.draw(v,v.gl.TRIANGLES,p,f,g,o.CullFaceMode.backCCW,Ae,s.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,s.paint,l.transform.zoom,ce,be)}}function Nh(l,r,s,u,p,f){const g=[U=>{let X=U.canonical.x-1,G=U.wrap;return X<0&&(X=(1<<U.canonical.z)-1,G--),new o.OverscaledTileID(U.overscaledZ,G,U.canonical.z,X,U.canonical.y)},U=>{let X=U.canonical.x+1,G=U.wrap;return X===1<<U.canonical.z&&(X=0,G++),new o.OverscaledTileID(U.overscaledZ,G,U.canonical.z,X,U.canonical.y)},U=>new o.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(U.canonical.y===0?1<<U.canonical.z:U.canonical.y)-1),U=>new o.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],v=U=>{const X=r.getSource().minzoom,G=oe=>{const ie=r.getTileByID(oe);if(ie&&ie.hasData())return ie.getBucket(p)},Y=[0,-1,1];for(const oe of Y){if(U.overscaledZ+oe<X)continue;const ie=G(U.calculateScaledKey(U.overscaledZ+oe));if(ie)return ie}},w=[0,0,0],A=(U,X)=>(w[0]=Math.min(U.min.y,X.min.y),w[1]=Math.max(U.max.y,X.max.y),w[2]=o.EXTENT-X.min.x>U.max.x?X.min.x-o.EXTENT:U.max.x,w),I=(U,X)=>(w[0]=Math.min(U.min.x,X.min.x),w[1]=Math.max(U.max.x,X.max.x),w[2]=o.EXTENT-X.min.y>U.max.y?X.min.y-o.EXTENT:U.max.y,w),P=[(U,X)=>A(U,X),(U,X)=>A(X,U),(U,X)=>I(U,X),(U,X)=>I(X,U)],R=new o.pointGeometry(0,0);let N,j,V;const F=(U,X,G,Y,oe)=>{const ie=[[Y?G:U,Y?U:G,0],[Y?G:X,Y?X:G,0]],ce=oe<0?o.EXTENT+oe:oe,xe=[Y?ce:(U+X)/2,Y?(U+X)/2:ce,0];return G===0&&oe<0||G!==0&&oe>0?f.getForTilePoints(V,[xe],!0,j):ie.push(xe),f.getForTilePoints(s,ie,!0,N),Math.max(ie[0][2],ie[1][2],xe[2])/f.exaggeration()};for(let U=0;U<4;U++){const X=(U<2?1:5)-U,G=u.borders[U];if(G.length===0)continue;const Y=V=g[U](s),oe=v(Y);if(!(oe&&oe instanceof o.FillExtrusionBucket&&oe.enableTerrain)||u.borderDoneWithNeighborZ[U]===oe.canonical.z&&oe.borderDoneWithNeighborZ[X]===u.canonical.z||(j=f.findDEMTileFor(Y),!j||!j.dem))continue;if(!N){const _e=f.findDEMTileFor(s);if(!_e||!_e.dem)return;N=_e}const ie=oe.borders[X];let ce=0;const xe=oe.borderDoneWithNeighborZ[X]!==u.canonical.z;if(u.canonical.z===oe.canonical.z){for(let _e=0;_e<G.length;_e++){const ue=u.featuresOnBorder[G[_e]],Ue=ue.borders[U];let fe;for(;ce<ie.length&&(fe=oe.featuresOnBorder[ie[ce]],!(fe.borders[X][1]>Ue[0]+3));)xe&&oe.encodeCentroid(void 0,fe,!1),ce++;if(fe&&ce<ie.length){const Ae=ce;let be=0;for(;!(fe.borders[X][0]>Ue[1]-3)&&(be++,++ce!==ie.length);)fe=oe.featuresOnBorder[ie[ce]];if(fe=oe.featuresOnBorder[ie[Ae]],ue.intersectsCount()>1||fe.intersectsCount()>1||be!==1){be!==1&&(ce=Ae),u.encodeCentroid(void 0,ue,!1),xe&&oe.encodeCentroid(void 0,fe,!1);continue}const Re=P[U](ue,fe),Ee=U%2?o.EXTENT-1:0;R.x=F(Re[0],Math.min(o.EXTENT-1,Re[1]),Ee,U<2,Re[2]),R.y=0,u.encodeCentroid(R,ue,!1),xe&&oe.encodeCentroid(R,fe,!1)}else u.encodeCentroid(void 0,ue,!1)}u.borderDoneWithNeighborZ[U]=oe.canonical.z,u.needsCentroidUpdate=!0,xe&&(oe.borderDoneWithNeighborZ[X]=u.canonical.z,oe.needsCentroidUpdate=!0)}else{for(const _e of G)u.encodeCentroid(void 0,u.featuresOnBorder[_e],!1);if(xe){for(const _e of ie)oe.encodeCentroid(void 0,oe.featuresOnBorder[_e],!1);oe.borderDoneWithNeighborZ[X]=u.canonical.z,oe.needsCentroidUpdate=!0}u.borderDoneWithNeighborZ[U]=oe.canonical.z,u.needsCentroidUpdate=!0}}(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(l)}const Vh=new o.Color(1,0,0,1),Gh=new o.Color(0,1,0,1),Sl=new o.Color(0,0,1,1),Il=new o.Color(1,0,1,1),iu=new o.Color(0,1,1,1);function ru(l,r,s){const u=l.context,p=l.transform,f=u.gl,g=p.projection.name==="globe",v=g?["PROJECTION_GLOBE_VIEW"]:null;let w=s.projMatrix;if(g&&o.globeToMercatorTransition(p.zoom)>0){const ue=o.transitionTileAABBinECEF(s.canonical,p),Ue=o.globeDenormalizeECEF(ue);w=o.multiply(new Float32Array(16),p.globeMatrix,Ue),o.multiply(w,p.projMatrix,w)}const A=l.useProgram("debug",null,v),I=r.getTileByID(s.key);l.terrain&&l.terrain.setupElevationDraw(I,A);const P=o.DepthMode.disabled,R=o.StencilMode.disabled,N=l.colorModeForRenderPass(),j="$debug";u.activeTexture.set(f.TEXTURE0),l.emptyTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),g?I._makeGlobeTileDebugBuffers(l.context,p):I._makeDebugTileBoundsBuffers(l.context,p.projection);const V=I._tileDebugBuffer||l.debugBuffer,F=I._tileDebugIndexBuffer||l.debugIndexBuffer,U=I._tileDebugSegments||l.debugSegments;A.draw(u,f.LINE_STRIP,P,R,N,o.CullFaceMode.disabled,Co(w,o.Color.red),j,V,F,U,null,null,null,[I._globeTileDebugBorderBuffer]);const X=I.latestRawTileData,G=Math.floor((X&&X.byteLength||0)/1024),Y=r.getTile(s).tileSize,oe=512/Math.min(Y,512)*(s.overscaledZ/p.zoom)*.5;let ie=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(ie+=` => ${s.overscaledZ}`),ie+=` ${G}kb`,function(ue,Ue){ue.initDebugOverlayCanvas();const fe=ue.debugOverlayCanvas,Ae=ue.context.gl,be=ue.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,fe.width,fe.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(Ue,5,5),be.strokeText(Ue,5,5),ue.debugOverlayTexture.update(fe),ue.debugOverlayTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)}(l,ie);const ce=I._tileDebugTextBuffer||l.debugBuffer,xe=I._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,_e=I._tileDebugTextSegments||l.debugSegments;A.draw(u,f.TRIANGLES,P,R,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Co(w,o.Color.transparent,oe),j,ce,xe,_e,null,null,null,[I._globeTileDebugTextBuffer])}function Al(l,r,s,u){Wr(l,0,r+s/2,l.transform.width,s,u)}function ba(l,r,s,u){Wr(l,r-s/2,0,s,l.transform.height,u)}function Wr(l,r,s,u,p,f){const g=l.context,v=g.gl;v.enable(v.SCISSOR_TEST),v.scissor(r*o.exported.devicePixelRatio,s*o.exported.devicePixelRatio,u*o.exported.devicePixelRatio,p*o.exported.devicePixelRatio),g.clear({color:f}),v.disable(v.SCISSOR_TEST)}const Ts=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:nu}=Ts;function Ir(l,r,s,u){l.emplaceBack(r,s,u)}class Kn{constructor(r){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Ir(this.vertexArray,-1,-1,1),Ir(this.vertexArray,1,-1,1),Ir(this.vertexArray,-1,1,1),Ir(this.vertexArray,1,1,1),Ir(this.vertexArray,-1,-1,-1),Ir(this.vertexArray,1,-1,-1),Ir(this.vertexArray,-1,1,-1),Ir(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,nu),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Jn(l,r,s,u,p,f){const g=l.gl,v=r.paint.get("sky-atmosphere-color"),w=r.paint.get("sky-atmosphere-halo-color"),A=r.paint.get("sky-atmosphere-sun-intensity"),I=((P,R,N,j,V)=>({u_matrix_3f:P,u_sun_direction:R,u_sun_intensity:N,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[V.r,V.g,V.b,V.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),u),p,A,v,w);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_CUBE_MAP_POSITIVE_X+f,r.skyboxTexture,0),s.draw(l,g.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,I,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Ml=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Qt{constructor(r){const s=new o.StructArrayLayout5f20;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const u=new o.StructArrayLayout3ui6;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(s,Ml.members),this.indexBuffer=r.createIndexBuffer(u),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Es={symbol:function(l,r,s,u,p){if(l.renderPass!=="translucent")return;const f=o.StencilMode.disabled,g=l.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(v,w,A,I,P,R,N){const j=w.transform,V=P==="map",F=R==="map";for(const U of v){const X=I.getTile(U),G=X.getBucket(A);if(!G||!G.text||!G.text.segments.get().length)continue;const Y=o.evaluateSizeForZoom(G.textSizeData,j.zoom),oe=cs(U,G.getProjection(),j),ie=j.calculatePixelsToTileUnitsMatrix(X),ce=Sr(oe,X.tileID.canonical,F,V,j,G.getProjection(),ie),xe=A.layout.get("icon-text-fit")!=="none"&&G.hasIconData();if(Y){const _e=Math.pow(2,j.zoom-X.tileID.overscaledZ);Jc(G,V,F,N,o.symbolSize,j,ce,U,_e,Y,xe)}}}(u,l,s,r,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),p),s.paint.get("icon-opacity").constantOr(1)!==0&&Yn(l,r,s,u,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),f,g),s.paint.get("text-opacity").constantOr(1)!==0&&Yn(l,r,s,u,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),f,g),r.map.showCollisionBoxes&&(Kc(l,r,s,u,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Kc(l,r,s,u,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(l,r,s,u){if(l.renderPass!=="translucent")return;const p=s.paint.get("circle-opacity"),f=s.paint.get("circle-stroke-width"),g=s.paint.get("circle-stroke-opacity"),v=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(p.constantOr(1)===0&&(f.constantOr(1)===0||g.constantOr(1)===0))return;const w=l.context,A=w.gl,I=l.transform,P=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),R=o.StencilMode.disabled,N=l.colorModeForRenderPass(),j=I.projection.name==="globe",V=[o.mercatorXfromLng(I.center.lng),o.mercatorYfromLat(I.center.lat)],F=[];for(let X=0;X<u.length;X++){const G=u[X],Y=r.getTile(G),oe=Y.getBucket(s);if(!oe||oe.projection.name!==I.projection.name)continue;const ie=oe.programConfigurations.get(s.id),ce=Oh(s);j&&ce.push("PROJECTION_GLOBE_VIEW");const xe=l.useProgram("circle",ie,ce),_e=oe.layoutVertexBuffer,ue=oe.globeExtVertexBuffer,Ue=oe.indexBuffer,fe=I.projection.createInversionMatrix(I,G.canonical),Ae={programConfiguration:ie,program:xe,layoutVertexBuffer:_e,globeExtVertexBuffer:ue,indexBuffer:Ue,uniformValues:Zc(l,G,Y,fe,V,s),tile:Y};if(v){const be=oe.segments.get();for(const Re of be)F.push({segments:new o.SegmentVector([Re]),sortKey:Re.sortKey,state:Ae})}else F.push({segments:oe.segments,sortKey:0,state:Ae})}v&&F.sort((X,G)=>X.sortKey-G.sortKey);const U={useDepthForOcclusion:!j};for(const X of F){const{programConfiguration:G,program:Y,layoutVertexBuffer:oe,globeExtVertexBuffer:ie,indexBuffer:ce,uniformValues:xe,tile:_e}=X.state,ue=X.segments;l.terrain&&l.terrain.setupElevationDraw(_e,Y,U),l.prepareDrawProgram(w,Y,_e.tileID.toUnwrapped()),Y.draw(w,A.TRIANGLES,P,R,N,o.CullFaceMode.disabled,xe,s.id,oe,ce,ue,s.paint,I.zoom,G,[ie])}},heatmap:function(l,r,s,u){if(s.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const p=l.context,f=p.gl,g=o.StencilMode.disabled,v=new o.ColorMode([f.ONE,f.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(N,j,V,F){const U=N.gl,X=j.width*F,G=j.height*F;N.activeTexture.set(U.TEXTURE1),N.viewport.set([0,0,X,G]);let Y=V.heatmapFbo;if(!Y||Y&&(Y.width!==X||Y.height!==G)){Y&&Y.destroy();const oe=U.createTexture();U.bindTexture(U.TEXTURE_2D,oe),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),Y=V.heatmapFbo=N.createFramebuffer(X,G,!1),function(ie,ce,xe,_e,ue,Ue){const fe=ie.gl;fe.texImage2D(fe.TEXTURE_2D,0,fe.RGBA,ue,Ue,0,fe.RGBA,ie.extRenderToTextureHalfFloat?ie.extTextureHalfFloat.HALF_FLOAT_OES:fe.UNSIGNED_BYTE,null),_e.colorAttachment.set(xe)}(N,0,oe,Y,X,G)}else U.bindTexture(U.TEXTURE_2D,Y.colorAttachment.get()),N.bindFramebuffer.set(Y.framebuffer)})(p,l,s,l.transform.projection.name==="globe"?.5:.25),p.clear({color:o.Color.transparent});const w=l.transform,A=w.projection.name==="globe",I=A?["PROJECTION_GLOBE_VIEW"]:null,P=A?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,R=[o.mercatorXfromLng(w.center.lng),o.mercatorYfromLat(w.center.lat)];for(let N=0;N<u.length;N++){const j=u[N];if(r.hasRenderableParent(j))continue;const V=r.getTile(j),F=V.getBucket(s);if(!F||F.projection.name!==w.projection.name)continue;const U=F.programConfigurations.get(s.id),X=l.useProgram("heatmap",U,I),{zoom:G}=l.transform;l.terrain&&l.terrain.setupElevationDraw(V,X),l.prepareDrawProgram(p,X,j.toUnwrapped());const Y=w.projection.createInversionMatrix(w,j.canonical);X.draw(p,f.TRIANGLES,o.DepthMode.disabled,g,v,P,_a(l,j,V,Y,R,G,s.paint.get("heatmap-intensity")),s.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,s.paint,l.transform.zoom,U,A?[F.globeExtVertexBuffer]:null)}p.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(p,f){const g=p.context,v=g.gl,w=f.heatmapFbo;if(!w)return;g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,w.colorAttachment.get()),g.activeTexture.set(v.TEXTURE1);let A=f.colorRampTexture;A||(A=f.colorRampTexture=new o.Texture(g,f.colorRamp,v.RGBA)),A.bind(v.LINEAR,v.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(g,v.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,p.colorModeForRenderPass(),o.CullFaceMode.disabled,((I,P,R,N)=>({u_image:0,u_color_ramp:1,u_opacity:P.paint.get("heatmap-opacity")}))(0,f),f.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,f.paint,p.transform.zoom)}(l,s))},line:function(l,r,s,u){if(l.renderPass!=="translucent")return;const p=s.paint.get("line-opacity"),f=s.paint.get("line-width");if(p.constantOr(1)===0||f.constantOr(1)===0)return;const g=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),v=l.colorModeForRenderPass(),w=l.terrain&&l.terrain.renderingToTexture?1:o.exported.devicePixelRatio,A=s.paint.get("line-dasharray"),I=A.constantOr(1),P=s.layout.get("line-cap"),R=s.paint.get("line-pattern"),N=R.constantOr(1),j=s.paint.get("line-gradient"),V=N?"linePattern":"line",F=l.context,U=F.gl,X=(Y=>{const oe=[];ya(Y)&&oe.push("RENDER_LINE_DASH"),Y.paint.get("line-gradient")&&oe.push("RENDER_LINE_GRADIENT");const ie=Y.paint.get("line-trim-offset");ie[0]===0&&ie[1]===0||oe.push("RENDER_LINE_TRIM_OFFSET");const ce=Y.paint.get("line-pattern").constantOr(1),xe=Y.paint.get("line-opacity").constantOr(1)!==1;return!ce&&xe&&oe.push("RENDER_LINE_ALPHA_DISCARD"),oe})(s);let G=X.includes("RENDER_LINE_ALPHA_DISCARD");l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(G=!1);for(const Y of u){const oe=r.getTile(Y);if(N&&!oe.patternsLoaded())continue;const ie=oe.getBucket(s);if(!ie)continue;l.prepareDrawTile();const ce=ie.programConfigurations.get(s.id),xe=l.useProgram(V,ce,X),_e=R.constantOr(null);if(_e&&oe.imageAtlas){const Pe=oe.imageAtlas.patternPositions[_e.toString()];Pe&&ce.setConstantPatternPositions(Pe)}const ue=A.constantOr(null),Ue=P.constantOr(null);if(!N&&ue&&Ue&&oe.lineAtlas){const Pe=oe.lineAtlas.getDash(ue,Ue);Pe&&ce.setConstantPatternPositions(Pe)}let[fe,Ae]=s.paint.get("line-trim-offset");(Ue==="round"||Ue==="square")&&fe!==Ae&&(fe===0&&(fe-=1),Ae===1&&(Ae+=1));const be=l.terrain?Y.projMatrix:null,Re=N?Xr(l,oe,s,be,w):vl(l,oe,s,be,ie.lineClipsArray.length,w,[fe,Ae]);if(j){const Pe=ie.gradients[s.id];let je=Pe.texture;if(s.gradientVersion!==Pe.version){let he=256;if(s.stepInterpolant){const ve=r.getSource().maxzoom,nt=Y.canonical.z===ve?Math.ceil(1<<l.transform.maxZoom-Y.canonical.z):1;he=o.clamp(o.nextPowerOfTwo(ie.maxLineLength/o.EXTENT*1024*nt),256,F.maxTextureSize)}Pe.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:he,image:Pe.gradient||void 0,clips:ie.lineClipsArray}),Pe.texture?Pe.texture.update(Pe.gradient):Pe.texture=new o.Texture(F,Pe.gradient,U.RGBA),Pe.version=s.gradientVersion,je=Pe.texture}F.activeTexture.set(U.TEXTURE1),je.bind(s.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}I&&(F.activeTexture.set(U.TEXTURE0),oe.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),ce.updatePaintBuffers()),N&&(F.activeTexture.set(U.TEXTURE0),oe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),ce.updatePaintBuffers()),l.prepareDrawProgram(F,xe,Y.toUnwrapped());const Ee=Pe=>{xe.draw(F,U.TRIANGLES,g,Pe,v,o.CullFaceMode.disabled,Re,s.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,s.paint,l.transform.zoom,ce,[ie.layoutVertexBuffer2])};if(G){const Pe=l.stencilModeForClipping(Y).ref;Pe===0&&l.terrain&&F.clear({stencil:0});const je={func:U.EQUAL,mask:255};Re.u_alpha_discard_threshold=.8,Ee(new o.StencilMode(je,Pe,255,U.KEEP,U.KEEP,U.INVERT)),Re.u_alpha_discard_threshold=0,Ee(new o.StencilMode(je,Pe,255,U.KEEP,U.KEEP,U.KEEP))}else Ee(l.stencilModeForClipping(Y))}G&&(l.resetStencilClippingMasks(),l.terrain&&F.clear({stencil:0}))},fill:function(l,r,s,u){const p=s.paint.get("fill-color"),f=s.paint.get("fill-opacity");if(f.constantOr(1)===0)return;const g=l.colorModeForRenderPass(),v=s.paint.get("fill-pattern"),w=l.opaquePassEnabledForLayer()&&!v.constantOr(1)&&p.constantOr(o.Color.transparent).a===1&&f.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===w){const A=l.depthModeForSublayer(1,l.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);tu(l,r,s,u,A,g,!1)}if(l.renderPass==="translucent"&&s.paint.get("fill-antialias")){const A=l.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);tu(l,r,s,u,A,g,!0)}},"fill-extrusion":function(l,r,s,u){const p=s.paint.get("fill-extrusion-opacity");if(p!==0&&l.renderPass==="translucent"){const f=new o.DepthMode(l.context.gl.LEQUAL,o.DepthMode.ReadWrite,l.depthRangeFor3D);if(p!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))El(l,r,s,u,f,o.StencilMode.disabled,o.ColorMode.disabled),El(l,r,s,u,f,l.stencilModeFor3D(),l.colorModeForRenderPass()),l.resetStencilClippingMasks();else{const g=l.colorModeForRenderPass();El(l,r,s,u,f,o.StencilMode.disabled,g)}}},hillshade:function(l,r,s,u){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent")return;const p=l.context,f=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),g=l.colorModeForRenderPass(),v=l.terrain&&l.terrain.renderingToTexture,[w,A]=l.renderPass!=="translucent"||v?[{},u]:l.stencilConfigForOverlap(u);for(const I of A){const P=r.getTile(I);if(P.needsHillshadePrepare&&l.renderPass==="offscreen")aa(l,P,s,f,o.StencilMode.disabled,g);else if(l.renderPass==="translucent"){const R=v&&l.terrain?l.terrain.stencilModeForRTTOverlap(I):w[I.overscaledZ];fl(l,I,P,s,f,R,g)}}p.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,r,s,u,p,f){if(l.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!u.length)return;const g=l.context,v=g.gl,w=r.getSource(),A=l.useProgram("raster"),I=l.colorModeForRenderPass(),P=l.terrain&&l.terrain.renderingToTexture,[R,N]=w instanceof se||P?[{},u]:l.stencilConfigForOverlap(u),j=N[N.length-1].overscaledZ,V=!l.options.moving;for(const F of N){const U=P?o.DepthMode.disabled:l.depthModeForSublayer(F.overscaledZ-j,s.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,v.LESS),X=F.toUnwrapped(),G=r.getTile(F);if(P&&(!G||!G.hasData()))continue;const Y=P?F.projMatrix:l.transform.calculateProjMatrix(X,V),oe=l.terrain&&P?l.terrain.stencilModeForRTTOverlap(F):R[F.overscaledZ],ie=f?0:s.paint.get("raster-fade-duration");G.registerFadeDuration(ie);const ce=r.findLoadedParent(F,0),xe=ha(G,ce,r,l.transform,ie);let _e,ue;l.terrain&&l.terrain.prepareDrawTile();const Ue=s.paint.get("raster-resampling")==="nearest"?v.NEAREST:v.LINEAR;g.activeTexture.set(v.TEXTURE0),G.texture.bind(Ue,v.CLAMP_TO_EDGE),g.activeTexture.set(v.TEXTURE1),ce?(ce.texture.bind(Ue,v.CLAMP_TO_EDGE),_e=Math.pow(2,ce.tileID.overscaledZ-G.tileID.overscaledZ),ue=[G.tileID.canonical.x*_e%1,G.tileID.canonical.y*_e%1]):G.texture.bind(Ue,v.CLAMP_TO_EDGE);const fe=Wc(Y,ue||[0,0],_e||1,xe,s,w instanceof se?w.perspectiveTransform:[0,0]);if(l.prepareDrawProgram(g,A,X),w instanceof se)w.boundsBuffer&&w.boundsSegments&&A.draw(g,v.TRIANGLES,U,o.StencilMode.disabled,I,o.CullFaceMode.disabled,fe,s.id,w.boundsBuffer,l.quadTriangleIndexBuffer,w.boundsSegments);else{const{tileBoundsBuffer:Ae,tileBoundsIndexBuffer:be,tileBoundsSegments:Re}=l.getTileBoundsBuffers(G);A.draw(g,v.TRIANGLES,U,oe,I,o.CullFaceMode.disabled,fe,s.id,Ae,be,Re)}}l.resetStencilClippingMasks()},background:function(l,r,s,u){const p=s.paint.get("background-color"),f=s.paint.get("background-opacity");if(f===0)return;const g=l.context,v=g.gl,w=l.transform,A=w.tileSize,I=s.paint.get("background-pattern");if(l.isPatternMissing(I))return;const P=!I&&p.a===1&&f===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==P)return;const R=o.StencilMode.disabled,N=l.depthModeForSublayer(0,P==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),j=l.colorModeForRenderPass(),V=l.useProgram(I?"backgroundPattern":"background");let F,U=u;U||(F=l.getBackgroundTiles(),U=Object.values(F).map(X=>X.tileID)),I&&(g.activeTexture.set(v.TEXTURE0),l.imageManager.bind(l.context));for(const X of U){const G=X.toUnwrapped(),Y=u?X.projMatrix:l.transform.calculateProjMatrix(G);l.prepareDrawTile();const oe=r?r.getTile(X):F?F[X.key]:new o.Tile(X,A,w.zoom,l),ie=I?Tl(Y,f,l,I,{tileID:X,tileSize:A}):Fh(Y,f,p);l.prepareDrawProgram(g,V,G);const{tileBoundsBuffer:ce,tileBoundsIndexBuffer:xe,tileBoundsSegments:_e}=l.getTileBoundsBuffers(oe);V.draw(g,v.TRIANGLES,N,R,j,o.CullFaceMode.disabled,ie,s.id,ce,xe,_e)}},sky:function(l,r,s){const u=l.transform,p=u.projection.name==="mercator"||u.projection.name==="globe"?1:o.smoothstep(7,8,u.zoom),f=s.paint.get("sky-opacity")*p;if(f===0)return;const g=l.context,v=s.paint.get("sky-type"),w=new o.DepthMode(g.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),A=l.frameCounter/1e3%1;v==="atmosphere"?l.renderPass==="offscreen"?s.needsSkyboxCapture(l)&&(function(I,P,R,N){const j=I.context,V=j.gl;let F=P.skyboxFbo;if(!F){F=P.skyboxFbo=j.createFramebuffer(32,32,!1),P.skyboxGeometry=new Kn(j),P.skyboxTexture=j.gl.createTexture(),V.bindTexture(V.TEXTURE_CUBE_MAP,P.skyboxTexture),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MAG_FILTER,V.LINEAR);for(let Y=0;Y<6;++Y)V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+Y,0,V.RGBA,32,32,0,V.RGBA,V.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(F.framebuffer),j.viewport.set([0,0,32,32]);const U=P.getCenter(I,!0),X=I.useProgram("skyboxCapture"),G=new Float64Array(16);o.identity(G),o.rotateY(G,G,.5*-Math.PI),Jn(j,P,X,G,U,0),o.identity(G),o.rotateY(G,G,.5*Math.PI),Jn(j,P,X,G,U,1),o.identity(G),o.rotateX(G,G,.5*-Math.PI),Jn(j,P,X,G,U,2),o.identity(G),o.rotateX(G,G,.5*Math.PI),Jn(j,P,X,G,U,3),o.identity(G),Jn(j,P,X,G,U,4),o.identity(G),o.rotateY(G,G,Math.PI),Jn(j,P,X,G,U,5),j.viewport.set([0,0,I.width,I.height])}(l,s),s.markSkyboxValid(l)):l.renderPass==="sky"&&function(I,P,R,N,j){const V=I.context,F=V.gl,U=I.transform,X=I.useProgram("skybox");V.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_CUBE_MAP,P.skyboxTexture);const G=((Y,oe,ie,ce,xe)=>({u_matrix:Y,u_sun_direction:oe,u_cubemap:0,u_opacity:ce,u_temporal_offset:xe}))(U.skyboxMatrix,P.getCenter(I,!1),0,N,j);I.prepareDrawProgram(V,X),X.draw(V,F.TRIANGLES,R,o.StencilMode.disabled,I.colorModeForRenderPass(),o.CullFaceMode.backCW,G,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(l,s,w,f,A):v==="gradient"&&l.renderPass==="sky"&&function(I,P,R,N,j){const V=I.context,F=V.gl,U=I.transform,X=I.useProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new Kn(V)),V.activeTexture.set(F.TEXTURE0);let G=P.colorRampTexture;G||(G=P.colorRampTexture=new o.Texture(V,P.colorRamp,F.RGBA)),G.bind(F.LINEAR,F.CLAMP_TO_EDGE);const Y=((oe,ie,ce,xe,_e)=>({u_matrix:oe,u_color_ramp:0,u_center_direction:ie,u_radius:o.degToRad(ce),u_opacity:xe,u_temporal_offset:_e}))(U.skyboxMatrix,P.getCenter(I,!1),P.paint.get("sky-gradient-radius"),N,j);I.prepareDrawProgram(V,X),X.draw(V,F.TRIANGLES,R,o.StencilMode.disabled,I.colorModeForRenderPass(),o.CullFaceMode.backCW,Y,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(l,s,w,f,A)},debug:function(l,r,s){for(let u=0;u<s.length;u++)ru(l,r,s[u])},custom:function(l,r,s){const u=l.context,p=s.implementation;if(l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(l.renderPass==="offscreen"){const f=p.prerender;f&&(l.setCustomLayerDefaults(),u.setColorMode(l.colorModeForRenderPass()),f.call(p,u.gl,l.transform.customLayerMatrix()),u.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),u.setColorMode(l.colorModeForRenderPass()),u.setStencilMode(o.StencilMode.disabled);const f=p.renderingMode==="3d"?new o.DepthMode(l.context.gl.LEQUAL,o.DepthMode.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,o.DepthMode.ReadOnly);u.setDepthMode(f),p.render(u.gl,l.transform.customLayerMatrix()),u.setDirty(),l.setBaseState(),u.bindFramebuffer.set(null)}}};class $h{constructor(r,s){this.context=new z(r),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Xn,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,s){const u=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Vc(this,r));const p=this._terrain;this.transform.elevation=u?p:null,p.update(r,this.transform,s)}_updateFog(r){const s=r.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=s.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const f=u+.78*(p-u);this.transform.fogCullDistSq=f*f}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,s){if(this.width=r*o.exported.devicePixelRatio,this.height=s*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._layers[u].resize()}setup(){const r=this.context,s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(s,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const u=new o.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(o.EXTENT,0),u.emplaceBack(0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=r.createVertexBuffer(u,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const p=new o.StructArrayLayout2i4;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(p,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const f=new o.StructArrayLayout4i8;f.emplaceBack(0,0,0,0),f.emplaceBack(o.EXTENT,0,o.EXTENT,0),f.emplaceBack(0,o.EXTENT,0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(f,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const g=new o.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(g);const v=new o.StructArrayLayout1ui2;for(const A of[0,1,3,2,0])v.emplaceBack(A);this.debugIndexBuffer=r.createIndexBuffer(v),this.emptyTexture=new o.Texture(r,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.create();const w=this.context.gl;this.stencilClearMode=new o.StencilMode({func:w.ALWAYS,mask:0},0,255,w.ZERO,w.ZERO,w.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Qt(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,s=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,s.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,vs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,s,u){if(!s||this.currentStencilSource===s.id||!r.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let v=!1;for(const w of u)if(this._tileClippingMaskIDs[w.key]===void 0){v=!0;break}if(!v)return}this.currentStencilSource=s.id;const p=this.context,f=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(o.ColorMode.disabled),p.setDepthMode(o.DepthMode.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of u){const w=s.getTile(v),A=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:P,tileBoundsSegments:R}=this.getTileBoundsBuffers(w);g.draw(p,f.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:f.ALWAYS,mask:0},A,255,f.KEEP,f.KEEP,f.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,vs(v.projMatrix),"$clipping",I,P,R)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,s=this.context.gl;return new o.StencilMode({func:s.NOTEQUAL,mask:255},r,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const s=this.context.gl;return new o.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(r){const s=this.context.gl,u=r.sort((g,v)=>v.overscaledZ-g.overscaledZ),p=u[u.length-1].overscaledZ,f=u[0].overscaledZ-p+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const g={};for(let v=0;v<f;v++)g[v+p]=new o.StencilMode({func:s.GEQUAL,mask:255},v+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=f,[g,u]}return[{[p]:o.StencilMode.disabled},u]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([r.CONSTANT_COLOR,r.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(r,s,u){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new o.DepthMode(u||this.context.gl.LEQUAL,s,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,s){this.style=r,this.options=s,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const u=this.style.order,p=this.style._sourceCaches;for(const w in p){const A=p[w];A.used&&A.prepare(this.context)}const f={},g={},v={};for(const w in p){const A=p[w];f[w]=A.getVisibleCoordinates(),g[w]=f[w].slice().reverse(),v[w]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let w=0;w<u.length;w++)if(this.style._layers[u[w]].is3D()){this.opaquePassCutoff=w;break}if(this.terrain&&(this.terrain.updateTileBinding(v),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const w of u){const A=this.style._layers[w],I=r._getLayerSourceCache(A);if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const P=I?g[I.id]:void 0;(A.type==="custom"||A.isSky()||P&&P.length)&&this.renderLayer(this,I,A,P)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:s.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const w=this.style._layers[u[this.currentLayer]],A=r._getLayerSourceCache(w);if(w.isSky())continue;const I=A?g[A.id]:void 0;this._renderTileClippingMasks(w,A,I),this.renderLayer(this,A,w,I)}if(this.style.fog&&this.transform.projection.supportsFog&&function(w,A){const I=w.context,P=I.gl,R=w.transform,N=new o.DepthMode(P.LEQUAL,o.DepthMode.ReadOnly,[0,1]),j=w.useProgram("globeAtmosphere",null,R.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),V=o.globeToMercatorTransition(R.zoom),F=A.properties.get("color").toArray01(),U=A.properties.get("high-color").toArray01(),X=A.properties.get("space-color").toArray01PremultipliedAlpha(),G=o.identity$1([]);o.rotateY$1(G,G,-o.degToRad(R._center.lng)),o.rotateX$1(G,G,o.degToRad(R._center.lat)),o.rotateZ$1(G,G,R.angle),o.rotateX$1(G,G,-R._pitch);const Y=o.fromQuat(new Float32Array(16),G),oe=o.mapValue(A.properties.get("star-intensity"),0,1,0,.25),ie=5e-4,ce=o.mapValue(A.properties.get("horizon-blend"),0,1,ie,.25),xe=o.globeUseCustomAntiAliasing(w,I,R)&&ce===ie?R.worldSize/(2*Math.PI*1.025)-1:R.globeRadius,_e=w.frameCounter/1e3%1,ue=o.length(R.globeCenterInViewSpace),Ue=Math.sqrt(Math.pow(ue,2)-Math.pow(xe,2)),fe=Math.acos(Ue/ue),Ae=((Re,Ee,Pe,je,he,ve,nt,ut,ot,xt,At,ht,et,ni)=>({u_frustum_tl:Re,u_frustum_tr:Ee,u_frustum_br:Pe,u_frustum_bl:je,u_horizon:he,u_transition:ve,u_fadeout_range:nt,u_color:ut,u_high_color:ot,u_space_color:xt,u_star_intensity:At,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ht,u_horizon_angle:et,u_rotation_matrix:ni}))(R.frustumCorners.TL,R.frustumCorners.TR,R.frustumCorners.BR,R.frustumCorners.BL,R.frustumCorners.horizon,V,ce,F,U,X,oe,_e,fe,Y);w.prepareDrawProgram(I,j);const be=w.atmosphereBuffer;be&&j.draw(I,P.TRIANGLES,N,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Ae,"skybox",be.vertexBuffer,be.indexBuffer,be.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const w=this.style._layers[u[this.currentLayer]],A=r._getLayerSourceCache(w);w.isSky()&&this.renderLayer(this,A,w,A?g[A.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;){const w=this.style._layers[u[this.currentLayer]],A=r._getLayerSourceCache(w);if(w.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(w)){if(w.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const I=A?(w.type==="symbol"?v:g)[A.id]:void 0;this._renderTileClippingMasks(w,A,A?f[A.id]:void 0),this.renderLayer(this,A,w,I),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let w=null;o.values(this.style._layers).forEach(A=>{const I=r._getLayerSourceCache(A);I&&!A.isHidden(this.transform.zoom)&&(!w||w.getSource().maxzoom<I.getSource().maxzoom)&&(w=I)}),w&&this.options.showTileBoundaries&&Es.debug(this,w,w.getVisibleCoordinates())}this.options.showPadding&&function(w){const A=w.transform.padding;Al(w,w.transform.height-(A.top||0),3,Vh),Al(w,A.bottom||0,3,Gh),ba(w,A.left||0,3,Sl),ba(w,w.transform.width-(A.right||0),3,Il);const I=w.transform.centerPoint;(function(P,R,N,j){Wr(P,R-1,N-10,2,20,j),Wr(P,R-10,N-1,20,2,j)})(w,I.x,w.transform.height-I.y,iu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,s,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(u.type)||Es[u.type](r,s,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let u=this.gpuTimers[r.id];u||(u=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),u.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,u.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,s=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(s),r.beginQueryEXT(r.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const s={};for(const u in r){const p=r[u],f=this.context.extTimerQuery,g=f.getQueryObjectEXT(p.query,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(p.query),s[u]=g}return s}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.extTimerQuery;let u=0;for(const p of r)u+=s.getQueryObjectEXT(p,s.QUERY_RESULT_EXT)/1e6,s.deleteQueryEXT(p);return u}translatePosMatrix(r,s,u,p,f){if(!u[0]&&!u[1])return r;const g=f?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(g){const A=Math.sin(g),I=Math.cos(g);u=[u[0]*I-u[1]*A,u[0]*A+u[1]*I]}const v=[f?u[0]:Gt(s,u[0],this.transform.zoom),f?u[1]:Gt(s,u[1],this.transform.zoom),0],w=new Float32Array(16);return o.translate(w,r,v),w}saveTileTexture(r){const s=this._tileTextures[r.size[0]];s?s.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const s=this._tileTextures[r];return s&&s.length>0?s.pop():null}isPatternMissing(r){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,s=this.terrain&&this.terrain.exaggeration()===0,u=this.style&&this.style.fog,p=[];return this.terrainRenderModeElevated()&&p.push("TERRAIN"),this.transform.projection.name==="globe"&&p.push("GLOBE"),s&&p.push("ZERO_EXAGGERATION"),u&&!r&&u.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),r&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(r,s,u){this.cache=this.cache||{};const p=u||[],f=this.currentGlobalDefines().concat(p),g=gl.cacheKey(dl[r],r,f,s);return this.cache[g]||(this.cache[g]=new gl(this.context,r,dl[r],s,Uh[r],f)),this.cache[g]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,s,u){if(this.terrain&&this.terrain.renderingToTexture)return;const p=this.style.fog;if(p){const f=p.getOpacity(this.transform.pitch),g=((v,w,A,I,P,R,N,j,V,F,U)=>{const X=v.transform,G=w.properties.get("color").toArray01();G[3]=I;const Y=v.frameCounter/1e3%1;return{u_fog_matrix:A?X.calculateFogTileMatrix(A):v.identityMat,u_fog_range:w.getFovAdjustedRange(X._fov),u_fog_color:G,u_fog_horizon_blend:w.properties.get("horizon-blend"),u_fog_temporal_offset:Y,u_frustum_tl:P,u_frustum_tr:R,u_frustum_br:N,u_frustum_bl:j,u_globe_pos:V,u_globe_radius:F,u_viewport:U,u_globe_transition:o.globeToMercatorTransition(X.zoom),u_is_globe:+(X.projection.name==="globe")}})(this,p,u,f,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);s.setFogUniformValues(r,g)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,s=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)s[p.key]=r[p.key]||new o.Tile(p,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class wa{constructor(r=0,s=0,u=0,p=0){if(isNaN(r)||r<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=s,this.left=u,this.right=p}interpolate(r,s,u){return s.top!=null&&r.top!=null&&(this.top=o.number(r.top,s.top,u)),s.bottom!=null&&r.bottom!=null&&(this.bottom=o.number(r.bottom,s.bottom,u)),s.left!=null&&r.left!=null&&(this.left=o.number(r.left,s.left,u)),s.right!=null&&r.right!=null&&(this.right=o.number(r.right,s.right,u)),this}getCenter(r,s){const u=o.clamp((this.left+r-this.right)/2,0,r),p=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.pointGeometry(u,p)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new wa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function zo(l,r){const s=o.getColumn(l,3);o.fromQuat(l,r),o.setColumn(l,3,s)}function Cl(l,r){const s=o.identity$1([]);return o.rotateZ$1(s,s,-r),o.rotateX$1(s,s,-l),s}function ou(l,r){const s=[l[0],l[1],0],u=[r[0],r[1],0];if(o.length(s)>=1e-15){const g=o.normalize([],s);o.scale$2(u,g,o.dot(u,g)),r[0]=u[0],r[1]=u[1]}const p=o.cross([],r,l);if(o.len(p)<1e-15)return null;const f=Math.atan2(-p[1],p[0]);return Cl(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),f)}class kl{constructor(r,s){this.position=r,this.orientation=s}get position(){return this._position}set position(r){if(r){const s=r instanceof o.MercatorCoordinate?r:new o.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(s.x=o.wrap(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(r,s){if(this.orientation=null,!this.position)return;const u=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(r)):0,p=this.position,f=o.MercatorCoordinate.fromLngLat(r,u),g=[f.x-p.x,f.y-p.y,f.z-p.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=ou(g,s)}setPitchBearing(r,s){this.orientation=Cl(o.degToRad(r),o.degToRad(-s))}}class zl{constructor(r,s){this._transform=o.identity([]),this.orientation=s,this.position=r}get mercatorPosition(){const r=this.position;return new o.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=o.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var s;r&&o.setColumn(this._transform,3,[(s=r)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.identity$1([]),r&&zo(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,s){this._orientation=Cl(r,s),zo(this._transform,this._orientation)}forward(){const r=o.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,s){const u=new Float64Array(16);return o.invert(u,this.getWorldToCamera(r,s)),u}getWorldToCameraPosition(r,s,u){const p=this.position;o.scale$2(p,p,-r);const f=new Float64Array(16);return o.fromScaling(f,[u,u,u]),o.translate(f,f,p),f[10]*=s,f}getWorldToCamera(r,s){const u=new Float64Array(16),p=new Float64Array(4),f=this.position;return o.conjugate(p,this._orientation),o.scale$2(f,f,-r),o.fromQuat(u,p),o.translate(u,u,f),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=s,u[9]*=s,u[10]*=s,u[11]*=s,u}getCameraToClipPerspective(r,s,u,p){const f=new Float64Array(16);return o.perspective(f,r,s,u,p),f}getDistanceToElevation(r,s=!1){const u=r===0?0:o.mercatorZfromAltitude(r,s?o.latFromMercatorY(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new zl([...this.position],[...this.orientation])}}function Ta(l,r){const s=zn(l.projection,l.zoom,l.width,l.height),u=function(f,g,v,w,A){const I=new o.LngLat(v.lng-180*Pn,v.lat),P=new o.LngLat(v.lng+180*Pn,v.lat),R=f.project(I.lng,I.lat),N=f.project(P.lng,P.lat),j=-Math.atan2(N.y-R.y,N.x-R.x),V=o.MercatorCoordinate.fromLngLat(v);V.y=o.clamp(V.y,-.999975,.999975);const F=V.toLngLat(),U=f.project(F.lng,F.lat),X=o.MercatorCoordinate.fromLngLat(F);X.x+=Pn;const G=X.toLngLat(),Y=f.project(G.lng,G.lat),oe=Pl(Y.x-U.x,Y.y-U.y,j),ie=o.MercatorCoordinate.fromLngLat(F);ie.y+=Pn;const ce=ie.toLngLat(),xe=f.project(ce.lng,ce.lat),_e=Pl(xe.x-U.x,xe.y-U.y,j),ue=Math.abs(oe.x)/Math.abs(_e.y),Ue=o.identity([]);o.rotateZ(Ue,Ue,-j*(1-(A?0:w)));const fe=o.identity([]);return o.scale(fe,fe,[1,1-(1-ue)*w,1]),fe[4]=-_e.x/_e.y*w,o.rotateZ(fe,fe,j),o.multiply(fe,Ue,fe),fe}(l.projection,0,l.center,s,r),p=Ss(l);return o.scale(u,u,[p,p,1]),u}function Ss(l){const r=l.projection,s=zn(l.projection,l.zoom,l.width,l.height),u=Ea(r,l.center),p=Ea(r,o.LngLat.convert(r.center));return Math.pow(2,u*s+(1-s)*p)}function zn(l,r,s,u,p=1/0){const f=l.range;if(!f)return 0;const g=Math.min(p,Math.max(s,u)),v=Math.log(g/1024)/Math.LN2;return o.smoothstep(f[0]+v,f[1]+v,r)}const Pn=1/4e4;function Ea(l,r){const s=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),u=new o.LngLat(r.lng-180*Pn,s),p=new o.LngLat(r.lng+180*Pn,s),f=l.project(u.lng,s),g=l.project(p.lng,s),v=o.MercatorCoordinate.fromLngLat(u),w=o.MercatorCoordinate.fromLngLat(p),A=g.x-f.x,I=g.y-f.y,P=w.x-v.x,R=w.y-v.y,N=Math.sqrt((P*P+R*R)/(A*A+I*I));return Math.log(N)/Math.LN2}function Pl(l,r,s){const u=Math.cos(s),p=Math.sin(s);return{x:l*u-r*p,y:l*p+r*u}}class Po{constructor(r,s,u,p,f,g,v){this.tileSize=512,this._renderWorldCopies=f===void 0||f,this._minZoom=r||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(g),this.setMaxBounds(v),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new wa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new zl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Po(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,s=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(r||u)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const u=!re(s,this.getProjection());return u&&this._calcMatrices(),this.mercatorFromTransition=!1,u}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const s=r!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const s=-r*Math.PI/180;var u;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(u=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u),function(p,f,g){var v=f[0],w=f[1],A=f[2],I=f[3],P=Math.sin(g),R=Math.cos(g);p[0]=v*R+A*P,p[1]=w*R+I*P,p[2]=v*-P+A*R,p[3]=w*-P+I*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const s=o.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const s=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,f=0;for(let g=0;g<s.length;g++){const v=new o.pointGeometry(s[g][0]*this.width,u+s[g][1]*(this.height-u)),w=r.pointCoordinate(v);if(!w)continue;const A=1/Math.hypot(w[0]-this._camera.position[0],w[1]-this._camera.position[1]);p+=w[3]*A,f+=A}return f===0?NaN:p/f}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*s,p=this._mercatorZfromZoom(r),f=this._mercatorZfromZoom(this._maxZoom),g=Math.max(p-u,f);this._setZoom(this._zoomFromMercatorZ(g))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let u;u=r.z<this._camera.position[2]?[s.x,s.y,s.z]:[r.x,r.y,r.z];const p=o.length(o.sub([],this._camera.position,u));return o.clamp(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let s=!1;if(r.orientation&&!o.exactEquals(r.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(r.orientation)),r.position){const u=[r.position.x,r.position.y,r.position.z];o.exactEquals$1(u,this._camera.position)||(this._setCameraPosition(u),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,s=new kl;return s.position=new o.MercatorCoordinate(r[0],r[1],r[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(r){if(!o.length$1(r))return!1;o.normalize$1(r,r);const s=o.transformQuat([],[0,0,-1],r),u=o.transformQuat([],[0,-1,0],r);if(u[2]<0)return!1;const p=ou(s,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(r){const s=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;r[2]=o.clamp(r[2],p/u,p/s),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,s,u){this._unmodified=!1,this._edgeInsets.interpolate(r,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const s=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(r){const s=[new o.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const u=this.pointCoordinate(new o.pointGeometry(0,0)),p=this.pointCoordinate(new o.pointGeometry(this.width,0)),f=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),g=this.pointCoordinate(new o.pointGeometry(0,this.height)),v=Math.floor(Math.min(u.x,p.x,f.x,g.x)),w=Math.floor(Math.max(u.x,p.x,f.x,g.x)),A=1;for(let I=v-A;I<=w+A;I++)I!==0&&s.push(new o.UnwrappedTileID(I,r))}return s}coveringTiles(r){let s=this.coveringZoomLevel(r);const u=s,p=this.elevation&&!r.isTerrainDEM,f=this.projection.name==="mercator";if(r.minzoom!==void 0&&s<r.minzoom)return[];r.maxzoom!==void 0&&s>r.maxzoom&&(s=r.maxzoom);const g=this.locationCoordinate(this.center),v=this.center.lat,w=1<<s,A=[w*g.x,w*g.y,0],I=this.projection.name==="globe",P=!I,R=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,P),N=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=w*o.mercatorZfromAltitude(1,this.center.lat),V=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),F=[w*N.x,w*N.y,V*(P?1:j)],U=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),X=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?s:0,G=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Y=r.isTerrainDEM?-G:this._elevation?this._elevation.getMinElevationBelowMSL():0,oe=this.projection.isReprojectedInTileSpace?Ss(this):1,ie=Ee=>{const je=new o.MercatorCoordinate(Ee.x+25e-6,Ee.y,Ee.z),he=new o.MercatorCoordinate(Ee.x,Ee.y+25e-6,Ee.z),ve=Ee.toLngLat(),nt=je.toLngLat(),ut=he.toLngLat(),ot=this.locationCoordinate(ve),xt=this.locationCoordinate(nt),At=this.locationCoordinate(ut),ht=Math.hypot(xt.x-ot.x,xt.y-ot.y),et=Math.hypot(At.x-ot.x,At.y-ot.y);return Math.sqrt(ht*et)*oe/25e-6},ce=Ee=>{const Pe=G,je=Y;return{aabb:o.tileAABB(this,w,0,0,0,Ee,je,Pe,this.projection),zoom:0,x:0,y:0,minZ:je,maxZ:Pe,wrap:Ee,fullyVisible:!1}},xe=[];let _e=[];const ue=s,Ue=r.reparseOverscaled?u:s,fe=Ee=>Ee*Ee,Ae=fe((V-this._centerAltitude)*j),be=Ee=>{if(!this._elevation||!Ee.tileID||!f)return;const Pe=this._elevation.getMinMaxForTile(Ee.tileID),je=Ee.aabb;Pe?(je.min[2]=Pe.min,je.max[2]=Pe.max,je.center[2]=(je.min[2]+je.max[2])/2):(Ee.shouldSplit=Re(Ee),Ee.shouldSplit||(je.min[2]=je.max[2]=je.center[2]=this._centerAltitude))},Re=Ee=>{if(Ee.zoom<X)return!0;if(Ee.zoom===ue)return!1;if(Ee.shouldSplit!=null)return Ee.shouldSplit;const Pe=Ee.aabb.distanceX(F),je=Ee.aabb.distanceY(F);let he=Ae,ve=1;if(I){he=fe(Ee.aabb.distanceZ(F));const ot=Math.pow(2,Ee.zoom),xt=o.latFromMercatorY((Ee.y+1)/ot),At=o.latFromMercatorY(Ee.y/ot),ht=Math.min(Math.max(v,xt),At),et=o.circumferenceAtLatitude(ht)/o.circumferenceAtLatitude(v);if(ve=ht===v?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,et/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Ee.zoom===ue-1&&et>=.9)return!0}else if(p&&(he=fe(Ee.aabb.distanceZ(F)*j)),this.projection.isReprojectedInTileSpace&&u<=5){const ot=Math.pow(2,Ee.zoom),xt=ie(new o.MercatorCoordinate((Ee.x+.5)/ot,(Ee.y+.5)/ot));ve=xt>.85?1:xt}const nt=Pe*Pe+je*je+he,ut=fe((1<<ue-Ee.zoom)*U*ve*((ot,xt)=>{if(xt*fe(.707)<ot)return 1;const At=Math.sqrt(xt/ot);return At/(1.4144271570014144+(Math.pow(1.1,At-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(he,Ae),nt));return nt<ut};if(this.renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)xe.push(ce(-Ee)),xe.push(ce(Ee));for(xe.push(ce(0));xe.length>0;){const Ee=xe.pop(),Pe=Ee.x,je=Ee.y;let he=Ee.fullyVisible;if(!he){const ve=Ee.aabb.intersects(R);if(ve===0)continue;he=ve===2}if(Ee.zoom!==ue&&Re(Ee))for(let ve=0;ve<4;ve++){const nt=(Pe<<1)+ve%2,ut=(je<<1)+(ve>>1),ot={aabb:f?Ee.aabb.quadrant(ve):o.tileAABB(this,w,Ee.zoom+1,nt,ut,Ee.wrap,Ee.minZ,Ee.maxZ,this.projection),zoom:Ee.zoom+1,x:nt,y:ut,wrap:Ee.wrap,fullyVisible:he,tileID:void 0,shouldSplit:void 0,minZ:Ee.minZ,maxZ:Ee.maxZ};p&&!I&&(ot.tileID=new o.OverscaledTileID(Ee.zoom+1===ue?Ue:Ee.zoom+1,Ee.wrap,Ee.zoom+1,nt,ut),be(ot)),xe.push(ot)}else{const ve=Ee.zoom===ue?Ue:Ee.zoom;if(r.minzoom&&r.minzoom>ve)continue;const nt=A[0]-(.5+Pe+(Ee.wrap<<Ee.zoom))*(1<<s-Ee.zoom),ut=A[1]-.5-je,ot=Ee.tileID?Ee.tileID:new o.OverscaledTileID(ve,Ee.wrap,Ee.zoom,Pe,je);_e.push({tileID:ot,distanceSq:nt*nt+ut*ut})}}if(this.fogCullDistSq){const Ee=this.fogCullDistSq,Pe=this.horizonLineFromTop();_e=_e.filter(je=>{const he=[0,0,0,1],ve=[o.EXTENT,o.EXTENT,0,1],nt=this.calculateFogTileMatrix(je.tileID.toUnwrapped());o.transformMat4$1(he,he,nt),o.transformMat4$1(ve,ve,nt);const ut=o.getAABBPointSquareDist(he,ve);if(ut===0)return!0;let ot=!1;const xt=this._elevation;if(xt&&ut>Ee&&Pe!==0){const At=this.calculateProjMatrix(je.tileID.toUnwrapped());let ht;r.isTerrainDEM||(ht=xt.getMinMaxForTile(je.tileID)),ht||(ht={min:Y,max:G});const et=o.furthestTileCorner(this.rotation),ni=[et[0]*o.EXTENT,et[1]*o.EXTENT,ht.max];o.transformMat4(ni,ni,At),ot=(1-ni[1])*this.height*.5<Pe}return ut<Ee||ot})}return _e.sort((Ee,Pe)=>Ee.distanceSq-Pe.distanceSq).map(Ee=>Ee.tileID)}resize(r,s){this.width=r,this.height=s,this.pixelsToGLUnits=[2/r,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const s=o.clamp(r.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),u=this.projection.project(r.lng,s);return new o.pointGeometry(u.x*this.worldSize,u.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,s){let u,p;const f=this.centerPoint;if(this.projection.name==="globe"){const v=this.worldSize;u=(s.x-f.x)/v,p=(s.y-f.y)/v}else{const v=this.pointCoordinate(s),w=this.pointCoordinate(f);u=v.x-w.x,p=v.y-w.y}const g=this.locationCoordinate(r);this.setLocation(new o.MercatorCoordinate(g.x-u,g.y-p))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,s){const u=s?o.mercatorZfromAltitude(s,r.lat):void 0,p=this.projection.project(r.lng,r.lat);return new o.MercatorCoordinate(p.x,p.y,u)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,s){const u=s??this._centerAltitude,p=[r.x,r.y,0,1],f=[r.x,r.y,1,1];o.transformMat4$1(p,p,this.pixelMatrixInverse),o.transformMat4$1(f,f,this.pixelMatrixInverse);const g=f[3];o.scale$1(p,p,1/p[3]),o.scale$1(f,f,1/g);const v=p[2],w=f[2];return{p0:p,p1:f,t:v===w?0:(u-v)/(w-v)}}screenPointToMercatorRay(r){const s=[r.x,r.y,0,1],u=[r.x,r.y,1,1];return o.transformMat4$1(s,s,this.pixelMatrixInverse),o.transformMat4$1(u,u,this.pixelMatrixInverse),o.scale$1(s,s,1/s[3]),o.scale$1(u,u,1/u[3]),s[2]=o.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,u[2]=o.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,o.scale$1(s,s,1/this.worldSize),o.scale$1(u,u,1/this.worldSize),new o.Ray([s[0],s[1],s[2]],o.normalize([],o.sub([],u,s)))}rayIntersectionCoordinate(r){const{p0:s,p1:u,t:p}=r,f=o.mercatorZfromAltitude(s[2],this._center.lat),g=o.mercatorZfromAltitude(u[2],this._center.lat);return new o.MercatorCoordinate(o.number(s[0],u[0],p)/this.worldSize,o.number(s[1],u[1],p)/this.worldSize,o.number(f,g,p))}pointCoordinate(r,s=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,s)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let s=this.projection.pointCoordinate3D(this,r.x,r.y);if(s)return new o.MercatorCoordinate(s[0],s[1],s[2]);let u=0,p=this.horizonLineFromTop();if(r.y>p)return this.pointCoordinate(r);const f=.02*p,g=r.clone();for(let v=0;v<10&&p-u>f;v++){g.y=o.number(u,p,.66);const w=this.projection.pointCoordinate3D(this,g.x,g.y);w?(p=g.y,s=w):u=g.y}return s?new o.MercatorCoordinate(s[0],s[1],s[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,s){const u=s&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,p=[r.x*this.worldSize,r.y*this.worldSize,u+r.toAltitude(),1];return o.transformMat4$1(p,p,this.pixelMatrix),p[3]>0?new o.pointGeometry(p[0]/p[3],p[1]/p[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:r,left:s}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,f=this.pointCoordinate3D(new o.pointGeometry(s,r)),g=this.pointCoordinate3D(new o.pointGeometry(p,r)),v=this.pointCoordinate3D(new o.pointGeometry(p,u)),w=this.pointCoordinate3D(new o.pointGeometry(s,u));let A=Math.min(f.x,w.x),I=Math.max(g.x,v.x),P=Math.min(f.y,g.y),R=Math.max(w.y,v.y);const N=Math.pow(2,-this.zoom)/16,j=(ie,ce,xe,_e)=>{const ue=(ie+xe)/2,Ue=(ce+_e)/2,fe=new o.pointGeometry(ue,Ue),Ae=this.pointCoordinate3D(fe),be=Math.max(0,A-Ae.x,P-Ae.y,Ae.x-I,Ae.y-R);A=Math.min(A,Ae.x),I=Math.max(I,Ae.x),P=Math.min(P,Ae.y),R=Math.max(R,Ae.y),be>N&&(j(ie,ce,ue,Ue),j(ue,Ue,xe,_e))};j(s,r,p,r),j(p,r,p,u),j(p,u,s,u),j(s,u,s,r);const[V,F]=o.polesInViewport(this),U=V||F,X=V?90:o.latFromMercatorY(P),G=U?180:o.lngFromMercatorX(I),Y=F?-90:o.latFromMercatorY(R),oe=U?-180:o.lngFromMercatorX(A);return new o.LngLatBounds(new o.LngLat(oe,Y),new o.LngLat(G,X))}_getBounds(r,s){if(this.projection.name==="globe")return this._getGlobeBounds();const u=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),p=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),f=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),g=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let v=this.pointCoordinate(u,r),w=this.pointCoordinate(p,r);const A=this.pointCoordinate(f,s),I=this.pointCoordinate(g,s),P=(R,N)=>(N.y-R.y)/(N.x-R.x);return v.y>1&&w.y>=0?v=new o.MercatorCoordinate((1-I.y)/P(I,v)+I.x,1):v.y<0&&w.y<=1&&(v=new o.MercatorCoordinate(-I.y/P(I,v)+I.x,0)),w.y>1&&v.y>=0?w=new o.MercatorCoordinate((1-A.y)/P(A,w)+A.x,1):w.y<0&&v.y<=1&&(w=new o.MercatorCoordinate(-A.y/P(A,w)+A.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(v)).extend(this.coordinateLocation(w)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(A))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBounds(0,0);const s=r.visibleDemTiles.reduce((u,p)=>{if(p.dem){const f=p.dem.tree;u.min=Math.min(u.min,f.minimums[0]),u.max=Math.max(u.max,f.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBounds(s.min*r.exaggeration(),s.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,u=this.height/2-s*(1-this._horizonShift);return r?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,s){return this.projection.createTileMatrix(this,s,r)}calculateDistanceTileData(r){const s=r.key,u=this._distanceTileDataCache;if(u[s])return u[s];const p=r.canonical,f=1/this.height,g=this.cameraWorldSize,v=g/this.zoomScale(p.z),w=(p.x+Math.pow(2,p.z)*r.wrap)*v,A=p.y*v,I=this.point;I.x*=g/this.worldSize,I.y*=g/this.worldSize;const P=this.angle,R=Math.sin(-P),N=-Math.cos(-P);return u[s]={bearing:[R,N],center:[(I.x-w)*f,(I.y-A)*f],scale:v/o.EXTENT*f},u[s]}calculateFogTileMatrix(r){const s=r.key,u=this._fogTileMatrixCache;if(u[s])return u[s];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.multiply(p,this.worldToFogMatrix,p),u[s]=new Float32Array(p),u[s]}calculateProjMatrix(r,s=!1){const u=r.key,p=s?this._alignedProjMatrixCache:this._projMatrixCache;if(p[u])return p[u];const f=this.calculatePosMatrix(r,this.worldSize);return o.multiply(f,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.alignedProjMatrix:this.projMatrix,f),p[u]=new Float32Array(f),p[u]}calculatePixelsToTileUnitsMatrix(r){const s=r.tileID.key,u=this._pixelsToTileUnitsCache;if(u[s])return u[s];const p=function(f,g){const{scale:v}=f.tileTransform,w=v*o.EXTENT/(f.tileSize*Math.pow(2,g.zoom-f.tileID.overscaledZ+f.tileID.canonical.z));return A=new Float32Array(4),R=(I=g.inverseAdjustmentMatrix)[1],N=I[2],j=I[3],F=(P=[w,w])[1],A[0]=I[0]*(V=P[0]),A[1]=R*V,A[2]=N*F,A[3]=j*F,A;var A,I,P,R,N,j,V,F}(r,this);return u[s]=p,u[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(s),p=this._camera.forward(),f=o.mercatorZfromAltitude(1,this._center.lat);u[2]/=f,p[2]/=f,o.normalize(p,p);const g=r.raycast(u,p,r.exaggeration());if(g){const v=o.scaleAndAdd([],u,p,g),w=new o.MercatorCoordinate(v[0],v[1],o.mercatorZfromAltitude(v[2],o.latFromMercatorY(v[1]))),A=(w.z+o.length([w.x-u[0],w.y-u[1],w.z-u[2]*f]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=w.toAltitude(),this._center=this.coordinateLocation(w),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const s=this._elevation,u=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),f=s.getAtPointOrZero(new o.MercatorCoordinate(...p)),g=this.pixelsPerMeter/this.worldSize*f,v=this._minimumHeightOverTerrain(),w=p[2]-g;if(w<=v)if(w<0||r){const A=this.locationCoordinate(this._center,this._centerAltitude),I=[p[0],p[1],A.z-p[2]],P=o.length(I);I[2]-=(v-w)/this._pixelsPerMercatorPixel;const R=o.length(I);if(R===0)return;o.scale$2(I,I,P/R*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],A.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const R=this.center;return R.lat=o.clamp(R.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(R.lng=o.clamp(R.lng,this.minLng,this.maxLng)),this.center=R,void(this._constraining=!1)}const s=this._unmodified,{x:u,y:p}=this.point;let f=0,g=u,v=p;const w=this.width/2,A=this.height/2,I=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(p-A<I&&(v=I+A),p+A>P&&(v=P-A),P-I<this.height&&(f=Math.max(f,this.height/(P-I)),v=(P+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const R=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,j=this.worldSize/2-(R+N)/2;g=(u+j+this.worldSize)%this.worldSize-j,g-w<R&&(g=R+w),g+w>N&&(g=N-w),N-R<this.width&&(f=Math.max(f,this.width/(N-R)),g=(N+R)/2)}g===u&&v===p||(this.center=this.unproject(new o.pointGeometry(g,v))),f&&(this.zoom+=this.scaleZoom(f)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,s=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const u=zn(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,u),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const p=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?s:1),f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);f[8]=2*-r.x/this.width,f[9]=2*r.y/this.height;let g=o.mul([],f,p);if(this.projection.isReprojectedInTileSpace){const oe=this.locationCoordinate(this.center),ie=o.identity([]);o.translate(ie,ie,[oe.x*this.worldSize,oe.y*this.worldSize,0]),o.multiply(ie,ie,Ta(this)),o.translate(ie,ie,[-oe.x*this.worldSize,-oe.y*this.worldSize,0]),o.multiply(g,g,ie),this.inverseAdjustmentMatrix=function(ce){const xe=Ta(ce,!0);return gt([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],g,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=g,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const v=o.invert([],f);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(v,this.horizonLineFromTop(),this.height);const w=new Float32Array(16);o.identity(w),o.scale(w,w,[1,-1,1]),o.rotateX(w,w,this._pitch),o.rotateZ(w,w,this.angle);const A=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),I=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;A[8]=2*-r.x/this.width,A[9]=2*(r.y+I)/this.height,this.skyboxMatrix=o.multiply(w,A,w);const P=this.point,R=P.x,N=P.y,j=this.width%2/2,V=this.height%2/2,F=Math.cos(this.angle),U=Math.sin(this.angle),X=R-Math.round(R)+F*j+U*V,G=N-Math.round(N)+F*V+U*j,Y=new Float64Array(g);if(o.translate(Y,Y,[X>.5?X-1:X,G>.5?G-1:G,0]),this.alignedProjMatrix=Y,g=o.create(),o.scale(g,g,[this.width/2,-this.height/2,1]),o.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=o.create(),o.scale(g,g,[1,-1,1]),o.translate(g,g,[-1,-1,0]),o.scale(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},g=o.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=g,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const oe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(oe,oe,p),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=g;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,f=[r,r,s];o.scale$2(f,f,p),o.scale$2(u,u,-1),o.multiply$2(u,u,f);const g=o.create();o.translate(g,g,u),o.scale(g,g,f),this.mercatorFogMatrix=g,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,s,p)}_computeCameraPosition(r){const s=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,f=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-r/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*f,p.y/this.worldSize-u[1]*f,r/this.worldSize*this._centerAltitude-u[2]*f]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=r[2];let f=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(f=Math.min((s-u)/p,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,r,f),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,s=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),f=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,g=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),v=Math.max((r[2]-f)/Math.cos(u),g),w=this._zoomFromMercatorZ(v);o.scaleAndAdd(r,r,s,v),this._pitch=o.clamp(u,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(p,-Math.PI,Math.PI),this._setZoom(o.clamp(w,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){const s=g=>{const v=this.getCameraToCenterDistance(this.projection,g);return this.scaleZoom(v/(r*this.tileSize))};let u,p=s(this.zoom),f=Math.abs(p-s(p));for(;u!==f;)p=s(p),u=f,f=Math.abs(p-s(p));return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,s){const u=Math.min(r.x,s.x),p=Math.max(r.x,s.x),f=Math.min(r.y,s.y),g=Math.max(r.y,s.y);if(f<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const v=[new o.pointGeometry(u,f),new o.pointGeometry(p,g),new o.pointGeometry(u,g),new o.pointGeometry(p,f)],w=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(const I of v){const P=this.pointRayIntersection(I);if(P.t<0)return!0;const R=this.rayIntersectionCoordinate(P);if(R.x<w||R.y<0||R.x>A||R.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,s){const u=o.length(o.sub([],this._camera.position,r)),p=this._zoomFromMercatorZ(u)+s;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([s,u,p],f){const g=[s,u,p,1];o.transformMat4$1(g,g,f);const v=g[3]=Math.max(g[3],1e-6);return g[0]/=v,g[1]/=v,g[2]/=v,g}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,r))}}getCameraToCenterDistance(r,s=this.zoom){const u=zn(r,s,this.width,this.height,1024),p=r.pixelSpaceConversion(this.center.lat,this.worldSize,u);return .5/Math.tan(.5*this._fov)*this.height*p}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(r,r,this.globeMatrix),r}}function Is(l,r){let s=!1,u=null;const p=()=>{u=null,s&&(l(),u=setTimeout(p,r),s=!1)};return()=>(s=!0,u||p(),u)}class Qe{constructor(r){this._hashName=r&&encodeURIComponent(r),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Is(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,o.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const s=zr(r);if(this._hashName){const u=this._hashName;let p=!1;const f=o.window.location.hash.slice(1).split("&").map(g=>{const v=g.split("=")[0];return v===u?(p=!0,`${v}=${s}`):g}).filter(g=>g);return p||f.push(`${u}=${s}`),`#${f.join("&")}`}return`#${s}`}_getCurrentHash(){const r=o.window.location.hash.replace("#","");if(this._hashName){let s;return r.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(s=u)}),(s&&s[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(u=>isNaN(u))){const u=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(s[3]||0):r.getBearing();return r.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,r)}}function zr(l,r){const s=l.getCenter(),u=Math.round(100*l.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,p),g=Math.round(s.lng*f)/f,v=Math.round(s.lat*f)/f,w=l.getBearing(),A=l.getPitch();let I=r?`/${g}/${v}/${u}`:`${u}/${v}/${g}`;return(w||A)&&(I+="/"+Math.round(10*w)/10),A&&(I+=`/${Math.round(A)}`),I}const As={linearity:.3,easing:o.bezier(0,0,.3,1)},su=o.extend({deceleration:2500,maxSpeed:1400},As),au=o.extend({deceleration:20,maxSpeed:1400},As),Do=o.extend({deceleration:1e3,maxSpeed:360},As),lu=o.extend({deceleration:1e3,maxSpeed:90},As);class Sa{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,s=o.exported.now();for(;r.length>0&&s-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)s.zoom+=f.zoomDelta||0,s.bearing+=f.bearingDelta||0,s.pitch+=f.pitchDelta||0,f.panDelta&&s.pan._add(f.panDelta),f.around&&(s.around=f.around),f.pinchAround&&(s.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const f=Qn(s.pan.mag(),u,o.extend({},su,r||{}));p.offset=s.pan.mult(f.amount/s.pan.mag()),p.center=this._map.transform.center,Lo(p,f)}if(s.zoom){const f=Qn(s.zoom,u,au);p.zoom=this._map.transform.zoom+f.amount,Lo(p,f)}if(s.bearing){const f=Qn(s.bearing,u,Do);p.bearing=this._map.transform.bearing+o.clamp(f.amount,-179,179),Lo(p,f)}if(s.pitch){const f=Qn(s.pitch,u,lu);p.pitch=this._map.transform.pitch+f.amount,Lo(p,f)}if(p.zoom||p.bearing){const f=s.pinchAround===void 0?s.around:s.pinchAround;p.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Lo(l,r){(!l.duration||l.duration<r.duration)&&(l.duration=r.duration,l.easing=r.easing)}function Qn(l,r,s){const{maxSpeed:u,linearity:p,deceleration:f}=s,g=o.clamp(l*p/(r/1e3),-u,u),v=Math.abs(g)/(f*p);return{easing:s.easing,duration:1e3*v,amount:g*(v/2)}}class _r extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,u,p={}){const f=Se(s.getCanvasContainer(),u),g=s.unproject(f);super(r,o.extend({point:f,lngLat:g,originalEvent:u},p)),this._defaultPrevented=!1,this.target=s}}class Ms extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,u){const p=r==="touchend"?u.changedTouches:u.touches,f=dt(s.getCanvasContainer(),p),g=f.map(w=>s.unproject(w)),v=f.reduce((w,A,I,P)=>w.add(A.div(P.length)),new o.pointGeometry(0,0));super(r,{points:f,point:v,lngLats:g,lngLat:s.unproject(v),originalEvent:u}),this._defaultPrevented=!1}}class Ro extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,u){super(r,{originalEvent:u}),this._defaultPrevented=!1}}class qh{constructor(r,s){this._map=r,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Ro(r.type,this._map,r))}mousedown(r,s){return this._mousedownPos=s,this._firePreventable(new _r(r.type,this._map,r))}mouseup(r){this._map.fire(new _r(r.type,this._map,r))}preclick(r){const s=o.extend({},r);s.type="preclick",this._map.fire(new _r(s.type,this._map,s))}click(r,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(r),this._map.fire(new _r(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new _r(r.type,this._map,r))}mouseover(r){this._map.fire(new _r(r.type,this._map,r))}mouseout(r){this._map.fire(new _r(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ms(r.type,this._map,r))}touchmove(r){this._map.fire(new Ms(r.type,this._map,r))}touchend(r){this._map.fire(new Ms(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ms(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zh{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new _r(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new _r(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cu{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,s){this.isEnabled()&&r.shiftKey&&r.button===0&&(rt(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(r,s){if(!this._active)return;const u=s,p=this._startPos,f=this._lastPos;if(!p||!f||f.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=We("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const g=Math.min(p.x,u.x),v=Math.max(p.x,u.x),w=Math.min(p.y,u.y),A=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${g}px,${w}px)`,this._box.style.width=v-g+"px",this._box.style.height=A-w+"px")})}mouseupWindow(r,s){if(!this._active)return;const u=this._startPos,p=s;if(u&&r.button===0){if(this.reset(),St(),u.x!==p.x||u.y!==p.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:f=>f.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ne(),delete this._startPos,delete this._lastPos}_fireEvent(r,s){return this._map.fire(new o.Event(r,{originalEvent:s}))}}function Bo(l,r){const s={};for(let u=0;u<l.length;u++)s[l[u].identifier]=r[u];return s}class Dl{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const f=new o.pointGeometry(0,0);for(const g of p)f._add(g);return f.div(p.length)}(s),this.touches=Bo(u,s)))}touchmove(r,s,u){if(this.aborted||!this.centroid)return;const p=Bo(u,s);for(const f in this.touches){const g=this.touches[f],v=p[f];(!v||v.dist(g)>30)&&(this.aborted=!0)}}touchend(r,s,u){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Ia{constructor(r){this.singleTap=new Dl(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,s,u){this.singleTap.touchstart(r,s,u)}touchmove(r,s,u){this.singleTap.touchmove(r,s,u)}touchend(r,s,u){const p=this.singleTap.touchend(r,s,u);if(p){const f=r.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(p)<30;if(f&&g||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class uu{constructor(){this._zoomIn=new Ia({numTouches:1,numTaps:2}),this._zoomOut=new Ia({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,s,u){this._zoomIn.touchstart(r,s,u),this._zoomOut.touchstart(r,s,u)}touchmove(r,s,u){this._zoomIn.touchmove(r,s,u),this._zoomOut.touchmove(r,s,u)}touchend(r,s,u){const p=this._zoomIn.touchend(r,s,u),f=this._zoomOut.touchend(r,s,u);return p?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:g.getZoom()+1,around:g.unproject(p)},{originalEvent:r})}):f?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:g.getZoom()-1,around:g.unproject(f)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Aa={0:1,2:2};class Cs{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,s){return!1}_move(r,s){return{}}mousedown(r,s){if(this._lastPoint)return;const u=Pi(r);this._correctButton(r,u)&&(this._lastPoint=s,this._eventButton=u)}mousemoveWindow(r,s){const u=this._lastPoint;if(u){if(r.preventDefault(),this._eventButton!=null&&function(p,f){const g=Aa[f];return p.buttons===void 0||(p.buttons&g)!==g}(r,this._eventButton))this.reset();else if(this._moved||!(s.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(u,s)}}mouseupWindow(r){this._lastPoint&&Pi(r)===this._eventButton&&(this._moved&&St(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hu extends Cs{mousedown(r,s){super.mousedown(r,s),this._lastPoint&&(this._active=!0)}_correctButton(r,s){return s===0&&!r.ctrlKey}_move(r,s){return{around:s,panDelta:s.sub(r)}}}class Ll extends Cs{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const u=.8*(s.x-r.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(r){r.preventDefault()}}class Rl extends Cs{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const u=-.5*(s.y-r.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(r){r.preventDefault()}}class pu{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(r,s,u){return this._calculateTransform(r,s,u)}touchmove(r,s,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,s,u)}}touchend(r,s,u){this._calculateTransform(r,s,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,s,u){u.length>0&&(this._active=!0);const p=Bo(u,s),f=new o.pointGeometry(0,0),g=new o.pointGeometry(0,0);let v=0;for(const A in p){const I=p[A],P=this._touches[A];P&&(f._add(I),g._add(I.sub(P)),v++,p[A]=I)}if(this._touches=p,v<this._minTouches||!g.mag())return;const w=g.div(v);return this._sum._add(w),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(v),panDelta:w}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=We("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ma{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,s,u){return{}}touchstart(r,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(r,s,u){const p=this._firstTwoTouches;if(!p)return;r.preventDefault();const[f,g]=p,v=hn(u,s,f),w=hn(u,s,g);if(!v||!w)return;const A=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],A,r)}touchend(r,s,u){if(!this._firstTwoTouches)return;const[p,f]=this._firstTwoTouches,g=hn(u,s,p),v=hn(u,s,f);g&&v||(this._active&&St(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function hn(l,r,s){for(let u=0;u<l.length;u++)if(l[u].identifier===s)return r[u]}function Bl(l,r){return Math.log(l/r)/Math.LN2}class du extends Ma{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,s){const u=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Bl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bl(this._distance,u),pinchAround:s}}}function fu(l,r){return 180*l.angleWith(r)/Math.PI}class mu extends Ma{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,s){const u=this._vector;if(this._vector=r[0].sub(r[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:fu(this._vector,u),pinchAround:s}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const s=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=fu(r,u);return Math.abs(p)<s}}function Ca(l){return Math.abs(l.y)>Math.abs(l.x)}class _u extends Ma{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Ca(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,s,u){const p=this._lastPoints;if(!p)return;const f=r[0].sub(p[0]),g=r[1].sub(p[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(f,g,u.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(f.y+g.y)/2*-.5})}gestureBeginsVertically(r,s,u){if(this._valid!==void 0)return this._valid;const p=r.mag()>=2,f=s.mag()>=2;if(!p&&!f)return;if(!p||!f)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const g=r.y>0==s.y>0;return Ca(r)&&Ca(s)&&g}}const gu={panStep:100,bearingStep:15,pitchStep:10};class nr{constructor(){const r=gu;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let s=0,u=0,p=0,f=0,g=0;switch(r.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:r.shiftKey?u=-1:(r.preventDefault(),f=-1);break;case 39:r.shiftKey?u=1:(r.preventDefault(),f=1);break;case 38:r.shiftKey?p=1:(r.preventDefault(),g=-1);break;case 40:r.shiftKey?p=-1:(r.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:v=>{const w=v.getZoom();v.easeTo({duration:300,easeId:"keyboardHandler",easing:Xh,zoom:s?Math.round(w)+s*(r.shiftKey?2:1):w,bearing:v.getBearing()+u*this._bearingStep,pitch:v.getPitch()+p*this._pitchStep,offset:[-f*this._panStep,-g*this._panStep],center:v.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xh(l){return l*(2-l)}const Ol=4.000244140625;class Wh{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=r.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const u=o.exported.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%Ol==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),r.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=r,this._delta-=s,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Se(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Ol?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&A!==0&&(A=1/A);const I=s(),P=Math.pow(2,I),R=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):P;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(R*A))),this._type==="wheel"&&(this._startZoom=I,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:s(),p=this._startZoom,f=this._easing;let g,v=!1;if(this._type==="wheel"&&p&&f){const w=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),A=f(w);g=o.number(p,u,A),w<1?this._frameId||(this._frameId=!0):v=!0}else g=u,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:g-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let s=o.ease;if(this._prevEase){const u=this._prevEase,p=(o.exported.now()-u.start)/u.duration,f=u.easing(p+.01)-u.easing(p),g=.27/Math.sqrt(f*f+1e-4)*.01,v=Math.sqrt(.0729-g*g);s=o.bezier(g,v,.25,1)}return this._prevEase={start:o.exported.now(),duration:r,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=We("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Hh{constructor(r,s){this._clickZoom=r,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,s){return r.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(r.shiftKey?-1:1),around:u.unproject(s)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yu{constructor(){this._tap=new Ia({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,s,u){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=s[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(r,s,u))}touchmove(r,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=s[0],f=p.y-this._swipePoint.y;return this._swipePoint=p,r.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(r,s,u)}touchend(r,s,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(r,s,u)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oo{constructor(r,s,u){this._el=r,this._mousePan=s,this._touchPan=u}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hr{constructor(r,s,u){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ka{constructor(r,s,u,p){this._el=r,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const it=l=>l.zoom||l.drag||l.pitch||l.rotate;class xu extends o.Event{}class vu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,s){const u=o.sub([],s,r);this.radius=o.length(u[2]<0?o.div([],u,this.constants):[u[0],u[1],0])}projectRay(r){o.div(r,r,this.constants),o.normalize(r,r),o.mul$1(r,r,this.constants);const s=o.scale$2([],r,this.radius);if(s[2]>0){const u=o.scale$2([],[0,0,1],o.dot(s,[0,0,1])),p=o.scale$2([],o.normalize([],[s[0],s[1],0]),this.radius),f=o.add([],s,o.scale$2([],o.sub([],o.add([],p,u),s),2));s[0]=f[0],s[1]=f[1]}return s}}function Dn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class ks{constructor(r,s){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Sa(r),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new vu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[p,f,g]of this._listeners)p.addEventListener(f,p===o.window.document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[r,s,u]of this._listeners)r.removeEventListener(s,r===o.window.document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(r){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new qh(s,r));const p=s.boxZoom=new cu(s,r);this._add("boxZoom",p);const f=new uu,g=new pn;s.doubleClickZoom=new Hh(g,f),this._add("tapZoom",f),this._add("clickZoom",g);const v=new yu;this._add("tapDragZoom",v);const w=s.touchPitch=new _u(s);this._add("touchPitch",w);const A=new Ll(r),I=new Rl(r);s.dragRotate=new Hr(r,A,I),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const P=new hu(r),R=new pu(s,r);s.dragPan=new Oo(u,P,R),this._add("mousePan",P),this._add("touchPan",R,["touchZoom","touchRotate"]);const N=new mu,j=new du;s.touchZoomRotate=new ka(u,j,N,v),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Zh(s));const V=s.scrollZoom=new Wh(s,this);this._add("scrollZoom",V,["mousePan"]);const F=s.keyboard=new nr;this._add("keyboard",F);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[U]&&s[U].enable(r[U])}_add(r,s,u){this._handlers.push({handlerName:r,handler:s,allowed:u}),this._handlersById[r]=s}stop(r){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!it(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,s,u){for(const p in r)if(p!==u&&(!s||s.indexOf(p)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const s=[];for(const u of r)this._el.contains(u.target)&&s.push(u);return s}handleEvent(r,s){this._updatingCamera=!0;const u=r.type==="renderFrame",p=u?void 0:r,f={needsRenderFrame:!1},g={},v={},w=r.touches?this._getMapTouches(r.touches):void 0,A=w?dt(this._el,w):u?void 0:Se(this._el,r);for(const{handlerName:R,handler:N,allowed:j}of this._handlers){if(!N.isEnabled())continue;let V;this._blockedByActive(v,j,R)?N.reset():N[s||r.type]&&(V=N[s||r.type](r,A,w),this.mergeHandlerResult(f,g,V,R,p),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||N.isActive())&&(v[R]=N)}const I={};for(const R in this._previousActiveHandlers)v[R]||(I[R]=p);this._previousActiveHandlers=v,(Object.keys(I).length||Dn(f))&&(this._changes.push([f,g,I]),this._triggerRenderFrame()),(Object.keys(v).length||Dn(f))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:P}=f;P&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],P(this._map))}mergeHandlerResult(r,s,u,p,f){if(!u)return;o.extend(r,u);const g={handlerName:p,originalEvent:u.originalEvent||f};u.zoomDelta!==void 0&&(s.zoom=g),u.panDelta!==void 0&&(s.drag=g),u.pitchDelta!==void 0&&(s.pitch=g),u.bearingDelta!==void 0&&(s.rotate=g)}_applyChanges(){const r={},s={},u={};for(const[p,f,g]of this._changes)p.panDelta&&(r.panDelta=(r.panDelta||new o.pointGeometry(0,0))._add(p.panDelta)),p.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(r.around=p.around),p.aroundCoord!==void 0&&(r.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(r.pinchAround=p.pinchAround),p.noInertia&&(r.noInertia=p.noInertia),o.extend(s,f),o.extend(u,g);this._updateMapTransform(r,s,u),this._changes=[]}_updateMapTransform(r,s,u){const p=this._map,f=p.transform,g=X=>[X.x,X.y,X.z];if((X=>{const G=this._eventsInProgress.drag;return G&&!this._handlersById[G.handlerName].isActive()})()&&!Dn(r)){const X=f.zoom;f.cameraElevationReference="sea",f.recenterOnTerrain(),f.cameraElevationReference="ground",X!==f.zoom&&this._map._update(!0)}if(f._isCameraConstrained&&p._stop(!0),!Dn(r))return void this._fireEvents(s,u,!0);let{panDelta:v,zoomDelta:w,bearingDelta:A,pitchDelta:I,around:P,aroundCoord:R,pinchAround:N}=r;f._isCameraConstrained&&(w>0&&(w=0),f._isCameraConstrained=!1),N!==void 0&&(P=N),(X=>s.drag&&!this._eventsInProgress.drag)()&&P&&(this._dragOrigin=g(f.pointCoordinate3D(P)),this._trackingEllipsoid.setup(f._camera.position,this._dragOrigin)),f.cameraElevationReference="sea",p._stop(!0),P=P||p.transform.centerPoint,A&&(f.bearing+=A),I&&(f.pitch+=I),f._updateCameraState();const j=[0,0,0];if(v)if(f.projection.name==="mercator"){const X=this._trackingEllipsoid.projectRay(f.screenPointToMercatorRay(P).dir),G=this._trackingEllipsoid.projectRay(f.screenPointToMercatorRay(P.sub(v)).dir);j[0]=G[0]-X[0],j[1]=G[1]-X[1]}else{const X=f.pointCoordinate(P);if(f.projection.name==="globe"){v=v.rotate(-f.angle);const G=f._pixelsPerMercatorPixel/f.worldSize;j[0]=-v.x*o.mercatorScale(o.latFromMercatorY(X.y))*G,j[1]=-v.y*o.mercatorScale(f.center.lat)*G}else{const G=f.pointCoordinate(P.sub(v));X&&G&&(j[0]=G.x-X.x,j[1]=G.y-X.y)}}const V=f.zoom,F=[0,0,0];if(w){const X=g(R||f.pointCoordinate3D(P)),G={dir:o.normalize([],o.sub([],X,f._camera.position))};if(G.dir[2]<0){const Y=f.zoomDeltaToMovement(X,w);o.scale$2(F,G.dir,Y)}}const U=o.add(j,j,F);f._translateCameraConstrained(U),w&&Math.abs(f.zoom-V)>1e-4&&f.recenterOnTerrain(),f.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(s,u,!0)}_fireEvents(r,s,u){const p=it(this._eventsInProgress),f=it(r),g={};for(const I in r){const{originalEvent:P}=r[I];this._eventsInProgress[I]||(g[`${I}start`]=P),this._eventsInProgress[I]=r[I]}!p&&f&&this._fireEvent("movestart",f.originalEvent);for(const I in g)this._fireEvent(I,g[I]);f&&this._fireEvent("move",f.originalEvent);for(const I in r){const{originalEvent:P}=r[I];this._fireEvent(I,P)}const v={};let w;for(const I in this._eventsInProgress){const{handlerName:P,originalEvent:R}=this._eventsInProgress[I];this._handlersById[P].isActive()||(delete this._eventsInProgress[I],w=s[P]||R,v[`${I}end`]=w)}for(const I in v)this._fireEvent(I,v[I]);const A=it(this._eventsInProgress);if(u&&(p||f)&&!A){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=R=>R!==0&&-this._bearingSnap<R&&R<this._bearingSnap;I?(P(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:w})):(this._map.fire(new o.Event("moveend",{originalEvent:w})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,s){this._map.fire(new o.Event(r,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new xu("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Fl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class bu extends o.Evented{constructor(r,s){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=s.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,s){return this.jumpTo({center:r},s)}panBy(r,s,u){return r=o.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,o.extend({offset:r},s),u)}panTo(r,s,u){return this.easeTo(o.extend({center:r},s),u)}getZoom(){return this.transform.zoom}setZoom(r,s){return this.jumpTo({zoom:r},s),this}zoomTo(r,s,u){return this.easeTo(o.extend({zoom:r},s),u)}zoomIn(r,s){return this.zoomTo(this.getZoom()+1,r,s),this}zoomOut(r,s){return this.zoomTo(this.getZoom()-1,r,s),this}getBearing(){return this.transform.bearing}setBearing(r,s){return this.jumpTo({bearing:r},s),this}getPadding(){return this.transform.padding}setPadding(r,s){return this.jumpTo({padding:r},s),this}rotateTo(r,s,u){return this.easeTo(o.extend({bearing:r},s),u)}resetNorth(r,s){return this.rotateTo(0,o.extend({duration:1e3},r),s),this}resetNorthPitch(r,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},r),s),this}snapToNorth(r,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,s):this}getPitch(){return this.transform.pitch}setPitch(r,s){return this.jumpTo({pitch:r},s),this}cameraForBounds(r,s){r=o.LngLatBounds.convert(r);const u=s&&s.bearing||0,p=s&&s.pitch||0,f=r.getNorthWest(),g=r.getSouthEast();return this._cameraForBounds(this.transform,f,g,u,p,s)}_extendCameraOptions(r){const s={top:0,bottom:0,right:0,left:0};if(typeof(r=o.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const u=r.padding;r.padding={top:u,bottom:u,right:u,left:u}}return r.padding=o.extend(s,r.padding),r}_minimumAABBFrustumDistance(r,s){const u=s.max[0]-s.min[0],p=s.max[1]-s.min[1];return u/p>r.aspect?u/(2*Math.tan(.5*r.fovX)*r.aspect):p/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,s,u,p,f,g){const v=r.clone(),w=this._extendCameraOptions(g);v.bearing=p,v.pitch=f;const A=o.LngLat.convert(s),I=o.LngLat.convert(u),P=.5*(A.lat+I.lat),R=.5*(A.lng+I.lng),N=o.latLngToECEF(P,R),j=o.normalize([],N),V=o.normalize([],o.cross([],j,[0,1,0])),F=o.cross([],V,j),U=[V[0],V[1],V[2],0,F[0],F[1],F[2],0,j[0],j[1],j[2],0,0,0,0,1],X=[N,o.latLngToECEF(A.lat,A.lng),o.latLngToECEF(I.lat,A.lng),o.latLngToECEF(I.lat,I.lng),o.latLngToECEF(A.lat,I.lng),o.latLngToECEF(P,A.lng),o.latLngToECEF(P,I.lng),o.latLngToECEF(A.lat,R),o.latLngToECEF(I.lat,R)];let G=o.Aabb.fromPoints(X.map(he=>[o.dot(V,he),o.dot(F,he),o.dot(j,he)]));const Y=o.transformMat4([],G.center,U);o.squaredLength(Y)===0&&o.set(Y,0,0,1),o.normalize(Y,Y),o.scale$2(Y,Y,o.GLOBE_RADIUS),v.center=o.ecefToLatLng(Y);const oe=v.getWorldToCameraMatrix(),ie=o.invert(new Float64Array(16),oe);G=o.Aabb.applyTransform(G,o.multiply([],oe,U)),o.transformMat4(Y,Y,oe);const ce=.5*(G.max[2]-G.min[2]),xe=this._minimumAABBFrustumDistance(v,G),_e=o.scale$2([],[0,0,1],ce),ue=o.add(_e,Y,_e),Ue=xe+(v.pitch===0?0:o.distance(Y,ue)),fe=v.globeCenterInViewSpace,Ae=o.sub([],Y,[fe[0],fe[1],fe[2]]);o.normalize(Ae,Ae),o.scale$2(Ae,Ae,Ue);const be=o.add([],Y,Ae);o.transformMat4(be,be,ie);const Re=o.earthRadius/o.GLOBE_RADIUS,Ee=o.length(be),Pe=o.mercatorZfromAltitude(Ee*Re-o.earthRadius,0),je=Math.min(v.zoomFromMercatorZAdjusted(Pe),w.maxZoom);return je>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(v.setProjection({name:"mercator"}),v.zoom=je,this._cameraForBounds(v,s,u,p,f,g)):{center:v.center,zoom:je,bearing:p,pitch:f}}queryTerrainElevation(r,s){const u=this.transform.elevation;return u?(s=o.extend({},{exaggerated:!0},s),u.getAtPoint(o.MercatorCoordinate.fromLngLat(r),null,s.exaggerated)):null}_cameraForBounds(r,s,u,p,f,g){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,s,u,p,f,g);const v=r.clone(),w=this._extendCameraOptions(g),A=v.padding;v.bearing=p,v.pitch=f;const I=o.LngLat.convert(s),P=o.LngLat.convert(u),R=new o.LngLat(I.lng,P.lat),N=new o.LngLat(P.lng,I.lat),j=v.project(I),V=v.project(P),F=this.queryTerrainElevation(I),U=this.queryTerrainElevation(P),X=this.queryTerrainElevation(R),G=this.queryTerrainElevation(N),Y=[[j.x,j.y,Math.min(F||0,U||0,X||0,G||0)],[V.x,V.y,Math.max(F||0,U||0,X||0,G||0)]];let oe=o.Aabb.fromPoints(Y);const ie=v.getWorldToCameraMatrix(),ce=o.invert(new Float64Array(16),ie);oe=o.Aabb.applyTransform(oe,ie);const xe=o.sub([],oe.max,oe.min),_e=A.left||0,ue=A.right||0,Ue=A.bottom||0,fe=A.top||0,{left:Ae,right:be,top:Re,bottom:Ee}=w.padding,Pe=.5*(_e+ue),je=.5*(fe+Ue),he=Math.min(v.scaleZoom(v.scale*Math.min((v.width-(_e+ue+Ae+be))/xe[0],(v.height-(Ue+fe+Ee+Re))/xe[1])),w.maxZoom),ve=v.scale/v.zoomScale(he);oe=new o.Aabb([oe.min[0]-(Ae+Pe)*ve,oe.min[1]-(Ee+je)*ve,oe.min[2]],[oe.max[0]+(be+Pe)*ve,oe.max[1]+(Re+je)*ve,oe.max[2]]);const nt=.5*xe[2],ut=this._minimumAABBFrustumDistance(v,oe),ot=[0,0,1,0];o.transformMat4$1(ot,ot,ie),o.normalize$2(ot,ot);const xt=o.scale$2([],ot,ut+nt),At=o.add([],oe.center,xt),ht=(typeof w.offset.x=="number"&&typeof w.offset.y=="number"?new o.pointGeometry(w.offset.x,w.offset.y):o.pointGeometry.convert(w.offset)).rotate(-o.degToRad(p));oe.center[0]-=ht.x*ve,oe.center[1]+=ht.y*ve,o.transformMat4(oe.center,oe.center,ce),o.transformMat4(At,At,ce);const et=[oe.center[0],oe.center[1],At[2]*v.pixelsPerMeter];o.scale$2(et,et,1/v.worldSize);const ni=o.lngFromMercatorX(et[0]),Yt=o.latFromMercatorY(et[1]),pi=Math.min(v._zoomFromMercatorZ(et[2]),w.maxZoom),li=new o.LngLat(ni,Yt);return v.mercatorFromTransition&&pi<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(v.setProjection({name:"globe"}),v.zoom=pi,this._cameraForBounds(v,s,u,p,f,g)):{center:li,zoom:pi,bearing:p,pitch:f}}fitBounds(r,s,u){const p=this.cameraForBounds(r,s);return this._fitInternal(p,s,u)}fitScreenCoordinates(r,s,u,p,f){const g=o.pointGeometry.convert(r),v=o.pointGeometry.convert(s),w=new o.pointGeometry(Math.min(g.x,v.x),Math.min(g.y,v.y)),A=new o.pointGeometry(Math.max(g.x,v.x),Math.max(g.y,v.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(g,v))return this;const I=this.transform.pointLocation3D(w),P=this.transform.pointLocation3D(A),R=this.transform.pointLocation3D(new o.pointGeometry(w.x,A.y)),N=this.transform.pointLocation3D(new o.pointGeometry(A.x,w.y)),j=[Math.min(I.lng,P.lng,R.lng,N.lng),Math.min(I.lat,P.lat,R.lat,N.lat)],V=[Math.max(I.lng,P.lng,R.lng,N.lng),Math.max(I.lat,P.lat,R.lat,N.lat)],F=p&&p.pitch?p.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,j,V,u,F,p);return this._fitInternal(U,p,f)}_fitInternal(r,s,u){return r?(delete(s=o.extend(r,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(r,s){this.stop();const u=r.preloadOnly?this.transform.clone():this.transform;let p=!1,f=!1,g=!1;return"zoom"in r&&u.zoom!==+r.zoom&&(p=!0,u.zoom=+r.zoom),r.center!==void 0&&(u.center=o.LngLat.convert(r.center)),"bearing"in r&&u.bearing!==+r.bearing&&(f=!0,u.bearing=+r.bearing),"pitch"in r&&u.pitch!==+r.pitch&&(g=!0,u.pitch=+r.pitch),r.padding==null||u.isPaddingEqual(r.padding)||(u.padding=r.padding),r.preloadOnly?(this._preloadTiles(u),this):(this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),p&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),f&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),g&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Fl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,s){const u=this.transform;if(!u.projection.supportsFreeCamera)return o.warnOnce(Fl),this;this.stop();const p=u.zoom,f=u.pitch,g=u.bearing;u.setFreeCameraOptions(r);const v=p!==u.zoom,w=f!==u.pitch,A=g!==u.bearing;return this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),v&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),A&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),w&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)),this}easeTo(r,s){this._stop(!1,r.easeId),((r=o.extend({offset:[0,0],duration:500,easing:o.ease},r)).animate===!1||!r.essential&&o.exported.prefersReducedMotion)&&(r.duration=0);const u=this.transform,p=this.getZoom(),f=this.getBearing(),g=this.getPitch(),v=this.getPadding(),w="zoom"in r?+r.zoom:p,A="bearing"in r?this._normalizeBearing(r.bearing,f):f,I="pitch"in r?+r.pitch:g,P="padding"in r?r.padding:u.padding,R=o.pointGeometry.convert(r.offset);let N,j,V;if(u.projection.name==="globe"){const _e=o.MercatorCoordinate.fromLngLat(u.center),ue=R.rotate(-u.angle);_e.x+=ue.x/u.worldSize,_e.y+=ue.y/u.worldSize;const Ue=_e.toLngLat(),fe=o.LngLat.convert(r.center||Ue);this._normalizeCenter(fe),N=u.centerPoint.add(ue),j=new o.pointGeometry(_e.x,_e.y).mult(u.worldSize),V=new o.pointGeometry(o.mercatorXfromLng(fe.lng),o.mercatorYfromLat(fe.lat)).mult(u.worldSize).sub(j)}else{N=u.centerPoint.add(R);const _e=u.pointLocation(N),ue=o.LngLat.convert(r.center||_e);this._normalizeCenter(ue),j=u.project(_e),V=u.project(ue).sub(j)}const F=u.zoomScale(w-p);let U,X;r.around&&(U=o.LngLat.convert(r.around),X=u.locationPoint(U));const G=this._zooming||w!==p,Y=this._rotating||f!==A,oe=this._pitching||I!==g,ie=!u.isPaddingEqual(P),ce=_e=>ue=>{if(G&&(_e.zoom=o.number(p,w,ue)),Y&&(_e.bearing=o.number(f,A,ue)),oe&&(_e.pitch=o.number(g,I,ue)),ie&&(_e.interpolatePadding(v,P,ue),N=_e.centerPoint.add(R)),U)_e.setLocationAtPoint(U,X);else{const Ue=_e.zoomScale(_e.zoom-p),fe=w>p?Math.min(2,F):Math.max(.5,F),Ae=Math.pow(fe,1-ue),be=_e.unproject(j.add(V.mult(ue*Ae)).mult(Ue));_e.setLocationAtPoint(_e.renderWorldCopies?be.wrap():be,N)}return r.preloadOnly||this._fireMoveEvents(s),_e};if(r.preloadOnly){const _e=this._emulate(ce,r.duration,u);return this._preloadTiles(_e),this}const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=G,this._rotating=Y,this._pitching=oe,this._padding=ie,this._easeId=r.easeId,this._prepareEase(s,r.noMoveStart,xe),this._ease(ce(u),_e=>{u.recenterOnTerrain(),this._afterEase(s,_e)},r),this}_prepareEase(r,s,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||u.moving||this.fire(new o.Event("movestart",r)),this._zooming&&!u.zooming&&this.fire(new o.Event("zoomstart",r)),this._rotating&&!u.rotating&&this.fire(new o.Event("rotatestart",r)),this._pitching&&!u.pitching&&this.fire(new o.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.Event("move",r)),this._zooming&&this.fire(new o.Event("zoom",r)),this._rotating&&this.fire(new o.Event("rotate",r)),this._pitching&&this.fire(new o.Event("pitch",r))}_afterEase(r,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new o.Event("zoomend",r)),p&&this.fire(new o.Event("rotateend",r)),f&&this.fire(new o.Event("pitchend",r)),this.fire(new o.Event("moveend",r))}flyTo(r,s){if(!r.essential&&o.exported.prefersReducedMotion){const he=o.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(he,s)}this.stop(),r=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},r);const u=this.transform,p=this.getZoom(),f=this.getBearing(),g=this.getPitch(),v=this.getPadding(),w="zoom"in r?o.clamp(+r.zoom,u.minZoom,u.maxZoom):p,A="bearing"in r?this._normalizeBearing(r.bearing,f):f,I="pitch"in r?+r.pitch:g,P="padding"in r?r.padding:u.padding,R=u.zoomScale(w-p),N=o.pointGeometry.convert(r.offset);let j=u.centerPoint.add(N);const V=u.pointLocation(j),F=o.LngLat.convert(r.center||V);this._normalizeCenter(F);const U=u.project(V),X=u.project(F).sub(U);let G=r.curve;const Y=Math.max(u.width,u.height),oe=Y/R,ie=X.mag();if("minZoom"in r){const he=o.clamp(Math.min(r.minZoom,p,w),u.minZoom,u.maxZoom),ve=Y/u.zoomScale(he-p);G=Math.sqrt(ve/ie*2)}const ce=G*G;function xe(he){const ve=(oe*oe-Y*Y+(he?-1:1)*ce*ce*ie*ie)/(2*(he?oe:Y)*ce*ie);return Math.log(Math.sqrt(ve*ve+1)-ve)}function _e(he){return(Math.exp(he)-Math.exp(-he))/2}function ue(he){return(Math.exp(he)+Math.exp(-he))/2}const Ue=xe(0);let fe=function(he){return ue(Ue)/ue(Ue+G*he)},Ae=function(he){return Y*((ue(Ue)*(_e(ve=Ue+G*he)/ue(ve))-_e(Ue))/ce)/ie;var ve},be=(xe(1)-Ue)/G;if(Math.abs(ie)<1e-6||!isFinite(be)){if(Math.abs(Y-oe)<1e-6)return this.easeTo(r,s);const he=oe<Y?-1:1;be=Math.abs(Math.log(oe/Y))/G,Ae=function(){return 0},fe=function(ve){return Math.exp(he*G*ve)}}r.duration="duration"in r?+r.duration:1e3*be/("screenSpeed"in r?+r.screenSpeed/G:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Re=f!==A,Ee=I!==g,Pe=!u.isPaddingEqual(P),je=he=>ve=>{const nt=ve*be,ut=1/fe(nt);he.zoom=ve===1?w:p+he.scaleZoom(ut),Re&&(he.bearing=o.number(f,A,ve)),Ee&&(he.pitch=o.number(g,I,ve)),Pe&&(he.interpolatePadding(v,P,ve),j=he.centerPoint.add(N));const ot=ve===1?F:he.unproject(U.add(X.mult(Ae(nt))).mult(ut));return he.setLocationAtPoint(he.renderWorldCopies?ot.wrap():ot,j),he._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(s),he};if(r.preloadOnly){const he=this._emulate(je,r.duration,u);return this._preloadTiles(he),this}return this._zooming=!0,this._rotating=Re,this._pitching=Ee,this._padding=Pe,this._prepareEase(s,!1),this._ease(je(u),()=>this._afterEase(s),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,s)}if(!r){const u=this.handlers;u&&u.stop(!1)}return this}_ease(r,s,u){u.animate===!1||u.duration===0?(r(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=u,this._onEaseFrame=r,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,s){r=o.wrap(r,-180,180);const u=Math.abs(r-s);return Math.abs(r-360-s)<u&&(r-=360),Math.abs(r+360-s)<u&&(r+=360),r}_normalizeCenter(r){const s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;const u=r.lng-s.center.lng;r.lng+=u>180?-360:u<-180?360:0}_emulate(r,s,u){const p=Math.ceil(15*s/1e3),f=[],g=r(u.clone());for(let v=0;v<=p;v++){const w=g(v/p);f.push(w.clone())}return f}}class Ul{constructor(r={}){this.options=r,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const s=this.options&&this.options.compact;return this._map=r,this._container=We("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=We("button","mapboxgl-ctrl-attrib-button",this._container),We("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=We("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,s){const u=this._map._getUIString(`AttributionControl.${s}`);r.setAttribute("aria-label",u),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",u)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(r){const u=s.reduce((p,f,g)=>(f.value&&(p+=`${f.key}=${f.value}${g<s.length-1?"&":""}`),p),"?");r.href=`${o.config.FEEDBACK_URL}/${u}#${zr(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style._sourceCaches;for(const p in s){const f=s[p];if(f.used){const g=f.getSource();g.attribution&&r.indexOf(g.attribution)<0&&r.push(g.attribution)}}r.sort((p,f)=>p.length-f.length),r=r.filter((p,f)=>{for(let g=f+1;g<r.length;g++)if(r[g].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const u=r.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,r.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class jl{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=We("div","mapboxgl-ctrl");const s=We("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const s in r){const u=r[s].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const s=r[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Nl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const s=++this._id;return this._queue.push({callback:r,id:s,cancelled:!1}),s}remove(r){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const p of u)if(p.id===r)return void(p.cancelled=!0)}run(r=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Vl(l,r,s){if(l=new o.LngLat(l.lng,l.lat),r){const u=new o.LngLat(l.lng-360,l.lat),p=new o.LngLat(l.lng+360,l.lat),f=360*Math.ceil(Math.abs(l.lng-s.center.lng)/360),g=s.locationPoint(l).distSqr(r),v=r.x<0||r.y<0||r.x>s.width||r.y>s.height;s.locationPoint(u).distSqr(r)<g&&(v||Math.abs(u.lng-s.center.lng)<f)?l=u:s.locationPoint(p).distSqr(r)<g&&(v||Math.abs(p.lng-s.center.lng)<f)&&(l=p)}for(;Math.abs(l.lng-s.center.lng)>180;){const u=s.locationPoint(l);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;l.lng>s.center.lng?l.lng-=360:l.lng+=360}return l}const Fo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class zs extends o.Evented{constructor(r,s){if(super(),(r instanceof o.window.HTMLElement||s)&&(r=o.extend({element:r},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=o.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=We("div");const p=41,f=27,g=Ve("svg",{display:"block",height:p*this._scale+"px",width:f*this._scale+"px",viewBox:`0 0 ${f} ${p}`},this._element),v=Ve("radialGradient",{id:"shadowGradient"},Ve("defs",{},g));Ve("stop",{offset:"10%","stop-opacity":.4},v),Ve("stop",{offset:"100%","stop-opacity":.05},v),Ve("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},g),Ve("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},g),Ve("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},g),Ve("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},g),this._offset=o.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()});const u=this._element.classList;for(const p in Fo)u.remove(`mapboxgl-marker-anchor-${p}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const s=r.code,u=r.charCode||r.keyCode;s!=="Space"&&s!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(r){const s=r.originalEvent.target,u=this._element;this._popup&&(s===u||u.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,s=this._pos;if(!r||!s)return!1;const u=r.unproject(s),p=r.getFreeCameraOptions();if(!p.position)return!1;const f=p.position.toLngLat();return f.distanceTo(u)<.9*f.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const s=this._pos;if(!s||s.x<0||s.x>r.transform.width||s.y<0||s.y>r.transform.height)return void this._clearFadeTimer();const u=r.unproject(s);let p;r._showingGlobe()&&o.isLngLatBehindGlobe(r.transform,this._lngLat)?p=0:(p=1-r._queryFogOpacity(u),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Fo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const r=this._pos,s=this._map,u=this.getPitchAlignment();if(!s||!r||u!=="map")return"";if(!s._showingGlobe()){const w=s.getPitch();return w?`rotateX(${w}deg)`:""}const p=o.radToDeg(o.globeTiltAtLngLat(s.transform,this._lngLat)),f=r.sub(o.globeCenterToScreenPoint(s.transform)),g=Math.abs(f.x)+Math.abs(f.y);if(g===0)return"";const v=p/g;return`rotateX(${-f.y*v}deg) rotateY(${f.x*v}deg)`}_calculateZTransform(){const r=this._pos,s=this._map;if(!s||!r)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(s._showingGlobe()){const f=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),g=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(f);u=o.radToDeg(Math.atan2(g.y,g.x))-90}else u=-s.getBearing();else if(p==="horizon"){const f=o.smoothstep(4,6,s.getZoom()),g=o.globeCenterToScreenPoint(s.transform);g.y+=f*s.transform.height;const v=r.sub(g),w=o.radToDeg(Math.atan2(v.y,v.x));u=(w>90?w-270:w+90)*(1-f)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(r){o.window.cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=Vl(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),r===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.pointGeometry.convert(r),this._update(),this}_onMove(r){const s=this._map;if(!s)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const f=this._clickTolerance||s._clickTolerance;if(r.point.dist(u)<f)return;this._isDragging=!0}this._pos=r.point.sub(p),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(r){const s=this._map,u=this._pos;s&&u&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(u),this._pointerdownPos=r.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const s=this._map;return s&&(r?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const za={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},wu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Gl(l=new o.pointGeometry(0,0),r="bottom"){if(typeof l=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(r){case"top":return new o.pointGeometry(0,l);case"top-left":return new o.pointGeometry(s,s);case"top-right":return new o.pointGeometry(-s,s);case"bottom":return new o.pointGeometry(0,-l);case"bottom-left":return new o.pointGeometry(s,-s);case"bottom-right":return new o.pointGeometry(-s,-s);case"left":return new o.pointGeometry(l,0);case"right":return new o.pointGeometry(-l,0)}return new o.pointGeometry(0,0)}return l instanceof o.pointGeometry||Array.isArray(l)?o.pointGeometry.convert(l):o.pointGeometry.convert(l[r]||[0,0])}class Tu{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const s=o.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,s,u){this._start=this.getValue(s),this._end=r,this._startTime=s,this._endTime=s+u}}const Eu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Su={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Iu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Au{constructor(r,s,u=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Ll({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,u&&(this.mousePitch=new Rl({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(r,s){this.mouseRotate.mousedown(r,s),this.mousePitch&&this.mousePitch.mousedown(r,s),rt()}move(r,s){const u=this.map,p=this.mouseRotate.mousemoveWindow(r,s),f=p&&p.bearingDelta;if(f&&u.setBearing(u.getBearing()+f),this.mousePitch){const g=this.mousePitch.mousemoveWindow(r,s),v=g&&g.pitchDelta;v&&u.setPitch(u.getPitch()+v)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ne(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Se(this.element,r)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Se(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=dt(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=dt(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const $l={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Mu={maxWidth:100,unit:"metric"};function Cu(l,r,s){const u=ql(r),p=u/r,f={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[s];this._map._requestDomTask(()=>{this._container.style.width=l*p+"px",this._container.innerHTML=`${u}&nbsp;${f}`})}function ql(l){const r=Math.pow(10,`${Math.floor(l)}`.length-1);let s=l/r;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:s>=1?1:function(u){const p=Math.pow(10,Math.ceil(-Math.log(u)/Math.LN10));return Math.round(u*p)/p}(s),r*s}const Ps={version:o.version,supported:Ce,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends bu{constructor(l){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(l=o.extend({},Su,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(l.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Po(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._optimizeForTerrain=l.optimizeForTerrain,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new Nl,this._domRenderTaskQueue=new Nl,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Eu,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Tu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,typeof l.container=="string"){if(this._container=o.window.document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new ks(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this._hash=l.hash&&new Qe(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,o.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),l.attributionControl&&this.addControl(new Ul({customAttribution:l.customAttribution})),this._logoControl=new jl,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(l,r){if(r===void 0&&(r=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=l.onAdd(this);this._controls.push(l);const u=this._controlPositions[r];return r.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(l);return r>-1&&this._controls.splice(r,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),this.fire(new o.Event("resize",l)),r&&this.fire(new o.Event("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(o.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?o.window.navigator.language:Array.isArray(l)?l.length===0?void 0:l.map(r=>r==="auto"?o.window.navigator.language:r):l}setLanguage(l){const r=this._parseLanguage(l);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,r=l.projection.name;let s;r==="globe"&&l.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(l.setMercatorFromTransition(),s=!0):r==="mercator"&&l.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(l.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,r){return this._updateProjection(l||r||{name:"mercator"})}_updateProjection(l){let r;if(r=l.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const s in this.style._sourceCaches)this.style._sourceCaches[s].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(l){return this.transform.locationPoint3D(o.LngLat.convert(l))}unproject(l){return this.transform.pointLocation3D(o.pointGeometry.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,r,s){if(l==="mouseenter"||l==="mouseover"){let u=!1;const p=g=>{const v=r.filter(A=>this.getLayer(A)),w=v.length?this.queryRenderedFeatures(g.point,{layers:v}):[];w.length?u||(u=!0,s.call(this,new _r(l,this,g.originalEvent,{features:w}))):u=!1},f=()=>{u=!1};return{layers:new Set(r),listener:s,delegates:{mousemove:p,mouseout:f}}}if(l==="mouseleave"||l==="mouseout"){let u=!1;const p=g=>{const v=r.filter(w=>this.getLayer(w));(v.length?this.queryRenderedFeatures(g.point,{layers:v}):[]).length?u=!0:u&&(u=!1,s.call(this,new _r(l,this,g.originalEvent)))},f=g=>{u&&(u=!1,s.call(this,new _r(l,this,g.originalEvent)))};return{layers:new Set(r),listener:s,delegates:{mousemove:p,mouseout:f}}}{const u=p=>{const f=r.filter(v=>this.getLayer(v)),g=f.length?this.queryRenderedFeatures(p.point,{layers:f}):[];g.length&&(p.features=g,s.call(this,p),delete p.features)};return{layers:new Set(r),listener:s,delegates:{[l]:u}}}}on(l,r,s){if(s===void 0)return super.on(l,r);Array.isArray(r)||(r=[r]);const u=this._createDelegatedListener(l,r,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(l,r,s){if(s===void 0)return super.once(l,r);Array.isArray(r)||(r=[r]);const u=this._createDelegatedListener(l,r,s);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(l,r,s){if(s===void 0)return super.off(l,r);r=new Set(Array.isArray(r)?r:[r]);const u=(f,g)=>{if(f.size!==g.size)return!1;for(const v of f)if(!g.has(v))return!1;return!0},p=this._delegatedListeners?this._delegatedListeners[l]:void 0;return p&&(f=>{for(let g=0;g<f.length;g++){const v=f[g];if(v.listener===s&&u(v.layers,r)){for(const w in v.delegates)this.off(w,v.delegates[w]);return f.splice(g,1),this}}})(p),this}queryRenderedFeatures(l,r){return this.style?(r!==void 0||l===void 0||l instanceof o.pointGeometry||Array.isArray(l)||(r=l,l=void 0),this.style.queryRenderedFeatures(l=l||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(l,r){return this.style.querySourceFeatures(l,r)}setStyle(l,r){return(r=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&l?(this._diffStyle(l,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(l,r))}_getUIString(l){const r=this._locale[l];if(r==null)throw new Error(`Missing UI string '${l}'`);return r}_updateStyle(l,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l&&(this.style=new Ki(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof l=="string"?this.style.loadURL(l):this.style.loadJSON(l)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ki(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,r){if(typeof l=="string"){const s=this._requestManager.normalizeStyleURL(l),u=this._requestManager.transformRequest(s,o.ResourceType.Style);o.getJSON(u,(p,f)=>{p?this.fire(new o.ErrorEvent(p)):f&&this._updateDiff(f,r)})}else typeof l=="object"&&this._updateDiff(l,r)}_updateDiff(l,r){try{this.style.setState(l)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(l,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(l,r){return this._lazyInitEmptyStyle(),this.style.addSource(l,r),this._update(!0)}isSourceLoaded(l){return!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){const l=this.style&&this.style._sourceCaches;for(const r in l){const s=l[r]._tiles;for(const u in s){const p=s[u];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(l,r,s){this._lazyInitEmptyStyle(),this.style.addSourceType(l,r,s)}removeSource(l){return this.style.removeSource(l),this._updateTerrain(),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,r,{pixelRatio:s=1,sdf:u=!1,stretchX:p,stretchY:f,content:g}={}){if(this._lazyInitEmptyStyle(),r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap){const{width:v,height:w,data:A}=o.exported.getImageData(r);this.style.addImage(l,{data:new o.RGBAImage({width:v,height:w},A),pixelRatio:s,stretchX:p,stretchY:f,content:g,sdf:u,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:v,height:w}=r,A=r;this.style.addImage(l,{data:new o.RGBAImage({width:v,height:w},new Uint8Array(A.data)),pixelRatio:s,stretchX:p,stretchY:f,content:g,sdf:u,version:0,userImage:A}),A.onAdd&&A.onAdd(this,l)}}updateImage(l,r){const s=this.style.getImage(l);if(!s)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap?o.exported.getImageData(r):r,{width:p,height:f}=u;p!==void 0&&f!==void 0?p===s.data.width&&f===s.data.height?(s.data.replace(u.data,!(r instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&r instanceof o.window.ImageBitmap)),this.style.updateImage(l,s)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${p}, ${f})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,r){o.getImage(this._requestManager.transformRequest(l,o.ResourceType.Image),(s,u)=>{r(s,u instanceof o.window.HTMLImageElement?o.exported.getImageData(u):u)})}listImages(){return this.style.listImages()}addLayer(l,r){return this._lazyInitEmptyStyle(),this.style.addLayer(l,r),this._update(!0)}moveLayer(l,r){return this.style.moveLayer(l,r),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,r,s){return this.style.setLayerZoomRange(l,r,s),this._update(!0)}setFilter(l,r,s={}){return this.style.setFilter(l,r,s),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,r,s,u={}){return this.style.setPaintProperty(l,r,s,u),this._update(!0)}getPaintProperty(l,r){return this.style.getPaintProperty(l,r)}setLayoutProperty(l,r,s,u={}){return this.style.setLayoutProperty(l,r,s,u),this._update(!0)}getLayoutProperty(l,r){return this.style.getLayoutProperty(l,r)}setLight(l,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(l),this.transform):0}setFeatureState(l,r){return this.style.setFeatureState(l,r),this._update()}removeFeatureState(l,r){return this.style.removeFeatureState(l,r),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let s,u,p,f=this._container;for(;f&&(!u||!p);){const g=o.window.getComputedStyle(f).transform;g&&g!=="none"&&(s=g.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(u=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(p=s[3])),f=f.parentElement}this._containerWidth=u?Math.abs(l/u):l,this._containerHeight=p?Math.abs(r/p):r}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=We("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=We("div","mapboxgl-canvas-container",l);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=We("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=We("div","mapboxgl-control-container",l),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(p=>{u[p]=We("div",`mapboxgl-ctrl-${p}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,r){const s=o.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(l),this._canvas.height=s*Math.ceil(r),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${r}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const r=this._markers.indexOf(l);r!==-1&&this._markers.splice(r,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const r=this._popups.indexOf(l);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const l=o.extend({},Ce.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);r?(o.storeAuthState(r,!0),this.painter=new $h(r,this.transform),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(r)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let r;const s=this.painter.context.extTimerQuery,u=o.exported.now();if(this.listens("gpu-timing-frame")&&(r=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const p=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,w=this.transform.pitch,A=o.exported.now(),I=new o.EvaluationParameters(v,{now:A,fadeDuration:p,pitch:w,transition:this.style.getTransition()});this.style.update(I)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let f=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),f=this._updateAverageElevation(u),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):f=this._updateAverageElevation(u),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,p,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:p,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const v=o.exported.now()-u;s.endQueryEXT(s.TIME_ELAPSED_EXT,r),setTimeout(()=>{const w=s.getQueryObjectEXT(r,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(r),this.fire(new o.Event("gpu-timing-frame",{cpuTime:v,gpuTime:w})),o.window.performance.mark("frame-gpu",{startTime:u,detail:{gpuTime:w}})},50)}if(this.listens("gpu-timing-layer")){const v=this.painter.collectGpuTimers();setTimeout(()=>{const w=this.painter.queryGpuTimers(v);this.fire(new o.Event("gpu-timing-layer",{layerTimes:w}))},50)}if(this.listens("gpu-timing-deferred-render")){const v=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const w=this.painter.queryGpuTimeDeferredRender(v);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:w}))},50)}const g=this._sourcesDirty||this._styleDirty||this._placementDirty||f;if(g||this._repaint)this.triggerRepaint();else{const v=!this.isMoving()&&this.loaded();if(v&&(f=this._updateAverageElevation(u,!0)),f)this.triggerRepaint();else if(this._triggerFrame(!1),v&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const w=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:w})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const r of this._markers)l&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!l||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(l,r=!1){const s=u=>(this.transform.averageElevation=u,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((r||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const u=this.transform.averageElevation;let p=this.transform.sampleAverageElevation(),f=!1;this.transform.elevation&&(f=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(p)?p=0:this._averageElevationLastSampledAt=l;const g=Math.abs(u-p);if(g>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(p),s(p);this._averageElevation.easeTo(p,l,300)}else if(g>1e-4)return this._averageElevation.jumpTo(p),s(p)}return!!this._averageElevation.isEasing(l)&&s(this._averageElevation.getValue(l))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===o.AUTH_ERR_MSG||l.status===401)){const r=this.painter.context.gl;o.storeAuthState(r,!1),this._logoControl instanceof jl&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const s=this.painter.context.gl,u=s.createFramebuffer();function p(f){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,f,0);const g=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,g),g}return s.bindFramebuffer(s.FRAMEBUFFER,u),this._canvasPixelComparison(p(l),r.canvasCopies.map(p),r.timeStamps)}_canvasPixelComparison(l,r,s){let u=s[1]-s[0];const p=l.length/4;for(let f=0;f<r.length;f++){const g=r[f];let v=0;for(let w=0;w<g.length;w+=4)g[w]===l[w]&&g[w+1]===l[w+1]&&g[w+2]===l[w+2]&&g[w+3]===l[w+3]&&(v+=1);u+=(s[f+2]-s[f+1])*(1-v/p)}return u}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=o.exported.frame(r=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(r)}))}_preloadTiles(l){const r=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(r,(s,u)=>s._preloadTiles(l,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,l&&this._update())}_setCacheLimits(l,r){o.setCacheLimits(l,r)}get version(){return o.version}},NavigationControl:class{constructor(l){this.options=o.extend({},Iu,l),this._container=We("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),We("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),We("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:r}):s.resetNorth({},{originalEvent:r}))}),this._compassIcon=We("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const r=l.getZoom(),s=r===l.getMaxZoom(),u=r===l.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Au(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,r){const s=We("button",l,this._container);return s.type="button",s.addEventListener("click",r),s}_setButtonTitle(l,r){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${r}`);l.setAttribute("aria-label",s),l.firstElementChild&&l.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.Evented{constructor(l){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},$l,l),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Is(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=We("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const r=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,l(s)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(s=>r(s.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(l){const r=this._map.getMaxBounds(),s=l.coords;return!!r&&(s.longitude<r.getWest()||s.longitude>r.getEast()||s.latitude<r.getSouth()||s.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",l)),this._finish()}}_updateCamera(l){const r=new o.LngLat(l.coords.longitude,l.coords.latitude),s=l.coords.accuracy,u=this._map.getBearing(),p=o.extend({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(s),p,{geolocateSource:!0})}_updateMarker(l){if(l){const r=new o.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,r=o.mercatorZfromAltitude(1,l._center.lat)*l.worldSize,s=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=We("button","mapboxgl-ctrl-geolocate",this._container),We("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=We("div","mapboxgl-user-location"),this._dotElement.appendChild(We("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(We("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new zs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=We("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ul,ScaleControl:class{constructor(l){this.options=o.extend({},Mu,l),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Cu.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,r=this._map,s=r._containerHeight/2,u=r._containerWidth/2-l/2,p=r.unproject([u,s]),f=r.unproject([u+l,s]),g=p.distanceTo(f);if(this.options.unit==="imperial"){const v=3.2808*g;v>5280?this._setScale(l,v/5280,"mile"):this._setScale(l,v,"foot")}else this.options.unit==="nautical"?this._setScale(l,g/1852,"nautical-mile"):g>=1e3?this._setScale(l,g/1e3,"kilometer"):this._setScale(l,g,"meter")}_setScale(l,r,s){const u=ql(r),p=u/r;this._map._requestDomTask(()=>{this._container.style.width=l*p+"px",this._container.innerHTML=s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:s}).format(u):`${u}&nbsp;nm`})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=We("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof o.window.HTMLElement?this._container=l.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=We("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=We("button","mapboxgl-ctrl-fullscreen",this._controlContainer);We("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(l){super(),this.options=o.extend(Object.create(za),l),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=o.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(o.window.document.createTextNode(l))}setHTML(l){const r=o.window.document.createDocumentFragment(),s=o.window.document.createElement("body");let u;for(s.innerHTML=l;u=s.firstChild,u;)r.appendChild(u);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=We("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(l),this.options.closeButton){const s=this._closeButton=We("button","mapboxgl-popup-close-button",r);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let r;return this._classList.delete(l)?r=!1:(this._classList.add(l),r=!0),this._updateClassList(),r}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const r=this._map,s=this._container,u=this._pos;if(!r||!s||!u)return"bottom";const p=s.offsetWidth,f=s.offsetHeight,g=u.x<p/2,v=u.x>r.transform.width-p/2;if(u.y+l<f)return g?"top-left":v?"top-right":"top";if(u.y>r.transform.height-f){if(g)return"bottom-left";if(v)return"bottom-right"}return g?"left":v?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),l.className=r.join(" ")}_update(l){const r=this._map,s=this._content;if(!r||!this._lngLat&&!this._trackPointer||!s)return;let u=this._container;if(u||(u=this._container=We("div","mapboxgl-popup",r.getContainer()),this._tip=We("div","mapboxgl-popup-tip",u),u.appendChild(s)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vl(this._lngLat,this._pos,r.transform)),!this._trackPointer||l){const p=this._pos=this._trackPointer&&l?l:r.project(this._lngLat),f=Gl(this.options.offset),g=this._anchor=this._getAnchor(f.y),v=Gl(this.options.offset,g),w=p.add(v).round();r._requestDomTask(()=>{this._container&&g&&(this._container.style.transform=`${Fo[g]} translate(${w.x}px,${w.y}px)`)})}if(!this._marker&&r._showingGlobe()){const p=o.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(wu);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:zs,Style:Ki,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:kl,Evented:o.Evented,config:o.config,prewarm:function(){wt().acquire(mt)},clearPrewarmedResources:function(){const l=lt;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(mt),lt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(l){o.config.ACCESS_TOKEN=l},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(l){o.config.API_URL=l},get workerCount(){return pt.workerCount},set workerCount(l){pt.workerCount=l},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){o.clearTileCache(l)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Ps});var ae=O;return ae})})(S0);const xd=pd;var ed=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},dd={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(E,y){(function(x){var k=y&&!y.nodeType&&y,O=E&&!E.nodeType&&E,Q=typeof ed=="object"&&ed;(Q.global===Q||Q.window===Q||Q.self===Q)&&(x=Q);var ae,o=2147483647,re=36,Ce=1,Xe=26,Ge=38,We=700,Ve=72,Ze=128,Ft="-",Ct=/^xn--/,rt=/[^\x20-\x7E]/,Ne=/[\x2E\u3002\uFF0E\uFF61]/g,at={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},St=re-Ce,Se=Math.floor,dt=String.fromCharCode,Pi;function kt(Ye){throw RangeError(at[Ye])}function gt(Ye,ft){for(var Ot=Ye.length,Ut=[];Ot--;)Ut[Ot]=ft(Ye[Ot]);return Ut}function ei(Ye,ft){var Ot=Ye.split("@"),Ut="";Ot.length>1&&(Ut=Ot[0]+"@",Ye=Ot[1]),Ye=Ye.replace(Ne,".");var Gt=Ye.split("."),ti=gt(Gt,ft).join(".");return Ut+ti}function rr(Ye){for(var ft=[],Ot=0,Ut=Ye.length,Gt,ti;Ot<Ut;)Gt=Ye.charCodeAt(Ot++),Gt>=55296&&Gt<=56319&&Ot<Ut?(ti=Ye.charCodeAt(Ot++),(ti&64512)==56320?ft.push(((Gt&1023)<<10)+(ti&1023)+65536):(ft.push(Gt),Ot--)):ft.push(Gt);return ft}function Tr(Ye){return gt(Ye,function(ft){var Ot="";return ft>65535&&(ft-=65536,Ot+=dt(ft>>>10&1023|55296),ft=56320|ft&1023),Ot+=dt(ft),Ot}).join("")}function ii(Ye){return Ye-48<10?Ye-22:Ye-65<26?Ye-65:Ye-97<26?Ye-97:re}function ji(Ye,ft){return Ye+22+75*(Ye<26)-((ft!=0)<<5)}function Tt(Ye,ft,Ot){var Ut=0;for(Ye=Ot?Se(Ye/We):Ye>>1,Ye+=Se(Ye/ft);Ye>St*Xe>>1;Ut+=re)Ye=Se(Ye/St);return Se(Ut+(St+1)*Ye/(Ye+Ge))}function Wi(Ye){var ft=[],Ot=Ye.length,Ut,Gt=0,ti=Ze,gi=Ve,ri,Ii,Ai,Mi,Oi,$t,Ci,It,qi;for(ri=Ye.lastIndexOf(Ft),ri<0&&(ri=0),Ii=0;Ii<ri;++Ii)Ye.charCodeAt(Ii)>=128&&kt("not-basic"),ft.push(Ye.charCodeAt(Ii));for(Ai=ri>0?ri+1:0;Ai<Ot;){for(Mi=Gt,Oi=1,$t=re;Ai>=Ot&&kt("invalid-input"),Ci=ii(Ye.charCodeAt(Ai++)),(Ci>=re||Ci>Se((o-Gt)/Oi))&&kt("overflow"),Gt+=Ci*Oi,It=$t<=gi?Ce:$t>=gi+Xe?Xe:$t-gi,!(Ci<It);$t+=re)qi=re-It,Oi>Se(o/qi)&&kt("overflow"),Oi*=qi;Ut=ft.length+1,gi=Tt(Gt-Mi,Ut,Mi==0),Se(Gt/Ut)>o-ti&&kt("overflow"),ti+=Se(Gt/Ut),Gt%=Ut,ft.splice(Gt++,0,ti)}return Tr(ft)}function fr(Ye){var ft,Ot,Ut,Gt,ti,gi,ri,Ii,Ai,Mi,Oi,$t=[],Ci,It,qi,sn;for(Ye=rr(Ye),Ci=Ye.length,ft=Ze,Ot=0,ti=Ve,gi=0;gi<Ci;++gi)Oi=Ye[gi],Oi<128&&$t.push(dt(Oi));for(Ut=Gt=$t.length,Gt&&$t.push(Ft);Ut<Ci;){for(ri=o,gi=0;gi<Ci;++gi)Oi=Ye[gi],Oi>=ft&&Oi<ri&&(ri=Oi);for(It=Ut+1,ri-ft>Se((o-Ot)/It)&&kt("overflow"),Ot+=(ri-ft)*It,ft=ri,gi=0;gi<Ci;++gi)if(Oi=Ye[gi],Oi<ft&&++Ot>o&&kt("overflow"),Oi==ft){for(Ii=Ot,Ai=re;Mi=Ai<=ti?Ce:Ai>=ti+Xe?Xe:Ai-ti,!(Ii<Mi);Ai+=re)sn=Ii-Mi,qi=re-Mi,$t.push(dt(ji(Mi+sn%qi,0))),Ii=Se(sn/qi);$t.push(dt(ji(Ii,0))),ti=Tt(Ot,It,Ut==Gt),Ot=0,++Ut}++Ot,++ft}return $t.join("")}function Mr(Ye){return ei(Ye,function(ft){return Ct.test(ft)?Wi(ft.slice(4).toLowerCase()):ft})}function Si(Ye){return ei(Ye,function(ft){return rt.test(ft)?"xn--"+fr(ft):ft})}if(ae={version:"1.3.2",ucs2:{decode:rr,encode:Tr},decode:Wi,encode:fr,toASCII:Si,toUnicode:Mr},k&&O)if(E.exports==k)O.exports=ae;else for(Pi in ae)ae.hasOwnProperty(Pi)&&(k[Pi]=ae[Pi]);else x.punycode=ae})(ed)})(dd,dd.exports);var I0={isString:function(E){return typeof E=="string"},isObject:function(E){return typeof E=="object"&&E!==null},isNull:function(E){return E===null},isNullOrUndefined:function(E){return E==null}},zc={};function A0(E,y){return Object.prototype.hasOwnProperty.call(E,y)}var M0=function(E,y,x,k){y=y||"&",x=x||"=";var O={};if(typeof E!="string"||E.length===0)return O;var Q=/\+/g;E=E.split(y);var ae=1e3;k&&typeof k.maxKeys=="number"&&(ae=k.maxKeys);var o=E.length;ae>0&&o>ae&&(o=ae);for(var re=0;re<o;++re){var Ce=E[re].replace(Q,"%20"),Xe=Ce.indexOf(x),Ge,We,Ve,Ze;Xe>=0?(Ge=Ce.substr(0,Xe),We=Ce.substr(Xe+1)):(Ge=Ce,We=""),Ve=decodeURIComponent(Ge),Ze=decodeURIComponent(We),A0(O,Ve)?Array.isArray(O[Ve])?O[Ve].push(Ze):O[Ve]=[O[Ve],Ze]:O[Ve]=Ze}return O},Ac=function(E){switch(typeof E){case"string":return E;case"boolean":return E?"true":"false";case"number":return isFinite(E)?E:"";default:return""}},C0=function(E,y,x,k){return y=y||"&",x=x||"=",E===null&&(E=void 0),typeof E=="object"?Object.keys(E).map(function(O){var Q=encodeURIComponent(Ac(O))+x;return Array.isArray(E[O])?E[O].map(function(ae){return Q+encodeURIComponent(Ac(ae))}).join(y):Q+encodeURIComponent(Ac(E[O]))}).join(y):k?encodeURIComponent(Ac(k))+x+encodeURIComponent(Ac(E)):""};zc.decode=zc.parse=M0;zc.encode=zc.stringify=C0;var k0=dd.exports,co=I0;function ho(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var z0=/^([a-z0-9.+-]+:)/i,P0=/:[0-9]*$/,D0=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,L0=["<",">",'"',"`"," ","\r",`
`,"	"],R0=["{","}","|","\\","^","`"].concat(L0),fd=["'"].concat(R0),x_=["%","/","?",";","#"].concat(fd),v_=["/","?","#"],B0=255,b_=/^[+a-z0-9A-Z_-]{0,63}$/,O0=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,F0={javascript:!0,"javascript:":!0},md={javascript:!0,"javascript:":!0},tl={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_d=zc;function U0(E,y,x){if(E&&co.isObject(E)&&E instanceof ho)return E;var k=new ho;return k.parse(E,y,x),k}ho.prototype.parse=function(E,y,x){if(!co.isString(E))throw new TypeError("Parameter 'url' must be a string, not "+typeof E);var k=E.indexOf("?"),O=k!==-1&&k<E.indexOf("#")?"?":"#",Q=E.split(O),ae=/\\/g;Q[0]=Q[0].replace(ae,"/"),E=Q.join(O);var o=E;if(o=o.trim(),!x&&E.split("#").length===1){var re=D0.exec(o);if(re)return this.path=o,this.href=o,this.pathname=re[1],re[2]?(this.search=re[2],y?this.query=_d.parse(this.search.substr(1)):this.query=this.search.substr(1)):y&&(this.search="",this.query={}),this}var Ce=z0.exec(o);if(Ce){Ce=Ce[0];var Xe=Ce.toLowerCase();this.protocol=Xe,o=o.substr(Ce.length)}if(x||Ce||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var Ge=o.substr(0,2)==="//";Ge&&!(Ce&&md[Ce])&&(o=o.substr(2),this.slashes=!0)}if(!md[Ce]&&(Ge||Ce&&!tl[Ce])){for(var We=-1,Ve=0;Ve<v_.length;Ve++){var Ze=o.indexOf(v_[Ve]);Ze!==-1&&(We===-1||Ze<We)&&(We=Ze)}var Ft,Ct;We===-1?Ct=o.lastIndexOf("@"):Ct=o.lastIndexOf("@",We),Ct!==-1&&(Ft=o.slice(0,Ct),o=o.slice(Ct+1),this.auth=decodeURIComponent(Ft)),We=-1;for(var Ve=0;Ve<x_.length;Ve++){var Ze=o.indexOf(x_[Ve]);Ze!==-1&&(We===-1||Ze<We)&&(We=Ze)}We===-1&&(We=o.length),this.host=o.slice(0,We),o=o.slice(We),this.parseHost(),this.hostname=this.hostname||"";var rt=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!rt)for(var Ne=this.hostname.split(/\./),Ve=0,at=Ne.length;Ve<at;Ve++){var St=Ne[Ve];if(St&&!St.match(b_)){for(var Se="",dt=0,Pi=St.length;dt<Pi;dt++)St.charCodeAt(dt)>127?Se+="x":Se+=St[dt];if(!Se.match(b_)){var kt=Ne.slice(0,Ve),gt=Ne.slice(Ve+1),ei=St.match(O0);ei&&(kt.push(ei[1]),gt.unshift(ei[2])),gt.length&&(o="/"+gt.join(".")+o),this.hostname=kt.join(".");break}}}this.hostname.length>B0?this.hostname="":this.hostname=this.hostname.toLowerCase(),rt||(this.hostname=k0.toASCII(this.hostname));var rr=this.port?":"+this.port:"",Tr=this.hostname||"";this.host=Tr+rr,this.href+=this.host,rt&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!F0[Xe])for(var Ve=0,at=fd.length;Ve<at;Ve++){var ii=fd[Ve];if(o.indexOf(ii)!==-1){var ji=encodeURIComponent(ii);ji===ii&&(ji=escape(ii)),o=o.split(ii).join(ji)}}var Tt=o.indexOf("#");Tt!==-1&&(this.hash=o.substr(Tt),o=o.slice(0,Tt));var Wi=o.indexOf("?");if(Wi!==-1?(this.search=o.substr(Wi),this.query=o.substr(Wi+1),y&&(this.query=_d.parse(this.query)),o=o.slice(0,Wi)):y&&(this.search="",this.query={}),o&&(this.pathname=o),tl[Xe]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var rr=this.pathname||"",fr=this.search||"";this.path=rr+fr}return this.href=this.format(),this};ho.prototype.format=function(){var E=this.auth||"";E&&(E=encodeURIComponent(E),E=E.replace(/%3A/i,":"),E+="@");var y=this.protocol||"",x=this.pathname||"",k=this.hash||"",O=!1,Q="";this.host?O=E+this.host:this.hostname&&(O=E+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(O+=":"+this.port)),this.query&&co.isObject(this.query)&&Object.keys(this.query).length&&(Q=_d.stringify(this.query));var ae=this.search||Q&&"?"+Q||"";return y&&y.substr(-1)!==":"&&(y+=":"),this.slashes||(!y||tl[y])&&O!==!1?(O="//"+(O||""),x&&x.charAt(0)!=="/"&&(x="/"+x)):O||(O=""),k&&k.charAt(0)!=="#"&&(k="#"+k),ae&&ae.charAt(0)!=="?"&&(ae="?"+ae),x=x.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),ae=ae.replace("#","%23"),y+O+x+ae+k};ho.prototype.resolve=function(E){return this.resolveObject(U0(E,!1,!0)).format()};ho.prototype.resolveObject=function(E){if(co.isString(E)){var y=new ho;y.parse(E,!1,!0),E=y}for(var x=new ho,k=Object.keys(this),O=0;O<k.length;O++){var Q=k[O];x[Q]=this[Q]}if(x.hash=E.hash,E.href==="")return x.href=x.format(),x;if(E.slashes&&!E.protocol){for(var ae=Object.keys(E),o=0;o<ae.length;o++){var re=ae[o];re!=="protocol"&&(x[re]=E[re])}return tl[x.protocol]&&x.hostname&&!x.pathname&&(x.path=x.pathname="/"),x.href=x.format(),x}if(E.protocol&&E.protocol!==x.protocol){if(!tl[E.protocol]){for(var Ce=Object.keys(E),Xe=0;Xe<Ce.length;Xe++){var Ge=Ce[Xe];x[Ge]=E[Ge]}return x.href=x.format(),x}if(x.protocol=E.protocol,!E.host&&!md[E.protocol]){for(var at=(E.pathname||"").split("/");at.length&&!(E.host=at.shift()););E.host||(E.host=""),E.hostname||(E.hostname=""),at[0]!==""&&at.unshift(""),at.length<2&&at.unshift(""),x.pathname=at.join("/")}else x.pathname=E.pathname;if(x.search=E.search,x.query=E.query,x.host=E.host||"",x.auth=E.auth,x.hostname=E.hostname||E.host,x.port=E.port,x.pathname||x.search){var We=x.pathname||"",Ve=x.search||"";x.path=We+Ve}return x.slashes=x.slashes||E.slashes,x.href=x.format(),x}var Ze=x.pathname&&x.pathname.charAt(0)==="/",Ft=E.host||E.pathname&&E.pathname.charAt(0)==="/",Ct=Ft||Ze||x.host&&E.pathname,rt=Ct,Ne=x.pathname&&x.pathname.split("/")||[],at=E.pathname&&E.pathname.split("/")||[],St=x.protocol&&!tl[x.protocol];if(St&&(x.hostname="",x.port=null,x.host&&(Ne[0]===""?Ne[0]=x.host:Ne.unshift(x.host)),x.host="",E.protocol&&(E.hostname=null,E.port=null,E.host&&(at[0]===""?at[0]=E.host:at.unshift(E.host)),E.host=null),Ct=Ct&&(at[0]===""||Ne[0]==="")),Ft)x.host=E.host||E.host===""?E.host:x.host,x.hostname=E.hostname||E.hostname===""?E.hostname:x.hostname,x.search=E.search,x.query=E.query,Ne=at;else if(at.length)Ne||(Ne=[]),Ne.pop(),Ne=Ne.concat(at),x.search=E.search,x.query=E.query;else if(!co.isNullOrUndefined(E.search)){if(St){x.hostname=x.host=Ne.shift();var Se=x.host&&x.host.indexOf("@")>0?x.host.split("@"):!1;Se&&(x.auth=Se.shift(),x.host=x.hostname=Se.shift())}return x.search=E.search,x.query=E.query,(!co.isNull(x.pathname)||!co.isNull(x.search))&&(x.path=(x.pathname?x.pathname:"")+(x.search?x.search:"")),x.href=x.format(),x}if(!Ne.length)return x.pathname=null,x.search?x.path="/"+x.search:x.path=null,x.href=x.format(),x;for(var dt=Ne.slice(-1)[0],Pi=(x.host||E.host||Ne.length>1)&&(dt==="."||dt==="..")||dt==="",kt=0,gt=Ne.length;gt>=0;gt--)dt=Ne[gt],dt==="."?Ne.splice(gt,1):dt===".."?(Ne.splice(gt,1),kt++):kt&&(Ne.splice(gt,1),kt--);if(!Ct&&!rt)for(;kt--;kt)Ne.unshift("..");Ct&&Ne[0]!==""&&(!Ne[0]||Ne[0].charAt(0)!=="/")&&Ne.unshift(""),Pi&&Ne.join("/").substr(-1)!=="/"&&Ne.push("");var ei=Ne[0]===""||Ne[0]&&Ne[0].charAt(0)==="/";if(St){x.hostname=x.host=ei?"":Ne.length?Ne.shift():"";var Se=x.host&&x.host.indexOf("@")>0?x.host.split("@"):!1;Se&&(x.auth=Se.shift(),x.host=x.hostname=Se.shift())}return Ct=Ct||x.host&&Ne.length,Ct&&!ei&&Ne.unshift(""),Ne.length?x.pathname=Ne.join("/"):(x.pathname=null,x.path=null),(!co.isNull(x.pathname)||!co.isNull(x.search))&&(x.path=(x.pathname?x.pathname:"")+(x.search?x.search:"")),x.auth=E.auth||x.auth,x.slashes=x.slashes||E.slashes,x.href=x.format(),x};ho.prototype.parseHost=function(){var E=this.host,y=P0.exec(E);y&&(y=y[0],y!==":"&&(this.port=y.substr(1)),E=E.substr(0,E.length-y.length)),E&&(this.hostname=E)};class j0 extends Error{constructor(y,x){super(x),this.message=x,this.key=y}}var N0=j0;class vd{constructor(y,x=[]){this.parent=y,this.bindings={};for(const[k,O]of x)this.bindings[k]=O}concat(y){return new vd(this,y)}get(y){if(this.bindings[y])return this.bindings[y];if(this.parent)return this.parent.get(y);throw new Error(`${y} not found in scope.`)}has(y){return this.bindings[y]?!0:this.parent?this.parent.has(y):!1}}var V0=vd;const Ah={kind:"null"},tt={kind:"number"},Ht={kind:"string"},Nt={kind:"boolean"},Yo={kind:"color"},il={kind:"object"},Vt={kind:"value"},G0={kind:"error"},Mh={kind:"collator"},bd={kind:"formatted"},Ch={kind:"resolvedImage"};function xn(E,y){return{kind:"array",itemType:E,N:y}}function Bi(E){if(E.kind==="array"){const y=Bi(E.itemType);return typeof E.N=="number"?`array<${y}, ${E.N}>`:E.itemType.kind==="value"?"array":`array<${y}>`}else return E.kind}const $0=[Ah,tt,Ht,Nt,Yo,bd,il,xn(Vt),Ch];function Pc(E,y){if(y.kind==="error")return null;if(E.kind==="array"){if(y.kind==="array"&&(y.N===0&&y.itemType.kind==="value"||!Pc(E.itemType,y.itemType))&&(typeof E.N!="number"||E.N===y.N))return null}else{if(E.kind===y.kind)return null;if(E.kind==="value"){for(const x of $0)if(!Pc(x,y))return null}}return`Expected ${Bi(E)} but found ${Bi(y)} instead.`}function wd(E,y){return y.some(x=>x.kind===E.kind)}function Dc(E,y){return y.some(x=>x==="null"?E===null:x==="array"?Array.isArray(E):x==="object"?E&&!Array.isArray(E)&&typeof E=="object":x===typeof E)}var q0={},P_,w_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Mc(E){return E=Math.round(E),E<0?0:E>255?255:E}function T_(E){return E<0?0:E>1?1:E}function td(E){return E[E.length-1]==="%"?Mc(parseFloat(E)/100*255):Mc(parseInt(E))}function mh(E){return E[E.length-1]==="%"?T_(parseFloat(E)/100):T_(parseFloat(E))}function id(E,y,x){return x<0?x+=1:x>1&&(x-=1),x*6<1?E+(y-E)*x*6:x*2<1?y:x*3<2?E+(y-E)*(2/3-x)*6:E}function Z0(E){var y=E.replace(/ /g,"").toLowerCase();if(y in w_)return w_[y].slice();if(y[0]==="#"){if(y.length===4){var x=parseInt(y.substr(1),16);return x>=0&&x<=4095?[(x&3840)>>4|(x&3840)>>8,x&240|(x&240)>>4,x&15|(x&15)<<4,1]:null}else if(y.length===7){var x=parseInt(y.substr(1),16);return x>=0&&x<=16777215?[(x&16711680)>>16,(x&65280)>>8,x&255,1]:null}return null}var k=y.indexOf("("),O=y.indexOf(")");if(k!==-1&&O+1===y.length){var Q=y.substr(0,k),ae=y.substr(k+1,O-(k+1)).split(","),o=1;switch(Q){case"rgba":if(ae.length!==4)return null;o=mh(ae.pop());case"rgb":return ae.length!==3?null:[td(ae[0]),td(ae[1]),td(ae[2]),o];case"hsla":if(ae.length!==4)return null;o=mh(ae.pop());case"hsl":if(ae.length!==3)return null;var re=(parseFloat(ae[0])%360+360)%360/360,Ce=mh(ae[1]),Xe=mh(ae[2]),Ge=Xe<=.5?Xe*(Ce+1):Xe+Ce-Xe*Ce,We=Xe*2-Ge;return[Mc(id(We,Ge,re+1/3)*255),Mc(id(We,Ge,re)*255),Mc(id(We,Ge,re-1/3)*255),o];default:return null}}return null}try{P_=q0.parseCSSColor=Z0}catch{}class Or{constructor(y,x,k,O=1){this.r=y,this.g=x,this.b=k,this.a=O}static parse(y){if(!y)return;if(y instanceof Or)return y;if(typeof y!="string")return;const x=P_(y);if(x)return new Or(x[0]/255*x[3],x[1]/255*x[3],x[2]/255*x[3],x[3])}toString(){const[y,x,k,O]=this.toArray();return`rgba(${Math.round(y)},${Math.round(x)},${Math.round(k)},${O})`}toArray(){const{r:y,g:x,b:k,a:O}=this;return O===0?[0,0,0,0]:[y*255/O,x*255/O,k*255/O,O]}toArray01(){const{r:y,g:x,b:k,a:O}=this;return O===0?[0,0,0,0]:[y/O,x/O,k/O,O]}toArray01PremultipliedAlpha(){const{r:y,g:x,b:k,a:O}=this;return[y,x,k,O]}}Or.black=new Or(0,0,0,1);Or.white=new Or(1,1,1,1);Or.transparent=new Or(0,0,0,0);Or.red=new Or(1,0,0,1);Or.blue=new Or(0,0,1,1);var $n=Or;class Td{constructor(y,x,k){y?this.sensitivity=x?"variant":"case":this.sensitivity=x?"accent":"base",this.locale=k,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(y,x){return this.collator.compare(y,x)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gd{constructor(y,x,k,O,Q){this.text=y.normalize?y.normalize():y,this.image=x,this.scale=k,this.fontStack=O,this.textColor=Q}}class Gn{constructor(y){this.sections=y}static fromString(y){return new Gn([new gd(y,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(y=>y.text.length!==0||y.image&&y.image.name.length!==0)}static factory(y){return y instanceof Gn?y:Gn.fromString(y)}toString(){return this.sections.length===0?"":this.sections.map(y=>y.text).join("")}serialize(){const y=["format"];for(const x of this.sections){if(x.image){y.push(["image",x.image.name]);continue}y.push(x.text);const k={};x.fontStack&&(k["text-font"]=["literal",x.fontStack.split(",")]),x.scale&&(k["font-scale"]=x.scale),x.textColor&&(k["text-color"]=["rgba"].concat(x.textColor.toArray())),y.push(k)}return y}}class Jo{constructor(y){this.name=y.name,this.available=y.available}toString(){return this.name}static fromString(y){return y?new Jo({name:y,available:!1}):null}serialize(){return["image",this.name]}}function D_(E,y,x,k){return typeof E=="number"&&E>=0&&E<=255&&typeof y=="number"&&y>=0&&y<=255&&typeof x=="number"&&x>=0&&x<=255?typeof k>"u"||typeof k=="number"&&k>=0&&k<=1?null:`Invalid rgba value [${[E,y,x,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof k=="number"?[E,y,x,k]:[E,y,x]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vh(E){if(E===null)return!0;if(typeof E=="string")return!0;if(typeof E=="boolean")return!0;if(typeof E=="number")return!0;if(E instanceof $n)return!0;if(E instanceof Td)return!0;if(E instanceof Gn)return!0;if(E instanceof Jo)return!0;if(Array.isArray(E)){for(const y of E)if(!vh(y))return!1;return!0}else if(typeof E=="object"){for(const y in E)if(!vh(E[y]))return!1;return!0}else return!1}function ir(E){if(E===null)return Ah;if(typeof E=="string")return Ht;if(typeof E=="boolean")return Nt;if(typeof E=="number")return tt;if(E instanceof $n)return Yo;if(E instanceof Td)return Mh;if(E instanceof Gn)return bd;if(E instanceof Jo)return Ch;if(Array.isArray(E)){const y=E.length;let x;for(const k of E){const O=ir(k);if(!x)x=O;else{if(x===O)continue;x=Vt;break}}return xn(x||Vt,y)}else return il}function Cc(E){const y=typeof E;return E===null?"":y==="string"||y==="number"||y==="boolean"?String(E):E instanceof $n||E instanceof Gn||E instanceof Jo?E.toString():JSON.stringify(E)}class Ed{constructor(y,x){this.type=y,this.value=x}static parse(y,x){if(y.length!==2)return x.error(`'literal' expression requires exactly one argument, but found ${y.length-1} instead.`);if(!vh(y[1]))return x.error("invalid value");const k=y[1];let O=ir(k);const Q=x.expectedType;return O.kind==="array"&&O.N===0&&Q&&Q.kind==="array"&&(typeof Q.N!="number"||Q.N===0)&&(O=Q),new Ed(O,k)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof $n?["rgba"].concat(this.value.toArray()):this.value instanceof Gn?this.value.serialize():this.value}}var bh=Ed;class X0{constructor(y){this.name="ExpressionEvaluationError",this.message=y}toJSON(){return this.message}}var wr=X0;const rd={string:Ht,number:tt,boolean:Nt,object:il};class Sd{constructor(y,x){this.type=y,this.args=x}static parse(y,x){if(y.length<2)return x.error("Expected at least one argument.");let k=1,O;const Q=y[0];if(Q==="array"){let o;if(y.length>2){const Ce=y[1];if(typeof Ce!="string"||!(Ce in rd)||Ce==="object")return x.error('The item type argument of "array" must be one of string, number, boolean',1);o=rd[Ce],k++}else o=Vt;let re;if(y.length>3){if(y[2]!==null&&(typeof y[2]!="number"||y[2]<0||y[2]!==Math.floor(y[2])))return x.error('The length argument to "array" must be a positive integer literal',2);re=y[2],k++}O=xn(o,re)}else O=rd[Q];const ae=[];for(;k<y.length;k++){const o=x.parse(y[k],k,Vt);if(!o)return null;ae.push(o)}return new Sd(O,ae)}evaluate(y){for(let x=0;x<this.args.length;x++){const k=this.args[x].evaluate(y);if(Pc(this.type,ir(k))){if(x===this.args.length-1)throw new wr(`Expected value to be of type ${Bi(this.type)}, but found ${Bi(ir(k))} instead.`)}else return k}return null}eachChild(y){this.args.forEach(y)}outputDefined(){return this.args.every(y=>y.outputDefined())}serialize(){const y=this.type,x=[y.kind];if(y.kind==="array"){const k=y.itemType;if(k.kind==="string"||k.kind==="number"||k.kind==="boolean"){x.push(k.kind);const O=y.N;(typeof O=="number"||this.args.length>1)&&x.push(O)}}return x.concat(this.args.map(k=>k.serialize()))}}var uo=Sd;class kh{constructor(y){this.type=bd,this.sections=y}static parse(y,x){if(y.length<2)return x.error("Expected at least one argument.");const k=y[1];if(!Array.isArray(k)&&typeof k=="object")return x.error("First argument must be an image or text section.");const O=[];let Q=!1;for(let ae=1;ae<=y.length-1;++ae){const o=y[ae];if(Q&&typeof o=="object"&&!Array.isArray(o)){Q=!1;let re=null;if(o["font-scale"]&&(re=x.parse(o["font-scale"],1,tt),!re))return null;let Ce=null;if(o["text-font"]&&(Ce=x.parse(o["text-font"],1,xn(Ht)),!Ce))return null;let Xe=null;if(o["text-color"]&&(Xe=x.parse(o["text-color"],1,Yo),!Xe))return null;const Ge=O[O.length-1];Ge.scale=re,Ge.font=Ce,Ge.textColor=Xe}else{const re=x.parse(y[ae],1,Vt);if(!re)return null;const Ce=re.type.kind;if(Ce!=="string"&&Ce!=="value"&&Ce!=="null"&&Ce!=="resolvedImage")return x.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Q=!0,O.push({content:re,scale:null,font:null,textColor:null})}}return new kh(O)}evaluate(y){const x=k=>{const O=k.content.evaluate(y);return ir(O)===Ch?new gd("",O,null,null,null):new gd(Cc(O),null,k.scale?k.scale.evaluate(y):null,k.font?k.font.evaluate(y).join(","):null,k.textColor?k.textColor.evaluate(y):null)};return new Gn(this.sections.map(x))}eachChild(y){for(const x of this.sections)y(x.content),x.scale&&y(x.scale),x.font&&y(x.font),x.textColor&&y(x.textColor)}outputDefined(){return!1}serialize(){const y=["format"];for(const x of this.sections){y.push(x.content.serialize());const k={};x.scale&&(k["font-scale"]=x.scale.serialize()),x.font&&(k["text-font"]=x.font.serialize()),x.textColor&&(k["text-color"]=x.textColor.serialize()),y.push(k)}return y}}class zh{constructor(y){this.type=Ch,this.input=y}static parse(y,x){if(y.length!==2)return x.error("Expected two arguments.");const k=x.parse(y[1],1,Ht);return k?new zh(k):x.error("No image name provided.")}evaluate(y){const x=this.input.evaluate(y),k=Jo.fromString(x);return k&&y.availableImages&&(k.available=y.availableImages.indexOf(x)>-1),k}eachChild(y){y(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const W0={"to-boolean":Nt,"to-color":Yo,"to-number":tt,"to-string":Ht};class Id{constructor(y,x){this.type=y,this.args=x}static parse(y,x){if(y.length<2)return x.error("Expected at least one argument.");const k=y[0];if((k==="to-boolean"||k==="to-string")&&y.length!==2)return x.error("Expected one argument.");const O=W0[k],Q=[];for(let ae=1;ae<y.length;ae++){const o=x.parse(y[ae],ae,Vt);if(!o)return null;Q.push(o)}return new Id(O,Q)}evaluate(y){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(y));if(this.type.kind==="color"){let x,k;for(const O of this.args){if(x=O.evaluate(y),k=null,x instanceof $n)return x;if(typeof x=="string"){const Q=y.parseColor(x);if(Q)return Q}else if(Array.isArray(x)&&(x.length<3||x.length>4?k=`Invalid rbga value ${JSON.stringify(x)}: expected an array containing either three or four numeric values.`:k=D_(x[0],x[1],x[2],x[3]),!k))return new $n(x[0]/255,x[1]/255,x[2]/255,x[3])}throw new wr(k||`Could not parse color from value '${typeof x=="string"?x:String(JSON.stringify(x))}'`)}else if(this.type.kind==="number"){let x=null;for(const k of this.args){if(x=k.evaluate(y),x===null)return 0;const O=Number(x);if(!isNaN(O))return O}throw new wr(`Could not convert ${JSON.stringify(x)} to number.`)}else return this.type.kind==="formatted"?Gn.fromString(Cc(this.args[0].evaluate(y))):this.type.kind==="resolvedImage"?Jo.fromString(Cc(this.args[0].evaluate(y))):Cc(this.args[0].evaluate(y))}eachChild(y){this.args.forEach(y)}outputDefined(){return this.args.every(y=>y.outputDefined())}serialize(){if(this.type.kind==="formatted")return new kh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new zh(this.args[0]).serialize();const y=[`to-${this.type.kind}`];return this.eachChild(x=>{y.push(x.serialize())}),y}}var Qa=Id;const H0=["Unknown","Point","LineString","Polygon"];class Y0{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?H0[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const y=this.featureDistanceData.center,x=this.featureDistanceData.scale,{x:k,y:O}=this.featureTileCoord,Q=k*x-y[0],ae=O*x-y[1],o=this.featureDistanceData.bearing[0],re=this.featureDistanceData.bearing[1];return o*Q+re*ae}return 0}parseColor(y){let x=this._parseColorCache[y];return x||(x=this._parseColorCache[y]=$n.parse(y)),x}}var K0=Y0;class el{constructor(y,x,k,O){this.name=y,this.type=x,this._evaluate=k,this.args=O}evaluate(y){return this._evaluate(y,this.args)}eachChild(y){this.args.forEach(y)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(y=>y.serialize()))}static parse(y,x){const k=y[0],O=el.definitions[k];if(!O)return x.error(`Unknown expression "${k}". If you wanted a literal array, use ["literal", [...]].`,0);const Q=Array.isArray(O)?O[0]:O.type,ae=Array.isArray(O)?[[O[1],O[2]]]:O.overloads,o=ae.filter(([Ce])=>!Array.isArray(Ce)||Ce.length===y.length-1);let re=null;for(const[Ce,Xe]of o){re=new p1(x.registry,x.path,null,x.scope);const Ge=[];let We=!1;for(let Ve=1;Ve<y.length;Ve++){const Ze=y[Ve],Ft=Array.isArray(Ce)?Ce[Ve-1]:Ce.type,Ct=re.parse(Ze,1+Ge.length,Ft);if(!Ct){We=!0;break}Ge.push(Ct)}if(!We){if(Array.isArray(Ce)&&Ce.length!==Ge.length){re.error(`Expected ${Ce.length} arguments, but found ${Ge.length} instead.`);continue}for(let Ve=0;Ve<Ge.length;Ve++){const Ze=Array.isArray(Ce)?Ce[Ve]:Ce.type,Ft=Ge[Ve];re.concat(Ve+1).checkSubtype(Ze,Ft.type)}if(re.errors.length===0)return new el(k,Q,Xe,Ge)}}if(o.length===1)x.errors.push(...re.errors);else{const Xe=(o.length?o:ae).map(([We])=>J0(We)).join(" | "),Ge=[];for(let We=1;We<y.length;We++){const Ve=x.parse(y[We],1+Ge.length);if(!Ve)return null;Ge.push(Bi(Ve.type))}x.error(`Expected arguments of type ${Xe}, but found (${Ge.join(", ")}) instead.`)}return null}static register(y,x){el.definitions=x;for(const k in x)y[k]=el}}function J0(E){return Array.isArray(E)?`(${E.map(Bi).join(", ")})`:`(${Bi(E.type)}...)`}var Ph=el;class Dh{constructor(y,x,k){this.type=Mh,this.locale=k,this.caseSensitive=y,this.diacriticSensitive=x}static parse(y,x){if(y.length!==2)return x.error("Expected one argument.");const k=y[1];if(typeof k!="object"||Array.isArray(k))return x.error("Collator options argument must be an object.");const O=x.parse(k["case-sensitive"]===void 0?!1:k["case-sensitive"],1,Nt);if(!O)return null;const Q=x.parse(k["diacritic-sensitive"]===void 0?!1:k["diacritic-sensitive"],1,Nt);if(!Q)return null;let ae=null;return k.locale&&(ae=x.parse(k.locale,1,Ht),!ae)?null:new Dh(O,Q,ae)}evaluate(y){return new Td(this.caseSensitive.evaluate(y),this.diacriticSensitive.evaluate(y),this.locale?this.locale.evaluate(y):null)}eachChild(y){y(this.caseSensitive),y(this.diacriticSensitive),this.locale&&y(this.locale)}outputDefined(){return!1}serialize(){const y={};return y["case-sensitive"]=this.caseSensitive.serialize(),y["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(y.locale=this.locale.serialize()),["collator",y]}}const Ko=8192;function Ad(E,y){E[0]=Math.min(E[0],y[0]),E[1]=Math.min(E[1],y[1]),E[2]=Math.max(E[2],y[0]),E[3]=Math.max(E[3],y[1])}function Q0(E){return(180+E)/360}function e1(E){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+E*Math.PI/360)))/360}function wh(E,y){return!(E[0]<=y[0]||E[2]>=y[2]||E[1]<=y[1]||E[3]>=y[3])}function t1(E,y){const x=Q0(E[0]),k=e1(E[1]),O=Math.pow(2,y.z);return[Math.round(x*O*Ko),Math.round(k*O*Ko)]}function i1(E,y,x){const k=E[0]-y[0],O=E[1]-y[1],Q=E[0]-x[0],ae=E[1]-x[1];return k*ae-Q*O===0&&k*Q<=0&&O*ae<=0}function r1(E,y,x){return y[1]>E[1]!=x[1]>E[1]&&E[0]<(x[0]-y[0])*(E[1]-y[1])/(x[1]-y[1])+y[0]}function Md(E,y){let x=!1;for(let k=0,O=y.length;k<O;k++){const Q=y[k];for(let ae=0,o=Q.length;ae<o-1;ae++){if(i1(E,Q[ae],Q[ae+1]))return!1;r1(E,Q[ae],Q[ae+1])&&(x=!x)}}return x}function n1(E,y){for(let x=0;x<y.length;x++)if(Md(E,y[x]))return!0;return!1}function o1(E,y){return E[0]*y[1]-E[1]*y[0]}function E_(E,y,x,k){const O=E[0]-x[0],Q=E[1]-x[1],ae=y[0]-x[0],o=y[1]-x[1],re=k[0]-x[0],Ce=k[1]-x[1],Xe=O*Ce-re*Q,Ge=ae*Ce-re*o;return Xe>0&&Ge<0||Xe<0&&Ge>0}function s1(E,y,x,k){const O=[y[0]-E[0],y[1]-E[1]],Q=[k[0]-x[0],k[1]-x[1]];return o1(Q,O)===0?!1:!!(E_(E,y,x,k)&&E_(x,k,E,y))}function a1(E,y,x){for(const k of x)for(let O=0;O<k.length-1;++O)if(s1(E,y,k[O],k[O+1]))return!0;return!1}function L_(E,y){for(let x=0;x<E.length;++x)if(!Md(E[x],y))return!1;for(let x=0;x<E.length-1;++x)if(a1(E[x],E[x+1],y))return!1;return!0}function l1(E,y){for(let x=0;x<y.length;x++)if(L_(E,y[x]))return!0;return!1}function Cd(E,y,x){const k=[];for(let O=0;O<E.length;O++){const Q=[];for(let ae=0;ae<E[O].length;ae++){const o=t1(E[O][ae],x);Ad(y,o),Q.push(o)}k.push(Q)}return k}function R_(E,y,x){const k=[];for(let O=0;O<E.length;O++){const Q=Cd(E[O],y,x);k.push(Q)}return k}function B_(E,y,x,k){if(E[0]<x[0]||E[0]>x[2]){const O=k*.5;let Q=E[0]-x[0]>O?-k:x[0]-E[0]>O?k:0;Q===0&&(Q=E[0]-x[2]>O?-k:x[2]-E[0]>O?k:0),E[0]+=Q}Ad(y,E)}function c1(E){E[0]=E[1]=1/0,E[2]=E[3]=-1/0}function S_(E,y,x,k){const O=Math.pow(2,k.z)*Ko,Q=[k.x*Ko,k.y*Ko],ae=[];if(!E)return ae;for(const o of E)for(const re of o){const Ce=[re.x+Q[0],re.y+Q[1]];B_(Ce,y,x,O),ae.push(Ce)}return ae}function I_(E,y,x,k){const O=Math.pow(2,k.z)*Ko,Q=[k.x*Ko,k.y*Ko],ae=[];if(!E)return ae;for(const o of E){const re=[];for(const Ce of o){const Xe=[Ce.x+Q[0],Ce.y+Q[1]];Ad(y,Xe),re.push(Xe)}ae.push(re)}if(y[2]-y[0]<=O/2){c1(y);for(const o of ae)for(const re of o)B_(re,y,x,O)}return ae}function u1(E,y){const x=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],O=E.canonicalID();if(!O)return!1;if(y.type==="Polygon"){const Q=Cd(y.coordinates,k,O),ae=S_(E.geometry(),x,k,O);if(!wh(x,k))return!1;for(const o of ae)if(!Md(o,Q))return!1}if(y.type==="MultiPolygon"){const Q=R_(y.coordinates,k,O),ae=S_(E.geometry(),x,k,O);if(!wh(x,k))return!1;for(const o of ae)if(!n1(o,Q))return!1}return!0}function h1(E,y){const x=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],O=E.canonicalID();if(!O)return!1;if(y.type==="Polygon"){const Q=Cd(y.coordinates,k,O),ae=I_(E.geometry(),x,k,O);if(!wh(x,k))return!1;for(const o of ae)if(!L_(o,Q))return!1}if(y.type==="MultiPolygon"){const Q=R_(y.coordinates,k,O),ae=I_(E.geometry(),x,k,O);if(!wh(x,k))return!1;for(const o of ae)if(!l1(o,Q))return!1}return!0}class kc{constructor(y,x){this.type=Nt,this.geojson=y,this.geometries=x}static parse(y,x){if(y.length!==2)return x.error(`'within' expression requires exactly one argument, but found ${y.length-1} instead.`);if(vh(y[1])){const k=y[1];if(k.type==="FeatureCollection")for(let O=0;O<k.features.length;++O){const Q=k.features[O].geometry.type;if(Q==="Polygon"||Q==="MultiPolygon")return new kc(k,k.features[O].geometry)}else if(k.type==="Feature"){const O=k.geometry.type;if(O==="Polygon"||O==="MultiPolygon")return new kc(k,k.geometry)}else if(k.type==="Polygon"||k.type==="MultiPolygon")return new kc(k,k)}return x.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(y){if(y.geometry()!=null&&y.canonicalID()!=null){if(y.geometryType()==="Point")return u1(y,this.geometries);if(y.geometryType()==="LineString")return h1(y,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var kd=kc;function O_(E){if(E instanceof Ph){if(E.name==="get"&&E.args.length===1)return!1;if(E.name==="feature-state")return!1;if(E.name==="has"&&E.args.length===1)return!1;if(E.name==="properties"||E.name==="geometry-type"||E.name==="id")return!1;if(/^filter-/.test(E.name))return!1}if(E instanceof kd)return!1;let y=!0;return E.eachChild(x=>{y&&!O_(x)&&(y=!1)}),y}function F_(E,y){if(E instanceof Ph&&y.indexOf(E.name)>=0)return!1;let x=!0;return E.eachChild(k=>{x&&!F_(k,y)&&(x=!1)}),x}class zd{constructor(y,x){this.type=x.type,this.name=y,this.boundExpression=x}static parse(y,x){if(y.length!==2||typeof y[1]!="string")return x.error("'var' expression requires exactly one string literal argument.");const k=y[1];return x.scope.has(k)?new zd(k,x.scope.get(k)):x.error(`Unknown variable "${k}". Make sure "${k}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(y){return this.boundExpression.evaluate(y)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var U_=zd;class Pd{constructor(y,x=[],k,O=new V0,Q=[]){this.registry=y,this.path=x,this.key=x.map(ae=>`[${ae}]`).join(""),this.scope=O,this.errors=Q,this.expectedType=k}parse(y,x,k,O,Q={}){return x?this.concat(x,k,O)._parse(y,Q):this._parse(y,Q)}_parse(y,x){(y===null||typeof y=="string"||typeof y=="boolean"||typeof y=="number")&&(y=["literal",y]);function k(O,Q,ae){return ae==="assert"?new uo(Q,[O]):ae==="coerce"?new Qa(Q,[O]):O}if(Array.isArray(y)){if(y.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const O=y[0];if(typeof O!="string")return this.error(`Expression name must be a string, but found ${typeof O} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Q=this.registry[O];if(Q){let ae=Q.parse(y,this);if(!ae)return null;if(this.expectedType){const o=this.expectedType,re=ae.type;if((o.kind==="string"||o.kind==="number"||o.kind==="boolean"||o.kind==="object"||o.kind==="array")&&re.kind==="value")ae=k(ae,o,x.typeAnnotation||"assert");else if((o.kind==="color"||o.kind==="formatted"||o.kind==="resolvedImage")&&(re.kind==="value"||re.kind==="string"))ae=k(ae,o,x.typeAnnotation||"coerce");else if(this.checkSubtype(o,re))return null}if(!(ae instanceof bh)&&ae.type.kind!=="resolvedImage"&&yd(ae)){const o=new K0;try{ae=new bh(ae.type,ae.evaluate(o))}catch(re){return this.error(re.message),null}}return ae}return this.error(`Unknown expression "${O}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof y>"u"?this.error("'undefined' value invalid. Use null instead."):typeof y=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof y} instead.`)}concat(y,x,k){const O=typeof y=="number"?this.path.concat(y):this.path,Q=k?this.scope.concat(k):this.scope;return new Pd(this.registry,O,x||null,Q,this.errors)}error(y,...x){const k=`${this.key}${x.map(O=>`[${O}]`).join("")}`;this.errors.push(new N0(k,y))}checkSubtype(y,x){const k=Pc(y,x);return k&&this.error(k),k}}var p1=Pd;function yd(E){if(E instanceof U_)return yd(E.boundExpression);if(E instanceof Ph&&E.name==="error")return!1;if(E instanceof Dh)return!1;if(E instanceof kd)return!1;const y=E instanceof Qa||E instanceof uo;let x=!0;return E.eachChild(k=>{y?x=x&&yd(k):x=x&&k instanceof bh}),x?O_(E)&&F_(E,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]):!1}function j_(E,y){const x=E.length-1;let k=0,O=x,Q=0,ae,o;for(;k<=O;)if(Q=Math.floor((k+O)/2),ae=E[Q],o=E[Q+1],ae<=y){if(Q===x||y<o)return Q;k=Q+1}else if(ae>y)O=Q-1;else throw new wr("Input is not a number.");return 0}class Dd{constructor(y,x,k){this.type=y,this.input=x,this.labels=[],this.outputs=[];for(const[O,Q]of k)this.labels.push(O),this.outputs.push(Q)}static parse(y,x){if(y.length-1<4)return x.error(`Expected at least 4 arguments, but found only ${y.length-1}.`);if((y.length-1)%2!==0)return x.error("Expected an even number of arguments.");const k=x.parse(y[1],1,tt);if(!k)return null;const O=[];let Q=null;x.expectedType&&x.expectedType.kind!=="value"&&(Q=x.expectedType);for(let ae=1;ae<y.length;ae+=2){const o=ae===1?-1/0:y[ae],re=y[ae+1],Ce=ae,Xe=ae+1;if(typeof o!="number")return x.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ce);if(O.length&&O[O.length-1][0]>=o)return x.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Ce);const Ge=x.parse(re,Xe,Q);if(!Ge)return null;Q=Q||Ge.type,O.push([o,Ge])}return new Dd(Q,k,O)}evaluate(y){const x=this.labels,k=this.outputs;if(x.length===1)return k[0].evaluate(y);const O=this.input.evaluate(y);if(O<=x[0])return k[0].evaluate(y);const Q=x.length;if(O>=x[Q-1])return k[Q-1].evaluate(y);const ae=j_(x,O);return k[ae].evaluate(y)}eachChild(y){y(this.input);for(const x of this.outputs)y(x)}outputDefined(){return this.outputs.every(y=>y.outputDefined())}serialize(){const y=["step",this.input.serialize()];for(let x=0;x<this.labels.length;x++)x>0&&y.push(this.labels[x]),y.push(this.outputs[x].serialize());return y}}var d1=Dd,f1=N_;function N_(E,y,x,k){this.cx=3*E,this.bx=3*(x-E)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*y,this.by=3*(k-y)-this.cy,this.ay=1-this.cy-this.by,this.p1x=E,this.p1y=y,this.p2x=x,this.p2y=k}N_.prototype={sampleCurveX:function(E){return((this.ax*E+this.bx)*E+this.cx)*E},sampleCurveY:function(E){return((this.ay*E+this.by)*E+this.cy)*E},sampleCurveDerivativeX:function(E){return(3*this.ax*E+2*this.bx)*E+this.cx},solveCurveX:function(E,y){if(y===void 0&&(y=1e-6),E<0)return 0;if(E>1)return 1;for(var x=E,k=0;k<8;k++){var O=this.sampleCurveX(x)-E;if(Math.abs(O)<y)return x;var Q=this.sampleCurveDerivativeX(x);if(Math.abs(Q)<1e-6)break;x=x-O/Q}var ae=0,o=1;for(x=E,k=0;k<20&&(O=this.sampleCurveX(x),!(Math.abs(O-E)<y));k++)E>O?ae=x:o=x,x=(o-ae)*.5+ae;return x},solve:function(E,y){return this.sampleCurveY(this.solveCurveX(E,y))}};function $r(E,y,x){return E*(1-x)+y*x}function m1(E,y,x){return new $n($r(E.r,y.r,x),$r(E.g,y.g,x),$r(E.b,y.b,x),$r(E.a,y.a,x))}function _1(E,y,x){return E.map((k,O)=>$r(k,y[O],x))}var g1=Object.freeze({__proto__:null,number:$r,color:m1,array:_1});const V_=.95047,G_=1,$_=1.08883,q_=4/29,rl=6/29,Z_=3*rl*rl,y1=rl*rl*rl,x1=Math.PI/180,v1=180/Math.PI;function nd(E){return E>y1?Math.pow(E,1/3):E/Z_+q_}function od(E){return E>rl?E*E*E:Z_*(E-q_)}function sd(E){return 255*(E<=.0031308?12.92*E:1.055*Math.pow(E,1/2.4)-.055)}function ad(E){return E/=255,E<=.04045?E/12.92:Math.pow((E+.055)/1.055,2.4)}function X_(E){const y=ad(E.r),x=ad(E.g),k=ad(E.b),O=nd((.4124564*y+.3575761*x+.1804375*k)/V_),Q=nd((.2126729*y+.7151522*x+.072175*k)/G_),ae=nd((.0193339*y+.119192*x+.9503041*k)/$_);return{l:116*Q-16,a:500*(O-Q),b:200*(Q-ae),alpha:E.a}}function W_(E){let y=(E.l+16)/116,x=isNaN(E.a)?y:y+E.a/500,k=isNaN(E.b)?y:y-E.b/200;return y=G_*od(y),x=V_*od(x),k=$_*od(k),new $n(sd(3.2404542*x-1.5371385*y-.4985314*k),sd(-.969266*x+1.8760108*y+.041556*k),sd(.0556434*x-.2040259*y+1.0572252*k),E.alpha)}function b1(E,y,x){return{l:$r(E.l,y.l,x),a:$r(E.a,y.a,x),b:$r(E.b,y.b,x),alpha:$r(E.alpha,y.alpha,x)}}function w1(E){const{l:y,a:x,b:k}=X_(E),O=Math.atan2(k,x)*v1;return{h:O<0?O+360:O,c:Math.sqrt(x*x+k*k),l:y,alpha:E.a}}function T1(E){const y=E.h*x1,x=E.c,k=E.l;return W_({l:k,a:Math.cos(y)*x,b:Math.sin(y)*x,alpha:E.alpha})}function E1(E,y,x){const k=y-E;return E+x*(k>180||k<-180?k-360*Math.round(k/360):k)}function S1(E,y,x){return{h:E1(E.h,y.h,x),c:$r(E.c,y.c,x),l:$r(E.l,y.l,x),alpha:$r(E.alpha,y.alpha,x)}}const _h={forward:X_,reverse:W_,interpolate:b1},gh={forward:w1,reverse:T1,interpolate:S1};class Th{constructor(y,x,k,O,Q){this.type=y,this.operator=x,this.interpolation=k,this.input=O,this.labels=[],this.outputs=[];for(const[ae,o]of Q)this.labels.push(ae),this.outputs.push(o)}static interpolationFactor(y,x,k,O){let Q=0;if(y.name==="exponential")Q=ld(x,y.base,k,O);else if(y.name==="linear")Q=ld(x,1,k,O);else if(y.name==="cubic-bezier"){const ae=y.controlPoints;Q=new f1(ae[0],ae[1],ae[2],ae[3]).solve(ld(x,1,k,O))}return Q}static parse(y,x){let[k,O,Q,...ae]=y;if(!Array.isArray(O)||O.length===0)return x.error("Expected an interpolation type expression.",1);if(O[0]==="linear")O={name:"linear"};else if(O[0]==="exponential"){const Ce=O[1];if(typeof Ce!="number")return x.error("Exponential interpolation requires a numeric base.",1,1);O={name:"exponential",base:Ce}}else if(O[0]==="cubic-bezier"){const Ce=O.slice(1);if(Ce.length!==4||Ce.some(Xe=>typeof Xe!="number"||Xe<0||Xe>1))return x.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);O={name:"cubic-bezier",controlPoints:Ce}}else return x.error(`Unknown interpolation type ${String(O[0])}`,1,0);if(y.length-1<4)return x.error(`Expected at least 4 arguments, but found only ${y.length-1}.`);if((y.length-1)%2!==0)return x.error("Expected an even number of arguments.");if(Q=x.parse(Q,2,tt),!Q)return null;const o=[];let re=null;k==="interpolate-hcl"||k==="interpolate-lab"?re=Yo:x.expectedType&&x.expectedType.kind!=="value"&&(re=x.expectedType);for(let Ce=0;Ce<ae.length;Ce+=2){const Xe=ae[Ce],Ge=ae[Ce+1],We=Ce+3,Ve=Ce+4;if(typeof Xe!="number")return x.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',We);if(o.length&&o[o.length-1][0]>=Xe)return x.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',We);const Ze=x.parse(Ge,Ve,re);if(!Ze)return null;re=re||Ze.type,o.push([Xe,Ze])}return re.kind!=="number"&&re.kind!=="color"&&!(re.kind==="array"&&re.itemType.kind==="number"&&typeof re.N=="number")?x.error(`Type ${Bi(re)} is not interpolatable.`):new Th(re,k,O,Q,o)}evaluate(y){const x=this.labels,k=this.outputs;if(x.length===1)return k[0].evaluate(y);const O=this.input.evaluate(y);if(O<=x[0])return k[0].evaluate(y);const Q=x.length;if(O>=x[Q-1])return k[Q-1].evaluate(y);const ae=j_(x,O),o=x[ae],re=x[ae+1],Ce=Th.interpolationFactor(this.interpolation,O,o,re),Xe=k[ae].evaluate(y),Ge=k[ae+1].evaluate(y);return this.operator==="interpolate"?g1[this.type.kind.toLowerCase()](Xe,Ge,Ce):this.operator==="interpolate-hcl"?gh.reverse(gh.interpolate(gh.forward(Xe),gh.forward(Ge),Ce)):_h.reverse(_h.interpolate(_h.forward(Xe),_h.forward(Ge),Ce))}eachChild(y){y(this.input);for(const x of this.outputs)y(x)}outputDefined(){return this.outputs.every(y=>y.outputDefined())}serialize(){let y;this.interpolation.name==="linear"?y=["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?y=["linear"]:y=["exponential",this.interpolation.base]:y=["cubic-bezier"].concat(this.interpolation.controlPoints);const x=[this.operator,y,this.input.serialize()];for(let k=0;k<this.labels.length;k++)x.push(this.labels[k],this.outputs[k].serialize());return x}}function ld(E,y,x,k){const O=k-x,Q=E-x;return O===0?0:y===1?Q/O:(Math.pow(y,Q)-1)/(Math.pow(y,O)-1)}var cd=Th;class Eh{constructor(y,x){this.type=y,this.args=x}static parse(y,x){if(y.length<2)return x.error("Expectected at least one argument.");let k=null;const O=x.expectedType;O&&O.kind!=="value"&&(k=O);const Q=[];for(const o of y.slice(1)){const re=x.parse(o,1+Q.length,k,void 0,{typeAnnotation:"omit"});if(!re)return null;k=k||re.type,Q.push(re)}return O&&Q.some(o=>Pc(O,o.type))?new Eh(Vt,Q):new Eh(k,Q)}evaluate(y){let x=null,k=0,O;for(const Q of this.args){if(k++,x=Q.evaluate(y),x&&x instanceof Jo&&!x.available&&(O||(O=x),x=null,k===this.args.length))return O;if(x!==null)break}return x}eachChild(y){this.args.forEach(y)}outputDefined(){return this.args.every(y=>y.outputDefined())}serialize(){const y=["coalesce"];return this.eachChild(x=>{y.push(x.serialize())}),y}}var I1=Eh;class Ld{constructor(y,x){this.type=x.type,this.bindings=[].concat(y),this.result=x}evaluate(y){return this.result.evaluate(y)}eachChild(y){for(const x of this.bindings)y(x[1]);y(this.result)}static parse(y,x){if(y.length<4)return x.error(`Expected at least 3 arguments, but found ${y.length-1} instead.`);const k=[];for(let Q=1;Q<y.length-1;Q+=2){const ae=y[Q];if(typeof ae!="string")return x.error(`Expected string, but found ${typeof ae} instead.`,Q);if(/[^a-zA-Z0-9_]/.test(ae))return x.error("Variable names must contain only alphanumeric characters or '_'.",Q);const o=x.parse(y[Q+1],Q+1);if(!o)return null;k.push([ae,o])}const O=x.parse(y[y.length-1],y.length-1,x.expectedType,k);return O?new Ld(k,O):null}outputDefined(){return this.result.outputDefined()}serialize(){const y=["let"];for(const[x,k]of this.bindings)y.push(x,k.serialize());return y.push(this.result.serialize()),y}}var A1=Ld;class Rd{constructor(y,x,k){this.type=y,this.index=x,this.input=k}static parse(y,x){if(y.length!==3)return x.error(`Expected 2 arguments, but found ${y.length-1} instead.`);const k=x.parse(y[1],1,tt),O=x.parse(y[2],2,xn(x.expectedType||Vt));if(!k||!O)return null;const Q=O.type;return new Rd(Q.itemType,k,O)}evaluate(y){const x=this.index.evaluate(y),k=this.input.evaluate(y);if(x<0)throw new wr(`Array index out of bounds: ${x} < 0.`);if(x>=k.length)throw new wr(`Array index out of bounds: ${x} > ${k.length-1}.`);if(x!==Math.floor(x))throw new wr(`Array index must be an integer, but found ${x} instead.`);return k[x]}eachChild(y){y(this.index),y(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var M1=Rd;class Bd{constructor(y,x){this.type=Nt,this.needle=y,this.haystack=x}static parse(y,x){if(y.length!==3)return x.error(`Expected 2 arguments, but found ${y.length-1} instead.`);const k=x.parse(y[1],1,Vt),O=x.parse(y[2],2,Vt);return!k||!O?null:wd(k.type,[Nt,Ht,tt,Ah,Vt])?new Bd(k,O):x.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(k.type)} instead`)}evaluate(y){const x=this.needle.evaluate(y),k=this.haystack.evaluate(y);if(k==null)return!1;if(!Dc(x,["boolean","string","number","null"]))throw new wr(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(ir(x))} instead.`);if(!Dc(k,["string","array"]))throw new wr(`Expected second argument to be of type array or string, but found ${Bi(ir(k))} instead.`);return k.indexOf(x)>=0}eachChild(y){y(this.needle),y(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var C1=Bd;class Sh{constructor(y,x,k){this.type=tt,this.needle=y,this.haystack=x,this.fromIndex=k}static parse(y,x){if(y.length<=2||y.length>=5)return x.error(`Expected 3 or 4 arguments, but found ${y.length-1} instead.`);const k=x.parse(y[1],1,Vt),O=x.parse(y[2],2,Vt);if(!k||!O)return null;if(!wd(k.type,[Nt,Ht,tt,Ah,Vt]))return x.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(k.type)} instead`);if(y.length===4){const Q=x.parse(y[3],3,tt);return Q?new Sh(k,O,Q):null}else return new Sh(k,O)}evaluate(y){const x=this.needle.evaluate(y),k=this.haystack.evaluate(y);if(!Dc(x,["boolean","string","number","null"]))throw new wr(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(ir(x))} instead.`);if(!Dc(k,["string","array"]))throw new wr(`Expected second argument to be of type array or string, but found ${Bi(ir(k))} instead.`);if(this.fromIndex){const O=this.fromIndex.evaluate(y);return k.indexOf(x,O)}return k.indexOf(x)}eachChild(y){y(this.needle),y(this.haystack),this.fromIndex&&y(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const y=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),y]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var k1=Sh;class Od{constructor(y,x,k,O,Q,ae){this.inputType=y,this.type=x,this.input=k,this.cases=O,this.outputs=Q,this.otherwise=ae}static parse(y,x){if(y.length<5)return x.error(`Expected at least 4 arguments, but found only ${y.length-1}.`);if(y.length%2!==1)return x.error("Expected an even number of arguments.");let k,O;x.expectedType&&x.expectedType.kind!=="value"&&(O=x.expectedType);const Q={},ae=[];for(let Ce=2;Ce<y.length-1;Ce+=2){let Xe=y[Ce];const Ge=y[Ce+1];Array.isArray(Xe)||(Xe=[Xe]);const We=x.concat(Ce);if(Xe.length===0)return We.error("Expected at least one branch label.");for(const Ze of Xe){if(typeof Ze!="number"&&typeof Ze!="string")return We.error("Branch labels must be numbers or strings.");if(typeof Ze=="number"&&Math.abs(Ze)>Number.MAX_SAFE_INTEGER)return We.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ze=="number"&&Math.floor(Ze)!==Ze)return We.error("Numeric branch labels must be integer values.");if(!k)k=ir(Ze);else if(We.checkSubtype(k,ir(Ze)))return null;if(typeof Q[String(Ze)]<"u")return We.error("Branch labels must be unique.");Q[String(Ze)]=ae.length}const Ve=x.parse(Ge,Ce,O);if(!Ve)return null;O=O||Ve.type,ae.push(Ve)}const o=x.parse(y[1],1,Vt);if(!o)return null;const re=x.parse(y[y.length-1],y.length-1,O);return!re||o.type.kind!=="value"&&x.concat(1).checkSubtype(k,o.type)?null:new Od(k,O,o,Q,ae,re)}evaluate(y){const x=this.input.evaluate(y);return(ir(x)===this.inputType&&this.outputs[this.cases[x]]||this.otherwise).evaluate(y)}eachChild(y){y(this.input),this.outputs.forEach(y),y(this.otherwise)}outputDefined(){return this.outputs.every(y=>y.outputDefined())&&this.otherwise.outputDefined()}serialize(){const y=["match",this.input.serialize()],x=Object.keys(this.cases).sort(),k=[],O={};for(const ae of x){const o=O[this.cases[ae]];o===void 0?(O[this.cases[ae]]=k.length,k.push([this.cases[ae],[ae]])):k[o][1].push(ae)}const Q=ae=>this.inputType.kind==="number"?Number(ae):ae;for(const[ae,o]of k)o.length===1?y.push(Q(o[0])):y.push(o.map(Q)),y.push(this.outputs[ae].serialize());return y.push(this.otherwise.serialize()),y}}var z1=Od;class Fd{constructor(y,x,k){this.type=y,this.branches=x,this.otherwise=k}static parse(y,x){if(y.length<4)return x.error(`Expected at least 3 arguments, but found only ${y.length-1}.`);if(y.length%2!==0)return x.error("Expected an odd number of arguments.");let k;x.expectedType&&x.expectedType.kind!=="value"&&(k=x.expectedType);const O=[];for(let ae=1;ae<y.length-1;ae+=2){const o=x.parse(y[ae],ae,Nt);if(!o)return null;const re=x.parse(y[ae+1],ae+1,k);if(!re)return null;O.push([o,re]),k=k||re.type}const Q=x.parse(y[y.length-1],y.length-1,k);return Q?new Fd(k,O,Q):null}evaluate(y){for(const[x,k]of this.branches)if(x.evaluate(y))return k.evaluate(y);return this.otherwise.evaluate(y)}eachChild(y){for(const[x,k]of this.branches)y(x),y(k);y(this.otherwise)}outputDefined(){return this.branches.every(([y,x])=>x.outputDefined())&&this.otherwise.outputDefined()}serialize(){const y=["case"];return this.eachChild(x=>{y.push(x.serialize())}),y}}var P1=Fd;class Ih{constructor(y,x,k,O){this.type=y,this.input=x,this.beginIndex=k,this.endIndex=O}static parse(y,x){if(y.length<=2||y.length>=5)return x.error(`Expected 3 or 4 arguments, but found ${y.length-1} instead.`);const k=x.parse(y[1],1,Vt),O=x.parse(y[2],2,tt);if(!k||!O)return null;if(!wd(k.type,[xn(Vt),Ht,Vt]))return x.error(`Expected first argument to be of type array or string, but found ${Bi(k.type)} instead`);if(y.length===4){const Q=x.parse(y[3],3,tt);return Q?new Ih(k.type,k,O,Q):null}else return new Ih(k.type,k,O)}evaluate(y){const x=this.input.evaluate(y),k=this.beginIndex.evaluate(y);if(!Dc(x,["string","array"]))throw new wr(`Expected first argument to be of type array or string, but found ${Bi(ir(x))} instead.`);if(this.endIndex){const O=this.endIndex.evaluate(y);return x.slice(k,O)}return x.slice(k)}eachChild(y){y(this.input),y(this.beginIndex),this.endIndex&&y(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const y=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),y]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var D1=Ih;function A_(E,y){return E==="=="||E==="!="?y.kind==="boolean"||y.kind==="string"||y.kind==="number"||y.kind==="null"||y.kind==="value":y.kind==="string"||y.kind==="number"||y.kind==="value"}function L1(E,y,x){return y===x}function R1(E,y,x){return y!==x}function B1(E,y,x){return y<x}function O1(E,y,x){return y>x}function F1(E,y,x){return y<=x}function U1(E,y,x){return y>=x}function H_(E,y,x,k){return k.compare(y,x)===0}function j1(E,y,x,k){return!H_(E,y,x,k)}function N1(E,y,x,k){return k.compare(y,x)<0}function V1(E,y,x,k){return k.compare(y,x)>0}function G1(E,y,x,k){return k.compare(y,x)<=0}function $1(E,y,x,k){return k.compare(y,x)>=0}function nl(E,y,x){const k=E!=="=="&&E!=="!=";return class Y_{constructor(Q,ae,o){this.type=Nt,this.lhs=Q,this.rhs=ae,this.collator=o,this.hasUntypedArgument=Q.type.kind==="value"||ae.type.kind==="value"}static parse(Q,ae){if(Q.length!==3&&Q.length!==4)return ae.error("Expected two or three arguments.");const o=Q[0];let re=ae.parse(Q[1],1,Vt);if(!re)return null;if(!A_(o,re.type))return ae.concat(1).error(`"${o}" comparisons are not supported for type '${Bi(re.type)}'.`);let Ce=ae.parse(Q[2],2,Vt);if(!Ce)return null;if(!A_(o,Ce.type))return ae.concat(2).error(`"${o}" comparisons are not supported for type '${Bi(Ce.type)}'.`);if(re.type.kind!==Ce.type.kind&&re.type.kind!=="value"&&Ce.type.kind!=="value")return ae.error(`Cannot compare types '${Bi(re.type)}' and '${Bi(Ce.type)}'.`);k&&(re.type.kind==="value"&&Ce.type.kind!=="value"?re=new uo(Ce.type,[re]):re.type.kind!=="value"&&Ce.type.kind==="value"&&(Ce=new uo(re.type,[Ce])));let Xe=null;if(Q.length===4){if(re.type.kind!=="string"&&Ce.type.kind!=="string"&&re.type.kind!=="value"&&Ce.type.kind!=="value")return ae.error("Cannot use collator to compare non-string types.");if(Xe=ae.parse(Q[3],3,Mh),!Xe)return null}return new Y_(re,Ce,Xe)}evaluate(Q){const ae=this.lhs.evaluate(Q),o=this.rhs.evaluate(Q);if(k&&this.hasUntypedArgument){const re=ir(ae),Ce=ir(o);if(re.kind!==Ce.kind||!(re.kind==="string"||re.kind==="number"))throw new wr(`Expected arguments for "${E}" to be (string, string) or (number, number), but found (${re.kind}, ${Ce.kind}) instead.`)}if(this.collator&&!k&&this.hasUntypedArgument){const re=ir(ae),Ce=ir(o);if(re.kind!=="string"||Ce.kind!=="string")return y(Q,ae,o)}return this.collator?x(Q,ae,o,this.collator.evaluate(Q)):y(Q,ae,o)}eachChild(Q){Q(this.lhs),Q(this.rhs),this.collator&&Q(this.collator)}outputDefined(){return!0}serialize(){const Q=[E];return this.eachChild(ae=>{Q.push(ae.serialize())}),Q}}}const q1=nl("==",L1,H_),Z1=nl("!=",R1,j1),X1=nl("<",B1,N1),W1=nl(">",O1,V1),H1=nl("<=",F1,G1),Y1=nl(">=",U1,$1);class Ud{constructor(y,x,k,O,Q,ae){this.type=Ht,this.number=y,this.locale=x,this.currency=k,this.unit=O,this.minFractionDigits=Q,this.maxFractionDigits=ae}static parse(y,x){if(y.length!==3)return x.error("Expected two arguments.");const k=x.parse(y[1],1,tt);if(!k)return null;const O=y[2];if(typeof O!="object"||Array.isArray(O))return x.error("NumberFormat options argument must be an object.");let Q=null;if(O.locale&&(Q=x.parse(O.locale,1,Ht),!Q))return null;let ae=null;if(O.currency&&(ae=x.parse(O.currency,1,Ht),!ae))return null;let o=null;if(O.unit&&(o=x.parse(O.unit,1,Ht),!o))return null;let re=null;if(O["min-fraction-digits"]&&(re=x.parse(O["min-fraction-digits"],1,tt),!re))return null;let Ce=null;return O["max-fraction-digits"]&&(Ce=x.parse(O["max-fraction-digits"],1,tt),!Ce)?null:new Ud(k,Q,ae,o,re,Ce)}evaluate(y){return new Intl.NumberFormat(this.locale?this.locale.evaluate(y):[],{style:this.currency&&"currency"||this.unit&&"unit"||"decimal",currency:this.currency?this.currency.evaluate(y):void 0,unit:this.unit?this.unit.evaluate(y):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(y):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(y):void 0}).format(this.number.evaluate(y))}eachChild(y){y(this.number),this.locale&&y(this.locale),this.currency&&y(this.currency),this.unit&&y(this.unit),this.minFractionDigits&&y(this.minFractionDigits),this.maxFractionDigits&&y(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const y={};return this.locale&&(y.locale=this.locale.serialize()),this.currency&&(y.currency=this.currency.serialize()),this.unit&&(y.unit=this.unit.serialize()),this.minFractionDigits&&(y["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(y["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),y]}}class jd{constructor(y){this.type=tt,this.input=y}static parse(y,x){if(y.length!==2)return x.error(`Expected 1 argument, but found ${y.length-1} instead.`);const k=x.parse(y[1],1);return k?k.type.kind!=="array"&&k.type.kind!=="string"&&k.type.kind!=="value"?x.error(`Expected argument of type string or array, but found ${Bi(k.type)} instead.`):new jd(k):null}evaluate(y){const x=this.input.evaluate(y);if(typeof x=="string")return x.length;if(Array.isArray(x))return x.length;throw new wr(`Expected value to be of type string or array, but found ${Bi(ir(x))} instead.`)}eachChild(y){y(this.input)}outputDefined(){return!1}serialize(){const y=["length"];return this.eachChild(x=>{y.push(x.serialize())}),y}}var K1=jd;const J1={"==":q1,"!=":Z1,">":W1,"<":X1,">=":Y1,"<=":H1,array:uo,at:M1,boolean:uo,case:P1,coalesce:I1,collator:Dh,format:kh,image:zh,in:C1,"index-of":k1,interpolate:cd,"interpolate-hcl":cd,"interpolate-lab":cd,length:K1,let:A1,literal:bh,match:z1,number:uo,"number-format":Ud,object:uo,slice:D1,step:d1,string:uo,"to-boolean":Qa,"to-color":Qa,"to-number":Qa,"to-string":Qa,var:U_,within:kd};function M_(E,[y,x,k,O]){y=y.evaluate(E),x=x.evaluate(E),k=k.evaluate(E);const Q=O?O.evaluate(E):1,ae=D_(y,x,k,Q);if(ae)throw new wr(ae);return new $n(y/255*Q,x/255*Q,k/255*Q,Q)}function C_(E,y){return E in y}function ud(E,y){const x=y[E];return typeof x>"u"?null:x}function Q1(E,y,x,k){for(;x<=k;){const O=x+k>>1;if(y[O]===E)return!0;y[O]>E?k=O-1:x=O+1}return!1}function Xs(E){return{type:E}}Ph.register(J1,{error:[G0,[Ht],(E,[y])=>{throw new wr(y.evaluate(E))}],typeof:[Ht,[Vt],(E,[y])=>Bi(ir(y.evaluate(E)))],"to-rgba":[xn(tt,4),[Yo],(E,[y])=>y.evaluate(E).toArray()],rgb:[Yo,[tt,tt,tt],M_],rgba:[Yo,[tt,tt,tt,tt],M_],has:{type:Nt,overloads:[[[Ht],(E,[y])=>C_(y.evaluate(E),E.properties())],[[Ht,il],(E,[y,x])=>C_(y.evaluate(E),x.evaluate(E))]]},get:{type:Vt,overloads:[[[Ht],(E,[y])=>ud(y.evaluate(E),E.properties())],[[Ht,il],(E,[y,x])=>ud(y.evaluate(E),x.evaluate(E))]]},"feature-state":[Vt,[Ht],(E,[y])=>ud(y.evaluate(E),E.featureState||{})],properties:[il,[],E=>E.properties()],"geometry-type":[Ht,[],E=>E.geometryType()],id:[Vt,[],E=>E.id()],zoom:[tt,[],E=>E.globals.zoom],pitch:[tt,[],E=>E.globals.pitch||0],"distance-from-center":[tt,[],E=>E.distanceFromCenter()],"heatmap-density":[tt,[],E=>E.globals.heatmapDensity||0],"line-progress":[tt,[],E=>E.globals.lineProgress||0],"sky-radial-progress":[tt,[],E=>E.globals.skyRadialProgress||0],accumulated:[Vt,[],E=>E.globals.accumulated===void 0?null:E.globals.accumulated],"+":[tt,Xs(tt),(E,y)=>{let x=0;for(const k of y)x+=k.evaluate(E);return x}],"*":[tt,Xs(tt),(E,y)=>{let x=1;for(const k of y)x*=k.evaluate(E);return x}],"-":{type:tt,overloads:[[[tt,tt],(E,[y,x])=>y.evaluate(E)-x.evaluate(E)],[[tt],(E,[y])=>-y.evaluate(E)]]},"/":[tt,[tt,tt],(E,[y,x])=>y.evaluate(E)/x.evaluate(E)],"%":[tt,[tt,tt],(E,[y,x])=>y.evaluate(E)%x.evaluate(E)],ln2:[tt,[],()=>Math.LN2],pi:[tt,[],()=>Math.PI],e:[tt,[],()=>Math.E],"^":[tt,[tt,tt],(E,[y,x])=>Math.pow(y.evaluate(E),x.evaluate(E))],sqrt:[tt,[tt],(E,[y])=>Math.sqrt(y.evaluate(E))],log10:[tt,[tt],(E,[y])=>Math.log(y.evaluate(E))/Math.LN10],ln:[tt,[tt],(E,[y])=>Math.log(y.evaluate(E))],log2:[tt,[tt],(E,[y])=>Math.log(y.evaluate(E))/Math.LN2],sin:[tt,[tt],(E,[y])=>Math.sin(y.evaluate(E))],cos:[tt,[tt],(E,[y])=>Math.cos(y.evaluate(E))],tan:[tt,[tt],(E,[y])=>Math.tan(y.evaluate(E))],asin:[tt,[tt],(E,[y])=>Math.asin(y.evaluate(E))],acos:[tt,[tt],(E,[y])=>Math.acos(y.evaluate(E))],atan:[tt,[tt],(E,[y])=>Math.atan(y.evaluate(E))],min:[tt,Xs(tt),(E,y)=>Math.min(...y.map(x=>x.evaluate(E)))],max:[tt,Xs(tt),(E,y)=>Math.max(...y.map(x=>x.evaluate(E)))],abs:[tt,[tt],(E,[y])=>Math.abs(y.evaluate(E))],round:[tt,[tt],(E,[y])=>{const x=y.evaluate(E);return x<0?-Math.round(-x):Math.round(x)}],floor:[tt,[tt],(E,[y])=>Math.floor(y.evaluate(E))],ceil:[tt,[tt],(E,[y])=>Math.ceil(y.evaluate(E))],"filter-==":[Nt,[Ht,Vt],(E,[y,x])=>E.properties()[y.value]===x.value],"filter-id-==":[Nt,[Vt],(E,[y])=>E.id()===y.value],"filter-type-==":[Nt,[Ht],(E,[y])=>E.geometryType()===y.value],"filter-<":[Nt,[Ht,Vt],(E,[y,x])=>{const k=E.properties()[y.value],O=x.value;return typeof k==typeof O&&k<O}],"filter-id-<":[Nt,[Vt],(E,[y])=>{const x=E.id(),k=y.value;return typeof x==typeof k&&x<k}],"filter->":[Nt,[Ht,Vt],(E,[y,x])=>{const k=E.properties()[y.value],O=x.value;return typeof k==typeof O&&k>O}],"filter-id->":[Nt,[Vt],(E,[y])=>{const x=E.id(),k=y.value;return typeof x==typeof k&&x>k}],"filter-<=":[Nt,[Ht,Vt],(E,[y,x])=>{const k=E.properties()[y.value],O=x.value;return typeof k==typeof O&&k<=O}],"filter-id-<=":[Nt,[Vt],(E,[y])=>{const x=E.id(),k=y.value;return typeof x==typeof k&&x<=k}],"filter->=":[Nt,[Ht,Vt],(E,[y,x])=>{const k=E.properties()[y.value],O=x.value;return typeof k==typeof O&&k>=O}],"filter-id->=":[Nt,[Vt],(E,[y])=>{const x=E.id(),k=y.value;return typeof x==typeof k&&x>=k}],"filter-has":[Nt,[Vt],(E,[y])=>y.value in E.properties()],"filter-has-id":[Nt,[],E=>E.id()!==null&&E.id()!==void 0],"filter-type-in":[Nt,[xn(Ht)],(E,[y])=>y.value.indexOf(E.geometryType())>=0],"filter-id-in":[Nt,[xn(Vt)],(E,[y])=>y.value.indexOf(E.id())>=0],"filter-in-small":[Nt,[Ht,xn(Vt)],(E,[y,x])=>x.value.indexOf(E.properties()[y.value])>=0],"filter-in-large":[Nt,[Ht,xn(Vt)],(E,[y,x])=>Q1(E.properties()[y.value],x.value,0,x.value.length-1)],all:{type:Nt,overloads:[[[Nt,Nt],(E,[y,x])=>y.evaluate(E)&&x.evaluate(E)],[Xs(Nt),(E,y)=>{for(const x of y)if(!x.evaluate(E))return!1;return!0}]]},any:{type:Nt,overloads:[[[Nt,Nt],(E,[y,x])=>y.evaluate(E)||x.evaluate(E)],[Xs(Nt),(E,y)=>{for(const x of y)if(x.evaluate(E))return!0;return!1}]]},"!":[Nt,[Nt],(E,[y])=>!y.evaluate(E)],"is-supported-script":[Nt,[Ht],(E,[y])=>{const x=E.globals&&E.globals.isSupportedScript;return x?x(y.evaluate(E)):!0}],upcase:[Ht,[Ht],(E,[y])=>y.evaluate(E).toUpperCase()],downcase:[Ht,[Ht],(E,[y])=>y.evaluate(E).toLowerCase()],concat:[Ht,Xs(Vt),(E,y)=>y.map(x=>Cc(x.evaluate(E))).join("")],"resolved-locale":[Ht,[Mh],(E,[y])=>y.evaluate(E).resolvedLocale()]});function ex(E){throw new Error('Could not dynamically require "'+E+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var tx={};(function(E){var y=function(){var x=function(Ct,rt,Ne,at){for(Ne=Ne||{},at=Ct.length;at--;Ne[Ct[at]]=rt);return Ne},k=[1,12],O=[1,13],Q=[1,9],ae=[1,10],o=[1,11],re=[1,14],Ce=[1,15],Xe=[14,18,22,24],Ge=[18,22],We=[22,24],Ve={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(rt,Ne,at,St,Se,dt,Pi){var kt=dt.length-1;switch(Se){case 1:this.$=new String(rt.replace(/\\(\\|")/g,"$1").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(rt),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=dt[kt-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=dt[kt-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[dt[kt-2],dt[kt]];break;case 16:this.$={},this.$[dt[kt][0]]=dt[kt][1];break;case 17:this.$=dt[kt-2],dt[kt-2][dt[kt][0]]=dt[kt][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[dt[kt]];break;case 21:this.$=dt[kt-2],dt[kt-2].push(dt[kt]);break}},table:[{3:5,4:k,5:6,6:O,7:3,8:Q,9:4,10:ae,11:o,12:1,13:2,15:7,16:8,17:re,23:Ce},{1:[3]},{14:[1,16]},x(Xe,[2,7]),x(Xe,[2,8]),x(Xe,[2,9]),x(Xe,[2,10]),x(Xe,[2,11]),x(Xe,[2,12]),x(Xe,[2,3]),x(Xe,[2,4]),x(Xe,[2,5]),x([14,18,21,22,24],[2,1]),x(Xe,[2,2]),{3:20,4:k,18:[1,17],19:18,20:19},{3:5,4:k,5:6,6:O,7:3,8:Q,9:4,10:ae,11:o,13:23,15:7,16:8,17:re,23:Ce,24:[1,21],25:22},{1:[2,6]},x(Xe,[2,13]),{18:[1,24],22:[1,25]},x(Ge,[2,16]),{21:[1,26]},x(Xe,[2,18]),{22:[1,28],24:[1,27]},x(We,[2,20]),x(Xe,[2,14]),{3:20,4:k,20:29},{3:5,4:k,5:6,6:O,7:3,8:Q,9:4,10:ae,11:o,13:30,15:7,16:8,17:re,23:Ce},x(Xe,[2,19]),{3:5,4:k,5:6,6:O,7:3,8:Q,9:4,10:ae,11:o,13:31,15:7,16:8,17:re,23:Ce},x(Ge,[2,17]),x(Ge,[2,15]),x(We,[2,21])],defaultActions:{16:[2,6]},parseError:function(rt,Ne){if(Ne.recoverable)this.trace(rt);else throw new Error(rt)},parse:function(rt){var Ne=this,at=[0],St=[null],Se=[],dt=this.table,Pi="",kt=0,gt=0,ei=2,rr=1,Tr=Se.slice.call(arguments,1),ii=Object.create(this.lexer),ji={yy:{}};for(var Tt in this.yy)Object.prototype.hasOwnProperty.call(this.yy,Tt)&&(ji.yy[Tt]=this.yy[Tt]);ii.setInput(rt,ji.yy),ji.yy.lexer=ii,ji.yy.parser=this,typeof ii.yylloc>"u"&&(ii.yylloc={});var Wi=ii.yylloc;Se.push(Wi);var fr=ii.options&&ii.options.ranges;typeof ji.yy.parseError=="function"?this.parseError=ji.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function Mr(){var Ai;return Ai=ii.lex()||rr,typeof Ai!="number"&&(Ai=Ne.symbols_[Ai]||Ai),Ai}for(var Si,Ye,ft,Ot,Ut={},Gt,ti,gi,ri;;){if(Ye=at[at.length-1],this.defaultActions[Ye]?ft=this.defaultActions[Ye]:((Si===null||typeof Si>"u")&&(Si=Mr()),ft=dt[Ye]&&dt[Ye][Si]),typeof ft>"u"||!ft.length||!ft[0]){var Ii="";ri=[];for(Gt in dt[Ye])this.terminals_[Gt]&&Gt>ei&&ri.push("'"+this.terminals_[Gt]+"'");ii.showPosition?Ii="Parse error on line "+(kt+1)+`:
`+ii.showPosition()+`
Expecting `+ri.join(", ")+", got '"+(this.terminals_[Si]||Si)+"'":Ii="Parse error on line "+(kt+1)+": Unexpected "+(Si==rr?"end of input":"'"+(this.terminals_[Si]||Si)+"'"),this.parseError(Ii,{text:ii.match,token:this.terminals_[Si]||Si,line:ii.yylineno,loc:Wi,expected:ri})}if(ft[0]instanceof Array&&ft.length>1)throw new Error("Parse Error: multiple actions possible at state: "+Ye+", token: "+Si);switch(ft[0]){case 1:at.push(Si),St.push(ii.yytext),Se.push(ii.yylloc),at.push(ft[1]),Si=null,gt=ii.yyleng,Pi=ii.yytext,kt=ii.yylineno,Wi=ii.yylloc;break;case 2:if(ti=this.productions_[ft[1]][1],Ut.$=St[St.length-ti],Ut._$={first_line:Se[Se.length-(ti||1)].first_line,last_line:Se[Se.length-1].last_line,first_column:Se[Se.length-(ti||1)].first_column,last_column:Se[Se.length-1].last_column},fr&&(Ut._$.range=[Se[Se.length-(ti||1)].range[0],Se[Se.length-1].range[1]]),Ot=this.performAction.apply(Ut,[Pi,gt,kt,ji.yy,ft[1],St,Se].concat(Tr)),typeof Ot<"u")return Ot;ti&&(at=at.slice(0,-1*ti*2),St=St.slice(0,-1*ti),Se=Se.slice(0,-1*ti)),at.push(this.productions_[ft[1]][0]),St.push(Ut.$),Se.push(Ut._$),gi=dt[at[at.length-2]][at[at.length-1]],at.push(gi);break;case 3:return!0}}return!0}},Ze=function(){var Ct={EOF:1,parseError:function(Ne,at){if(this.yy.parser)this.yy.parser.parseError(Ne,at);else throw new Error(Ne)},setInput:function(rt,Ne){return this.yy=Ne||this.yy||{},this._input=rt,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var rt=this._input[0];this.yytext+=rt,this.yyleng++,this.offset++,this.match+=rt,this.matched+=rt;var Ne=rt.match(/(?:\r\n?|\n).*/g);return Ne?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),rt},unput:function(rt){var Ne=rt.length,at=rt.split(/(?:\r\n?|\n)/g);this._input=rt+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-Ne),this.offset-=Ne;var St=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),at.length-1&&(this.yylineno-=at.length-1);var Se=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:at?(at.length===St.length?this.yylloc.first_column:0)+St[St.length-at.length].length-at[0].length:this.yylloc.first_column-Ne},this.options.ranges&&(this.yylloc.range=[Se[0],Se[0]+this.yyleng-Ne]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(rt){this.unput(this.match.slice(rt))},pastInput:function(){var rt=this.matched.substr(0,this.matched.length-this.match.length);return(rt.length>20?"...":"")+rt.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var rt=this.match;return rt.length<20&&(rt+=this._input.substr(0,20-rt.length)),(rt.substr(0,20)+(rt.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var rt=this.pastInput(),Ne=new Array(rt.length+1).join("-");return rt+this.upcomingInput()+`
`+Ne+"^"},test_match:function(rt,Ne){var at,St,Se;if(this.options.backtrack_lexer&&(Se={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(Se.yylloc.range=this.yylloc.range.slice(0))),St=rt[0].match(/(?:\r\n?|\n).*/g),St&&(this.yylineno+=St.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:St?St[St.length-1].length-St[St.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+rt[0].length},this.yytext+=rt[0],this.match+=rt[0],this.matches=rt,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(rt[0].length),this.matched+=rt[0],at=this.performAction.call(this,this.yy,this,Ne,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),at)return at;if(this._backtrack){for(var dt in Se)this[dt]=Se[dt];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var rt,Ne,at,St;this._more||(this.yytext="",this.match="");for(var Se=this._currentRules(),dt=0;dt<Se.length;dt++)if(at=this._input.match(this.rules[Se[dt]]),at&&(!Ne||at[0].length>Ne[0].length)){if(Ne=at,St=dt,this.options.backtrack_lexer){if(rt=this.test_match(at,Se[dt]),rt!==!1)return rt;if(this._backtrack){Ne=!1;continue}else return!1}else if(!this.options.flex)break}return Ne?(rt=this.test_match(Ne,Se[St]),rt!==!1?rt:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var Ne=this.next();return Ne||this.lex()},begin:function(Ne){this.conditionStack.push(Ne)},popState:function(){var Ne=this.conditionStack.length-1;return Ne>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(Ne){return Ne=this.conditionStack.length-1-Math.abs(Ne||0),Ne>=0?this.conditionStack[Ne]:"INITIAL"},pushState:function(Ne){this.begin(Ne)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(Ne,at,St,Se){switch(St){case 0:break;case 1:return 6;case 2:return at.yytext=at.yytext.substr(1,at.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return Ct}();Ve.lexer=Ze;function Ft(){this.yy={}}return Ft.prototype=Ve,Ve.Parser=Ft,new Ft}();typeof ex<"u"&&(E.parser=y,E.Parser=y.Parser,E.parse=function(){return y.parse.apply(y,arguments)})})(tx);xd.accessToken="pk.eyJ1Ijoib2drZGV2IiwiYSI6ImNsZHVzaXY2djA4eWozc3Fsbzl5M25qcjUifQ.TQMXg0p1ZjSkcUdpTUsNlQ";let ai=null;ai=new xd.Map({container:"map",style:"mapbox://styles/mapbox/satellite-v9",projection:"globe",zoom:2,minZoom:2,center:[-45.37257355955616,-21.968033674683838]});ai.on("load",()=>{ai.touchZoomRotate.enable({around:"center"}),ai.setFog({color:"rgb(100, 100, 100)","high-color":"rgb(50, 50, 50)","horizon-blend":.02,"space-color":"rgb(0, 0, 0)","star-intensity":.2}),E={};var E={type:"FeatureCollection",features:[{type:"Feature",properties:{place:"santa-cruz-area",name:"Province of Santa Cruz",country:"argentina",continent:"South America"},geometry:{coordinates:[-70.27305275992737,-48.64001645604238],type:"Point"}},{type:"Feature",properties:{place:"torres-del-paine-area",name:"Torres del Paine",country:"chile",continent:"South America"},geometry:{coordinates:[-73.17793051664984,-50.96870690754686],type:"Point"}},{type:"Feature",properties:{place:"ibera-wetlands-area",name:"Ibera Wetlands",country:"argentina",continent:"South America"},geometry:{coordinates:[-57.131741920441584,-28.15269934779628],type:"Point"}},{type:"Feature",properties:{place:"andalucia-area",name:"Andalucia/Castilla de la Mancha",country:"spain",continent:"Europe"},geometry:{coordinates:[-3.886375512792597,38.03129448745335],type:"Point"}},{type:"Feature",properties:{place:"aguapey-river-basin",name:"Aguapey River Basin",country:"Argentina",continent:"South America"},geometry:{coordinates:[-56.52111153733962,-28.299430332602597],type:"Point"}},{type:"Feature",properties:{place:"bahia-lomas",name:"Bahia Lomas",country:"Argentina",continent:"South America"},geometry:{coordinates:[-69.07485463220233,-52.55744532275889],type:"Point"}},{type:"Feature",properties:{place:"peninsula-valdes",name:"Peninsula Valdes",country:"Argentina",continent:"South America"},geometry:{coordinates:[-63.89775737980409,-42.532684755412276],type:"Point"}},{type:"Feature",properties:{place:"lago-la-plata",name:"Lago la Plata",country:"Argentina",continent:"South America"},geometry:{coordinates:[-71.77123429715127,-44.85615759403982],type:"Point"},id:14}]};y={};var y={type:"FeatureCollection",features:[{type:"Feature",properties:{place:"santa-cruz-area",country:"argentina",continent:"South America"},geometry:{type:"Polygon",coordinates:[[[-67.598876953125,-46.01985337287632],[-71.60888671875,-45.98169518512228],[-71.7626953125,-46.10370875598025],[-71.9384765625,-46.13417004624325],[-71.78466796874999,-46.21785176740299],[-71.641845703125,-46.68713141244413],[-71.883544921875,-46.8000594467873],[-71.97143554687499,-46.8000594467873],[-71.8505859375,-47.21210577562242],[-72.037353515625,-47.19717795172787],[-72.037353515625,-47.353710619513606],[-72.1142578125,-47.31648293428332],[-72.35595703125,-47.46523622438362],[-72.322998046875,-47.613569753973955],[-72.520751953125,-47.76886840424206],[-72.564697265625,-47.95314495015593],[-72.44384765625,-47.98992166741417],[-72.257080078125,-48.34164617237459],[-72.432861328125,-48.52388120259334],[-72.57568359375,-48.451065619532145],[-72.5537109375,-48.78515199804314],[-72.83935546875,-48.98021698537499],[-72.894287109375,-48.944151234187935],[-73.135986328125,-49.2032427441791],[-73.0810546875,-49.274972875996376],[-73.47656249999999,-49.210420445650286],[-73.5205078125,-49.26780455063752],[-73.41064453125,-49.35375571830991],[-73.54248046875,-49.55372551347578],[-73.45458984375,-49.80963156356309],[-73.564453125,-49.95121990866204],[-73.45458984375,-49.96535590991309],[-73.531494140625,-50.14170587960566],[-73.41064453125,-50.24017888479702],[-73.42163085937499,-50.34546040860478],[-73.36669921875,-50.57626025689926],[-73.17993164062499,-50.625073063414355],[-73.1689453125,-50.79899141148548],[-72.79541015625,-50.639010281258706],[-72.59765625,-50.68775800806201],[-72.4658203125,-50.59718623058701],[-72.279052734375,-50.67383524992133],[-72.3779296875,-50.736455137010644],[-72.2900390625,-51.03448563297413],[-72.388916015625,-51.020666012558095],[-72.388916015625,-51.13800148806255],[-72.26806640624999,-51.26878915771343],[-72.3779296875,-51.35806157319091],[-72.301025390625,-51.39920565355377],[-72.421875,-51.570241445811234],[-72.2900390625,-51.618016548773696],[-72.2900390625,-51.692990211491846],[-71.927490234375,-51.923943445544694],[-72.02636718749999,-51.971345808851716],[-69.9609375,-51.99841038239032],[-69.521484375,-52.15371445951162],[-69.169921875,-52.146973340644706],[-68.895263671875,-52.274880130680536],[-68.4228515625,-52.35547370875268],[-68.35693359375,-52.32862548843016],[-68.9501953125,-51.68617954855623],[-68.9501953125,-51.52241608253253],[-69.18090820312499,-50.965346321637696],[-69.3896484375,-51.082821861609766],[-69.136962890625,-50.847572953653874],[-68.93920898437499,-50.324422739309384],[-68.367919921875,-50.13466432216695],[-68.64257812499999,-49.83798245308484],[-68.291015625,-50.12057809796008],[-67.752685546875,-49.85215166776998],[-67.6318359375,-49.26780455063752],[-67.598876953125,-49.0738659012854],[-67.203369140625,-48.821332549646634],[-67.159423828125,-48.64016871811908],[-66.873779296875,-48.60385760823253],[-66.46728515624999,-48.400032496106846],[-66.478271484375,-48.327039130634766],[-66.37939453125,-48.363548888986884],[-66.192626953125,-48.12943437745314],[-65.93994140625,-48.08541857551197],[-66.02783203125,-48.01197512670994],[-65.9619140625,-47.93106634750977],[-65.841064453125,-47.975214123416166],[-65.775146484375,-47.91634204016117],[-65.906982421875,-47.75409797968002],[-65.709228515625,-47.36115300722623],[-65.753173828125,-47.18224592701489],[-65.928955078125,-47.055154085503474],[-66.192626953125,-47.070121823833084],[-66.632080078125,-47.04766864046081],[-67.39013671875,-46.59661864884464],[-67.576904296875,-46.36967413462374],[-67.6318359375,-46.21785176740299],[-67.598876953125,-46.01985337287632]]]}},{type:"Feature",properties:{place:"andalucia-area",country:"Spain",continent:"Europe"},geometry:{coordinates:[[[-7.420304238197446,37.17501674294009],[-7.112516088033146,37.223887187121264],[-6.6247294143444435,37.06639103702412],[-6.346876245788309,36.78998454963704],[-6.414795909213069,36.71577704340035],[-6.390097849785803,36.6315884689314],[-6.173989829797307,36.33869080332006],[-6.087546621801209,36.179368390302514],[-5.9084856909542225,36.189335558675964],[-5.815867965114677,36.0945962720794],[-5.630632519410597,36.009732608895476],[-5.408349984565007,36.10457421580722],[-5.346604835996175,36.19431867023921],[-5.223114538859761,36.3536106167805],[-4.96378491487377,36.48776020265552],[-4.642710142318975,36.502651402846155],[-4.364855776887708,36.710824416061755],[-4.0889452702561755,36.74051794489746],[-3.8666627350392275,36.7553603978448],[-3.7802195270442667,36.70092401384464],[-3.551762477341555,36.71577412735395],[-3.4653192693466224,36.681119398854946],[-3.348003487067274,36.730621370886325],[-2.9274579027315895,36.72145772819562],[-2.8595381635592787,36.657091146099646],[-2.6743027178551984,36.6719497250635],[-2.5693359652889285,36.79565961498163],[-2.359402460157554,36.820377664881946],[-2.198865073879574,36.721457600957095],[-2.1247708955988287,36.73630374582045],[-1.9024883607532388,36.97345136576378],[-1.791347093329847,37.21969678508887],[-1.6061116476257666,37.32288103574179],[-1.6802058259076205,37.40630752348379],[-1.9024883607532388,37.53372146662555],[-2.001280598462415,37.84155352586123],[-2.198865073879574,37.90978701886161],[-2.3347044007302316,38.0120187048598],[-2.0630257470300535,38.27424610912027],[-1.928956437213401,38.30301552535232],[-1.6881502523787901,38.36113713786824],[-1.5523109255292695,38.332082146623065],[-1.4967402918175878,38.36113713786824],[-1.4411696581058777,38.54971031706097],[-1.379424509538211,38.67997207158126],[-1.1447929449795708,38.7185227087607],[-.885463320992443,38.636577770350556],[-.910161380419737,38.920572439162214],[-1.1077458558380613,38.94458778034718],[-1.2457893570870056,39.03087672728981],[-1.15934636487151,39.32285135973143],[-1.486595652282233,39.42308650074392],[-1.5483408008510366,39.51841471087354],[-1.332232780861375,39.64690053362665],[-1.2210915134391485,39.82258659871286],[-1.1284737905871225,40.00255455636312],[-1.356930840288669,40.01674240939661],[-1.4063269591432572,40.19148336839828],[-1.5174682265665922,40.19148336839828],[-1.7767978505526116,40.379887343166615],[-1.6656562928183973,40.577146220021774],[-1.5051189065404174,40.577146220021774],[-1.548340510537912,40.86727757895579],[-1.9682075208018261,41.17473633158065],[-2.0916978179382966,41.09102630274279],[-2.412772689317052,41.063099110153956],[-2.85733775900826,41.27690338455989],[-3.3142518584136837,41.2629808982615],[-3.443916670406111,41.12359277942292],[-3.456265700120298,40.755118580919884],[-3.2031105909903204,40.506763109085625],[-3.0796202938538784,40.262196464995526],[-3.0796202938538784,40.082913462780056],[-3.406869581265738,40.04983600116398],[-3.7094208092491954,39.91262975618153],[-3.585930512112725,40.111252788208645],[-4.153985878940404,40.30458884129433],[-4.524456770349758,40.266908041791766],[-4.907276691472163,40.15845876685853],[-5.364190790877586,40.14430041642564],[-5.401237880017931,39.92683628092726],[-5.314794672022998,39.808358538024834],[-5.16043180060214,39.81784428629388],[-5.216002434313822,39.58030806207037],[-4.913451206329256,39.370600397092346],[-4.623249008058906,39.45646630176935],[-4.789960909192843,39.198551490480554],[-4.913451206329256,39.05485473793803],[-4.907276691472163,38.785837091288045],[-5.067814077750114,38.75213820137873],[-5.586473325722039,38.40459801889796],[-5.512379147440157,38.23989782723561],[-5.703789108002525,38.19623810316975],[-5.944595187418315,38.00674342443216],[-6.142179662836611,37.972679559064886],[-6.3953347719655085,38.04565418581922],[-6.876946930798198,38.225347496727835],[-7.185672673638749,37.99701250544756],[-7.5437945353338876,37.572469298527466],[-7.420304238197446,37.17501674294009]]],type:"Polygon"}},{type:"Feature",properties:{place:"torres-del-paine-area",country:"chile",continent:"South America"},geometry:{coordinates:[[[-72.72444560541972,-50.934621448501524],[-72.70024577919477,-50.93221516453114],[-72.7095481575007,-50.892224860064694],[-72.7129308405209,-50.880487852474474],[-72.72223321882683,-50.87621911653744],[-72.7235017249596,-50.866879893339664],[-72.74802617685722,-50.86474495100347],[-72.75394587214296,-50.86127546118187],[-72.77576917560744,-50.805194547453695],[-72.88020951386119,-50.792901057006524],[-72.8907803982999,-50.77846544139737],[-72.92883558227938,-50.78220843639777],[-72.94744033889124,-50.7546636807828],[-72.98422701673792,-50.74984836932966],[-73.01551683467646,-50.760013445875714],[-73.04680665261445,-50.7624206406569],[-73.07259961064484,-50.78808968037599],[-73.09796973329765,-50.77338518324999],[-73.11995717293024,-50.77819807314749],[-73.18126830267452,-50.80759941731876],[-73.20917545279538,-50.818286228722926],[-73.24260405496581,-50.82340412724006],[-73.47301346532404,-50.885263336227325],[-73.41739400004974,-50.99874430186487],[-73.54163812739367,-51.07838825595316],[-73.48651280829311,-51.28999408182149],[-73.37355182755559,-51.28583419366587],[-73.22727720614053,-51.2340714102336],[-73.18824377206468,-51.24628998977803],[-73.16069351699277,-51.2539543168489],[-73.09739677465006,-51.24895120903634],[-73.09108066686134,-51.25238889817539],[-73.08119458510414,-51.25015442946927],[-73.08421533230758,-51.24551326289661],[-73.06609084908683,-51.238120808391756],[-73.06334471526588,-51.238120808391756],[-73.05812706100512,-51.23485399654314],[-73.04219948484096,-51.231758908183416],[-73.04000257778435,-51.22986736280422],[-73.03148956293761,-51.23313452871255],[-73.03148956293761,-51.23794887670886],[-73.0295672692628,-51.239840089877326],[-73.02599729529501,-51.23691727311871],[-73.01913196074196,-51.2351978823978],[-73.01528737339164,-51.24069970652407],[-73.01199201280637,-51.24138738827616],[-73.00897126560292,-51.23794887670886],[-73.002929771196,-51.23794887670886],[-72.99826134369953,-51.23932431217858],[-72.99633905002474,-51.231071082496314],[-72.98727680841436,-51.23365037580935],[-72.98111784807168,-51.228086177329835],[-72.97601874153956,-51.22803716203676],[-72.97166060103473,-51.23288875355736],[-72.96899729364158,-51.22606605613926],[-72.97516187467735,-51.22291174177064],[-72.95676083975555,-51.21244758999173],[-72.85092850314429,-51.21357523420688],[-72.84462600205845,-51.21391188476422],[-72.8395449159115,-51.21455457444751],[-72.83856778396029,-51.214309741339854],[-72.83886092354564,-51.214003698125204],[-72.83847007076503,-51.213636443582274],[-72.83432923739656,-51.19528320640433],[-72.83017642586374,-51.17697069791977],[-72.82724504587058,-51.16462561067512],[-72.82255482261432,-51.144308678184075],[-72.82030973284301,-51.132935131314625],[-72.81845318331641,-51.126005841020245],[-72.82153114896337,-51.123491416638785],[-72.82280142049986,-51.12079285772099],[-72.81928374547518,-51.12079285772099],[-72.82033161443981,-51.11400509873247],[-72.81544186962267,-51.10512587683613],[-72.80355790494549,-51.099456990450115],[-72.78354757691024,-51.07063148925523],[-72.76770996620682,-51.03662015994485],[-72.77203726995864,-51.0266906773852],[-72.78145210119513,-51.02051127122286],[-72.7849022567412,-51.01995949847437],[-72.79484338289102,-51.01863521708493],[-72.7951942461668,-51.0155818686393],[-72.7930305892989,-51.01363203492721],[-72.79648077263333,-51.00914341860589],[-72.79320604754699,-51.004139211749376],[-72.79034066412757,-50.99431320700582],[-72.79402473983505,-50.988828865686614],[-72.79512845743137,-50.98092552841134],[-72.79579221485298,-50.978209178888655],[-72.79263936747451,-50.97256702164996],[-72.77886640261075,-50.97120862215424],[-72.75795800752965,-50.961385222476565],[-72.73704965123096,-50.946541594685925],[-72.72800755722814,-50.943614122624425],[-72.72444560541972,-50.934621448501524]]],type:"Polygon"}},{type:"Feature",properties:{place:"ibera-wetlands-area",country:"argentina",continent:"South America"},geometry:{coordinates:[[[-58.52541116467003,-28.918022054059975],[-58.520544834704594,-28.96293131256357],[-58.49355882307793,-28.97879975566805],[-58.38163323387279,-28.9768647099569],[-58.354647222246086,-28.963318376708557],[-58.322352487020694,-28.973768561543267],[-58.22325631317874,-28.972220452594122],[-57.93814276513031,-28.8965848313223],[-57.69175597673478,-28.764462064415113],[-57.53691820510636,-28.703170958428615],[-57.48869728242562,-28.688424697530905],[-57.436448392693435,-28.683359076695318],[-57.389111937715825,-28.66006953355094],[-57.34929651072598,-28.648423131429283],[-57.28028310394306,-28.61153432642861],[-57.21348166532594,-28.557536829738382],[-57.179859749201285,-28.584733279486542],[-57.159952035705814,-28.574632561667244],[-57.13606277951202,-28.532665354128824],[-57.086514278326604,-28.49962314609273],[-57.058201085800675,-28.48834779380517],[-56.95998969922472,-28.419503168983667],[-56.91044161230401,-28.387983057947586],[-56.83390751375606,-28.352560394300554],[-56.76226864462738,-28.26304307615176],[-56.73174348393508,-28.170655386477236],[-56.70170427881203,-28.142610760848022],[-56.69418358704699,-28.126615785298654],[-56.67206390538573,-28.10281396489855],[-56.64552028739227,-28.06729651592451],[-56.62738214843043,-28.04152925982371],[-56.587930620455666,-28.000097849098232],[-56.530419448136655,-27.957903709961847],[-56.496210253035656,-27.825139075881793],[-56.49258016055006,-27.593940444773125],[-56.53903149203845,-27.555118398203447],[-56.59300351529183,-27.545704924722358],[-56.62883739958282,-27.569237095372664],[-56.64918750671103,-27.5896275624919],[-56.70138995543191,-27.636668013859307],[-56.77839834269601,-27.66465574559537],[-56.922618667127054,-27.657210925672246],[-56.97066627890503,-27.645999980909252],[-57.05383628195145,-27.58328023573796],[-57.15072048762704,-27.6236601903436],[-57.16879257537083,-27.640125336310447],[-57.18426167695415,-27.688294914120696],[-57.21642466632869,-27.726058408458222],[-57.30780635018522,-27.824445476709954],[-57.375793958488586,-27.896241188695242],[-57.42692391312623,-27.92593845149709],[-57.460770502816416,-27.95096266711503],[-57.48189417150137,-27.975557204494187],[-57.50301828421547,-28.011802554546556],[-57.52726309930661,-28.08849238526532],[-57.55414833367007,-28.16766676838182],[-57.584117059734,-28.245958640282367],[-57.61572338572532,-28.30322880845587],[-57.616449976679874,-28.308186524901693],[-57.69982522416244,-28.36174702298114],[-57.75886022107524,-28.410008400381905],[-57.80500011697738,-28.450103607036517],[-57.86294498978907,-28.501996120019122],[-57.94940820940123,-28.573486149776805],[-58.020431493585164,-28.624361210838266],[-58.13570965499463,-28.675551148158128],[-58.27981550208894,-28.740755226393794],[-58.32177559395916,-28.78151974669749],[-58.41659474080187,-28.828952172826483],[-58.49688199874063,-28.89481231012779],[-58.52541116467003,-28.918022054059975]]],type:"Polygon"}},{type:"Feature",properties:{place:"aguapey-river-basin",continent:"South America"},geometry:{coordinates:[[[-56.39720246136214,-27.945110513518728],[-56.44866987510834,-28.032370231305563],[-56.54954600605123,-28.079606401332917],[-56.67924388869119,-28.168571948161038],[-56.72865260588782,-28.242955718492347],[-56.765709143784775,-28.384323119072448],[-56.71835912313844,-28.456746248819456],[-56.64556285399033,-28.579792105056463],[-56.64556285399033,-28.69385896561878],[-56.67092184345093,-28.768908381511487],[-56.63288335926059,-28.855009711563653],[-56.664582096086065,-28.899421244898086],[-56.601184622434545,-29.010366935420365],[-56.461710182655764,-28.952135269310375],[-56.517318608691326,-28.741436273166634],[-56.450751261357695,-28.46313324775391],[-56.22886010357881,-28.223204797344394],[-56.37238165086593,-28.24024420909436],[-56.23695431408869,-27.983435916189073],[-56.39720246136214,-27.945110513518728]]],type:"Polygon"}},{type:"Feature",properties:{place:"peninsula-valdes",continent:"South America"},geometry:{coordinates:[[[-64.62046217476252,-42.42697411441296],[-64.63015018687844,-42.49844395224354],[-64.5939783991759,-42.496598723182096],[-64.57565584208854,-42.491300639592716],[-64.53865146208817,-42.49818806073884],[-64.51853257375187,-42.50269096374748],[-64.50307507633386,-42.50048481265828],[-64.49553049400375,-42.499690178117724],[-64.45241859497462,-42.50710637443274],[-64.44451474681894,-42.50896028605478],[-64.43661089866377,-42.510284474978285],[-64.43158117711022,-42.510814142692695],[-64.40212137943995,-42.51796421752981],[-64.35721315128445,-42.53596818886371],[-64.35577608798316,-42.53173242713974],[-64.34392031575013,-42.5325266543457],[-64.31841244215775,-42.54787972847848],[-64.31014932817696,-42.55978899555437],[-64.3137419864292,-42.567727244376734],[-64.31086785982761,-42.57196056407448],[-64.30907153070126,-42.57831000490499],[-64.31014932817696,-42.584658799265945],[-64.30691593574979,-42.588361964095554],[-64.29865280930746,-42.582807141892346],[-64.29028319486507,-42.577780917062434],[-64.27950520410985,-42.57539994020323],[-64.26999406201362,-42.580955429884185],[-64.25706049230489,-42.59841231799998],[-64.26388654298432,-42.6021146657258],[-64.26843008217317,-42.60914064665139],[-64.27597466450324,-42.61548630087603],[-64.2691486138238,-42.621302582614916],[-64.26268182896891,-42.61918763393176],[-64.2511853225615,-42.61971637783778],[-64.24112587945433,-42.61442873673663],[-64.22567744896857,-42.61601507621055],[-64.2148994742113,-42.62209566984998],[-64.21238461343476,-42.63081896267286],[-64.22028846158993,-42.63663381210096],[-64.22675524644431,-42.65090432087629],[-64.2321442438869,-42.654867766630545],[-64.23681469961492,-42.66358646596124],[-64.2411258895178,-42.66517155267555],[-64.24435928194501,-42.67547363120602],[-64.2508260667999,-42.68154841552737],[-64.24543707942071,-42.71191342847784],[-64.26121746229857,-42.74409028295997],[-64.25367287996846,-42.767040299068256],[-64.23966174470148,-42.78681805685605],[-64.22744670664288,-42.80026326748679],[-64.21199827615712,-42.809752245718485],[-64.1969091114969,-42.827144925513686],[-64.19367571906973,-42.834522160132565],[-64.18038288353542,-42.84663999111344],[-64.15882693402082,-42.85875544543568],[-64.15667133906939,-42.86744550290126],[-64.1505638200401,-42.86797213373707],[-64.14409703518571,-42.87587105711647],[-64.12685227557405,-42.878767075725705],[-64.10385926275819,-42.880083402890286],[-64.08906800725704,-42.875209812108594],[-64.08044562745125,-42.87494652812853],[-64.0445190449266,-42.86599420447523],[-64.01793337385851,-42.86283425081678],[-64.00284420919829,-42.858620727668864],[-63.925961322595484,-42.84176375966372],[-63.91913526745378,-42.84439796552919],[-63.90426427727937,-42.837021909146024],[-63.87947493533714,-42.83596811502455],[-63.870493289706246,-42.83623156523986],[-63.8694154922305,-42.832279694083724],[-63.847141011065276,-42.82753711512329],[-63.84282982116238,-42.82859105300616],[-63.83672230213307,-42.82490219179579],[-63.8241479982494,-42.82437519365308],[-63.81049576555813,-42.82305740148225],[-63.809417968082386,-42.819895250882084],[-63.763072676625555,-42.81119850283006],[-63.74007966381019,-42.81172561328507],[-63.739361132159544,-42.81436109817662],[-63.724631233324416,-42.81119850283006],[-63.714931056042886,-42.80381848476595],[-63.707027207887194,-42.80434565811355],[-63.70127895468346,-42.79696482246338],[-63.68008227099399,-42.791955896835354],[-63.675771081091085,-42.78931945735054],[-63.66175971390659,-42.77956365480431],[-63.65098173914882,-42.777981487903745],[-63.6452334859451,-42.7711249641774],[-63.63301844788653,-42.7658501985964],[-63.62762946050786,-42.754771728813566],[-63.63337771371209,-42.74738498183822],[-63.63229991623636,-42.73946963316999],[-63.63732963778993,-42.73260884688053],[-63.634455511187824,-42.72126049613982],[-63.642718625168584,-42.71386975633022],[-63.637688903615,-42.69882160180184],[-63.62311704582086,-42.67839732148267],[-63.617728059686215,-42.66175543638103],[-63.61460964800126,-42.65356757046446],[-63.60850212897196,-42.644847466338305],[-63.60419093906903,-42.62793226484311],[-63.58394722836492,-42.61322896706666],[-63.58322869685014,-42.60556094208273],[-63.58827291633922,-42.598949818143716],[-63.583961726436286,-42.594189374589156],[-63.59042851129068,-42.585460950248255],[-63.588632182164275,-42.577789507728035],[-63.591865574591466,-42.56958795642897],[-63.60300281517432,-42.548682352531955],[-63.60264354934927,-42.520356000139394],[-63.599050891096454,-42.514000661713766],[-63.599410156921564,-42.50711498237182],[-63.60228428357544,-42.5049961555806],[-63.60551761824925,-42.452797418619404],[-63.60766812040529,-42.4189738865329],[-63.60084206972536,-42.36219079400396],[-63.59796794312376,-42.33085852027304],[-63.60987453873548,-42.29872985123146],[-63.63855659947987,-42.2555886966384],[-63.67340538452976,-42.22047860941781],[-63.69460206821924,-42.18641380960152],[-63.70322444802507,-42.16351620722977],[-63.711846832696125,-42.15019983376626],[-63.73743103137677,-42.098126347647145],[-63.757909183415634,-42.07599680941931],[-63.772639082250734,-42.07119661389584],[-63.80209887992096,-42.07039654601317],[-63.8574258170087,-42.07866342783958],[-63.942256763192646,-42.10396889251136],[-63.94549015561981,-42.11143184980104],[-63.9548310671201,-42.111165330767264],[-63.973153624207995,-42.11676199569794],[-63.98213526983888,-42.13168401933267],[-64.0015356244025,-42.13807809643433],[-64.01087653585847,-42.145803411634816],[-64.02955835877142,-42.145803411634816],[-64.02991762459654,-42.15299509916818],[-64.03961780187858,-42.1601859696328],[-64.0525513715873,-42.16444684063855],[-64.0561440298396,-42.16151752264573],[-64.0604552197425,-42.168174867389354],[-64.0798555743061,-42.176162756365876],[-64.10967488285799,-42.18335084240474],[-64.13230862984824,-42.19213535637947],[-64.17182787062565,-42.19985407303951],[-64.22320288363551,-42.208902402336456],[-64.33493455528718,-42.22832531938251],[-64.37840572014191,-42.23736957026045],[-64.37732792266617,-42.23923146103103],[-64.36583141625825,-42.24082732368121],[-64.35792756810307,-42.245614669463535],[-64.34571253004448,-42.244816803725804],[-64.32990483373361,-42.24986978298084],[-64.32487511218004,-42.24880603150944],[-64.31050447917052,-42.25252908317614],[-64.305834023442,-42.24827414904704],[-64.2968523778111,-42.24986978298084],[-64.2882299980053,-42.24401892789766],[-64.28068541567518,-42.24614657434999],[-64.27134450421872,-42.246944423270264],[-64.27314082273178,-42.243221035405654],[-64.26008995828086,-42.239141884745045],[-64.25470097090172,-42.23967384420123],[-64.24895271769802,-42.23621602757292],[-64.22991162895997,-42.24233357421508],[-64.21805585672692,-42.24286550676376],[-64.20727788196969,-42.24259954104962],[-64.18356633750315,-42.24898240874295],[-64.17566248934796,-42.24738675236258],[-64.16057332468729,-42.243663397178494],[-64.15446580565849,-42.23940786503333],[-64.1390173751727,-42.24392935840803],[-64.13470618526978,-42.23940786503333],[-64.10812051420166,-42.251109887798094],[-64.0987796027452,-42.25270544999936],[-64.07830145070633,-42.26227797558011],[-64.06141579340658,-42.27557051975936],[-64.05171561612501,-42.288860480390056],[-64.04524883127065,-42.3122440023387],[-64.04740442622209,-42.31622896367163],[-64.05099708447436,-42.322338747650846],[-64.05961946428071,-42.32552622552802],[-64.0700381732124,-42.33030713954891],[-64.06931964156226,-42.33668112635177],[-64.04524883127065,-42.347568526064386],[-64.04522755760006,-42.358480032576054],[-64.05025727915363,-42.36325844136821],[-64.06067598808585,-42.38316456636427],[-64.07109469733014,-42.38528751457585],[-64.07612441888318,-42.39032922744458],[-64.08510606451458,-42.39935022929506],[-64.09516550762122,-42.4022685110912],[-64.10378788742705,-42.40943099095583],[-64.12031411538854,-42.427201019630644],[-64.14043300160232,-42.427201019630644],[-64.15408510296167,-42.42163185097916],[-64.16845573597173,-42.42083621507237],[-64.17707811577758,-42.41738834280917],[-64.20150819189423,-42.41606218761121],[-64.21659735655443,-42.42163185097916],[-64.22593826801094,-42.41579695320611],[-64.28881002077117,-42.415000611609614],[-64.30066579300417,-42.40226787931182],[-64.31036597028572,-42.405186025407176],[-64.32006614756727,-42.411817670836164],[-64.33299971727654,-42.41234817218261],[-64.34485548950953,-42.424018066561054],[-64.35958538834468,-42.42640482286108],[-64.37395602135422,-42.42163121939406],[-64.38760812271362,-42.42826112605038],[-64.41419379378173,-42.429852199318255],[-64.42281617358805,-42.43807210115878],[-64.45191671984735,-42.43674639002906],[-64.47708701035266,-42.43762753984095],[-64.48390416052037,-42.42940527821113],[-64.47959297061746,-42.41853206178966],[-64.48462269217103,-42.41322736948054],[-64.49073021120033,-42.417736386548825],[-64.4925265403262,-42.42542749095759],[-64.49288580615179,-42.42940527821113],[-64.50725643916132,-42.42860974095332],[-64.5194714772199,-42.42754900890374],[-64.53815330013236,-42.425162296165865],[-64.54174595838514,-42.42091902693504],[-64.54569788518815,-42.42622306787034],[-64.55647585994546,-42.43179182867469],[-64.57264282208186,-42.42675344735671],[-64.57156502460614,-42.42144945056378],[-64.57946887276132,-42.421184238944875],[-64.5844985943149,-42.427549008172896],[-64.59922849315,-42.42410150505063],[-64.61180279703368,-42.42595787644404],[-64.61862884771313,-42.4182668371007],[-64.62046217476252,-42.42697411441296]]],type:"Polygon"}},{type:"Feature",properties:{place:"lago-la-plata",continent:"South America"},geometry:{coordinates:[[[-71.66806234950059,-44.854609256146965],[-71.67572556420194,-44.8479569336756],[-71.67395673492602,-44.84607580421949],[-71.6642281739076,-44.840118488994555],[-71.65914278973838,-44.83870745568604],[-71.66511258854526,-44.83212217668116],[-71.66975576932903,-44.830867753769965],[-71.68070613922222,-44.831651772333196],[-71.68313827947732,-44.837609962964386],[-71.68977138926272,-44.838550673593566],[-71.69662560270787,-44.83729638934235],[-71.70104767589795,-44.83980493054256],[-71.71387168814996,-44.83525811920057],[-71.7238213528281,-44.83572849563197],[-71.7289067369967,-44.837609962964386],[-71.7472583413538,-44.83337657435718],[-71.75608176609262,-44.83305208663491],[-71.76404149783512,-44.830856861822014],[-71.77642330276834,-44.833365683354096],[-71.7775288229102,-44.83179768189523],[-71.78615186563125,-44.83117046968595],[-71.78858400588632,-44.83446325763181],[-71.78261420707945,-44.83587439487265],[-71.79212166443814,-44.838853348903584],[-71.79256387175758,-44.84198892361053],[-71.80273464009542,-44.84167537381858],[-71.80980995719968,-44.84590815202495],[-71.81290540843266,-44.84245924509797],[-71.82285507311143,-44.836501555888574],[-71.82440279872762,-44.84120504593196],[-71.82705604264177,-44.845124327672856],[-71.83634239634137,-44.84841631828113],[-71.83567908536283,-44.85311883564963],[-71.83899564025552,-44.85703730682745],[-71.8381112256179,-44.86205256086436],[-71.84120667685087,-44.86408988303251],[-71.84695537199866,-44.863306306114815],[-71.84939967673682,-44.86625177739434],[-71.84845084835034,-44.868672680850295],[-71.85205639621769,-44.87190039374178],[-71.85680053814833,-44.87297625781418],[-71.86287303981918,-44.87109348248851],[-71.86913530716744,-44.87297625781418],[-71.86894554149055,-44.875934780311894],[-71.88461471896608,-44.870830666544315],[-71.89106675199112,-44.86598893934189],[-71.89106675199112,-44.861146804868994],[-71.89543136256752,-44.858053005736075],[-71.8969494879851,-44.85522808743004],[-71.90264245830168,-44.85280661858009],[-71.90340152101072,-44.85522808743004],[-71.90093456771577,-44.857783971874994],[-71.90921577782953,-44.85509356405833],[-71.917565467627,-44.853882839532695],[-71.9190835930451,-44.85092318353104],[-71.92136078117173,-44.85119224945278],[-71.92477656336168,-44.85522808743455],[-71.92724351716518,-44.85859106970504],[-71.93900898915311,-44.85630426313041],[-71.94223500566565,-44.85280661858465],[-71.9431838400722,-44.850385047286814],[-71.95651971184044,-44.838570647835674],[-71.95936619699874,-44.840992715189415],[-71.96581823591214,-44.83776326809796],[-71.97321909732366,-44.83762870392953],[-71.97891206764025,-44.82888135892193],[-71.98434031576463,-44.82227008011161],[-71.9896537547264,-44.820654855231396],[-71.99572625639777,-44.819443406874285],[-72.00179876228466,-44.82159707423881],[-72.00824302056863,-44.82702391699567],[-72.00387840999277,-44.83025396461983],[-72.00368864431536,-44.83456041321775],[-72.0031193472837,-44.838597416525424],[-71.99401059477717,-44.8411540390036],[-71.99040504527512,-44.84075036925206],[-71.98525350260114,-44.84182870158481],[-71.98278654879763,-44.84882511158871],[-71.97956053228458,-44.85366828227962],[-71.97519592170872,-44.85528258200557],[-71.96646670055644,-44.854744487125195],[-71.95792724516008,-44.86039423262956],[-71.95375240026164,-44.86093227471568],[-71.95185474348925,-44.86496743009512],[-71.93970973020029,-44.87048167741846],[-71.93287816582043,-44.87290240297166],[-71.928513555244,-44.876802246644225],[-71.92244105357315,-44.87922270633993],[-71.91636855190181,-44.88258428700663],[-71.9165583175792,-44.88527341012641],[-71.9116244099717,-44.891323477550074],[-71.90270542307236,-44.89589421801746],[-71.8944555759554,-44.89661764328318],[-71.8893319026705,-44.8976930451977],[-71.88060268151825,-44.89392905050726],[-71.87566877391069,-44.89406348313158],[-71.86750884979011,-44.88949259761131],[-71.85877962863785,-44.88586251797035],[-71.85915915999267,-44.88855148785004],[-71.86067728582417,-44.89124033170867],[-71.86029775446993,-44.89258470666001],[-71.85991822311514,-44.89769304487714],[-71.8540354871217,-44.89796189221262],[-71.84758345409608,-44.8963487893413],[-71.84492673461463,-44.89312244784119],[-71.83316126262721,-44.89083701309491],[-71.83335102830463,-44.88855148752942],[-71.83581798210813,-44.88774480976401],[-71.83088407450062,-44.88666922181169],[-71.82061136284949,-44.879017890876796],[-71.8152979238877,-44.87995915661207],[-71.80087573241886,-44.873504453774366],[-71.7921465112666,-44.873504453774366],[-71.78930002361695,-44.872697566090295],[-71.78218877619473,-44.872697566454214],[-71.77801393129573,-44.87054580777674],[-71.76890517878921,-44.87283204870059],[-71.75846802679315,-44.866779918066094],[-71.75353411918506,-44.86113079920621],[-71.74803091454592,-44.85965117647202],[-71.74442536667857,-44.86153432608032],[-71.74252770990618,-44.86408993060208],[-71.73759380229868,-44.86785587785596],[-71.72962364385546,-44.86758688979379],[-71.72848505075937,-44.86556943719888],[-71.73099854733539,-44.862442885427136],[-71.72758276514543,-44.862442885427136],[-71.72644417108214,-44.860290743381604],[-71.72037166941075,-44.860021719969104],[-71.72511581134142,-44.86580544631978],[-71.71499635111144,-44.865318569176694],[-71.70538224474322,-44.86843752651478],[-71.69659011233746,-44.86878639558669],[-71.68460341904562,-44.86761592612288],[-71.67405569614648,-44.8658202093809],[-71.67086925714614,-44.862904891465256],[-71.66806234950059,-44.854609256146965]]],type:"Polygon"},id:5},{type:"Feature",properties:{place:"bahia-lomas",continent:"South America"},geometry:{coordinates:[[[-69.3245820834581,-52.55199732290134],[-69.31891202604767,-52.57117799553636],[-69.31087096001745,-52.57628700361329],[-69.31013995401449,-52.58139541641649],[-69.28674776192567,-52.61158951842267],[-69.26481758184273,-52.62934103532689],[-69.23208379625925,-52.663902367564035],[-69.19931658424535,-52.67916105389842],[-69.16390767139428,-52.68989355188649],[-69.12718731699975,-52.70141811174221],[-69.09112268354018,-52.69744446914785],[-69.07407394772268,-52.691085888537096],[-69.05112372643,-52.68114875219911],[-69.02686206392077,-52.66325620809854],[-68.98489594498554,-52.6560971386996],[-68.97112581221009,-52.65768814433987],[-68.95210991456801,-52.65848362544573],[-68.93571689935902,-52.65808588670173],[-68.92129104597514,-52.65211937126808],[-68.89637366285737,-52.640979697039974],[-68.86489907365595,-52.63302104952555],[-68.83211304323797,-52.627449134762756],[-68.7999827334285,-52.621876510483325],[-68.77178674726916,-52.6063490298484],[-68.76391809996844,-52.597985797743085],[-68.77440962970225,-52.58762910745613],[-68.7789996739609,-52.57886384207176],[-68.76654093912445,-52.56531406556007],[-68.76105409983674,-52.54643000882374],[-68.76302126166179,-52.54244227046917],[-68.80498738059656,-52.52209916915873],[-68.86137935291575,-52.46900320925423],[-68.97416329755312,-52.46380993860636],[-69.12869661350022,-52.420612742143504],[-69.20362106924945,-52.41840171233264],[-69.34125888322994,-52.43019258023433],[-69.37509573342302,-52.441243655546934],[-69.40168183000338,-52.45229195961309],[-69.38718032277703,-52.46922731078869],[-69.38355494597066,-52.4824765201683],[-69.35817730832605,-52.506756377233614],[-69.34246734216482,-52.52440603547828],[-69.3245820834581,-52.55199732290134]]],type:"Polygon"}}]};const x={"ibera-wetlands-area":{country:"argentina",subtitle:"REWILDING ARGENTINA AND TOMPKINS CONSERVATION",lat:"-55.002782764594525",lng:"-28.54128036630737",zoom:"6.5",images:["/images/journal-ibera-slider-1.jpg","/images/journal-ibera-slider-2.jpg","/images/journal-ibera-slider-3.jpg","/images/journal-ibera-slider-4.jpg","/images/journal-ibera-slider-5.jpg","/images/journal-ibera-slider-6.jpg","/images/journal-ibera-slider-7.jpg"],continent:"South America",defaultLocation:"Iber National Park",read:"/images/journal-ibera-slider-read.jpg",readLink:"/journal/jaguar-rewilding-argentina-and-tompkins-conservation/",content:"The Iber wetland is the second largest in the world, and it harbors almost 30% of Argentinas total biodiversity. Following a multi-decade effort by local and international NGOs working alongside local and national governments, this powerful spot became a national park in late 2018. For more information on conservation work being carried out there, visit <a target='_blank' href='http://www.rewildingargentina.org/'>rewildingargentina</a> and <a target='_blank' href='https://www.tompkinsconservation.org/'>tompkinsconservation</a>."},"santa-cruz-area":{country:"argentina",subtitle:"REWILDING ARGENTINA",lat:"-64.15689204675418",lng:"-48.6049241486501",zoom:"5.5",images:["/images/patagonia-slider-1.jpg","/images/patagonia-slider-2.jpg","/images/patagonia-slider-3.jpg","/images/patagonia-slider-4.jpg","/images/patagonia-slider-5.jpg","/images/patagonia-slider-6.jpg","/images/patagonia-slider-7.jpg"],continent:"South America",defaultLocation:"Patagonia National Park",read:"/images/patagonia-slider-read.jpg",readLink:"/journal/patagonia-national-park-rewilding-argentina/",content:"This impressive area houses the only extra-Andean glacier in Argentina, countless mountains, steppe, rivers and lakes, as well as most of the habitat of the precious and endemic Hooded grebe (Podiceps gallardoi), and all the rest of the typical patagonian wildlife. For more information on conservation work being carried out there, visit <a target='_blank' href='http://www.rewildingargentina.org/'>rewildingargentina</a>, <a target='_blank' href='https://www.tompkinsconservation.org/'>tompkinsconservation</a> and <a target='_blank' href='https://avesargentinas.org.ar/'>avesargentinas</a>."},"torres-del-paine-area":{country:"chile",subtitle:"Fundacin Cerro Guido and Panthera",lat:"-72",lng:"-50.9049241486501",zoom:"7.8",images:["/images/torres-del-paine.jpg","/images/torres-del-paine-1.jpg","/images/torres-del-paine-2.jpg","/images/torres-del-paine-3.jpg","/images/torres-del-paine-4.jpg","/images/torres-del-paine-5.jpg","/images/torres-del-paine-6.jpg"],continent:"South America",defaultLocation:"Torres del Paine",read:"/images/torres-del-paine-read.jpg",readLink:"/journal/puma-fundacion-cerro-guido-and-panthera/",content:"Internationally recognised as one of the most beautiful spots on Earth; full of rivers, mountains and glaciers, it is also said to harbor the biggest Puma (Puma concolor) population in the world. For more information on conservation work being carried out there, visit <a target='_blank' href='www.fundacioncgc.com'>fundacioncgc</a> and <a target='_blank' href='https://panthera.org/'>panthera</a>."},"andalucia-area":{country:"spain",subtitle:"CBD HABITAT AND IBERLINCE",lat:"1.9",lng:"39.07",zoom:"5.3",images:["/images/andalucia-slider-1.jpg","/images/andalucia-slider-2.jpg","/images/andalucia-slider-3.jpg","/images/andalucia-slider-4.jpg","/images/andalucia-slider-5.jpg","/images/andalucia-slider-6.jpg","/images/andalucia-slider-7.jpg"],continent:"Europe",defaultLocation:"Castilla de la Mancha/Andalucia",read:"/images/andalucia-read.jpg",readLink:"/lynx-cbd-habitat-and-iberlince/",content:"The Iberian Peninsula harbors about 50% of European plant and terrestrial vertebrate species and more than 30% of European endemic species. It is also home to the most endangered cat in the world, the Iberian lynx (Lynx pardinus). For more information on conservation work being carried out there, visit <a target='_blank' href='https://www.cbd-habitat.com/'>cbd-habitat</a> and <a target='_blank' href='https://www.lifelynxconnect.eu/'>lifelynxconnect</a>."},"aguapey-river-basin":{country:"argentina",subtitle:"province of corrientes, Argentina",lat:"-55.5",lng:"-28.268396793825374",zoom:"8",images:["/images/journal-ibera-slider-1.jpg","/images/journal-ibera-slider-2.jpg","/images/journal-ibera-slider-3.jpg","/images/journal-ibera-slider-4.jpg"],continent:"South America",defaultLocation:"Aguapey River Basin",read:"/images/field-journals-read.jpg",readLink:"/journal/patagonia-national-park-rewilding-argentina/#",content:"The Aguapey River basin is one of the most biodiverse regions in Argentina and at the same time the least protected. The landscape is characterized by a matrix of natural grasslands with a rich variety of wetlands, palm groves and forests. This mosaic of pampas, wetlands and Atlantic forest, generates an extraordinary diversity, with the presence of numerous endangered and exclusive species. Conservation initiatives are being born to preserve at least part of this amazing hotspot. For more information, visit <a target='_blank' href='http://datazone.birdlife.org/index.php/site/factsheet/19437'>birdlife</a>."},"peninsula-valdes":{country:"argentina",subtitle:"PUNTA NORTE ORCA RESEARCH",lat:"-63",lng:"-42.46334337165947",zoom:"7.8",images:["/images/journal-ibera-slider-1.jpg","/images/journal-ibera-slider-2.jpg","/images/journal-ibera-slider-3.jpg","/images/journal-ibera-slider-4.jpg"],continent:"South America",defaultLocation:"Peninsula Valdes",read:"/images/field-journals-read.jpg",readLink:"/journal/patagonia-national-park-rewilding-argentina/#",content:"Pennsula Valds in Patagonia is a site of global significance for the conservation of marine mammals. It is home to an important breeding population of the endangered southern right whale as well as important breeding populations of southern elephant seals and southern sea lions. The orcas in this area have developed a unique hunting strategy to adapt to local coastal conditions. For more information on conservation work being carried out there, visit <a target='_blank' href='https://www.pn-orca.org/'>www.pn-orca.org</a>."},"lago-la-plata":{country:"argentina",subtitle:"southern Patagonia, argentina",lat:"-71",lng:"-44.6049241486501",zoom:"8",images:["/images/journal-ibera-slider-1.jpg","/images/journal-ibera-slider-2.jpg","/images/journal-ibera-slider-3.jpg","/images/journal-ibera-slider-4.jpg"],continent:"South America",defaultLocation:"Lago la Plata",read:"/images/field-journals-read.jpg",readLink:"/journal/patagonia-national-park-rewilding-argentina/#",content:"Located in Southern Patagonia, Argentina, La Plata Lakes surface is 14,000 hectares. It is sorrounded by a wide range of mountains of different altitudes and teeming patagonian andean forests which make it a precious habitat for a huge variety of biodiversity and particularly the endangered Huemul (Hippocamelus bisulcus). For more information on conservation work being carried out there, visit <a target='_blank' href='https://www.shoonem.ch/'>www.shoonem.ch</a>."},"bahia-lomas":{country:"argentina",subtitle:"tIERRA DEL FUEGO, CHILE",lat:"-68.25689204675418",lng:"-52.6049241486501",zoom:"8",images:["/images/journal-ibera-slider-1.jpg","/images/journal-ibera-slider-2.jpg","/images/journal-ibera-slider-3.jpg","/images/journal-ibera-slider-4.jpg"],continent:"South America",defaultLocation:"Bahia Lomas",read:"/images/field-journals-read.jpg",readLink:"/journal/patagonia-national-park-rewilding-argentina/#",content:"Located on the northern chilean side of the Tierra del Fuego Island, Ramsar's second southernmost site lies on the border with Argentina and faces the Magellan Strait. The bay is renowned for its high concentrations of migratory shorebirds from October to March. Large cetaceans have frequently stranded in the flats. The impact of pollution from oil spills and the upcoming green hydrogen industry is big a concern for the greater Magellanic regions ecosystems. For more information on conservation work being carried out there, visit <a target='_blank' href='http://www.bahialomas.cl/'>www.bahialomas.cl</a>."}};ai.addSource("polygons",{type:"geojson",data:y}),ai.addSource("initialPoints",{type:"geojson",data:E}),ai.addLayer({id:"initialPoints",type:"symbol",source:"initialPoints",layout:{}}),ai.addLayer({id:"polygons",type:"fill",source:"polygons",layout:{},paint:{"fill-color":"#222","fill-opacity":.5}}),ai.addLayer({id:"outline",type:"line",source:"polygons",layout:{},paint:{"line-color":"#fff","line-width":.5}});for(const Ve of E.features){const Ze=document.createElement("div");Ze.className="marker initial";var k=Ve.properties.place,O=Ve.properties.name;k.replace(/\s+/g,"-").toLowerCase();var Q=document.createElement("div");Q.className="initialPlace "+k+" marker",Q.style.backgroundImage=`url(/images/WAWsiteJC-${k}.png)`,Q.style.backgroundRepeat="no-repeat",Ze.appendChild(Q),Q.innerHTML=`<div class="place-data" data-name="${k}">${O}</div>`;var ae=document.createElement("img");Q.appendChild(ae),ae.src="/images/pin.png";let Ft=new xd.Marker(Q,{anchor:"center",offset:[0,-40]}).setLngLat(Ve.geometry.coordinates).addTo(ai);Ft.getElement().addEventListener("click",Ct=>{console.log(Ve),o(Ve.properties.place)}),Ft.getElement().addEventListener("touchstart",Ct=>{console.log(Ve),o(Ve.properties.place)})}function o(Ve){console.log(Ve);var Ze=Ve;if(console.log(x[Ze]),x[Ze].isActive)return!1;re(Ze),Ge(Ze),We(),x[Ze].isActive=!0;var Ft=x[Ze].continent,rt=document.getElementsByClassName("popup-inner");$(".initialPlace").addClass("hidden"),$(".initialPlace."+Ze).removeClass("hidden"),$(".initial").addClass("hidden"),$(".popup").addClass("open"),$(".popup .images").show(),$(".back").show(),$(".continent-wrap").hide(),$(`.${Ze}.popup-text`).show(),ai.scrollZoom.disable(),ai.dragPan.disable(),ai.touchZoomRotate.disable();var Ct=document.getElementById("back");Ct.innerHTML=`back to ${Ft}`,Ct.className=`${Ft}`.toLowerCase();var rt=$(".popup-inner");rt.attr("id",`${Ze}`),console.log("true"),$("#"+Ze+".popup-inner").slideDown();var Ne=x[Ze].defaultLocation,at=x[Ze].subtitle,St=x[Ze].content,Se=x[Ze].read,dt=x[Ze].readLink,Pi=document.getElementsByClassName("title");Pi[0].innerHTML=`${Ne}`;var kt=document.getElementsByClassName("subtitle");kt[0].innerHTML=`${at}`;var gt=document.getElementsByClassName("journal-read");gt[0].href=dt;var ei=gt[0].childNodes[0].nextSibling;ei.src=Se;var rr=document.getElementsByClassName("popup-text"),Tr=document.getElementsByClassName("coming-soon");rr[0].className=`popup-text ${Ze}`,Tr[0].className=`coming-soon ${Ze}`,rr[0].innerHTML=`${St}`,$("."+Ze+".popup-text").slideDown()}function re(Ve){var Ze=Ve,Ft=x[Ze].images;console.log(x[Ve]);var Ct=$("#slider");for(const rt of Ft)$(".slider.images").slick("slickAdd",'<img style="width: 100%;" src='+rt+">");Ct.slick("refresh")}ai.on("click","polygons",Ve=>{o(Ve.features[0].properties.place)}),$(".back").on("click",function(Ve){We(),$(".popup").removeClass("open"),$(".animal").removeClass("visible"),$(".initialPlace").removeClass("hidden"),$(".initial").removeClass("hidden"),$(".back").hide(),ai.setMinZoom(2),$(".continent-wrap").show(),$(".popup-inner").slideUp(),$(".popup-text").hide(),$(".popup .images").hide(),ai.scrollZoom.enable(),ai.dragPan.enable(),ai.touchZoomRotate.enable({around:"center"});var Ze=document.getElementById("back");Ze.innerHTML=" ",$(".slider.images").slick("removeSlide",null,null,!0),Ze.classList.contains("europe")&&(console.log("test eu"),Ce()),Ze.classList.contains("america")&&Xe();var Ft=$("#slider");Ft.slick("refresh")}),$(".continents .continent-name").on("click",function(){$(".continents .continent-name").removeClass("active");var Ve=$(this).children("h2").text();$(".current-continent h2").text(Ve),$(this).addClass("active");var Ze=$(this).children("p").html();console.log(Ze),$(".continent-info .swap-text").html(Ze);var Ft=$(".continents h2").attr("id");$(".continents .continent-name h2").addClass(`${Ft}`)});function Ce(){ai.flyTo({center:[-4.657511208316919,39.70934455996375],zoom:5.5,bearing:0,speed:1,curve:1,easing:Ve=>Ve,essential:!0})}$("#europe").on("click",function(Ve){console.log("click"),Ce()});function Xe(){ai.flyTo({center:[-45.37257355955616,-21.968033674683838],zoom:2.5,bearing:0,speed:1,curve:1,easing:Ve=>Ve,essential:!0})}$("#south-america").on("click",function(Ve){Xe()});function Ge(Ve){var Ze=Ve,Ft=x[Ze].lat,Ct=x[Ze].lng,rt=x[Ze].zoom;ai.flyTo({center:[Ft,Ct],zoom:rt,bearing:0,speed:1,curve:1,easing:Ne=>Ne,essential:!0})}function We(){Object.keys(x).forEach(Ve=>{let Ze=x[Ve];Ze.isActive=!1})}});$(".slider").slick({dots:!1,infinite:!0,cssEase:"linear",slidesToScroll:1,slidesToShow:3,prevArrow:$(".prev"),nextArrow:$(".next")});const ix=120,hd=5,k_=3;let ol=!1,xh=!1;function Ws(){const E=ai.getZoom();if(xh&&!ol&&E<hd){let y=360/ix;if(E>k_){const k=(hd-E)/(hd-k_);y*=k}const x=ai.getCenter();x.lng-=y,ai.easeTo({center:x,duration:1e3,easing:k=>k})}}ai.on("mousedown",()=>{ol=!0});ai.on("mouseup",()=>{ol=!1,Ws()});ai.on("dragend",()=>{ol=!1,Ws()});ai.on("pitchend",()=>{ol=!1,Ws()});ai.on("rotateend",()=>{ol=!1,Ws()});ai.on("moveend",()=>{Ws()});ai.on("dblclick",E=>{console.log(E)});ai.on("click",E=>{console.log(E)});ai.doubleClickZoom.disable();document.getElementById("btn-spin").addEventListener("click",E=>{xh=!xh,xh?(Ws(),E.target.innerHTML="Pause rotation"):(ai.stop(),E.target.innerHTML="Start rotation")});Ws();$(".hamburger").on("click",function(){$(this).toggleClass("open"),$(".site-content").toggleClass("open"),$(".nav-menu").toggleClass("open"),$("body").toggleClass("fixed")});$(".inview-fadeUp").on("inview",function(E,y){y&&$(this).addClass("fadeUp")});$(".portfolio-item").on("click",function(){var E=$(this).data("name"),y="."+E;$(".port-popup"),$(y).addClass("open"),$("body").addClass("fixed")});$(".x").on("click",function(){$(".port-popup").removeClass("open"),$("body").removeClass("fixed")});$("body.fixed").on("click",function(){$("body").removeClass("fixed"),$(".port-popup").removeClass("open")});$(".nav-name").on("mouseover",function(){$(".animate").removeClass("active");var E=$(this).data("name"),y="."+E;$(y).addClass("active")});$(".nav-name").on("mouseleave",function(){$(".animate").removeClass("active"),$(".home").addClass("active")});var yh={y:window.pageYOffset},rx=E=>{var y=yh.y;yh={y:window.pageYOffset},yh.y>5?(document.body.classList.add("scrolled"),y>=yh.y?document.body.classList.add("scrolled-up"):document.body.classList.remove("scrolled-up")):document.body.classList.remove("scrolled","scrolled-up")};window.onscroll=rx;
//# sourceMappingURL=index-6b7f46f4.js.map
